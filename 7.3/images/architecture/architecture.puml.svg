<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1244px" preserveAspectRatio="none" style="width:1213px;height:1244px;" version="1.1" viewBox="0 0 1213 1244" width="1213px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rnj3khoa36a0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="222" x="489.25" y="20.4209">Stroom Architecture</text><text fill="#000000" font-family="sans-serif" font-size="20" font-weight="bold" lengthAdjust="spacing" textLength="582" x="309.25" y="44.1738">Example Two-Node Cluster (non-containerised deployment)</text><!--MD5=[69835acb3ac942e850dee7a03f5c945e]
cluster Stroom Cluster--><rect fill="#FFFFFF" filter="url(#f1rnj3khoa36a0)" height="552" style="stroke:#000000;stroke-width:1.5;" width="854" x="347.5" y="350.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="106" x="721.5" y="365.8857">Stroom Cluster</text><!--MD5=[30dfab3f8db4706d4981cd1d50ba2d4e]
cluster Stroom Node #1--><rect fill="#FFFFFF" filter="url(#f1rnj3khoa36a0)" height="328" rx="35" ry="35" style="stroke:#000000;stroke-width:1.5;" width="391" x="786.5" y="393.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="113" x="925.5" y="413.8857">Stroom Node #1</text><!--MD5=[d00117b4069ea71897f541f7691e2432]
cluster Stroom Node #2--><rect fill="#FFFFFF" filter="url(#f1rnj3khoa36a0)" height="290" rx="35" ry="35" style="stroke:#000000;stroke-width:1.5;" width="391" x="371.5" y="588.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="113" x="510.5" y="608.8857">Stroom Node #2</text><!--MD5=[fa6e3a9222af9f8270524df4a8c73c70]
cluster stroom_all_dbs--><rect fill="#FFFFFF" filter="url(#f1rnj3khoa36a0)" height="115" rx="35" ry="35" style="stroke:#000000;stroke-width:1.5;" width="185" x="762.5" y="973.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="94" x="808" y="993.3857">MySQL Server</text><!--MD5=[c07ac153e7bb18a80ecfb47246163a7c]
cluster shared_storage--><rect fill="#FFFFFF" filter="url(#f1rnj3khoa36a0)" height="142" rx="35" ry="35" style="stroke:#000000;stroke-width:1.5;" width="378" x="322.5" y="959.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="104" x="459.5" y="979.8857">Shared Storage</text><!--MD5=[b9096da1645c91f8466a9bd0cd7035dc]
entity stroom_node_1--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="802.5,652.8906,812.5,642.8906,924.5,642.8906,924.5,695.4844,914.5,705.4844,802.5,705.4844,802.5,652.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="914.5" x2="924.5" y1="652.8906" y2="642.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="802.5" x2="914.5" y1="652.8906" y2="652.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="914.5" x2="914.5" y1="652.8906" y2="705.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="66" x="825.5" y="675.8857">«java app»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="817.5" y="692.1826">Stroom node</text><!--MD5=[3e9365249b8817ef9d95bc5a75def637]
entity stroom_proxy_local_1--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="999.5,457.8906,1009.5,447.8906,1161.5,447.8906,1161.5,500.4844,1151.5,510.4844,999.5,510.4844,999.5,457.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1151.5" x2="1161.5" y1="457.8906" y2="447.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="999.5" x2="1151.5" y1="457.8906" y2="457.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="1151.5" x2="1151.5" y1="457.8906" y2="510.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="66" x="1042.5" y="480.8857">«java app»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="1014.5" y="497.1826">Local Stroom proxy</text><!--MD5=[d02999996b546895e3eb05b9a058dd1a]
entity log_sender_script_1--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="803,457.8906,813,447.8906,964,447.8906,964,500.4844,954,510.4844,803,510.4844,803,457.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="954" x2="964" y1="457.8906" y2="447.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="803" x2="954" y1="457.8906" y2="457.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="954" x2="954" y1="457.8906" y2="510.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="50" x="853.5" y="480.8857">«script»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="818" y="497.1826">send_to_stroom.sh</text><!--MD5=[2d5fbc2f3570ea99d73a97e0f8a1e25d]
entity stroom_node_2--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="475.5,809.8906,485.5,799.8906,597.5,799.8906,597.5,852.4844,587.5,862.4844,475.5,862.4844,475.5,809.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="587.5" x2="597.5" y1="809.8906" y2="799.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="475.5" x2="587.5" y1="809.8906" y2="809.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="587.5" x2="587.5" y1="809.8906" y2="862.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="66" x="498.5" y="832.8857">«java app»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="490.5" y="849.1826">Stroom node</text><!--MD5=[21829a3036b3eabf91931433e2e8d034]
entity stroom_proxy_local_2--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="387.5,652.8906,397.5,642.8906,549.5,642.8906,549.5,695.4844,539.5,705.4844,387.5,705.4844,387.5,652.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="539.5" x2="549.5" y1="652.8906" y2="642.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="387.5" x2="539.5" y1="652.8906" y2="652.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="539.5" x2="539.5" y1="652.8906" y2="705.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="66" x="430.5" y="675.8857">«java app»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="402.5" y="692.1826">Local Stroom proxy</text><!--MD5=[d1f57ca1c795b1811524610ae80b4efb]
entity log_sender_script_2--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="585,652.8906,595,642.8906,746,642.8906,746,695.4844,736,705.4844,585,705.4844,585,652.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="736" x2="746" y1="652.8906" y2="642.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="585" x2="736" y1="652.8906" y2="652.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="736" x2="736" y1="652.8906" y2="705.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="50" x="635.5" y="675.8857">«script»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121" x="600" y="692.1826">send_to_stroom.sh</text><!--MD5=[40b2f2205cc740157f5e31447dce3a90]
entity stroom_db--><path d="M778.5,1037.3906 C778.5,1027.3906 811.5,1027.3906 811.5,1027.3906 C811.5,1027.3906 844.5,1027.3906 844.5,1037.3906 L844.5,1062.6875 C844.5,1072.6875 811.5,1072.6875 811.5,1072.6875 C811.5,1072.6875 778.5,1072.6875 778.5,1062.6875 L778.5,1037.3906 " fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" style="stroke:#000000;stroke-width:1.5;"/><path d="M778.5,1037.3906 C778.5,1047.3906 811.5,1047.3906 811.5,1047.3906 C811.5,1047.3906 844.5,1047.3906 844.5,1037.3906 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="788.5" y="1064.3857">stroom</text><!--MD5=[4556cb27c697ea38b95df37aa8ac3618]
entity stroom_stats_db--><path d="M880,1037.3906 C880,1027.3906 905.5,1027.3906 905.5,1027.3906 C905.5,1027.3906 931,1027.3906 931,1037.3906 L931,1062.6875 C931,1072.6875 905.5,1072.6875 905.5,1072.6875 C905.5,1072.6875 880,1072.6875 880,1062.6875 L880,1037.3906 " fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" style="stroke:#000000;stroke-width:1.5;"/><path d="M880,1037.3906 C880,1047.3906 905.5,1047.3906 905.5,1047.3906 C905.5,1047.3906 931,1047.3906 931,1037.3906 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="890" y="1064.3857">stats</text><!--MD5=[3aa2f070d8590b17efbc8fd0778953a5]
entity stroom-node-2--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="538.5,1021.8906,584.5,1021.8906,591.5,1042.8906,676.5,1042.8906,676.5,1077.4844,538.5,1077.4844,538.5,1021.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="538.5" x2="591.5" y1="1042.8906" y2="1042.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="548.5" y="1062.8857">stroom-node-2</text><!--MD5=[c86d8d2880027dacc031ad5f1c419d1c]
entity stroom-node-1--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="365.5,1021.8906,411.5,1021.8906,418.5,1042.8906,503.5,1042.8906,503.5,1077.4844,365.5,1077.4844,365.5,1021.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="365.5" x2="418.5" y1="1042.8906" y2="1042.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="375.5" y="1062.8857">stroom-node-1</text><!--MD5=[c33e4d02d4290125d1c94e5600aa671b]
entity event_producer--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="371.5,64.8906,381.5,54.8906,511.5,54.8906,511.5,107.4844,501.5,117.4844,371.5,117.4844,371.5,64.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="501.5" x2="511.5" y1="64.8906" y2="54.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="371.5" x2="501.5" y1="64.8906" y2="64.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="501.5" x2="501.5" y1="64.8906" y2="117.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="394.5" y="87.8857">«application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="386.5" y="104.1826">Event generator</text><!--MD5=[3677200128df26b0ab79a654f7c368fe]
entity ui_client_browser--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="16,219.8906,26,209.8906,151,209.8906,151,262.4844,141,272.4844,16,272.4844,16,219.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="141" x2="151" y1="219.8906" y2="209.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="16" x2="141" y1="219.8906" y2="219.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="141" x2="141" y1="219.8906" y2="272.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="95" x="31" y="242.8857">«web browser»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="63.5" y="259.1826">User</text><!--MD5=[2de77eb5f4a5ea603a06f959b37fb769]
entity api_client_app--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="186.5,219.8906,196.5,209.8906,310.5,209.8906,310.5,262.4844,300.5,272.4844,186.5,272.4844,186.5,219.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="300.5" x2="310.5" y1="219.8906" y2="209.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="186.5" x2="300.5" y1="219.8906" y2="219.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="300.5" x2="300.5" y1="219.8906" y2="272.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="201.5" y="242.8857">«application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="212.5" y="259.1826">API client</text><!--MD5=[fe6f05c8cee4bc5bf69b8554e9ede833]
entity remote_proxy--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="345.5,219.8906,355.5,209.8906,537.5,209.8906,537.5,262.4844,527.5,272.4844,345.5,272.4844,345.5,219.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="527.5" x2="537.5" y1="219.8906" y2="209.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="345.5" x2="527.5" y1="219.8906" y2="219.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="527.5" x2="527.5" y1="219.8906" y2="272.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="394.5" y="242.8857">«application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="360.5" y="259.1826">Upstream Stroom proxy</text><!--MD5=[8824c66cba45be527cf3dd56bcd70cd2]
entity nginx--><polygon fill="#FEFECE" filter="url(#f1rnj3khoa36a0)" points="166,457.8906,176,447.8906,331,447.8906,331,500.4844,321,510.4844,166,510.4844,166,457.8906" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="321" x2="331" y1="457.8906" y2="447.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="166" x2="321" y1="457.8906" y2="457.8906"/><line style="stroke:#000000;stroke-width:1.5;" x1="321" x2="321" y1="457.8906" y2="510.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="201.5" y="480.8857">«web server»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="181" y="497.1826">Nginx load balancer</text><!--MD5=[1a9fb849602c0162fc28231b56db8ba7]
link log_sender_script_1 to nginx--><path d="M802.88,479.3906 C683.31,479.3906 459.83,479.3906 336.27,479.3906 " fill="none" id="log_sender_script_1-to-nginx" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="331.19,479.3906,340.19,483.3906,336.19,479.3906,340.19,475.3906,331.19,479.3906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="536.5" y="457.4575">HTTPS:443</text><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="512.5" y="472.5903">Internal audit data</text><!--MD5=[e3ae3adbec244927c099fa1b47d79db0]
link nginx to stroom_node_1--><path d="M331.07,480.6306 C437.52,484.3406 625.23,502.6806 762.5,580.8906 C789.03,596.0106 814.37,619.2406 833.02,638.6406 " fill="none" id="nginx-to-stroom_node_1" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="836.66,642.4606,833.3478,633.1854,833.211,638.8406,827.5558,638.7038,836.66,642.4606" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="774" y="553.9575">HTTP:8080</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="738.5" y="569.0903">Reverse-proxied traffic</text><!--MD5=[4d8498f5786554e027f873fa9aa1768c]
link nginx to stroom_proxy_local_1--><path d="M302.81,447.8006 C428.98,378.9006 748.83,230.2906 981.5,346.8906 C1021.26,366.8206 1049.15,411.1306 1064.98,443.0306 " fill="none" id="nginx-to-stroom_proxy_local_1" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="1067.22,447.6406,1066.8859,437.7974,1065.0355,443.1431,1059.6898,441.2927,1067.22,447.6406" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="726" y="315.9575">HTTP:8080</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="730" y="331.0903">Datafeed</text><!--MD5=[a51c8db31878d2be309e2ed4ecdd81f6]
link stroom_proxy_local_1 to stroom_node_1--><path d="M1046.12,510.9706 C1006.87,545.8806 942.84,602.8306 901.96,639.1806 " fill="none" id="stroom_proxy_local_1-to-stroom_node_1" style="stroke:#808080;stroke-width:1.0;"/><polygon fill="#808080" points="898.08,642.6306,907.4698,639.6588,901.8233,639.3159,902.1662,633.6695,898.08,642.6306" style="stroke:#808080;stroke-width:1.0;"/><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="1013" y="553.9575">HTTP:8080</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="1010.5" y="569.0903">Feed status</text><!--MD5=[aae0f4d488478c42be7a60e8dd5323f3]
link log_sender_script_2 to nginx--><path d="M641.5,642.4806 C623.48,621.5906 596.93,595.2706 567.5,580.8906 C546.49,570.6206 538.2,578.5206 515.5,572.8906 C513.16,572.3106 413.2,537.6306 336.28,510.9006 " fill="none" id="log_sender_script_2-to-nginx" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="331.25,509.1606,338.4388,515.8928,335.9731,510.8016,341.0643,508.3359,331.25,509.1606" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="540.5" y="553.9575">HTTPS:443</text><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="516.5" y="569.0903">Internal audit data</text><!--MD5=[55aa9ffcbcffc2dd500f7a8c18bef7dc]
link nginx to stroom_node_2--><path d="M235.88,511.0606 C217.22,561.8306 189.26,664.2406 236.5,729.8906 C264.13,768.2806 390.35,800.5006 470.01,817.4806 " fill="none" id="nginx-to-stroom_node_2" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="475.19,818.5806,467.2071,812.8123,470.2973,817.5506,465.559,820.6407,475.19,818.5806" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="273" y="671.4575">HTTP:8080</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="237.5" y="686.5903">Reverse-proxied traffic</text><!--MD5=[e4a8e517077ad6edff65130a58f358ea]
link nginx to stroom_proxy_local_2--><path d="M283.36,510.9706 C323.15,545.8806 388.07,602.8306 429.5,639.1806 " fill="none" id="nginx-to-stroom_proxy_local_2" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="433.44,642.6306,429.3176,633.686,429.6833,639.331,424.0383,639.6967,433.44,642.6306" style="stroke:#008000;stroke-width:1.0;"/><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="352.5" y="553.9575">HTTP:8080</text><text fill="#008000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="356.5" y="569.0903">Datafeed</text><!--MD5=[212f92e3c3c72fc28d16c4e3cceb4beb]
link stroom_proxy_local_2 to stroom_node_2--><path d="M473.26,706.1906 C476.92,725.1706 483.01,749.6606 492.5,769.8906 C496.6,778.6206 502.02,787.3806 507.65,795.4106 " fill="none" id="stroom_proxy_local_2-to-stroom_node_2" style="stroke:#808080;stroke-width:1.0;"/><polygon fill="#808080" points="510.8,799.7906,508.7981,790.1474,507.883,795.7297,502.3007,794.8146,510.8,799.7906" style="stroke:#808080;stroke-width:1.0;"/><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="496" y="750.9575">HTTP:8080</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="493.5" y="766.0903">Feed status</text><!--MD5=[8c6926865ac93cbe65c7fd9767816d3f]
link stroom_node_1 to stroom_node_2--><path d="M812.31,708.5706 C796.89,717.0106 779.52,725.0506 762.5,729.8906 C733.59,738.1106 654.86,725.4606 627.5,737.8906 C600.2,750.2906 576.68,774.8106 560.4,795.4906 " fill="none" id="stroom_node_1-stroom_node_2" style="stroke:#808080;stroke-width:1.0;"/><polygon fill="#808080" points="557.24,799.5706,565.9264,794.9287,560.3127,795.6262,559.6152,790.0125,557.24,799.5706" style="stroke:#808080;stroke-width:1.0;"/><polygon fill="#808080" points="817.03,705.9406,807.2235,706.8529,812.6687,708.3858,811.1358,713.831,817.03,705.9406" style="stroke:#808080;stroke-width:1.0;"/><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="677" y="750.9575">HTTP:8080</text><text fill="#808080" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="628.5" y="766.0903">Inter-node communication</text><!--MD5=[b0e0c69cc263250f6b79285722fdc41f]
link stroom_node_1 to stroom_db--><path d="M847.87,705.9106 C836.14,730.5506 821.04,766.5006 814.5,799.8906 C798.89,879.5506 804.56,976.3106 808.7,1022.2306 " fill="none" id="stroom_node_1-to-stroom_db" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="809.17,1027.3106,812.3291,1017.9822,808.7122,1022.3316,804.3627,1018.7147,809.17,1027.3106" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="815.5" y="835.9575">TCP:3306</text><!--MD5=[f0e3fa6bd4758de58ddb86322db04432]
link stroom_node_1 to stroom_stats_db--><path d="M866.94,705.9606 C874.98,777.4406 894.9,954.5906 902.49,1022.1406 " fill="none" id="stroom_node_1-to-stroom_stats_db" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="903.06,1027.1906,906.0328,1017.8011,902.5031,1022.2217,898.0825,1018.6921,903.06,1027.1906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="889.5" y="835.9575">TCP:3306</text><!--MD5=[fb4604c46d91f9e1f523b3a025af2a37]
link stroom_node_2 to stroom_db--><path d="M542.35,863.2206 C548.66,887.2506 561.24,919.2406 585.5,935.8906 C605.16,949.3906 670.53,934.6306 692.5,943.8906 C733.23,961.0506 769.64,997.9406 791.15,1023.0906 " fill="none" id="stroom_node_2-to-stroom_db" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="794.48,1027.0206,791.7359,1017.5618,791.2567,1023.1983,785.6202,1022.7191,794.48,1027.0206" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="586.5" y="931.9575">TCP:3306</text><!--MD5=[fcd075971ce9b86959b8271c817204c9]
link stroom_node_2 to stroom_stats_db--><path d="M597.62,852.9406 C691.31,884.5006 859.99,941.5206 862.5,943.8906 C884.49,964.6206 895.57,998.2006 900.91,1021.8006 " fill="none" id="stroom_node_2-to-stroom_stats_db" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="902.03,1026.9706,904.0362,1017.3283,900.9726,1022.0837,896.2171,1019.0201,902.03,1026.9706" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="839.5" y="931.9575">TCP:3306</text><!--MD5=[82f92885ad057cd3d82ad9f343b55ef9]
link stroom_node_1 to shared_storage--><path d="M817.91,705.9306 C801.2,715.4806 781.67,724.8406 762.5,729.8906 C720.48,740.9606 410.95,719.6606 371.5,737.8906 C308.715,766.9006 298.135,843.6681 303.4138,913.6681 C306.0531,948.6681 312.6572,981.9762 318.6827,1006.7769 C319.4358,1009.877 320.18,1012.8441 320.9062,1015.665 C321.2693,1017.0755 321.628,1018.4494 321.981,1019.785 C322.0693,1020.1189 322.1572,1020.4505 322.2447,1020.7796 " fill="none" id="stroom_node_1-to-shared_storage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="322.2447,1020.7796,323.7967,1011.0538,320.9594,1015.9476,316.0656,1013.1103,322.2447,1020.7796" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="315.5" y="835.9575">NFS/SMB</text><!--MD5=[2752bc870e733e018350d5894be1aafb]
link stroom_node_2 to shared_storage--><path d="M475.13,853.3506 C433.12,870.9206 379.75,900.2406 349.5,943.8906 C346.1763,948.6869 343.3828,953.8925 341.0395,959.3341 C340.9663,959.5042 340.8935,959.6745 340.8211,959.845 " fill="none" id="stroom_node_2-to-shared_storage" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="340.8211,959.845,348.0189,953.1225,342.7742,955.2422,340.6545,949.9975,340.8211,959.845" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#8B0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="368.5" y="931.9575">NFS/SMB</text><!--MD5=[989ef6e3dbf0f2cd69ae14acc8487b5d]
link ui_client_browser to nginx--><path d="M105.07,273.2406 C135.7,317.0606 191.66,397.0906 223.88,443.1806 " fill="none" id="ui_client_browser-to-nginx" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="226.92,447.5306,225.0561,437.8597,224.0613,443.4284,218.4926,442.4336,226.92,447.5306" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="147.5" y="323.4575">HTTPS</text><!--MD5=[f8c9e3aec2baf3f57b61323ecf9cc273]
link api_client_app to nginx--><path d="M248.5,273.2406 C248.5,316.7906 248.5,396.1306 248.5,442.3406 " fill="none" id="api_client_app-to-nginx" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="248.5,447.5306,252.5,438.5306,248.5,442.5306,244.5,438.5306,248.5,447.5306" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="249.5" y="315.9575">HTTPS</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="256.5" y="331.0903">/api</text><!--MD5=[c300b89a78c399230973140c26aa529a]
link event_producer to remote_proxy--><path d="M441.5,117.9806 C441.5,143.0006 441.5,178.4106 441.5,204.7206 " fill="none" id="event_producer-to-remote_proxy" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="441.5,209.8506,445.5,200.8506,441.5,204.8506,437.5,200.8506,441.5,209.8506" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="454.5" y="160.9575">HTTPS</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="442.5" y="176.0903">Event data</text><!--MD5=[fb1d713660c745da3a71d8c4842aab4b]
link remote_proxy to nginx--><path d="M416.27,273.2406 C380.36,317.1506 314.72,397.4206 277.07,443.4606 " fill="none" id="remote_proxy-to-nginx" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="273.74,447.5306,282.5376,443.1033,276.9085,443.6627,276.349,438.0336,273.74,447.5306" style="stroke:#0000FF;stroke-width:1.0;"/><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="450" y="315.9575">HTTPS</text><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="390.5" y="331.0903">Feed status and event data</text><rect fill="#DDDDDD" height="107.7813" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="208" x="983.5" y="1120.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="104" x="989.5" y="1138.8857">Types of traffic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="993.5" y="1155.1826"/><text fill="#0000FF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="989.5" y="1171.4795">Client</text><text fill="#8B0000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="989.5" y="1187.7764">Direct</text><text fill="#008000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="989.5" y="1204.0732">Reverse-proxied (unencrypted)</text><text fill="#808080" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142" x="989.5" y="1220.3701">Internal (unencrypted)</text><!--MD5=[eb0755d259020fffb75ad15b750d1e13]
@startuml

title
    =Stroom Architecture
    ==Example Two-Node Cluster (non-containerised deployment)
end title

'Define the various application ports
!stroom_port=8080
!stroom_proxy_port=8090

'Define all the nodes (services, actors, etc.)
node "Event generator" as event_producer <<application>>
node "User" as ui_client_browser <<web browser>>
node "API client" as api_client_app <<application>>
node "Upstream Stroom proxy" as remote_proxy <<application>>

node "Nginx load balancer" as nginx <<web server>>

rectangle "Stroom Cluster" {
storage "Stroom Node #1" {
    node "Stroom node" as stroom_node_1 <<java app>>
    node "Local Stroom proxy" as stroom_proxy_local_1 <<java app>>
    node "send_to_stroom.sh" as log_sender_script_1 <<script>>

    'Inter-service REST calls to nginx api gateway
    log_sender_script_1 - -> nginx : <color:DarkRed>HTTPS:443</color>\n<color:DarkRed>Internal audit data</color>

    'Reverse proxy connections
    nginx -[#Green]-> stroom_node_1 : <color:Green>HTTP:stroom_port</color>\n<color:Green>Reverse-proxied traffic</color>
    nginx -[#Green]-> stroom_proxy_local_1 : <color:Green>HTTP:stroom_port</color>\n<color:Green>Datafeed</color>

    'Effective connections (i.e. ignoring ngix gateway)
    stroom_proxy_local_1 -[#Grey]-> stroom_node_1 : <color:Grey>HTTP:stroom_port</color>\n<color:Grey>Feed status</color>
}

storage "Stroom Node #2" {
    node "Stroom node" as stroom_node_2 <<java app>>
    node "Local Stroom proxy" as stroom_proxy_local_2 <<java app>>
    node "send_to_stroom.sh" as log_sender_script_2 <<script>>

    ' Inter-service REST calls to nginx api gateway
    log_sender_script_2 - -> nginx : <color:DarkRed>HTTPS:443</color>\n<color:DarkRed>Internal audit data</color>

    'Reverse proxy connections
    nginx -[#Green]-> stroom_node_2 : <color:Green>HTTP:stroom_port</color>\n<color:Green>Reverse-proxied traffic</color>
    nginx -[#Green]-> stroom_proxy_local_2 : <color:Green>HTTP:stroom_port</color>\n<color:Green>Datafeed</color>

    'Effective connections (i.e. ignoring ngix gateway)
    stroom_proxy_local_2 -[#Grey]-> stroom_node_2 : <color:Grey>HTTP:stroom_port</color>\n<color:Grey>Feed status</color>
}
}

'Intra-cluster communication
stroom_node_1 <-[#Grey]-> stroom_node_2 : <color:Grey>HTTP:stroom_port</color>\n<color:Grey>Inter-node communication</color>

storage "MySQL Server" as stroom_all_dbs {
    database "stroom" as stroom_db
    database "stats" as stroom_stats_db
}

'DB connections
stroom_node_1 - -> stroom_db : <color:DarkRed>TCP:3306</color>
stroom_node_1 - -> stroom_stats_db : <color:DarkRed>TCP:3306</color>
stroom_node_2 - -> stroom_db : <color:DarkRed>TCP:3306</color>
stroom_node_2 - -> stroom_stats_db : <color:DarkRed>TCP:3306</color>

storage "Shared Storage" as shared_storage {
    folder "stroom-node-2"
    folder "stroom-node-1"
}

'Shared storage connections
stroom_node_1 - -> shared_storage : <color:DarkRed>NFS/SMB</color>
stroom_node_2 - -> shared_storage : <color:DarkRed>NFS/SMB</color>

'Client connections
ui_client_browser -[#Blue]-> nginx : <color:Blue>HTTPS</color>
api_client_app -[#Blue]-> nginx : <color:Blue>HTTPS</color>\n<color:Blue>/api</color>
event_producer -[#Blue]-> remote_proxy : <color:Blue>HTTPS</color>\n<color:Blue>Event data</color>
remote_proxy -[#Blue]-> nginx : <color:Blue>HTTPS</color>\n<color:Blue>Feed status and event data</color>

legend right
  <b>Types of traffic</b>

  <color:Blue>Client</color>
  <color:DarkRed>Direct</color>
  <color:Green>Reverse-proxied (unencrypted)</color>
  <color:Grey>Internal (unencrypted)</color>
endlegend

'hide empty members

@enduml

@startuml

title
    =Stroom Architecture
    ==Example Two-Node Cluster (non-containerised deployment)
end title


node "Event generator" as event_producer <<application>>
node "User" as ui_client_browser <<web browser>>
node "API client" as api_client_app <<application>>
node "Upstream Stroom proxy" as remote_proxy <<application>>

node "Nginx load balancer" as nginx <<web server>>

rectangle "Stroom Cluster" {
storage "Stroom Node #1" {
    node "Stroom node" as stroom_node_1 <<java app>>
    node "Local Stroom proxy" as stroom_proxy_local_1 <<java app>>
    node "send_to_stroom.sh" as log_sender_script_1 <<script>>

    log_sender_script_1 - -> nginx : <color:DarkRed>HTTPS:443</color>\n<color:DarkRed>Internal audit data</color>

    nginx -[#Green]-> stroom_node_1 : <color:Green>HTTP:8080</color>\n<color:Green>Reverse-proxied traffic</color>
    nginx -[#Green]-> stroom_proxy_local_1 : <color:Green>HTTP:8080</color>\n<color:Green>Datafeed</color>

    stroom_proxy_local_1 -[#Grey]-> stroom_node_1 : <color:Grey>HTTP:8080</color>\n<color:Grey>Feed status</color>
}

storage "Stroom Node #2" {
    node "Stroom node" as stroom_node_2 <<java app>>
    node "Local Stroom proxy" as stroom_proxy_local_2 <<java app>>
    node "send_to_stroom.sh" as log_sender_script_2 <<script>>

    log_sender_script_2 - -> nginx : <color:DarkRed>HTTPS:443</color>\n<color:DarkRed>Internal audit data</color>

    nginx -[#Green]-> stroom_node_2 : <color:Green>HTTP:8080</color>\n<color:Green>Reverse-proxied traffic</color>
    nginx -[#Green]-> stroom_proxy_local_2 : <color:Green>HTTP:8080</color>\n<color:Green>Datafeed</color>

    stroom_proxy_local_2 -[#Grey]-> stroom_node_2 : <color:Grey>HTTP:8080</color>\n<color:Grey>Feed status</color>
}
}

stroom_node_1 <-[#Grey]-> stroom_node_2 : <color:Grey>HTTP:8080</color>\n<color:Grey>Inter-node communication</color>

storage "MySQL Server" as stroom_all_dbs {
    database "stroom" as stroom_db
    database "stats" as stroom_stats_db
}

stroom_node_1 - -> stroom_db : <color:DarkRed>TCP:3306</color>
stroom_node_1 - -> stroom_stats_db : <color:DarkRed>TCP:3306</color>
stroom_node_2 - -> stroom_db : <color:DarkRed>TCP:3306</color>
stroom_node_2 - -> stroom_stats_db : <color:DarkRed>TCP:3306</color>

storage "Shared Storage" as shared_storage {
    folder "stroom-node-2"
    folder "stroom-node-1"
}

stroom_node_1 - -> shared_storage : <color:DarkRed>NFS/SMB</color>
stroom_node_2 - -> shared_storage : <color:DarkRed>NFS/SMB</color>

ui_client_browser -[#Blue]-> nginx : <color:Blue>HTTPS</color>
api_client_app -[#Blue]-> nginx : <color:Blue>HTTPS</color>\n<color:Blue>/api</color>
event_producer -[#Blue]-> remote_proxy : <color:Blue>HTTPS</color>\n<color:Blue>Event data</color>
remote_proxy -[#Blue]-> nginx : <color:Blue>HTTPS</color>\n<color:Blue>Feed status and event data</color>

legend right
  <b>Types of traffic</b>

  <color:Blue>Client</color>
  <color:DarkRed>Direct</color>
  <color:Green>Reverse-proxied (unencrypted)</color>
  <color:Grey>Internal (unencrypted)</color>
endlegend


@enduml

PlantUML version 1.2021.5(Sun Apr 25 11:20:28 GMT 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>