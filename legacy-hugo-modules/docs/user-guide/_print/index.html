<!doctype html>
<html lang="en" class="no-js">
  <head>
    
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.95.0" />
<link rel="canonical" type="text/html" href="../../../docs/user-guide/">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="../../../favicons/favicon.ico" >
<link rel="apple-touch-icon" href="../../../favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="../../../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../../../favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="../../../favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../../../favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="../../../favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="../../../favicons/android-192x192.png" sizes="192x192">

<title>User Guide | Stroom</title>
<meta name="description" content="Reference documentation for how to use Stroom.
">
<meta property="og:title" content="User Guide" />
<meta property="og:description" content="Reference documentation for how to use Stroom.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/user-guide/" /><meta property="og:site_name" content="Stroom" />

<meta itemprop="name" content="User Guide">
<meta itemprop="description" content="Reference documentation for how to use Stroom.
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="User Guide"/>
<meta name="twitter:description" content="Reference documentation for how to use Stroom.
"/>





<link href="../../../scss/main.css" rel="stylesheet">


<script src='../../../js/jquery-3.6.0.min.js'></script>


<script src='../../../js/lunr.min.js'></script>
  
<link rel="stylesheet" href="../../../css/prism.css"/>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="../../../">
		<span class="navbar-logo"><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="110.61089" height="30.000004" viewBox="0 0 88.488641 23.999957" id="svg2" inkscape:version="0.91 r13725" sodipodi:docname="logo.svg"><defs id="defs20"/><sodipodi:namedview pagecolor="#989898" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1920" inkscape:window-height="1137" id="namedview18" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="5.5951814" inkscape:cx="55.451414" inkscape:cy="16.275348" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg2"/><g id="g4150" style="opacity:.97000002" transform="matrix(0.03883584,0,0,0.03883584,0,-3.1155874e-4)"><path id="path6" d="M121.99991 205.98497C54.999958 205.98497.0 259.98493.0 327.98487c0 66.99994 54.999958 121.99989 121.99991 121.99989h167.99987c24.99998.0 44.99996 20.99998 44.99996 44.99996.0 24.99998-19.99998 44.99996-44.99996 44.99996H109.20929C65.984126 553.87219 27.100843 581.57313.01093599 617.98462H289.99978c66.99994.0 121.99991-54.99996 121.99991-122.9999.0-66.99994-54.99997-121.99989-121.99991-121.99989H121.99991c-24.999984.0-44.999969-19.99999-44.999969-44.99996.0-24.99998 19.999985-44.99996 44.999969-44.99996h228.79045c26.9905-35.88325 65.47093-63.18547 108.21554-76.99994H121.99991z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path8" d="M601.44485-.00077860649C572.6583 8.3697982 546.49491 22.822962 524.44491 41.902305V205.78969l.002.19528h-.002c-65.11 48e-5-123.03145 30.0199-160.74675 76.99994h160.74675v334.99971h76.99994V282.98491h144.85298c27.16134-36.05885 65.96411-63.39275 109.02184-76.99994H601.44485v-205.98574860649z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path10" d="m919.42586 205.98497c-113.99519.0-205.99537 92.00648-206.00296 205.99982-15e-5 68.67178.0 137.32749.0 205.99983h77.99994c-.012-68.6493.0176-137.46869.0-205.99983.0846-70.92785 57.05747-128.99988 128.00462-128.99988 5.28623.0 10.49823.32864 15.62183.95311 18.2219-24.51229 41.78461-45.0838 68.42501-60.15146-25.65065-11.43799-54.08662-17.80159-84.04684-17.80159z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path12" d="m1109.4153 205.98457c-113.99994.0-205.99983 91.99993-205.99983 205.99984.0 112.9999 91.99989 205.9998 205.99983 205.9998 114 0 205.9999-92.9999 205.9999-205.9998.0-113.99991-91.9999-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.99994-56.99996-128.99994-127.9999.0-70.99995 58.00004-128.9999 128.99994-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path14" d="m1444.4737 205.98457c-113.9999.0-205.9998 91.99993-205.9998 205.99984.0 112.9999 91.9999 205.9998 205.9998 205.9998s205.9999-92.9999 205.9999-205.9998c0-113.99991-92-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.9999-56.99996-128.9999-127.9999.0-70.99995 58-128.9999 128.9999-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path16" d="m1738.5308 379.98447c0-53 43-97 95.9999-97 53 0 97 44 97 97v237.9997h76.9999v-237.9997c0-53 43-97 96.9999-97 53 0 95.9999 44 95.9999 97v237.9997h77v-237.9997c0-96-77-173.9999-172.9999-173.9999-54.9999.0-103.9999 24.99998-135.9999 64.99995-31.9999-39.99997-79.9999-64.99995-134.9999-64.99995-95.9999.0-173.9998 77.9999-173.9998 173.9999v237.9997h77.9999z" style="fill:#fff" inkscape:connector-curvature="0"/></g></svg></span><span class="font-weight-bold">Stroom</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="../../../about/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="../../../docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="../../../community/" ><span>Community</span></a>
			</li>
			
			
			<li class="nav-item dropdown mr-4 d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Stroom Version (Legacy)
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="../../../../7.1">7.1</a>
	
	<a class="dropdown-item" href="../../../../7.0">7.0</a>
	
	<a class="dropdown-item" href="../../../../legacy">Legacy</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="../../../offline-search-index.json"
  data-offline-search-base-href="../../../"
  data-offline-search-max-results="50"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="../../../docs/user-guide/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">User Guide</h1>
<div class="lead">Reference documentation for how to use Stroom.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-d26bddfaf19c5dd48a7a6cdceea631c8">Application Programming Interfaces (API)</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-ebfd226579200a398d8590ddcf775ace">Query API</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-768489a1a5f8f6ea3170598ce5b73770">Concepts</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-6e7468161a354cb6edaf68b2b76c397f">Streams</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-48476d3d8490ade623a7b6f7eedc310a">Dashboards</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-2f221475c0cd4780dc719488032661ef">Dashboard Expressions</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1.1: <a href="#pg-463f96d6924865dbc630fbbc558a8327">Aggregate Functions</a></li>


    
  
    
    
	
<li>3.1.2: <a href="#pg-986f3c29d197e8672c0987b7b0db112c">Cast Functions</a></li>


    
  
    
    
	
<li>3.1.3: <a href="#pg-7a0bf793e9e3b446255d75e512185200">Date Functions</a></li>


    
  
    
    
	
<li>3.1.4: <a href="#pg-96c7b8143cd6966fdf891df8863bd6c3">Link Functions</a></li>


    
  
    
    
	
<li>3.1.5: <a href="#pg-30cb3d86e655657b10b0b12c86e020ef">Logic Funtions</a></li>


    
  
    
    
	
<li>3.1.6: <a href="#pg-e55fadbf273fff783da5186a2d0c132e">Mathematics Functions</a></li>


    
  
    
    
	
<li>3.1.7: <a href="#pg-14724839494655c6db5aeab186f5c92a">Rounding Functions</a></li>


    
  
    
    
	
<li>3.1.8: <a href="#pg-900d9753fc9c5756cc2d2d6024592e98">Selection Functions</a></li>


    
  
    
    
	
<li>3.1.9: <a href="#pg-bf3356630b2119a9da61618a438c1468">String Functions</a></li>


    
  
    
    
	
<li>3.1.10: <a href="#pg-31e6b218e404c55287e3e3d6fb6be1a1">Type Checking Functions</a></li>


    
  
    
    
	
<li>3.1.11: <a href="#pg-9684692ef069e48968553b5d53f673a5">URI Functions</a></li>


    
  
    
    
	
<li>3.1.12: <a href="#pg-d7f4cf2ecd821dd7e7d21e2be040e786">Value Functions</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3.2: <a href="#pg-09d02ed663f35a71994cbc79c44f56f8">Dictionaries</a></li>


    
  
    
    
	
<li>3.3: <a href="#pg-6bd1ea76bcd94d10f9c39559a771c351">Direct URLs</a></li>


    
  
    
    
	
<li>3.4: <a href="#pg-6b32fde0c74930062b1c105a8b60678a">Queries</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-f5b20cabc4011d0d84800d887de2ccc7">Data Retention</a></li>


    
  
    
    
	
<li>5: <a href="#pg-4c538bfe356bcf1e0e261c00d44a8992">Data Splitter</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-48e91d41ce117850b608db5bec356e50">Simple CSV Example</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-60e04cb943539552c26ef441163ec991">Simple CSV example with heading</a></li>


    
  
    
    
	
<li>5.3: <a href="#pg-d7c86891e32034cff23f52e772d0957b">Complex example with regex and user defined names</a></li>


    
  
    
    
	
<li>5.4: <a href="#pg-4e7eb119df912b5530510cddfbbe36eb">Multi Line Example</a></li>


    
  
    
    
	
<li>5.5: <a href="#pg-8f4175cc7d3f7d584edb7958e8546094">Element Reference</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.5.1: <a href="#pg-433f7e66c8f749c136edf8dd77485021">Content Providers</a></li>


    
  
    
    
	
<li>5.5.2: <a href="#pg-002b4e409b3795e26b4c2c408449ace2">Expressions</a></li>


    
  
    
    
	
<li>5.5.3: <a href="#pg-7a65167c519705ee561f6d7d28e6dd8a">Output</a></li>


    
  
    
    
	
<li>5.5.4: <a href="#pg-51f3f0c126598dfdbe243f6ba10324b0">Variables</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5.6: <a href="#pg-aaf101b97e91090cfb3df1bcf42a141a">Match References, Variables and Fixed Strings</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.6.1: <a href="#pg-3b82e13ffa085113005df16df1cec517">Concatenation of references</a></li>


    
  
    
    
	
<li>5.6.2: <a href="#pg-1634da39a3ac0fbcef0aa75957192611">Expression match references</a></li>


    
  
    
    
	
<li>5.6.3: <a href="#pg-bcb29e33caf02d50bf39e0cfeb4ecb3b">Use of fixed strings</a></li>


    
  
    
    
	
<li>5.6.4: <a href="#pg-ad6ae2faaa3721b740dceefffaf34916">Variable reference</a></li>


    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-cc2b0d6d7767dd7b562d8bea931f32d1">Editing and Viewing Data</a></li>


    
  
    
    
	
<li>7: <a href="#pg-d185e96091b29ee71e8e378700606d11">Event Feeds</a></li>


    
  
    
    
	
<li>8: <a href="#pg-c15dd253f719f80d0be2ad950d65cab4">Finding Things</a></li>


    
  
    
    
	
<li>9: <a href="#pg-b8860b8c19e9ebb1b61cd7ccafb22447">Nodes</a></li>


    
  
    
    
	
<li>10: <a href="#pg-4ba3d827447c0b785302fa20b313f31c">Pipelines</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>10.1: <a href="#pg-0d3ac18ea787cffda6272f82e6bae0a5">Reference Data</a></li>


    
  
    
    
	
<li>10.2: <a href="#pg-b02a3d3f350b1b05feec5352bf2f0e77">File Output</a></li>


    
  
    
    
	
<li>10.3: <a href="#pg-abb89cd998f89dc653cebf1da2271a55">Parser</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>10.3.1: <a href="#pg-850da8228403d37fae63cefb4607865a">Context Data</a></li>


    
  
    
    
	
<li>10.3.2: <a href="#pg-59f866a6d2114dc2ea44119af58eff26">XML Fragments</a></li>


    
  

    </ul>
    
  
    
    
	
<li>10.4: <a href="#pg-50b1aef8645c34dbbce8b9fff3d3ba23">XSLT Conversion</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>10.4.1: <a href="#pg-00fcef074a5fb84079d17e4049c5a7f8">XSLT Functions</a></li>


    
  
    
    
	
<li>10.4.2: <a href="#pg-3f52cd945d5eabe8bb9a84799caa130e">XSLT Includes</a></li>


    
  

    </ul>
    
  

    </ul>
    
  
    
    
	
<li>11: <a href="#pg-43200edc2182b8f93348171cfe19220f">Properties</a></li>


    
  
    
    
	
<li>12: <a href="#pg-ae5866da9cfde114a554760822fd9fca">Roles</a></li>


    
  
    
    
	
<li>13: <a href="#pg-2de7b2fe97b4152bbd00994cf953e1a2">Security</a></li>


    
  
    
    
	
<li>14: <a href="#pg-1df26607b1da056bc5eb1790db5dcdd0">Stroom Jobs</a></li>


    
  
    
    
	
<li>15: <a href="#pg-62543d26872ef2bc00bbc72ff957471a">Tools</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>15.1: <a href="#pg-75d7e9d7b1cee4d8756d17b998f45770">Command Line Tools</a></li>


    
  
    
    
	
<li>15.2: <a href="#pg-aaa793b6817f12a49ae679e8c2c3f5c8">Stream Dump Tool</a></li>


    
  

    </ul>
    
  
    
    
	
<li>16: <a href="#pg-d1aae0692f9ecb664825a4638d825273">Volumes</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '1.'; ">
    
  <h1 id="pg-d26bddfaf19c5dd48a7a6cdceea631c8">1 - Application Programming Interfaces (API)</h1>
    <div class="lead">Stroom&rsquo; public APIs for querying and interacting with all aspects of Stroom.</div>
	<p><em>Stroom</em> has a number of public APIs to allow other systems to interact with <em>Stroom</em>.
The APIs are defined by a <em>Swagger</em> spec that can be viewed as <a href="https://gchq.github.io/stroom/swagger.json">json (external link)</a> or <a href="https://gchq.github.io/stroom/swagger.yaml">yaml (external link)</a>.
A dynamic <a href="https://gchq.github.io/stroom/">user interface (external link)</a> is also available for viewing the APIs.</p>

</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '1.1.'; ">
    
  <h1 id="pg-ebfd226579200a398d8590ddcf775ace">1.1 - Query API</h1>
    <div class="lead">An API to allow other systems to query the data held in Stroom.</div>
	<p>The Query API uses common request/response models and end points for querying each type of data source held in <em>Stroom</em>. The request/response models are defined in <a href="https://github.com/gchq/stroom-query"><em>stroom-query</em> (external link)</a>.</p>
<p>Currently <em>Stroom</em> exposes a set of query endpoints for the following data source types. Each data source type will have its own endpoint due to differences in the way the data is queried and the restrictions imposed on the query terms.  However they all share the same API definition.</p>
<ul>
<li><a href="https://gchq.github.io/stroom/#/stroom-index%20query%20-%20v2"><em>stroom-index</em> (external link)</a> (the Lucene based event index)</li>
<li><a href="https://gchq.github.io/stroom/#/sqlstatistics%20query%20-%20v2"><em>sqlstatistics</em> (external link)</a> (Stroom&rsquo;s own statistics store)</li>
</ul>
<p>The detailed documentation for the request/responses is contained in the <em>Swagger</em> definition linked to above.</p>
<h2 id="common-endpoints">Common endpoints</h2>
<p>The standard query endpoints are</p>
<ul>
<li>
<p>/<a href="#datasource">datasource</a></p>
</li>
<li>
<p>/<a href="#search">search</a></p>
</li>
<li>
<p>/<a href="#destroy">destroy</a></p>
</li>
</ul>
<h3 id="datasource">datasource</h3>
<p>The data source endpoint is used to query <em>Stroom</em> for the details of a data source with a given <em>docRef</em>. The details will include such things as the fields available and any restrictions on querying the data.</p>
<h3 id="search">search</h3>
<p>The search endpoint is used to initiate a search against a data source or to request more data for an active search. A search request can be made using iterative mode, where it will perform the search and then only return the data it has immediately available. Subsequent requests for the same <em>queryKey</em> will also return the data immediately available, expecting that more results will have been found by the query. Requesting a search in non-iterative mode will result in the response being returned when the query has completed and all known results have been found.</p>
<p>The SearchRequest model is fairly complicated and contains not only the query terms but also a definition of how the data should be returned. A single SearchRequest can include multiple ResultRequest sections to return the queried data in multiple ways, e.g. as flat data and in an alternative aggregated form.</p>
<h4 id="_stroom_-as-a-query-builder"><em>Stroom</em> as a query builder</h4>
<p><em>Stroom</em> is able to export the json form of a SearchRequest model from its dashboards. This makes the dashboard a useful tool for building a query and the table settings to go with it. You can use the dashboard to defined the data source, define the query terms tree and build a table definition (or definitions) to describe how the data should be returned. The, clicking the download icon on the query pane of the dashboard will generate the SearchRequest json which can be immediately used with the /search API or modified to suit.</p>
<h3 id="destroy">destroy</h3>
<p>This endpoint is used to kill an active query by supplying the <em>queryKey</em> for query in question.</p>

</div>




    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '2.'; page-break-before: always">
    
  <h1 id="pg-768489a1a5f8f6ea3170598ce5b73770">2 - Concepts</h1>
    <div class="lead">Describes a number of core concepts involved in using Stroom.</div>
	
</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '2.1.'; ">
    
  <h1 id="pg-6e7468161a354cb6edaf68b2b76c397f">2.1 - Streams</h1>
    <div class="lead">The unit of data that Stroom operates on, essentially a bounded stream of data.</div>
	<p>Streams can either be created when data is directly POSTed in to Stroom or during the proxy aggregation process.
When data is directly POSTed to Stroom the content of the POST will be stored as one Stream.
With proxy aggregation multiple files in the proxy repository will/can be aggregated together into a single Stream.</p>
<h2 id="anatomy-of-a-stream">Anatomy of a Stream</h2>
<p>A Stream is made up of a number of parts of which the raw or cooked data is just one.
In addition to the data the Stream can contain a number of other child stream types, e.g. Context and Meta Data.</p>
<p>The hierarchy of a stream is as follows:</p>
<ul>
<li>Stream nnn
<ul>
<li>Part [1 to *]
<ul>
<li>Data [1-1]</li>
<li>Context [0-1]</li>
<li>Meta Data [0-1]</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Although all streams conform to the above hierarchy there are three main types of Stream that are used in Stroom:</p>
<ul>
<li>Non-segmented Stream - Raw events, Raw Reference</li>
<li>Segmented Stream - Events, Reference</li>
<li>Segmented Error Stream - Error</li>
</ul>
<p>Segmented means that the data has been demarcated into segments or records.</p>
<h3 id="child-stream-types">Child Stream Types</h3>
<h4 id="data">Data</h4>
<p>This is the actual data of the stream, e.g. the XML events, raw CSV, JSON, etc.</p>
<h4 id="context">Context</h4>
<p>This is additional contextual data that can be sent with the data.
Context data can be used for reference data lookups.</p>
<h4 id="meta-data">Meta Data</h4>
<p>This is the data about the Stream (e.g. the feed name, receipt time, user agent, etc.).
This meta data either comes from the HTTP headers when the data was POSTed to Stroom or is added by Stroom or Stroom-Proxy on receipt/processing.</p>
<h3 id="non-segmented-stream">Non-Segmented Stream</h3>
<p>The following is a representation of a non-segmented stream with three parts, each with Meta Data and Context child streams.</p>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/concepts/streams/non-segmented-stream.puml.svg" href="../../../images/user-guide/concepts/streams/non-segmented-stream.puml.svg">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/concepts/streams/non-segmented-stream.puml.svg" style="max-width: fit-content" alt="images/user-guide/concepts/streams/non-segmented-stream.puml.svg">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Non-Segmented Stream</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<p>Raw Events and Raw Reference streams contain non-segmented data, e.g. a large batch of CSV, JSON, XML, etc. data.
There is no notion of a record/event/segment in the data, it is simply data in any form (including malformed data) that is yet to be processed and demarcated into records/events, for example using a Data Splitter or an XML parser.</p>
<p>The Stream may be single-part or multi-part depending on how it is received.
If it is the product of proxy aggregation then it is likely to be multi-part.
Each part will have its own context and meta data child streams, if applicable.</p>
<h3 id="segmented-stream">Segmented Stream</h3>
<p>The following is a representation of a segmented stream that contains three records (i.e events) and has Meta Data and Context child streams.</p>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/concepts/streams/segmented-stream.puml.svg" href="../../../images/user-guide/concepts/streams/segmented-stream.puml.svg">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/concepts/streams/segmented-stream.puml.svg" style="max-width: fit-content" alt="images/user-guide/concepts/streams/segmented-stream.puml.svg">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Segmented Stream</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<p>Cooked Events and Reference data are forms of segmented data.
The raw data has been parsed and split into records/events and the resulting data is stored in a way that allows Stroom to know where each record/event starts/ends.
These streams only have a single part.</p>
<h3 id="error-stream">Error Stream</h3>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/concepts/streams/error-stream.puml.svg" href="../../../images/user-guide/concepts/streams/error-stream.puml.svg">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/concepts/streams/error-stream.puml.svg" style="max-width: fit-content" alt="images/user-guide/concepts/streams/error-stream.puml.svg">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Error Stream</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<p>Error streams are similar to segmented Event/Reference streams in that they are single-part and have demarcated records (where each error/warning/info message is a record).
Error streams do not have any Meta Data or Context child streams.</p>

</div>




    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.'; page-break-before: always">
    
  <h1 id="pg-48476d3d8490ade623a7b6f7eedc310a">3 - Dashboards</h1>
    <div class="lead">The means of displaying and visualising the results of queries.</div>
	
</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.'; ">
    
  <h1 id="pg-2f221475c0cd4780dc719488032661ef">3.1 - Dashboard Expressions</h1>
    <div class="lead">Expression language used to manipulate data on Stroom Dashboards.</div>
	<p>Expressions can be used to manipulate data on Stroom Dashboards.</p>
<p>Each function has a name, and some have additional aliases.</p>
<p>In some cases, functions can be nested. The return value for some functions being used
as the arguments for other functions.</p>
<p>The arguments to functions can either be other functions, literal values, or they can refer to fields on the input data using the field reference <code>${val}</code> syntax.</p>
<div class="card-deck mb-4">

  <div class="card mb-4">
  
    <div class="card-header">
      
        Aggregate Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="aggregate#average">Average</a></li>
<li><a href="aggregate#count">Count</a></li>
<li><a href="aggregate#count-groups">Count Groups</a></li>
<li><a href="aggregate#count-unique">Count Unique</a></li>
<li><a href="aggregate#joining">Joining</a></li>
<li><a href="aggregate#max">Max</a></li>
<li><a href="aggregate#min">Min</a></li>
<li><a href="aggregate#standard-deviation">Standard Deviation</a></li>
<li><a href="aggregate#sum">Sum</a></li>
<li><a href="aggregate#variance">Variance</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        String Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="string#concat">Concat</a></li>
<li><a href="string#current-user">Current User</a></li>
<li><a href="string#decode">Decode</a></li>
<li><a href="string#decodeurl">DecodeUrl</a></li>
<li><a href="string#encodeurl">EncodeUrl</a></li>
<li><a href="string#exclude">Exclude</a></li>
<li><a href="string#hash">Hash</a></li>
<li><a href="string#include">Include</a></li>
<li><a href="string#index-of">Index Of</a></li>
<li><a href="string#last-index-of">Last Index Of</a></li>
<li><a href="string#lower-case">Lower Case</a></li>
<li><a href="string#match">Match</a></li>
<li><a href="string#query-param">Query Param</a></li>
<li><a href="string#query-params">Query Params</a></li>
<li><a href="string#replace">Replace</a></li>
<li><a href="string#string-length">String Length</a></li>
<li><a href="string#substring">Substring</a></li>
<li><a href="string#substring-after">Substring After</a></li>
<li><a href="string#substring-before">Substring Before</a></li>
<li><a href="string#upper-case">Upper Case</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        Mathematics Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="mathematics#add">Add</a></li>
<li><a href="mathematics#average">Average</a></li>
<li><a href="mathematics#divide">Divide</a></li>
<li><a href="mathematics#max">Max</a></li>
<li><a href="mathematics#min">Min</a></li>
<li><a href="mathematics#modulo">Modulo</a></li>
<li><a href="mathematics#multiply">Multiply</a></li>
<li><a href="mathematics#negate">Negate</a></li>
<li><a href="mathematics#power">Power</a></li>
<li><a href="mathematics#random">Random</a></li>
<li><a href="mathematics#subtract">Subtract</a></li>
<li><a href="mathematics#sum">Sum</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        Type Checking Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="type-checking#is-boolean">Is Boolean</a></li>
<li><a href="type-checking#is-double">Is Double</a></li>
<li><a href="type-checking#is-error">Is Error</a></li>
<li><a href="type-checking#is-integer">Is Integer</a></li>
<li><a href="type-checking#is-long">Is Long</a></li>
<li><a href="type-checking#is-null">Is Null</a></li>
<li><a href="type-checking#is-number">Is Number</a></li>
<li><a href="type-checking#is-string">Is String</a></li>
<li><a href="type-checking#is-value">Is Value</a></li>
<li><a href="type-checking#type-of">Type Of</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


</div>
<div class="card-deck mb-4">
  <div class="card mb-4">
  
    <div class="card-header">
      
        Link Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="link#annotation">Annotation</a></li>
<li><a href="link#dashboard">Dashboard</a></li>
<li><a href="link#data">Data</a></li>
<li><a href="link#link">Link</a></li>
<li><a href="link#stepping">Stepping</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        Cast Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="cast#to-boolean">To Boolean</a></li>
<li><a href="cast#to-double">To Double</a></li>
<li><a href="cast#to-integer">To Integer</a></li>
<li><a href="cast#to-long">To Long</a></li>
<li><a href="cast#to-string">To String</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        Date Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="date#format-date">Format Date</a></li>
<li><a href="date#parse-date">Parse Date</a></li>
<li><a href="date#ceiling-yearmonthdayhourminutesecond">Ceiling Functions</a></li>
<li><a href="date#floor-yearmonthdayhourminutesecond">Floor Functions</a></li>
<li><a href="date#round-yearmonthdayhourminutesecond">Round Functions</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        Logic Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="logic#equals">Equals</a></li>
<li><a href="logic#greater-than">Greater Than</a></li>
<li><a href="logic#greater-than-or-equal-to">Greater Than or Equal To</a></li>
<li><a href="logic#if">If</a></li>
<li><a href="logic#less-than">Less Than</a></li>
<li><a href="logic#less-than-or-equal-to">Less Than or Equal To</a></li>
<li><a href="logic#not">Not</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


</div>
<div class="card-deck mb-4">

  <div class="card mb-4">
  
    <div class="card-header">
      
        Rounding Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="rounding#ceiling">Ceiling</a></li>
<li><a href="rounding#floor">Floor</a></li>
<li><a href="rounding#round">Round</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        Selection Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="selection#any">Any</a></li>
<li><a href="selection#bottom">Bottom</a></li>
<li><a href="selection#first">First</a></li>
<li><a href="selection#last">Last</a></li>
<li><a href="selection#nth">Nth</a></li>
<li><a href="selection#top">Top</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        URI Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="uri#extractauthorityfromuri">extractAuthorityFromUri</a></li>
<li><a href="uri#extractfragmentfromuri">extractFragmentFromUri</a></li>
<li><a href="uri#extracthostfromuri">extractHostFromUri</a></li>
<li><a href="uri#extractpathfromuri">extractPathFromUri</a></li>
<li><a href="uri#extractportfromuri">extractPortFromUri</a></li>
<li><a href="uri#extractqueryfromuri">extractQueryFromUri</a></li>
<li><a href="uri#extractschemefromuri">extractSchemeFromUri</a></li>
<li><a href="uri#extractschemespecificpartfromuri">extractSchemeSpecificPartFromUri</a></li>
<li><a href="uri#extractuserinfofromuri">extractUserInfoFromUri</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


  <div class="card mb-4">
  
    <div class="card-header">
      
        Value Functions
      
    </div>
  
  <div class="card-body">
    
    
    
      <p class="card-text">
        
          <ul>
<li><a href="value#err">Err</a></li>
<li><a href="value#false">False</a></li>
<li><a href="value#null">Null</a></li>
<li><a href="value#true">True</a></li>
</ul>

        
      </p>
    
  </div>
  
</div>


</div>

</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.1.'; page-break-before: always">
    
  <h1 id="pg-463f96d6924865dbc630fbbc558a8327">3.1.1 - Aggregate Functions</h1>
    <div class="lead">Functions that produce aggregates over multiple data points.</div>
	<h2 id="average">Average</h2>
<p>Takes an average value of the arguments</p>
<pre><code class="language-clike">average(arg)
mean(arg)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">average(${val})
${val} = [10, 20, 30, 40]
&gt; 25

mean(${val})
${val} = [10, 20, 30, 40]
&gt; 25
</code></pre>
<h2 id="count">Count</h2>
<p>Counts the number of records that are passed through it. Doesn&rsquo;t take any notice of the values of any fields.</p>
<pre><code class="language-clike">count()
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">Supplying 3 values...

count()
&gt; 3
</code></pre>
<h2 id="count-groups">Count Groups</h2>
<p>This is used to count the number of unique values where there are multiple group levels.
For Example, a data set grouped as follows</p>
<ol>
<li>Group by Name</li>
<li>Group by Type</li>
</ol>
<p>A groupCount could be used to count the number of distinct values of &rsquo;type&rsquo; for each value of &rsquo;name'</p>
<h2 id="count-unique">Count Unique</h2>
<p>This is used to count the number of unique values passed to the function where grouping is used to aggregate values in other columns.
For Example, a data set grouped as follows</p>
<ol>
<li>Group by Name</li>
<li>Group by Type</li>
</ol>
<p><code>countUnique()</code> could be used to count the number of distinct values of &rsquo;type&rsquo; for each value of &rsquo;name'</p>
<p>Examples</p>
<pre><code class="language-clike">countUnique(${val})
${val} = ['bill', 'bob', 'fred', 'bill']
&gt; 3
</code></pre>
<h2 id="joining">Joining</h2>
<p>Concatenates all values together into a single string.
If a delimter is supplied then the delimiter is placed bewteen each concatenated string.
If a limit is supplied then it will only concatenate up to limit values.</p>
<pre><code class="language-clike">joining(values)
joining(values, delimiter)
joining(values, delimiter, limit)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">joining(${val}, ', ')
${val} = ['bill', 'bob', 'fred', 'bill']
&gt; 'bill, bob, fred, bill'
</code></pre>
<h2 id="max">Max</h2>
<p>Determines the maximum value given in the args</p>
<pre><code class="language-clike">max(arg)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">max(${val})
${val} = [100, 30, 45, 109]
&gt; 109

# They can be nested
max(max(${val}), 40, 67, 89)
${val} = [20, 1002]
&gt; 1002
</code></pre>
<h2 id="min">Min</h2>
<p>Determines the minimum value given in the args</p>
<pre><code class="language-clike">min(arg)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">min(${val})
${val} = [100, 30, 45, 109]
&gt; 30
</code></pre>
<p>They can be nested</p>
<pre><code class="language-clike">min(max(${val}), 40, 67, 89)
${val} = [20, 1002]
&gt; 20
</code></pre>
<h2 id="standard-deviation">Standard Deviation</h2>
<p>Calculate the standard deviation for a set of input values.</p>
<pre><code class="language-clike">stDev(arg)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">round(stDev(${val}))
${val} = [600, 470, 170, 430, 300]
&gt; 147
</code></pre>
<h2 id="sum">Sum</h2>
<p>Sums all the arguments together</p>
<pre><code class="language-clike">sum(arg)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">sum(${val})
${val} = [89, 12, 3, 45]
&gt; 149
</code></pre>
<h2 id="variance">Variance</h2>
<p>Calculate the variance of a set of input values.</p>
<pre><code class="language-clike">variance(arg)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">variance(${val})
${val} = [600, 470, 170, 430, 300]
&gt; 21704
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.2.'; page-break-before: always">
    
  <h1 id="pg-986f3c29d197e8672c0987b7b0db112c">3.1.2 - Cast Functions</h1>
    <div class="lead">A set of functions for converting between different data types or for working with data types.</div>
	<h2 id="to-boolean">To Boolean</h2>
<p>Attempts to convert the passed value to a <em>boolean</em> data type.</p>
<pre><code class="language-clike">toBoolean(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">toBoolean(1)
&gt; true
toBoolean(0)
&gt; false
toBoolean('true')
&gt; true
toBoolean('false')
&gt; false
</code></pre>
<h2 id="to-double">To Double</h2>
<p>Attempts to convert the passed value to a <em>double</em> data type.</p>
<pre><code class="language-clike">toDouble(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">toDouble('1.2')
&gt; 1.2
</code></pre>
<h2 id="to-integer">To Integer</h2>
<p>Attempts to convert the passed value to a <em>integer</em> data type.</p>
<pre><code class="language-clike">toInteger(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">toInteger('1')
&gt; 1
</code></pre>
<h2 id="to-long">To Long</h2>
<p>Attempts to convert the passed value to a <em>long</em> data type.</p>
<pre><code class="language-clike">toLong(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">toLong('1')
&gt; 1
</code></pre>
<h2 id="to-string">To String</h2>
<p>Attempts to convert the passed value to a <em>string</em> data type.</p>
<pre><code class="language-clike">toString(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">toString(1.2)
&gt; '1.2'
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.3.'; page-break-before: always">
    
  <h1 id="pg-7a0bf793e9e3b446255d75e512185200">3.1.3 - Date Functions</h1>
    <div class="lead">Functions for manipulating dates and times.</div>
	<h2 id="parse-date">Parse Date</h2>
<p>Parse a date and return a long number of milliseconds since the epoch.</p>
<pre><code class="language-clike">parseDate(aString)
parseDate(aString, pattern)
parseDate(aString, pattern, timeZone)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">parseDate('2014 02 22', 'yyyy MM dd', '+0400')
&gt; 1393012800000
</code></pre>
<h2 id="format-date">Format Date</h2>
<p>Format a date supplied as milliseconds since the epoch.</p>
<pre><code class="language-clike">formatDate(aLong)
formatDate(aLong, pattern)
formatDate(aLong, pattern, timeZone)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">formatDate(1393071132888, 'yyyy MM dd', '+1200')
&gt; '2014 02 23'
</code></pre>
<h2 id="ceiling-yearmonthdayhourminutesecond">Ceiling Year/Month/Day/Hour/Minute/Second</h2>
<pre><code class="language-clike">ceilingYear(args...)
ceilingMonth(args...)
ceilingDay(args...)
ceilingHour(args...)
ceilingMinute(args...)
ceilingSecond(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">ceilingSecond(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-22T12:12:13.000Z&quot;
ceilingMinute(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-22T12:13:00.000Z&quot;
ceilingHour(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-22T13:00:00.000Z&quot;
ceilingDay(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-23T00:00:00.000Z&quot;
ceilingMonth(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-03-01T00:00:00.000Z&quot;
ceilingYear(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2015-01-01T00:00:00.000Z&quot;
</code></pre>
<h2 id="floor-yearmonthdayhourminutesecond">Floor Year/Month/Day/Hour/Minute/Second</h2>
<pre><code class="language-clike">floorYear(args...)
floorMonth(args...)
floorDay(args...)
floorHour(args...)
floorMinute(args...)
floorSecond(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">floorSecond(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-22T12:12:12.000Z&quot;
floorMinute(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-22T12:12:00.000Z&quot;
floorHour(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; 2014-02-22T12:00:00.000Z&quot;
floorDay(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-22T00:00:00.000Z&quot;
floorMonth(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-01T00:00:00.000Z&quot;
floorYear(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-01-01T00:00:00.000Z&quot;
</code></pre>
<h2 id="round-yearmonthdayhourminutesecond">Round Year/Month/Day/Hour/Minute/Second</h2>
<pre><code class="language-clike">roundYear(args...)
roundMonth(args...)
roundDay(args...)
roundHour(args...)
roundMinute(args...)
roundSecond(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">roundSecond(&quot;2014-02-22T12:12:12.888Z&quot;)
&gt; &quot;2014-02-22T12:12:13.000Z&quot;
roundMinute(&quot;2014-02-22T12:12:12.888Z&quot;)
&gt; &quot;2014-02-22T12:12:00.000Z&quot;
roundHour(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-22T12:00:00.000Z&quot;
roundDay(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-02-23T00:00:00.000Z&quot;
roundMonth(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-03-01T00:00:00.000Z&quot;
roundYear(&quot;2014-02-22T12:12:12.888Z&quot;
&gt; &quot;2014-01-01T00:00:00.000Z&quot;
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.4.'; page-break-before: always">
    
  <h1 id="pg-96c7b8143cd6966fdf891df8863bd6c3">3.1.4 - Link Functions</h1>
    <div class="lead">Functions for linking to other screens in Stroom and/or to particular sets of data.</div>
	<h2 id="annotation">Annotation</h2>
<p>A helper function to make forming links to annotations easier than using <a href="#link">Link</a>.
The Annotation function allows you to create a link to open the Annotation editor, either to view an existing annotation or to begin creating one with pre-populated values.</p>
<pre><code class="language-clike">annotation(text, annotationId)
annotation(text, annotationId, [streamId, eventId, title, subject, status, assignedTo, comment])
</code></pre>
<p>If you provide just the <em>text</em> and an <em>annotationId</em> then it will produce a link that opens an existing annotation with the supplied ID in the Annotation Edit dialog.</p>
<p>Example</p>
<pre><code class="language-clike">annotation('Open annotation', ${annotation:Id})
&gt; [Open annotation](?annotationId=1234){annotation}
annotation('Create annotation', '', ${StreamId}, ${EventId})
&gt; [Create annotation](?annotationId=&amp;streamId=1234&amp;eventId=45){annotation}
annotation('Escalate', '', ${StreamId}, ${EventId}, 'Escalation', 'Triage required')
&gt; [Escalate](?annotationId=&amp;streamId=1234&amp;eventId=45&amp;title=Escalation&amp;subject=Triage%20required){annotation}
</code></pre>
<p>If you don&rsquo;t supply an <em>annotationId</em> then the link will open the Annotation Edit dialog pre-populated with the optional arguments so that an annotation can be created.
If the <em>annotationId</em> is not provided then you must provide a <em>streamId</em> and an <em>eventId</em>.
If you don&rsquo;t need to pre-populate a value then you can use <code>''</code> or <code>null()</code> instead.</p>
<p>Example</p>
<pre><code class="language-clike">annotation('Create suspect event annotation', null(), 123, 456, 'Suspect Event', null(), 'assigned', 'jbloggs')
&gt; [Create suspect event annotation](?streamId=123&amp;eventId=456&amp;title=Suspect%20Event&amp;assignedTo=jbloggs){annotation}
</code></pre>
<h2 id="dashboard">Dashboard</h2>
<p>A helper function to make forming links to dashboards easier than using <a href="#link">Link</a>.</p>
<pre><code class="language-clike">dashboard(text, uuid)
dashboard(text, uuid, params)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">dashboard('Click Here','e177cf16-da6c-4c7d-a19c-09a201f5a2da')
&gt; [Click Here](?uuid=e177cf16-da6c-4c7d-a19c-09a201f5a2da){dashboard}
dashboard('Click Here','e177cf16-da6c-4c7d-a19c-09a201f5a2da', 'userId=user1')
&gt; [Click Here](?uuid=e177cf16-da6c-4c7d-a19c-09a201f5a2da&amp;params=userId%3Duser1){dashboard}
</code></pre>
<h2 id="data">Data</h2>
<p>Creates a link to open a source for data for viewing.</p>
<pre><code class="language-clike">data(text, id, partNo, [recordNo, lineFrom, colFrom, lineTo, colTo, viewType, displayType])
</code></pre>
<p><em>viewType</em> can be one of:</p>
<ul>
<li><code>preview</code> : Display the data as a formatted preview of a limited portion of the data.</li>
<li><code>source</code> : Display the un-formatted data in its original form with the ability to navigate around all of the data source.</li>
</ul>
<p><em>displayType</em> can be one of:</p>
<ul>
<li><code>dialog</code> : Open as a modal popup dialog.</li>
<li><code>tab</code> : Open as a top level tab within the Stroom browser tab.</li>
</ul>
<p>Example</p>
<pre><code class="language-clike">data('Quick View', ${StreamId}, 1)
&gt; [Quick View]?id=1234&amp;&amp;partNo=1)
</code></pre>
<h2 id="link">Link</h2>
<p>Create a string that represents a hyperlink for display in a dashboard table.</p>
<pre><code class="language-clike">link(url)
link(text, url)
link(text, url, type)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">link('http://www.somehost.com/somepath')
&gt; [http://www.somehost.com/somepath](http://www.somehost.com/somepath)
link('Click Here','http://www.somehost.com/somepath')
&gt; [Click Here](http://www.somehost.com/somepath)
link('Click Here','http://www.somehost.com/somepath', 'dialog')
&gt; [Click Here](http://www.somehost.com/somepath){dialog}
link('Click Here','http://www.somehost.com/somepath', 'dialog|Dialog Title')
&gt; [Click Here](http://www.somehost.com/somepath){dialog|Dialog Title}
</code></pre>
<p>Type can be one of:</p>
<ul>
<li><code>dialog</code> : Display the content of the link URL within a stroom popup dialog.</li>
<li><code>tab</code> : Display the content of the link URL within a stroom tab.</li>
<li><code>browser</code> : Display the content of the link URL within a new browser tab.</li>
<li><code>dashboard</code> : Used to launch a stroom dashboard internally with parameters in the URL.</li>
</ul>
<p>If you wish to override the default title or URL of the target link in either a tab or dialog you can. Both <code>dialog</code> and <code>tab</code> types allow titles to be specified after a <code>|</code>, e.g. <code>dialog|My Title</code>.</p>
<h2 id="stepping">Stepping</h2>
<p>Open the <em>Stepping</em> tab for the requested data source.</p>
<pre><code class="language-clike">stepping(text, id)
stepping(text, id, partNo)
stepping(text, id, partNo, recordNo)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">stepping('Click here to step',${StreamId})
&gt; [Click here to step](?id=1)
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.5.'; page-break-before: always">
    
  <h1 id="pg-30cb3d86e655657b10b0b12c86e020ef">3.1.5 - Logic Funtions</h1>
    
	<h2 id="equals">Equals</h2>
<p>Evaluates if arg1 is equal to arg2</p>
<pre><code class="language-clike">arg1 = arg2
equals(arg1, arg2)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">'foo' = 'bar'
&gt; false
'foo' = 'foo'
&gt; true
51 = 50
&gt; false
50 = 50
&gt; true

equals('foo', 'bar')
&gt; false
equals('foo', 'foo')
&gt; true
equals(51, 50)
&gt; false
equals(50, 50)
&gt; true
</code></pre>
<p>Note that <code>equals</code> cannot be applied to <code>null</code> and <code>error</code> values, e.g. <code>x=null()</code> or <code>x=err()</code>. The <a href="../../../docs/user-guide/dashboards/expressions/type-checking/#is-null"><code>isNull()</code></a> and <a href="../../../docs/user-guide/dashboards/expressions/type-checking/#is-error"><code>isError()</code></a> functions must be used instead.</p>
<h2 id="greater-than">Greater Than</h2>
<p>Evaluates if arg1 is greater than to arg2</p>
<pre><code class="language-clike">arg1 &gt; arg2
greaterThan(arg1, arg2)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">51 &gt; 50
&gt; true
50 &gt; 50
&gt; false
49 &gt; 50
&gt; false

greaterThan(51, 50)
&gt; true
greaterThan(50, 50)
&gt; false
greaterThan(49, 50)
&gt; false
</code></pre>
<h2 id="greater-than-or-equal-to">Greater Than or Equal To</h2>
<p>Evaluates if arg1 is greater than or equal to arg2</p>
<pre><code class="language-clike">arg1 &gt;= arg2
greaterThanOrEqualTo(arg1, arg2)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">51 &gt;= 50
&gt; true
50 &gt;= 50
&gt; true
49 &gt;= 50
&gt; false

greaterThanOrEqualTo(51, 50)
&gt; true
greaterThanOrEqualTo(50, 50)
&gt; true
greaterThanOrEqualTo(49, 50)
&gt; false
</code></pre>
<h2 id="if">If</h2>
<p>Evaluates the supplied boolean condition and returns one value if true or another if false</p>
<pre><code class="language-clike">if(expression, trueReturnValue, falseReturnValue)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">if(5 &lt; 10, 'foo', 'bar')
&gt; 'foo'
if(5 &gt; 10, 'foo', 'bar')
&gt; 'bar'
if(isNull(null()), 'foo', 'bar')
&gt; 'foo'
</code></pre>
<h2 id="less-than">Less Than</h2>
<p>Evaluates if arg1 is less than to arg2</p>
<pre><code class="language-clike">arg1 &lt; arg2
lessThan(arg1, arg2)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">51 &lt; 50
&gt; false
50 &lt; 50
&gt; false
49 &lt; 50
&gt; true

lessThan(51, 50)
&gt; false
lessThan(50, 50)
&gt; false
lessThan(49, 50)
&gt; true
</code></pre>
<h2 id="less-than-or-equal-to">Less Than or Equal To</h2>
<p>Evaluates if arg1 is less than or equal to arg2</p>
<pre><code class="language-clike">arg1 &lt;= arg2
lessThanOrEqualTo(arg1, arg2)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">51 &lt;= 50
&gt; false
50 &lt;= 50
&gt; true
49 &lt;= 50
&gt; true

lessThanOrEqualTo(51, 50)
&gt; false
lessThanOrEqualTo(50, 50)
&gt; true
lessThanOrEqualTo(49, 50)
&gt; true
</code></pre>
<h2 id="not">Not</h2>
<p>Inverts boolean values making true, false etc.</p>
<pre><code class="language-clike">not(booleanValue)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">not(5 &gt; 10)
&gt; true
not(5 = 5)
&gt; false
not(false())
&gt; true
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.6.'; page-break-before: always">
    
  <h1 id="pg-e55fadbf273fff783da5186a2d0c132e">3.1.6 - Mathematics Functions</h1>
    <div class="lead">Standard mathematical functions, such as add subtract, multiple, etc.</div>
	<h2 id="add">Add</h2>
<pre><code class="language-clike">arg1 + arg2
</code></pre>
<p>Or reduce the args by successive addition</p>
<pre><code class="language-clike">add(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">34 + 9
&gt; 43
add(45, 6, 72)
&gt; 123
</code></pre>
<h2 id="average">Average</h2>
<p>Takes an average value of the arguments</p>
<pre><code class="language-clike">average(args...)
mean(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">average(10, 20, 30, 40)
&gt; 25
mean(8.9, 24, 1.2, 1008)
&gt; 260.525
</code></pre>
<h2 id="divide">Divide</h2>
<p>Divides arg1 by arg2</p>
<pre><code class="language-clike">arg1 / arg2
</code></pre>
<p>Or reduce the args by successive division</p>
<pre><code class="language-clike">divide(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">42 / 7
&gt; 6
divide(1000, 10, 5, 2)
&gt; 10
divide(100, 4, 3)
&gt; 8.33
</code></pre>
<h2 id="max">Max</h2>
<p>Determines the maximum value given in the args</p>
<pre><code class="language-clike">max(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">max(100, 30, 45, 109)
&gt; 109

# They can be nested
max(max(${val}), 40, 67, 89)
${val} = [20, 1002]
&gt; 1002
</code></pre>
<h2 id="min">Min</h2>
<p>Determines the minimum value given in the args</p>
<pre><code class="language-clike">min(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">min(100, 30, 45, 109)
&gt; 30
</code></pre>
<p>They can be nested</p>
<pre><code class="language-clike">min(max(${val}), 40, 67, 89)
${val} = [20, 1002]
&gt; 20
</code></pre>
<h2 id="modulo">Modulo</h2>
<p>Determines the modulus of the dividend divided by the divisor.</p>
<pre><code class="language-clike">modulo(dividend, divisor)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">modulo(100, 30)
&gt; 10
</code></pre>
<h2 id="multiply">Multiply</h2>
<p>Multiplies arg1 by arg2</p>
<pre><code class="language-clike">arg1 * arg2
</code></pre>
<p>Or reduce the args by successive multiplication</p>
<pre><code class="language-clike">multiply(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">4 * 5
&gt; 20
multiply(4, 5, 2, 6)
&gt; 240
</code></pre>
<h2 id="negate">Negate</h2>
<p>Multiplies arg1 by -1</p>
<pre><code class="language-clike">negate(arg1)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">negate(80)
&gt; -80
negate(23.33)
&gt; -23.33
negate(-9.5)
&gt; 9.5
</code></pre>
<h2 id="power">Power</h2>
<p>Raises arg1 to the power arg2</p>
<pre><code class="language-clike">arg1 ^ arg2
</code></pre>
<p>Or reduce the args by successive raising to the power</p>
<pre><code class="language-clike">power(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">4 ^ 3
&gt; 64
power(2, 4, 3)
&gt; 4096
</code></pre>
<h2 id="random">Random</h2>
<p>Generates a random number between 0.0 and 1.0</p>
<pre><code class="language-clike">random()
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">random()
&gt; 0.78
random()
&gt; 0.89
...you get the idea
</code></pre>
<h2 id="subtract">Subtract</h2>
<pre><code class="language-clike">arg1 - arg2
</code></pre>
<p>Or reduce the args by successive subtraction</p>
<pre><code class="language-clike">subtract(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">29 - 8
&gt; 21
subtract(100, 20, 34, 2)
&gt; 44
</code></pre>
<h2 id="sum">Sum</h2>
<p>Sums all the arguments together</p>
<pre><code class="language-clike">sum(args...)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">sum(89, 12, 3, 45)
&gt; 149
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.7.'; page-break-before: always">
    
  <h1 id="pg-14724839494655c6db5aeab186f5c92a">3.1.7 - Rounding Functions</h1>
    <div class="lead">Functions for rounding data to a set precision.</div>
	<p>These functions require a value, and an optional decimal places.
If the decimal places are not given it will give you nearest whole number.</p>
<h2 id="ceiling">Ceiling</h2>
<pre><code class="language-clike">ceiling(value, decimalPlaces&lt;optional&gt;)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">ceiling(8.4234)
&gt; 9
ceiling(4.56, 1)
&gt; 4.6
ceiling(1.22345, 3)
&gt; 1.223
</code></pre>
<h2 id="floor">Floor</h2>
<pre><code class="language-clike">floor(value, decimalPlaces&lt;optional&gt;)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">floor(8.4234)
&gt; 8
floor(4.56, 1)
&gt; 4.5
floor(1.2237, 3)
&gt; 1.223
</code></pre>
<h2 id="round">Round</h2>
<pre><code class="language-clike">round(value, decimalPlaces&lt;optional&gt;)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">round(8.4234)
&gt; 8
round(4.56, 1)
&gt; 4.6
round(1.2237, 3)
&gt; 1.224
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.8.'; page-break-before: always">
    
  <h1 id="pg-900d9753fc9c5756cc2d2d6024592e98">3.1.8 - Selection Functions</h1>
    <div class="lead">Functions for selecting a sub-set of a set of data.</div>
	<p>Selection functions are a form of aggregate function operating on grouped data.</p>
<h2 id="any">Any</h2>
<p>Selects the first value found in the group that is not <code>null()</code> or <code>err()</code>.
If no explicit ordering is set then the value selected is indeterminate.</p>
<pre><code class="language-clike">any(${val})
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">any(${val})
${val} = [10, 20, 30, 40]
&gt; 10
</code></pre>
<h2 id="bottom">Bottom</h2>
<p>Selects the bottom N values and returns them as a delimited string in the order they are read.</p>
<pre><code class="language-clike">bottom(${val}, delimiter, limit)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">bottom(${val}, ', ', 2)
${val} = [10, 20, 30, 40]
&gt; '30, 40'
</code></pre>
<h2 id="first">First</h2>
<p>Selects the first value found in the group even if it is <code>null()</code> or <code>err()</code>.
If no explicit ordering is set then the value selected is indeterminate.</p>
<pre><code class="language-clike">first(${val})
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">first(${val})
${val} = [10, 20, 30, 40]
&gt; 10
</code></pre>
<h2 id="last">Last</h2>
<p>Selects the last value found in the group even if it is <code>null()</code> or <code>err()</code>.
If no explicit ordering is set then the value selected is indeterminate.</p>
<pre><code class="language-clike">last(${val})
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">last(${val})
${val} = [10, 20, 30, 40]
&gt; 40
</code></pre>
<h2 id="nth">Nth</h2>
<p>Selects the Nth value in a set of grouped values.
If there is no explicit ordering on the field selected then the value returned is indeterminate.</p>
<pre><code class="language-clike">nth(${val}, position)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">nth(${val}, 2)
${val} = [20, 40, 30, 10]
&gt; 40
</code></pre>
<h2 id="top">Top</h2>
<p>Selects the top N values and returns them as a delimited string in the order they are read.</p>
<pre><code class="language-clike">top(${val}, delimiter, limit)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">top(${val}, ', ', 2)
${val} = [10, 20, 30, 40]
&gt; '10, 20'
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.9.'; page-break-before: always">
    
  <h1 id="pg-bf3356630b2119a9da61618a438c1468">3.1.9 - String Functions</h1>
    <div class="lead">Functions for manipulating strings (text data).</div>
	<h2 id="concat">Concat</h2>
<p>Appends all the arguments end to end in a single string</p>
<pre><code class="language-clike">concat(args...)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">concat('this ', 'is ', 'how ', 'it ', 'works')
&gt; 'this is how it works'
</code></pre>
<h2 id="current-user">Current User</h2>
<p>Returns the username of the user running the query.</p>
<pre><code class="language-clike">currentUser()
</code></pre>
<p>Example</p>
<pre><code class="language-clike">currentUser()
&gt; 'jbloggs'
</code></pre>
<h2 id="decode">Decode</h2>
<p>The arguments are split into 3 parts</p>
<ol>
<li>The input value to test</li>
<li>Pairs of regex matchers with their respective output value</li>
<li>A default result, if the input doesn&rsquo;t match any of the regexes</li>
</ol>
<pre><code class="language-clike">decode(input, test1, result1, test2, result2, ... testN, resultN, otherwise)
</code></pre>
<p>It works much like a Java Switch/Case statement</p>
<p>Example</p>
<pre><code class="language-clike">decode(${val}, 'red', 'rgb(255, 0, 0)', 'green', 'rgb(0, 255, 0)', 'blue', 'rgb(0, 0, 255)', 'rgb(255, 255, 255)')
${val}='blue'
&gt; rgb(0, 0, 255)
${val}='green'
&gt; rgb(0, 255, 0)
${val}='brown'
&gt; rgb(255, 255, 255) // falls back to the 'otherwise' value
</code></pre>
<p>in Java, this would be equivalent to</p>
<pre><code class="language-java">String decode(value) {
    switch(value) {
        case &quot;red&quot;:
            return &quot;rgb(255, 0, 0)&quot;
        case &quot;green&quot;:
            return &quot;rgb(0, 255, 0)&quot;
        case &quot;blue&quot;:
            return &quot;rgb(0, 0, 255)&quot;
        default:
            return &quot;rgb(255, 255, 255)&quot;
    }
}
</code></pre>
<pre><code class="language-clike">decode('red')
&gt; 'rgb(255, 0, 0)'
</code></pre>
<h2 id="decodeurl">DecodeUrl</h2>
<p>Decodes a URL</p>
<pre><code class="language-clike">decodeUrl('userId%3Duser1')
&gt; userId=user1
</code></pre>
<h2 id="encodeurl">EncodeUrl</h2>
<p>Encodes a URL</p>
<pre><code class="language-clike">encodeUrl('userId=user1')
&gt; userId%3Duser1
</code></pre>
<h2 id="exclude">Exclude</h2>
<p>If the supplied string matches one of the supplied match strings then return null, otherwise return the supplied string</p>
<pre><code class="language-clike">exclude(aString, match...)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">exclude('hello', 'hello', 'hi')
&gt; null
exclude('hi', 'hello', 'hi')
&gt; null
exclude('bye', 'hello', 'hi')
&gt; 'bye'
</code></pre>
<h2 id="hash">Hash</h2>
<p>Cryptographically hashes a string</p>
<pre><code class="language-clike">hash(value)
hash(value, algorithm)
hash(value, algorithm, salt)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">hash(${val}, 'SHA-512', 'mysalt')
&gt; A hashed result...
</code></pre>
<p>If not specified the <code>hash()</code> function will use the <code>SHA-256</code> algorithm. Supported algorithms are determined by Java runtime environment.</p>
<h2 id="include">Include</h2>
<p>If the supplied string matches one of the supplied match strings then return it, otherwise return null</p>
<pre><code class="language-clike">include(aString, match...)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">include('hello', 'hello', 'hi')
&gt; 'hello'
include('hi', 'hello', 'hi')
&gt; 'hi'
include('bye', 'hello', 'hi')
&gt; null
</code></pre>
<h2 id="index-of">Index Of</h2>
<p>Finds the first position of the second string within the first</p>
<pre><code class="language-clike">indexOf(firstString, secondString)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">indexOf('aa-bb-cc', '-')
&gt; 2
</code></pre>
<h2 id="last-index-of">Last Index Of</h2>
<p>Finds the last position of the second string within the first</p>
<pre><code class="language-clike">lastIndexOf(firstString, secondString)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">lastIndexOf('aa-bb-cc', '-')
&gt; 5
</code></pre>
<h2 id="lower-case">Lower Case</h2>
<p>Converts the string to lower case</p>
<pre><code class="language-clike">lowerCase(aString)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">lowerCase('Hello DeVeLoPER')
&gt; 'hello developer'
</code></pre>
<h2 id="match">Match</h2>
<p>Test an input string using a regular expression to see if it matches</p>
<pre><code class="language-clike">match(input, regex)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">match('this', 'this')
&gt; true
match('this', 'that')
&gt; false
</code></pre>
<h2 id="query-param">Query Param</h2>
<p>Returns the value of the requested query parameter.</p>
<pre><code class="language-clike">queryParam(paramKey)
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">queryParam('user')
&gt; 'jbloggs'
</code></pre>
<h2 id="query-params">Query Params</h2>
<p>Returns all query parameters as a space delimited string.</p>
<pre><code class="language-clike">queryParams()
</code></pre>
<p>Examples</p>
<pre><code class="language-clike">queryParams()
&gt; 'user=jbloggs site=HQ'
</code></pre>
<h2 id="replace">Replace</h2>
<p>Perform text replacement on an input string using a regular expression to match part (or all) of the input string and a replacement string to insert in place of the matched part</p>
<pre><code class="language-clike">replace(input, regex, replacement)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">replace('this', 'is', 'at')
&gt; 'that'
</code></pre>
<h2 id="string-length">String Length</h2>
<p>Takes the length of a string</p>
<pre><code class="language-clike">stringLength(aString)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">stringLength('hello')
&gt; 5
</code></pre>
<h2 id="substring">Substring</h2>
<p>Take a substring based on start/end index of letters</p>
<pre><code class="language-clike">substring(aString, startIndex, endIndex)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">substring('this', 1, 2)
&gt; 'h'
</code></pre>
<h2 id="substring-after">Substring After</h2>
<p>Get the substring from the first string that occurs after the presence of the second string</p>
<pre><code class="language-clike">substringAfter(firstString, secondString)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">substringAfter('aa-bb', '-')
&gt; 'bb'
</code></pre>
<h2 id="substring-before">Substring Before</h2>
<p>Get the substring from the first string that occurs before the presence of the second string</p>
<pre><code class="language-clike">substringBefore(firstString, secondString)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">substringBefore('aa-bb', '-')
&gt; 'aa'
</code></pre>
<h2 id="upper-case">Upper Case</h2>
<p>Converts the string to upper case</p>
<pre><code class="language-clike">upperCase(aString)
</code></pre>
<p>Example</p>
<pre><code class="language-clike">upperCase('Hello DeVeLoPER')
&gt; 'HELLO DEVELOPER'
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.10.'; page-break-before: always">
    
  <h1 id="pg-31e6b218e404c55287e3e3d6fb6be1a1">3.1.10 - Type Checking Functions</h1>
    <div class="lead">Functions for evaluating the type of a value.</div>
	<h2 id="is-boolean">Is Boolean</h2>
<p>Checks if the passed value is a <em>boolean</em> data type.</p>
<pre><code class="language-clike">isBoolean(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">isBoolean(toBoolean('true'))
&gt; true
</code></pre>
<h2 id="is-double">Is Double</h2>
<p>Checks if the passed value is a <em>double</em> data type.</p>
<pre><code class="language-clike">isDouble(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">isDouble(toDouble('1.2'))
&gt; true
</code></pre>
<h2 id="is-error">Is Error</h2>
<p>Checks if the passed value is an error caused by an invalid evaluation of an expression on passed values, e.g. some values passed to an expression could result in a divide by 0 error.
Note that this method must be used to check for <code>error</code> as error equality using <code>x=err()</code> is not supported.</p>
<pre><code class="language-clike">isError(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">isError(toLong('1'))
&gt; false
isError(err())
&gt; true
</code></pre>
<h2 id="is-integer">Is Integer</h2>
<p>Checks if the passed value is an <em>integer</em> data type.</p>
<pre><code class="language-clike">isInteger(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">isInteger(toInteger('1'))
&gt; true
</code></pre>
<h2 id="is-long">Is Long</h2>
<p>Checks if the passed value is a <em>long</em> data type.</p>
<pre><code class="language-clike">isLong(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">isLong(toLong('1'))
&gt; true
</code></pre>
<h2 id="is-null">Is Null</h2>
<p>Checks if the passed value is <code>null</code>.
Note that this method must be used to check for <code>null</code> as null equality using <code>x=null()</code> is not supported.</p>
<pre><code class="language-clike">isNull(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">isNull(toLong('1'))
&gt; false
isNull(null())
&gt; true
</code></pre>
<h2 id="is-number">Is Number</h2>
<p>Checks if the passed value is a numeric data type.</p>
<pre><code class="language-clike">isNumber(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">isNumber(toLong('1'))
&gt; true
</code></pre>
<h2 id="is-string">Is String</h2>
<p>Checks if the passed value is a <em>string</em> data type.</p>
<pre><code class="language-clike">isString(arg1)
</code></pre>
<p>Examples:</p>
<pre><code>isString(toString(1.2))
&gt; true
</code></pre>
<h2 id="is-value">Is Value</h2>
<p>Checks if the passed value is a value data type, e.g. not <code>null</code> or <code>error</code>.</p>
<pre><code class="language-clike">isValue(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">isValue(toLong('1'))
&gt; true
isValue(null())
&gt; false
</code></pre>
<h2 id="type-of">Type Of</h2>
<p>Returns the data type of the passed value as a string.</p>
<pre><code class="language-clike">typeOf(arg1)
</code></pre>
<p>Examples:</p>
<pre><code class="language-clike">typeOf('abc')
&gt; string
typeOf(toInteger(123))
&gt; integer
typeOf(err())
&gt; error
typeOf(null())
&gt; null
typeOf(toBoolean('false'))
&gt; false
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.11.'; page-break-before: always">
    
  <h1 id="pg-9684692ef069e48968553b5d53f673a5">3.1.11 - URI Functions</h1>
    <div class="lead">Functions for extracting parts from a Uniform Resource Identifier (URI).</div>
	<p>Fields containing a Uniform Resource Identifier (URI) in string form can queried to extract the URI&rsquo;s individual components of <code>authority</code>, <code>fragment</code>, <code>host</code>, <code>path</code>, <code>port</code>, <code>query</code>, <code>scheme</code>, <code>schemeSpecificPart</code> and <code>userInfo</code>. See either <a href="http://www.ietf.org/rfc/rfc2396.txt">RFC 2306: Uniform Resource Identifiers (URI): Generic Syntax</a> or Java&rsquo;s java.net.URI Class for details regarding the components. If any component is not present within the passed URI, then an empty string is returned.</p>
<p>The extraction functions are</p>
<ul>
<li>extractAuthorityFromUri() - extract the Authority component</li>
<li>extractFragmentFromUri() - extract the Fragment component</li>
<li>extractHostFromUri() - extract the Host component</li>
<li>extractPathFromUri() - extract the Path component</li>
<li>extractPortFromUri() - extract the Port component</li>
<li>extractQueryFromUri() - extract the Query component</li>
<li>extractSchemeFromUri() - extract the Scheme component</li>
<li>extractSchemeSpecificPartFromUri() - extract the Scheme specific part component</li>
<li>extractUserInfoFromUri() - extract the UserInfo component</li>
</ul>
<p>If the URI is <code>http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;amp;p2=v2#more-details</code> the table below displays the extracted components</p>
<table>
<thead>
<tr>
<th>Expression</th>
<th>Extraction</th>
</tr>
</thead>
<tbody>
<tr>
<td>extractAuthorityFromUri(${URI})</td>
<td>foo:bar@w1.superman.com:8080</td>
</tr>
<tr>
<td>extractFragmentFromUri(${URI})</td>
<td>more-details</td>
</tr>
<tr>
<td>extractHostFromUri(${URI})</td>
<td>w1.superman.com</td>
</tr>
<tr>
<td>extractPathFromUri(${URI})</td>
<td>/very/long/path.html</td>
</tr>
<tr>
<td>extractPortFromUri(${URI})</td>
<td>8080</td>
</tr>
<tr>
<td>extractQueryFromUri(${URI})</td>
<td>p1=v1&amp;p2=v2</td>
</tr>
<tr>
<td>extractSchemeFromUri(${URI})</td>
<td>http</td>
</tr>
<tr>
<td>extractSchemeSpecificPartFromUri(${URI})</td>
<td>//foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2</td>
</tr>
<tr>
<td>extractUserInfoFromUri(${URI})</td>
<td>foo:bar</td>
</tr>
</tbody>
</table>
<h2 id="extractauthorityfromuri">extractAuthorityFromUri</h2>
<p>Extracts the Authority component from a URI</p>
<p><code>extractAuthorityFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractAuthorityFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; 'foo:bar@w1.superman.com:8080'
</code></pre>
<h2 id="extractfragmentfromuri">extractFragmentFromUri</h2>
<p>Extracts the Fragment component from a URI</p>
<p><code>extractFragmentFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractFragmentFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; 'more-details'
</code></pre>
<h2 id="extracthostfromuri">extractHostFromUri</h2>
<p>Extracts the Host component from a URI</p>
<p><code>extractHostFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractHostFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; 'w1.superman.com'
</code></pre>
<h2 id="extractpathfromuri">extractPathFromUri</h2>
<p>Extracts the Path component from a URI</p>
<p><code>extractPathFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractPathFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; '/very/long/path.html'
</code></pre>
<h2 id="extractportfromuri">extractPortFromUri</h2>
<p>Extracts the Port component from a URI</p>
<p><code>extractPortFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractPortFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; '8080'
</code></pre>
<h2 id="extractqueryfromuri">extractQueryFromUri</h2>
<p>Extracts the Query component from a URI</p>
<p><code>extractQueryFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractQueryFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; 'p1=v1&amp;p2=v2'
</code></pre>
<h2 id="extractschemefromuri">extractSchemeFromUri</h2>
<p>Extracts the Scheme component from a URI</p>
<p><code>extractSchemeFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractSchemeFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; 'http'
</code></pre>
<h2 id="extractschemespecificpartfromuri">extractSchemeSpecificPartFromUri</h2>
<p>Extracts the SchemeSpecificPart component from a URI</p>
<p><code>extractSchemeSpecificPartFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractSchemeSpecificPartFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; '//foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2'
</code></pre>
<h2 id="extractuserinfofromuri">extractUserInfoFromUri</h2>
<p>Extracts the UserInfo component from a URI</p>
<p><code>extractUserInfoFromUri(uri)</code></p>
<p>Example</p>
<pre><code class="language-clike">extractUserInfoFromUri('http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;p2=v2#more-details')
&gt; 'foo:bar'
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.1.12.'; page-break-before: always">
    
  <h1 id="pg-d7f4cf2ecd821dd7e7d21e2be040e786">3.1.12 - Value Functions</h1>
    <div class="lead">Functions that return a static value.</div>
	<h2 id="err">Err</h2>
<p>Returns <em>err</em></p>
<pre><code class="language-clike">err()
</code></pre>
<h2 id="false">False</h2>
<p>Returns boolean <em>false</em></p>
<pre><code class="language-clike">false()
</code></pre>
<h2 id="null">Null</h2>
<p>Returns <em>null</em></p>
<pre><code class="language-clike">null()
</code></pre>
<h2 id="true">True</h2>
<p>Returns boolean <em>true</em></p>
<pre><code class="language-clike">true()
</code></pre>

</div>




    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.2.'; page-break-before: always">
    
  <h1 id="pg-09d02ed663f35a71994cbc79c44f56f8">3.2 - Dictionaries</h1>
    
	<h2 id="creating">Creating</h2>
<p>Right click on a folder in the explorer tree that you want to create a dictionary in. Choose ‘New/Dictionary’ from the popup menu:</p>
<blockquote>
<p><strong>TODO</strong>: Fix image</p>
</blockquote>
<p>Call the dictionary something like ‘My Dictionary’ and click OK.</p>
<blockquote>
<p><strong>TODO</strong>: Fix image</p>
</blockquote>
<p>Now just add any search terms you want to the newly created dictionary and click save.</p>
<blockquote>
<p><strong>TODO</strong>: Fix image</p>
</blockquote>
<p>You can add multiple terms.</p>
<ul>
<li>Terms on separate lines act as if they are part of an &lsquo;OR&rsquo; expression when used in a search.</li>
<li>Terms on a single line separated by spaces act as if they are part of an &lsquo;AND&rsquo; expression when used in a search.</li>
</ul>
<h2 id="using">Using</h2>
<p>To perform a search using your dictionary, just choose the newly created dictionary as part of your search expression:</p>
<blockquote>
<p><strong>TODO</strong>: Fix image</p>
</blockquote>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.3.'; page-break-before: always">
    
  <h1 id="pg-6bd1ea76bcd94d10f9c39559a771c351">3.3 - Direct URLs</h1>
    <div class="lead">Navigating directly to a specific <em>Stroom</em> dashboard using a direct URL.</div>
	<p>It is possible to navigate directly to a specific <em>Stroom</em> dashboard using a direct URL.
This can be useful when you have a dashboard that needs to be viewed by users that would otherwise not be using the <em>Stroom</em> user interface.</p>
<h2 id="url-format">URL format</h2>
<p>The format for the URL is as follows:</p>
<p><code>https://&lt;HOST&gt;/stroom/dashboard?type=Dashboard&amp;uuid=&lt;DASHBOARD UUID&gt;[&amp;title=&lt;DASHBOARD TITLE&gt;][&amp;params=&lt;DASHBOARD PARAMETERS&gt;]</code></p>
<p>Example:</p>
<p><code>https://localhost/stroom/dashboard?type=Dashboard&amp;uuid=c7c6b03c-5d47-4b8b-b84e-e4dfc6c84a09&amp;title=My%20Dash&amp;params=userId%3DFred%20Bloggs</code></p>
<h3 id="host-and-path">Host and path</h3>
<p>The host and path are typically <code>https://&lt;HOST&gt;/stroom/dashboard</code> where <code>&lt;HOST&gt;</code> is the hostname/IP for <em>Stroom</em>.</p>
<h3 id="type">type</h3>
<p><code>type</code> is a required parameter and must always be <code>Dashboard</code> since we are opening a dashboard.</p>
<h3 id="uuid">uuid</h3>
<p><code>uuid</code> is a required parameter where <code>&lt;DASHBOARD UUID&gt;</code> is the UUID for the dashboard you want a direct URL to, e.g. <code>uuid=c7c6b03c-5d47-4b8b-b84e-e4dfc6c84a09</code></p>
<p>The UUID for the dashboard that you want to link to can be found by right clicking on the dashboard icon in the explorer tree and selecting Info.</p>
<p>The Info dialog will display something like this and the UUID can be copied from it:</p>
<pre><code class="language-text">DB ID: 4
UUID: c7c6b03c-5d47-4b8b-b84e-e4dfc6c84a09
Type: Dashboard
Name: Stroom Family App Events Dashboard
Created By: INTERNAL
Created On: 2018-12-10T06:33:03.275Z
Updated By: admin
Updated On: 2018-12-10T07:47:06.841Z
</code></pre>
<h3 id="title-optional">title (Optional)</h3>
<p><code>title</code> is an optional URL parameter where <code>&lt;DASHBOARD TITLE&gt;</code> allows the specification of a specific title for the opened dashboard instead of the default dashboard name.</p>
<p>The inclusion of <code>${name}</code> in the title allows the default dashboard name to be used and appended with other values, e.g. <code>'title=${name}%20-%20' + param.name</code></p>
<h3 id="params-optional">params (Optional)</h3>
<p><code>params</code> is an optional URL parameter where <code>&lt;DASHBOARD PARAMETERS&gt;</code> includes any parameters that have been defined for the dashboard in any of the expressions, e.g. <code>params=userId%3DFred%20Bloggs</code></p>
<h2 id="permissions">Permissions</h2>
<p>In order for as user to view a dashboard they will need the necessary permission on the various entities that make up the dashboard.</p>
<p>For a Lucene index query and associated table the following permissions will be required:</p>
<ul>
<li><em>Read</em> permission on the <em>Dashboard</em> entity.</li>
<li><em>Use</em> permission on any <em>Indexe</em> entities being queried in the dashboard.</li>
<li><em>Use</em> permission on any <em>Pipeline</em> entities set as search extraction <em>Pipelines</em> in any of the dashboard&rsquo;s tables.</li>
<li><em>Use</em> permission on any <em>XSLT</em> entities used by the above search extraction <em>Pipeline</em> entites.</li>
<li><em>Use</em> permission on any ancestor pipelines of any of the above search extraction <em>Pipeline</em> entites (if applicable).</li>
<li><em>Use</em> permission on any <em>Feed</em> entities that you want the user to be able to see data for.</li>
</ul>
<p>For a SQL Statistics query and associated table the following permissions will be required:</p>
<ul>
<li><em>Read</em> permission on the <em>Dashboard</em> entity.</li>
<li><em>Use</em> permission on the <em>StatisticStore</em> entity being queried.</li>
</ul>
<p>For a visualisation the following permissions will be required:</p>
<ul>
<li><em>Read</em> permission on any <em>Visualiation</em> entities used in the dashboard.</li>
<li><em>Read</em> permission on any <em>Script</em> entities used by the above <em>Visualiation</em> entities.</li>
<li><em>Read</em> permission on any <em>Script</em> entities used by the above <em>Script</em> entities.</li>
</ul>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.4.'; page-break-before: always">
    
  <h1 id="pg-6b32fde0c74930062b1c105a8b60678a">3.4 - Queries</h1>
    <div class="lead">How to query the data in Stroom.</div>
	<p>Dashboard queries are created with the query expression builder. The expression builder allows for complex boolean logic to be created across multiple index fields. The way in which different index fields may be queried depends on the type of data that the index field contains.</p>
<h2 id="date-time-fields">Date Time Fields</h2>
<p>Time fields can be queried for times equal, greater than, greater than or equal, less than, less than or equal or between two times.</p>
<p>Times can be specified in two ways:</p>
<ul>
<li>
<p>Absolute times</p>
</li>
<li>
<p>Relative times</p>
</li>
</ul>
<h3 id="absolute-times">Absolute Times</h3>
<p>An absolute time is specified in ISO 8601 date time format, e.g.  <code>2016-01-23T12:34:11.844Z</code></p>
<h3 id="relative-times">Relative Times</h3>
<p>In addition to absolute times it is possible to specify times using expressions. Relative time expressions create a date time that is relative to the execution time of the query. Supported expressons are as follows:</p>
<ul>
<li>
<p>now() - The current execution time of the query.</p>
</li>
<li>
<p>second() - The current execution time of the query rounded down to the nearest second.</p>
</li>
<li>
<p>minute() - The current execution time of the query rounded down to the nearest minute.</p>
</li>
<li>
<p>hour() - The current execution time of the query rounded down to the nearest hour.</p>
</li>
<li>
<p>day() - The current execution time of the query rounded down to the nearest day.</p>
</li>
<li>
<p>week() - The current execution time of the query rounded down to the first day of the week (Monday).</p>
</li>
<li>
<p>month() - The current execution time of the query rounded down to the start of the current month.</p>
</li>
<li>
<p>year() - The current execution time of the query rounded down to the start of the current year.</p>
</li>
</ul>
<h3 id="addingsubtracting-durations">Adding/Subtracting Durations</h3>
<p>With relative times it is possible to add or subtract durations so that queries can be constructed to provide for example, the last week of data, the last hour of data etc.</p>
<p>To add/subtract a duration from a query term the duration is simply appended after the relative time, e.g.</p>
<p><code>now() + 2d</code></p>
<p>Multiple durations can be combined in the expression, e.g.</p>
<p><code>now() + 2d - 10h</code></p>
<p><code>now() + 2w - 1d10h</code></p>
<p>Durations consist of a number and duration unit. Supported duration units are:</p>
<ul>
<li>
<p>s - Seconds</p>
</li>
<li>
<p>m - Minutes</p>
</li>
<li>
<p>h - Hours</p>
</li>
<li>
<p>d - Days</p>
</li>
<li>
<p>w - Weeks</p>
</li>
<li>
<p>M - Months</p>
</li>
<li>
<p>y - Years</p>
</li>
</ul>
<p>Using these durations a query to get the last weeks data could be as follows:</p>
<p><code>between now() - 1w and now()</code></p>
<p>Or midnight a week ago to midnight today:</p>
<p><code>between day() - 1w and day()</code></p>
<p>Or if you just wanted data for the week so far:</p>
<p><code>greater than week()</code></p>
<p>Or all data for the previous year:</p>
<p><code>between year() - 1y and year()</code></p>
<p>Or this year so far:</p>
<p><code>greater than year()</code></p>

</div>




    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '4.'; page-break-before: always">
    
  <h1 id="pg-f5b20cabc4011d0d84800d887de2ccc7">4 - Data Retention</h1>
    <div class="lead">Controlling the purging/retention of old data.</div>
	<p>By default Stroom will retain all the data it ingests and creates forever.
It is likely that storage constraints/costs will mean that data needs to be deleted after a certain time.
It is also likely that certain types of data may need to be kept for longer than other types.</p>
<h2 id="rules">Rules</h2>
<p>Stroom allows for a set of data retention policy rules to be created to control at a fine grained level what data is deleted and what is retained.</p>
<p>The data retention rules are accessible by selecting <em>Data Retention</em> from the <em>Tools</em> menu.
On first use the <em>Rules</em> tab of the <em>Data Retention</em> screen will show a single rule named <em>Default Retain All Forever Rule</em>.
This is the implicit rule in stroom that retains all data and is always in play unless another rule overrides it.
This rule cannot be edited, moved or removed.</p>
<h3 id="rule-precedence">Rule Precedence</h3>
<p>Rules have a precedence, with a lower rule number being a higher priority.
When running the data retention job, Stroom will look at each stream held on the system and the retention policy of the first rule (starting from the lowest numbered rule) that matches that stream will apply.
One a matching rule is found all other rules with higher rule numbers (lower priority) are ignored.
For example if rule 1 says to retain streams from feed <code>X-EVENTS</code> for 10 years and rule 2 says to retain streams from feeds <code>*-EVENTS</code> for 1 year then rule 1 would apply to streams from feed <code>X-EVENTS</code> and they would be kept for 10 years, but rule 2 would apply to feed <code>Y-EVENTS</code> and they would only be kept for 1 year.
Rules are re-numbered as new rules are added/deleted/moved.</p>
<h3 id="creating-a-rule">Creating a Rule</h3>
<p>To create a rule do the following:</p>
<ol>
<li>Click the 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/add.svg" 
  title="Add" 
  alt="add.svg">
 icon to add a new rule.</li>
<li>Edit the expression to define the data that the rule will match on.</li>
<li>Provide a name for the rule to help describe what its purpose is.</li>
<li>Set the retention period for data matching this rule, i.e <em>Forever</em> or a set time period.</li>
</ol>
<p>The new rule will be added at the top of the list of rules, i.e. with the highest priority.
The 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/up.svg" 
  title="Up" 
  alt="up.svg">
 and 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/down.svg" 
  title="Down" 
  alt="down.svg">
 icons can be used to change the priority of the rule.</p>
<p>Rules can be enabled/disabled by clicking the checkbox next to the rule.</p>
<p>Changes to rules will not take effect until the 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/save.svg" 
  title="Save" 
  alt="save.svg">
 icon is clicked.</p>
<p>Rules can also be deleted ( 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/delete.svg" 
  title="Delete" 
  alt="delete.svg">
 ) and copied ( 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/copy.svg" 
  title="Copy" 
  alt="copy.svg">
 ).</p>
<h2 id="impact-summary">Impact Summary</h2>
<p>When you have a number of complex rules it can be difficult to determine what data will actually be deleted next time the <em>Policy Based Data Retention</em> job runs.
To help with this, Stroom has the <em>Impact Summary</em> tab that acts as a dry run for the active rules.
The impact summary provides a count of the number of streams that will be deleted broken down by rule, stream type and feed name.
On large systems with lots of data or complex rules, this query may take a long time to run.</p>
<p>The impact summary operates on the current state of the rules on the <em>Rules</em> tab whether saved or un-saved.
This allows you to make a change to the rules and test its impact before saving it.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.'; page-break-before: always">
    
  <h1 id="pg-4c538bfe356bcf1e0e261c00d44a8992">5 - Data Splitter</h1>
    
	<p>Data Splitter was created to transform text into XML. The XML produced is basic but can be processed further with XSLT to form any desired XML output.</p>
<p>Data Splitter works by using regular expressions to match a region of content or tokenizers to split content. The whole match or match group can then be output or passed to other expressions to further divide the matched data.</p>
<p>The root <code>&lt;dataSplitter&gt;</code> element controls the way content is read and buffered from the source. It then passes this content on to one or more child expressions that attempt to match the content. The child expressions attempt to match content one at a time in the order they are specified until one matches. The matching expression then passes the content that it has matched to other elements that either emit XML or apply other expressions to the content matched by the parent.</p>
<p>This process of content supply, match, (supply, match)*, emit is best illustrated in a simple CSV example. Note that the elements and attributes used in all examples are explained in detail in the <a href="../../../docs/user-guide/data-splitter/element-reference/">element reference</a>.</p>

</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.1.'; page-break-before: always">
    
  <h1 id="pg-48e91d41ce117850b608db5bec356e50">5.1 - Simple CSV Example</h1>
    
	<p>The following CSV data will be split up into separate fields using Data Splitter.</p>
<pre><code class="language-csv">01/01/2010,00:00:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,logon,
01/01/2010,00:01:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,create,c:\test.txt
01/01/2010,00:02:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,logoff,
</code></pre>
<p>The first thing we need to do is match each record. Each record in a CSV file is delimited by a new line character. The following configuration will split the data into records using ‘\n’ as a delimiter:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;
  
  &lt;!-- Match each line using a new line character as the delimiter --&gt;
  &lt;split delimiter=&quot;\n&quot;/&gt;

&lt;/dataSplitter&gt;
</code></pre>
<p>In the above example the ‘split’ tokenizer matches all of the supplied content up to the end of each line ready to pass each line of content on for further treatment.</p>
<p>We can now add a <code>&lt;group&gt;</code> element within <code>&lt;split&gt;</code> to take content matched by the tokenizer.</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;

  &lt;!-- Match each line using a new line character as the delimiter --&gt;
  &lt;split delimiter=&quot;\n&quot;&gt;

    &lt;!-- Take the matched line (using group 1 ignores the delimiters, 
    without this each match would include the new line character) --&gt;
    &lt;group value=&quot;$1&quot;&gt;

    &lt;/group&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>The <code>&lt;group&gt;</code> within the <code>&lt;split&gt;</code> chooses to take the content from the <code>&lt;split&gt;</code> without including the new line &lsquo;\n&rsquo; delimiter by using match group 1, see <a href="../../../docs/user-guide/data-splitter/match-reference/3-1-expression-match-references/#sec-3-1-1">expression match references</a> for details.</p>
<pre><code class="language-text">01/01/2010,00:00:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,logon,
</code></pre>
<p>The content selected by the <code>&lt;group&gt;</code> from its parent match can then be passed onto sub expressions for further matching:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;

  &lt;!-- Match each line using a new line character as the delimiter --&gt;
  &lt;split delimiter=&quot;\n&quot;&gt;

    &lt;!-- Take the matched line (using group 1 ignores the delimiters, 
    without this each match would include the new line character) --&gt;
    &lt;group value=&quot;$1&quot;&gt;

      &lt;!-- Match each value separated by a comma as the delimiter --&gt;
      &lt;split delimiter=&quot;,&quot;&gt;

      &lt;/split&gt;
    &lt;/group&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>In the above example the additional <code>&lt;split&gt;</code> element within the <code>&lt;group&gt;</code> will match the content provided by the group repeatedly until it has used all of the group content.</p>
<p>The content matched by the inner <code>&lt;split&gt;</code> element can be passed to a <code>&lt;data&gt;</code> element to emit XML content.</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;

  &lt;!-- Match each line using a new line character as the delimiter --&gt;
  &lt;split delimiter=&quot;\n&quot;&gt;

    &lt;!-- Take the matched line (using group 1 ignores the delimiters, 
    without this each match would include the new line character) --&gt;
    &lt;group value=&quot;$1&quot;&gt;

      &lt;!-- Match each value separated by a comma as the delimiter --&gt;
      &lt;split delimiter=&quot;,&quot;&gt;

        &lt;!-- Output the value from group 1 (as above using group 1
        ignores the delimiters, without this each value would include
        the comma) --&gt;
        &lt;data value=&quot;$1&quot; /&gt;
      &lt;/split&gt;
    &lt;/group&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>In the above example each match from the inner <code>&lt;split&gt;</code> is made available to the inner <code>&lt;data&gt;</code> element that chooses to output content from match group 1, see <a href="../../../docs/user-guide/data-splitter/match-reference/3-1-expression-match-references/#sec-3-1-1">expression match references</a> for details.</p>
<p>The above configuration results in the following XML output for the whole input:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;record&gt;
    &lt;data value=&quot;01/01/2010&quot; /&gt;
    &lt;data value=&quot;00:00:00&quot; /&gt;
    &lt;data value=&quot;192.168.1.100&quot; /&gt;
    &lt;data value=&quot;SOMEHOST.SOMEWHERE.COM&quot; /&gt;
    &lt;data value=&quot;user1&quot; /&gt;
    &lt;data value=&quot;logon&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data value=&quot;01/01/2010&quot; /&gt;
    &lt;data value=&quot;00:01:00&quot; /&gt;
    &lt;data value=&quot;192.168.1.100&quot; /&gt;
    &lt;data value=&quot;SOMEHOST.SOMEWHERE.COM&quot; /&gt;
    &lt;data value=&quot;user1&quot; /&gt;
    &lt;data value=&quot;create&quot; /&gt;
    &lt;data value=&quot;c:\test.txt&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data value=&quot;01/01/2010&quot; /&gt;
    &lt;data value=&quot;00:02:00&quot; /&gt;
    &lt;data value=&quot;192.168.1.100&quot; /&gt;
    &lt;data value=&quot;SOMEHOST.SOMEWHERE.COM&quot; /&gt;
    &lt;data value=&quot;user1&quot; /&gt;
    &lt;data value=&quot;logoff&quot; /&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.2.'; page-break-before: always">
    
  <h1 id="pg-60e04cb943539552c26ef441163ec991">5.2 - Simple CSV example with heading</h1>
    
	<p>In addition to referencing content produced by a parent element it is often desirable to store content and reference it later. The following example of a CSV with a heading demonstrates how content can be stored in a variable and then referenced later on.</p>
<h2 id="a-namesec_1_2_1ainput"><a name="sec_1_2_1"></a>Input</h2>
<p>This example will use a similar input to the one in the previous CSV example but also adds a heading line.</p>
<pre><code class="language-text">Date,Time,IPAddress,HostName,User,EventType,Detail
01/01/2010,00:00:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,logon,
01/01/2010,00:01:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,create,c:\test.txt
01/01/2010,00:02:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,logoff,
</code></pre>
<h2 id="a-namesec_1_2_2aconfiguration"><a name="sec_1_2_2"></a>Configuration</h2>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;

  &lt;!-- Match heading line (note that maxMatch=&quot;1&quot; means that only the
  first line will be matched by this splitter) --&gt;
  &lt;split delimiter=&quot;\n&quot; maxMatch=&quot;1&quot;&gt;

    &lt;!-- Store each heading in a named list --&gt;
    &lt;group&gt;
      &lt;split delimiter=&quot;,&quot;&gt;
        &lt;var id=&quot;heading&quot; /&gt;
      &lt;/split&gt;
    &lt;/group&gt;
  &lt;/split&gt;

  &lt;!-- Match each record --&gt;
  &lt;split delimiter=&quot;\n&quot;&gt;

    &lt;!-- Take the matched line --&gt;
    &lt;group value=&quot;$1&quot;&gt;

      &lt;!-- Split the line up --&gt;
      &lt;split delimiter=&quot;,&quot;&gt;

        &lt;!-- Output the stored heading for each iteration and the value
        from group 1 --&gt;
        &lt;data name=&quot;$heading$1&quot; value=&quot;$1&quot; /&gt;
      &lt;/split&gt;
    &lt;/group&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<h2 id="a-namesec_1_2_3aoutput"><a name="sec_1_2_3"></a>Output</h2>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;record&gt;
    &lt;data name=&quot;Date&quot; value=&quot;01/01/2010&quot; /&gt;
    &lt;data name=&quot;Time&quot; value=&quot;00:00:00&quot; /&gt;
    &lt;data name=&quot;IPAddress&quot; value=&quot;192.168.1.100&quot; /&gt;
    &lt;data name=&quot;HostName&quot; value=&quot;SOMEHOST.SOMEWHERE.COM&quot; /&gt;
    &lt;data name=&quot;User&quot; value=&quot;user1&quot; /&gt;
    &lt;data name=&quot;EventType&quot; value=&quot;logon&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;Date&quot; value=&quot;01/01/2010&quot; /&gt;
    &lt;data name=&quot;Time&quot; value=&quot;00:01:00&quot; /&gt;
    &lt;data name=&quot;IPAddress&quot; value=&quot;192.168.1.100&quot; /&gt;
    &lt;data name=&quot;HostName&quot; value=&quot;SOMEHOST.SOMEWHERE.COM&quot; /&gt;
    &lt;data name=&quot;User&quot; value=&quot;user1&quot; /&gt;
    &lt;data name=&quot;EventType&quot; value=&quot;create&quot; /&gt;
    &lt;data name=&quot;Detail&quot; value=&quot;c:\test.txt&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;Date&quot; value=&quot;01/01/2010&quot; /&gt;
    &lt;data name=&quot;Time&quot; value=&quot;00:02:00&quot; /&gt;
    &lt;data name=&quot;IPAdress&quot; value=&quot;192.168.1.100&quot; /&gt;
    &lt;data name=&quot;HostName&quot; value=&quot;SOMEHOST.SOMEWHERE.COM&quot; /&gt;
    &lt;data name=&quot;User&quot; value=&quot;user1&quot; /&gt;
    &lt;data name=&quot;EventType&quot; value=&quot;logoff&quot; /&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.3.'; page-break-before: always">
    
  <h1 id="pg-d7c86891e32034cff23f52e772d0957b">5.3 - Complex example with regex and user defined names</h1>
    
	<p>The following example uses a real world Apache log and demonstrates the use of regular expressions rather than simple &lsquo;split&rsquo; tokenizers. The usage and structure of regular expressions is outside of the scope of this document but Data Splitter uses Java&rsquo;s standard regular expression library that is POSIX compliant and documented in numerous places.</p>
<p>This example also demonstrates that the names and values that are output can be hard coded in the absence of field name information to make XSLT conversion easier later on. Also shown is that any match can be divided into further fields with additional expressions and the ability to nest data elements to provide structure if needed.</p>
<h2 id="a-namesec_1_3_1ainput"><a name="sec_1_3_1"></a>Input</h2>
<pre><code class="language-text">192.168.1.100 - &quot;-&quot; [12/Jul/2012:11:57:07 +0000] &quot;GET /doc.htm HTTP/1.1&quot; 200 4235 &quot;-&quot; &quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET4.0C; .NET4.0E; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)&quot;
192.168.1.100 - &quot;-&quot; [12/Jul/2012:11:57:07 +0000] &quot;GET /default.css HTTP/1.1&quot; 200 3494 &quot;http://some.server:8080/doc.htm&quot; &quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET4.0C; .NET4.0E; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)&quot;
</code></pre>
<h2 id="a-namesec_1_3_2aconfiguration"><a name="sec_1_3_2"></a>Configuration</h2>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;

  &lt;!--
  Standard Apache Format

  %h - host name should be ok without quotes
  %l - Remote logname (from identd, if supplied). This will return a dash unless IdentityCheck is set On.
  \&quot;%u\&quot; - user name should be quoted to deal with DNs
  %t - time is added in square brackets so is contained for parsing purposes
  \&quot;%r\&quot; - URL is quoted
  %&gt;s - Response code doesn't need to be quoted as it is a single number
  %b - The size in bytes of the response sent to the client
  \&quot;%{Referer}i\&quot; - Referrer is quoted so that’s ok
  \&quot;%{User-Agent}i\&quot; - User agent is quoted so also ok

  LogFormat &quot;%h %l \&quot;%u\&quot; %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
  --&gt;

  &lt;!-- Match line --&gt;
  &lt;split delimiter=&quot;\n&quot;&gt;
    &lt;group value=&quot;$1&quot;&gt;

      &lt;!-- Provide a regular expression for the whole line with match
      groups for each field we want to split out --&gt;
      &lt;regex pattern=&quot;^([^ ]+) ([^ ]+) &amp;#34;([^&amp;#34;]+)&amp;#34; \[([^\]]+)] &amp;#34;([^&amp;#34;]+)&amp;#34; ([^ ]+) ([^ ]+) &amp;#34;([^&amp;#34;]+)&amp;#34; &amp;#34;([^&amp;#34;]+)&amp;#34;&quot;&gt;
        &lt;data name=&quot;host&quot; value=&quot;$1&quot; /&gt;
        &lt;data name=&quot;log&quot; value=&quot;$2&quot; /&gt;
        &lt;data name=&quot;user&quot; value=&quot;$3&quot; /&gt;
        &lt;data name=&quot;time&quot; value=&quot;$4&quot; /&gt;
        &lt;data name=&quot;url&quot; value=&quot;$5&quot;&gt;

          &lt;!-- Take the 5th regular expression group and pass it to
          another expression to divide into smaller components --&gt;
          &lt;group value=&quot;$5&quot;&gt;
            &lt;regex pattern=&quot;^([^ ]+) ([^ ]+) ([^ /]*)/([^ ]*)&quot;&gt;
              &lt;data name=&quot;httpMethod&quot; value=&quot;$1&quot; /&gt;
              &lt;data name=&quot;url&quot; value=&quot;$2&quot; /&gt;
              &lt;data name=&quot;protocol&quot; value=&quot;$3&quot; /&gt;
              &lt;data name=&quot;version&quot; value=&quot;$4&quot; /&gt;
            &lt;/regex&gt;
          &lt;/group&gt;
        &lt;/data&gt;
        &lt;data name=&quot;response&quot; value=&quot;$6&quot; /&gt;
        &lt;data name=&quot;size&quot; value=&quot;$7&quot; /&gt;
        &lt;data name=&quot;referrer&quot; value=&quot;$8&quot; /&gt;
        &lt;data name=&quot;userAgent&quot; value=&quot;$9&quot; /&gt;
      &lt;/regex&gt;
    &lt;/group&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<h2 id="a-namesec_1_3_3aoutput"><a name="sec_1_3_3"></a>Output</h2>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;record&gt;
    &lt;data name=&quot;host&quot; value=&quot;192.168.1.100&quot; /&gt;
    &lt;data name=&quot;log&quot; value=&quot;-&quot; /&gt;
    &lt;data name=&quot;user&quot; value=&quot;-&quot; /&gt;
    &lt;data name=&quot;time&quot; value=&quot;12/Jul/2012:11:57:07 +0000&quot; /&gt;
    &lt;data name=&quot;url&quot; value=&quot;GET /doc.htm HTTP/1.1&quot;&gt;
      &lt;data name=&quot;httpMethod&quot; value=&quot;GET&quot; /&gt;
      &lt;data name=&quot;url&quot; value=&quot;/doc.htm&quot; /&gt;
      &lt;data name=&quot;protocol&quot; value=&quot;HTTP&quot; /&gt;
      &lt;data name=&quot;version&quot; value=&quot;1.1&quot; /&gt;
    &lt;/data&gt;
    &lt;data name=&quot;response&quot; value=&quot;200&quot; /&gt;
    &lt;data name=&quot;size&quot; value=&quot;4235&quot; /&gt;
    &lt;data name=&quot;referrer&quot; value=&quot;-&quot; /&gt;
    &lt;data name=&quot;userAgent&quot; value=&quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET4.0C; .NET4.0E; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;host&quot; value=&quot;192.168.1.100&quot; /&gt;
    &lt;data name=&quot;log&quot; value=&quot;-&quot; /&gt;
    &lt;data name=&quot;user&quot; value=&quot;-&quot; /&gt;
    &lt;data name=&quot;time&quot; value=&quot;12/Jul/2012:11:57:07 +0000&quot; /&gt;
    &lt;data name=&quot;url&quot; value=&quot;GET /default.css HTTP/1.1&quot;&gt;
      &lt;data name=&quot;httpMethod&quot; value=&quot;GET&quot; /&gt;
      &lt;data name=&quot;url&quot; value=&quot;/default.css&quot; /&gt;
      &lt;data name=&quot;protocol&quot; value=&quot;HTTP&quot; /&gt;
      &lt;data name=&quot;version&quot; value=&quot;1.1&quot; /&gt;
    &lt;/data&gt;
    &lt;data name=&quot;response&quot; value=&quot;200&quot; /&gt;
    &lt;data name=&quot;size&quot; value=&quot;3494&quot; /&gt;
    &lt;data name=&quot;referrer&quot; value=&quot;http://some.server:8080/doc.htm&quot; /&gt;
    &lt;data name=&quot;userAgent&quot; value=&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET4.0C; .NET4.0E; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)&quot; /&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.4.'; page-break-before: always">
    
  <h1 id="pg-4e7eb119df912b5530510cddfbbe36eb">5.4 - Multi Line Example</h1>
    
	<p>Example multi line file where records are split over may lines. There are various ways this data could be treated but this example forms a record from data created when some fictitious query starts plus the subsequent query results.</p>
<h2 id="a-namesec_1_4_1ainput"><a name="sec_1_4_1"></a>Input</h2>
<pre><code class="language-text">09/07/2016    14:49:36    User = user1
09/07/2016    14:49:36    Query = some query

09/07/2016    16:34:40    Results:
09/07/2016    16:34:40    Line 1:   result1
09/07/2016    16:34:40    Line 2:   result2
09/07/2016    16:34:40    Line 3:   result3
09/07/2016    16:34:40    Line 4:   result4

09/07/2009    16:35:21    User = user2
09/07/2009    16:35:21    Query = some other query

09/07/2009    16:45:36    Results:
09/07/2009    16:45:36    Line 1:   result1
09/07/2009    16:45:36    Line 2:   result2
09/07/2009    16:45:36    Line 3:   result3
09/07/2009    16:45:36    Line 4:   result4
</code></pre>
<h2 id="a-namesec_1_4_2aconfiguration"><a name="sec_1_4_2"></a>Configuration</h2>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;

  &lt;!-- Match each record. We want to treat the query and results as a single event so match the two sets of data separated by a double new line --&gt;
  &lt;regex pattern=&quot;\n*((.*\n)+?\n(.*\n)+?\n)|\n*(.*\n?)+&quot;&gt;
    &lt;group&gt;

      &lt;!-- Split the record into query and results --&gt;
      &lt;regex pattern=&quot;(.*?)\n\n(.*)&quot; dotAll=&quot;true&quot;&gt;

        &lt;!-- Create a data element to output query data --&gt;
        &lt;data name=&quot;query&quot;&gt;
          &lt;group value=&quot;$1&quot;&gt;

            &lt;!-- We only want to output the date and time from the first line. --&gt;
            &lt;regex pattern=&quot;([^\t]*)\t([^\t]*)[\t]*([^=:]*)[=:]*(.*)&quot; maxMatch=&quot;1&quot;&gt;
              &lt;data name=&quot;date&quot; value=&quot;$1&quot; /&gt;
              &lt;data name=&quot;time&quot; value=&quot;$2&quot; /&gt;
              &lt;data name=&quot;$3&quot; value=&quot;$4&quot; /&gt;
            &lt;/regex&gt;
            
            &lt;!-- Output all other values --&gt;
            &lt;regex pattern=&quot;([^\t]*)\t([^\t]*)[\t]*([^=:]*)[=:]*(.*)&quot;&gt;
              &lt;data name=&quot;$3&quot; value=&quot;$4&quot; /&gt;
            &lt;/regex&gt;
          &lt;/group&gt;
        &lt;/data&gt;

        &lt;!-- Create a data element to output result data --&gt;
        &lt;data name=&quot;results&quot;&gt;
          &lt;group value=&quot;$2&quot;&gt;

            &lt;!-- We only want to output the date and time from the first line. --&gt;
            &lt;regex pattern=&quot;([^\t]*)\t([^\t]*)[\t]*([^=:]*)[=:]*(.*)&quot; maxMatch=&quot;1&quot;&gt;
              &lt;data name=&quot;date&quot; value=&quot;$1&quot; /&gt;
              &lt;data name=&quot;time&quot; value=&quot;$2&quot; /&gt;
              &lt;data name=&quot;$3&quot; value=&quot;$4&quot; /&gt;
            &lt;/regex&gt;
            
            &lt;!-- Output all other values --&gt;
            &lt;regex pattern=&quot;([^\t]*)\t([^\t]*)[\t]*([^=:]*)[=:]*(.*)&quot;&gt;
              &lt;data name=&quot;$3&quot; value=&quot;$4&quot; /&gt;
            &lt;/regex&gt;
          &lt;/group&gt;
        &lt;/data&gt;
      &lt;/regex&gt;
    &lt;/group&gt;
  &lt;/regex&gt;
&lt;/dataSplitter&gt;
</code></pre>
<h2 id="a-namesec_1_4_3aoutput"><a name="sec_1_4_3"></a>Output</h2>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;2.0&quot;&gt;
  &lt;record&gt;
    &lt;data name=&quot;query&quot;&gt;
      &lt;data name=&quot;date&quot; value=&quot;09/07/2016&quot; /&gt;
      &lt;data name=&quot;time&quot; value=&quot;14:49:36&quot; /&gt;
      &lt;data name=&quot;User&quot; value=&quot;user1&quot; /&gt;
      &lt;data name=&quot;Query&quot; value=&quot;some query&quot; /&gt;
    &lt;/data&gt;
    &lt;data name=&quot;results&quot;&gt;
      &lt;data name=&quot;date&quot; value=&quot;09/07/2016&quot; /&gt;
      &lt;data name=&quot;time&quot; value=&quot;16:34:40&quot; /&gt;
      &lt;data name=&quot;Results&quot; /&gt;
      &lt;data name=&quot;Line 1&quot; value=&quot;result1&quot; /&gt;
      &lt;data name=&quot;Line 2&quot; value=&quot;result2&quot; /&gt;
      &lt;data name=&quot;Line 3&quot; value=&quot;result3&quot; /&gt;
      &lt;data name=&quot;Line 4&quot; value=&quot;result4&quot; /&gt;
    &lt;/data&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;query&quot;&gt;
      &lt;data name=&quot;date&quot; value=&quot;09/07/2016&quot; /&gt;
      &lt;data name=&quot;time&quot; value=&quot;16:35:21&quot; /&gt;
      &lt;data name=&quot;User&quot; value=&quot;user2&quot; /&gt;
      &lt;data name=&quot;Query&quot; value=&quot;some other query&quot; /&gt;
    &lt;/data&gt;
    &lt;data name=&quot;results&quot;&gt;
      &lt;data name=&quot;date&quot; value=&quot;09/07/2016&quot; /&gt;
      &lt;data name=&quot;time&quot; value=&quot;16:45:36&quot; /&gt;
      &lt;data name=&quot;Results&quot; /&gt;
      &lt;data name=&quot;Line 1&quot; value=&quot;result1&quot; /&gt;
      &lt;data name=&quot;Line 2&quot; value=&quot;result2&quot; /&gt;
      &lt;data name=&quot;Line 3&quot; value=&quot;result3&quot; /&gt;
      &lt;data name=&quot;Line 4&quot; value=&quot;result4&quot; /&gt;
    &lt;/data&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.5.'; page-break-before: always">
    
  <h1 id="pg-8f4175cc7d3f7d584edb7958e8546094">5.5 - Element Reference</h1>
    
	<p>There are various elements used in a Data Splitter configuration to control behaviour. Each of these elements can be categorised as one of the following:</p>

</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.5.1.'; ">
    
  <h1 id="pg-433f7e66c8f749c136edf8dd77485021">5.5.1 - Content Providers</h1>
    
	<p>Content providers take some content from the input source or elsewhere (see <a href="../../../docs/user-guide/data-splitter/match-reference/3-3-use-of-fixed-strings/">fixed strings</a> and provide it to one or more expressions. Both the root element <code>&lt;dataSplitter&gt;</code> and <code>&lt;group&gt;</code> elements are content providers.</p>
<h2 id="a-namesec_2_1_1aroot-element-ltdatasplittergt"><a name="sec_2_1_1"></a>Root element &lt;dataSplitter&gt;</h2>
<p>The root element of a Data Splitter configuration is <code>&lt;dataSplitter&gt;</code>. It supplies content from the input source to one or more expressions defined within it. The way that content is buffered is controlled by the root element and the way that errors are handled as a result of child expressions not matching all of the content it supplies.</p>
<h3 id="a-namesec_2_1_1_1aattributes"><a name="sec_2_1_1_1"></a>Attributes</h3>
<p>The following attributes can be added to the <code>&lt;dataSplitter&gt;</code> root element:</p>
<ul>
<li><a href="#sec-2-1-1-1-1">ignoreErrors</a></li>
<li><a href="#sec-2-1-1-1-2">bufferSize</a></li>
</ul>
<h4 id="a-namesec-2-1-1-1-1aignoreerrors"><a name="sec-2-1-1-1-1"></a>ignoreErrors</h4>
<p>Data Splitter generates errors if not all of the content is matched by the regular expressions beneath the <code>&lt;dataSplitter&gt;</code> or within <code>&lt;group&gt;</code> elements. The error messages are intended to aid the user in writing good Data Splitter configurations. The intent is to indicate when the input data is not being matched fully and therefore possibly skipping some important data. Despite this, in some cases it is laborious to have to write expressions to match all content. In these cases it is preferable to add this attribute to ignore these errors. However it is often better to write expressions that capture all of the supplied content and discard unwanted characters. This attribute also affects errors generated by the use of the minMatch attribute on <code>&lt;regex&gt;</code> which is described later on.</p>
<p>Take the following example input:</p>
<pre><code class="language-text">Name1,Name2,Name3
value1,value2,value3 # a useless comment
value1,value2,value3 # a useless comment 
</code></pre>
<p>This could be matched with the following configuration:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;regex id=&quot;heading&quot; pattern=&quot;.+&quot; maxMatch=&quot;1&quot;&gt;
…
  &lt;/regex&gt;
  &lt;regex id=&quot;body&quot; pattern=&quot;\n[^#]+&quot;&gt;
…
  &lt;/regex&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>The above configuration would only match up to a comment for each record line, e.g.</p>
<pre><code class="language-text">Name1,Name2,Name3
value1,value2,value3 # a useless comment
value1,value2,value3 # a useless comment
</code></pre>
<p>This may well be the desired functionality but if there was useful content within the comment it would be lost. Because of this Data Splitter warns you when expressions are failing to match all of the content presented so that you can make sure that you aren’t missing anything important. In the above example it is obvious that this is the required behaviour but in more complex cases you might be otherwise unaware that your expressions were losing data.</p>
<p>To maintain this assurance that you are handling all content it is usually best to write expressions to explicitly match all content even though you may do nothing with some matches, e.g.</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;regex id=&quot;heading&quot; pattern=&quot;.+&quot; maxMatch=&quot;1&quot;&gt;
…
  &lt;/regex&gt;
  &lt;regex id=&quot;body&quot; pattern=&quot;\n([^#]+)#.+&quot;&gt;
…
  &lt;/regex&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>The above example would match all of the content and would therefore not generate warnings. Sub-expressions of &lsquo;body&rsquo; could use match group 1 and ignore the comment.</p>
<p>However as previously stated it might often be difficult to write expressions that will just match content that is to be discarded. In these cases ignoreErrors can be used to suppress errors caused by unmatched content.</p>
<h4 id="a-namesec-2-1-1-1-2abuffersize-advanced"><a name="sec-2-1-1-1-2"></a>bufferSize (Advanced)</h4>
<p>This is an optional attribute used to tune the size of the character buffer used by Data Splitter. The default size is 20000 characters and should be fine for most translations. The minimum value that this can be set to is 20000 characters and the maximum is 1000000000. The only reason to specify this attribute is when individual records are bigger than 10000 characters which is rarely the case.</p>
<h2 id="a-namesec_2_1_2agroup-element-ltgroupgt"><a name="sec_2_1_2"></a>Group element &lt;group&gt;</h2>
<p>Groups behave in a similar way to the root element in that they provide content for one or more inner expressions to deal with, e.g.</p>
<pre><code class="language-xml">&lt;group value=&quot;$1&quot;&gt;
  &lt;regex pattern=&quot;([^\t]*)\t([^\t]*)[\t]*([^=:]*)[=:]*(.*)&quot; maxMatch=&quot;1&quot;&gt;
  ...
  &lt;regex pattern=&quot;([^\t]*)\t([^\t]*)[\t]*([^=:]*)[=:]*(.*)&quot;&gt;
  ...
</code></pre>
<h3 id="a-namesec_2_1_2_1aattributes"><a name="sec_2_1_2_1"></a>Attributes</h3>
<p>As the <code>&lt;group&gt;</code> element is a content provider it also includes the same &lsquo;ignoreErrors&rsquo; attribute which behaves in the same way. The complete list of attributes for the <code>&lt;group&gt;</code> element is as follows:</p>
<ul>
<li><a href="#sec-2-1-2-1-1">id</a></li>
<li><a href="#sec-2-1-2-1-2">value</a></li>
<li><a href="#sec-2-1-2-1-3">ignoreErrors</a></li>
<li><a href="#sec-2-1-2-1-4">matchOrder</a></li>
<li><a href="#sec-2-1-2-1-5">reverse</a></li>
</ul>
<h4 id="a-namesec-2-1-2-1-1aid"><a name="sec-2-1-2-1-1"></a>id</h4>
<p>When Data Splitter reports errors it outputs an XPath to describe the part of the configuration that generated the error, e.g.</p>
<pre><code class="language-text">DSParser [2:1] ERROR: Expressions failed to match all of the content provided by group: regex[0]/group[0]/regex[3]/group[1] : &lt;group&gt;
</code></pre>
<p>It is often a little difficult to identify the configuration element that generated the error by looking at the path and the element description, particularly when multiple elements are the same, e.g. many <code>&lt;group&gt;</code> elements without attributes. To make identification easier you can add an &lsquo;id&rsquo; attribute to any element in the configuration resulting in error descriptions as follows:</p>
<pre><code class="language-text">DSParser [2:1] ERROR: Expressions failed to match all of the content provided by group: regex[0]/group[0]/regex[3]/group[1] : &lt;group id=&quot;myGroupId&quot;&gt;
</code></pre>
<h4 id="a-namesec-2-1-2-1-2avalue"><a name="sec-2-1-2-1-2"></a>value</h4>
<p>This attribute determines what content to present to child expressions. By default the entire content matched by a group’s parent expression is passed on by the group to child expressions. If required, content from a specific match group in the parent expression can be passed to child expressions using the value attribute, e.g. <code>value=&quot;$1&quot;</code>. In addition to this content can be composed in the same way as it is for data names and values. see <a href="../../../docs/user-guide/data-splitter/match-reference/">match references</a> for a full description of match references.</p>
<h4 id="a-namesec-2-1-2-1-3aignoreerrors"><a name="sec-2-1-2-1-3"></a>ignoreErrors</h4>
<p>This behaves in the same way as for the root element.</p>
<h4 id="a-namesec-2-1-2-1-4amatchorder"><a name="sec-2-1-2-1-4"></a>matchOrder</h4>
<p>This is an optional attribute used to control how content is consumed by expression matches. Content can be consumed in sequence or in any order using <code>matchOrder=&quot;sequence&quot;</code> or <code>matchOrder=&quot;any&quot;</code>. If the attribute is not specified, Data Splitter will default to matching in sequence.</p>
<p>When matching in sequence, each match consumes some content and the content position is moved beyond the match ready for the subsequent match. However, in some cases the order of these constructs is not predictable, e.g. we may sometimes be presented with:</p>
<pre><code class="language-text">Value1=1 Value2=2
</code></pre>
<p>… or sometimes with:</p>
<pre><code class="language-text">Value2=2 Value1=1
</code></pre>
<p>Using a sequential match order the following example would work to find both values in <code>Value1=1 Value2=2</code></p>
<pre><code class="language-xml">&lt;group&gt;
  &lt;regex pattern=&quot;Value1=([^ ]*)&quot;&gt;
  ...
  &lt;regex pattern=&quot;Value2=([^ ]*)&quot;&gt;
  ...
</code></pre>
<p>… but this example would skip over Value2 and only find the value of Value1 if the input was <code>Value2=2 Value1=1</code>.</p>
<p>To be able to deal with content that contains these constructs in either order we need to change the match order to <code>any</code>.</p>
<p>When matching in any order, each match removes the matched section from the content rather than moving the position past the match so that all remaining content can be matched by subsequent expressions. In the following example the first expression would match and remove <code>Value1=1</code> from the supplied content and the second expression would be presented with <code> Value2=2</code> which it could also match.</p>
<pre><code class="language-xml">&lt;group matchOrder=&quot;any&quot;&gt;
  &lt;regex pattern=&quot;Value1=([^ ]*)&quot;&gt;
  ...
  &lt;regex pattern=&quot;Value2=([^ ]*)&quot;&gt;
  ...
</code></pre>
<p>If the attribute is omitted by default the match order will be sequential. This is the default behaviour as tokens are most often in sequence and consuming content in this way is more efficient as content does not need to be copied by the parser to chop out sections as is required for matching in any order. It is only necessary to use this feature when fields that are identifiable with a specific match can occur in any order.</p>
<h4 id="a-namesec-2-1-2-1-5areverse"><a name="sec-2-1-2-1-5"></a>reverse</h4>
<p>Occasionally it is desirable to reverse the content presented by a group to child expressions. This is because it is sometimes easier to form a pattern by matching content in reverse.</p>
<p>Take the following example content of name, value pairs delimited by <code>=</code> but with no spaces between names, multiple spaces between values and only a space between subsequent pairs:</p>
<pre><code class="language-text">ipAddress=123.123.123.123 zones=Zone 1, Zone 2, Zone 3 location=loc1 A user=An end user serverName=bigserver
</code></pre>
<p>We could write a pattern that matches each name value pair by matching up to the start of the next name, e.g.</p>
<pre><code class="language-xml">&lt;regex pattern=&quot;([^=]+)=(.+?)( [^=]+=)&quot;&gt;
</code></pre>
<p>This would match the following:</p>
<pre><code class="language-text">ipAddress=123.123.123.123 zones=
</code></pre>
<p>Here we are capturing the name and value for each pair in separate groups but the pattern has to also match the name from the next name value pair to find the end of the value. By default Data Splitter will move the content buffer to the end of the match ready for subsequent matches so the next name will not be available for matching.</p>
<p>In addition to matching too much content the above example also uses a reluctant qualifier <code>.+?</code>. Use of reluctant qualifiers almost always impacts performance so they are to be avoided if at all possible.</p>
<p>A better way to match the example content is to match the input in reverse, reading characters from right to left.</p>
<p>The following example demonstrates this:</p>
<pre><code class="language-xml">&lt;group reverse=&quot;true&quot;&gt;
  &lt;regex pattern=&quot;([^=]+)=([^ ]+)&quot;&gt;
    &lt;data name=&quot;$2&quot; value=&quot;$1&quot; /&gt;
  &lt;/regex&gt;
&lt;/group&gt;
</code></pre>
<p>Using the reverse attribute on the parent group causes content to be supplied to all child expressions in reverse order. In the above example this allows the pattern to match values followed by names which enables us to cope with the fact that values have multiple spaces but names have no spaces.</p>
<p>Content is only presented to child regular expressions in reverse. When referencing values from match groups the content is returned in the correct order, e.g. the above example would return:</p>
<pre><code class="language-xml">&lt;data name=&quot;ipAddress&quot; value=&quot;123.123.123.123&quot; /&gt;
&lt;data name=&quot;zones&quot; value=&quot;Zone 1, Zone 2, Zone 3&quot; /&gt;
&lt;data name=&quot;location&quot; value=&quot;loc1&quot; /&gt;
&lt;data name=&quot;user&quot; value=&quot;An end user&quot; /&gt;
&lt;data name=&quot;serverName&quot; value=&quot;bigserver&quot; /&gt;
</code></pre>
<p>The reverse feature isn&rsquo;t needed very often but there are a few cases where it really helps produce the desired output without the complexity and performance overhead of a reluctant match.</p>
<p>An alternative to using the reverse attribute is to use the original reluctant expression example but tell Data Splitter to make the subsequent name available for the next match by not advancing the content beyond the end of the previous value. This is done by using the <a href="../../../docs/user-guide/data-splitter/element-reference/2-2-expressions/#sec-2-2-2-1-5">advance attribute</a> on the <code>&lt;regex&gt;</code>. However, the reverse attribute represents a better way to solve this particular problem and allows a simpler and more efficient regular expression to be used.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.5.2.'; page-break-before: always">
    
  <h1 id="pg-002b4e409b3795e26b4c2c408449ace2">5.5.2 - Expressions</h1>
    
	<p>Expressions match some data supplied by a parent content provider. The content matched by an expression depends on the type of expression and how it is configured.</p>
<p>The <code>&lt;split&gt;</code>, <code>&lt;regex&gt;</code> and <code>&lt;all&gt;</code> elements are all expressions and match content as described below.</p>
<h2 id="a-namesec_2_2_1athe-ltsplitgt-element"><a name="sec_2_2_1"></a>The &lt;split&gt; element</h2>
<p>The <code>&lt;split&gt;</code> element directs Data Splitter to break up content using a specified character sequence as a delimiter. In addition to this it is possible to specify characters that are used to escape the delimiter as well as characters that contain or &ldquo;quote&rdquo; a value that may include the delimiter sequence but allow it to be ignored.</p>
<h3 id="a-namesec_2_2_1_1aattributes"><a name="sec_2_2_1_1"></a>Attributes</h3>
<p>The <code>&lt;split&gt;</code> element has the following attributes:</p>
<ul>
<li><a href="#sec-2-2-1-1-1">id</a></li>
<li><a href="#sec-2-2-1-1-2">delimiter</a></li>
<li><a href="#sec-2-2-1-1-3">escape</a></li>
<li><a href="#sec-2-2-1-1-4">containerStart</a></li>
<li><a href="#sec-2-2-1-1-5">containerEnd</a></li>
<li><a href="#sec-2-2-1-1-6">maxMatch</a></li>
<li><a href="#sec-2-2-1-1-7">minMatch</a></li>
<li><a href="#sec-2-2-1-1-8">onlyMatch</a></li>
</ul>
<h4 id="a-namesec-2-2-1-1-1aid"><a name="sec-2-2-1-1-1"></a>id</h4>
<p>Optional attribute used to debug the location of expressions causing errors, see <a href="../../../docs/user-guide/data-splitter/element-reference/2-1-content-providers/#sec-2-1-2-1-1">id</a>.</p>
<h4 id="a-namesec-2-2-1-1-2adelimiter"><a name="sec-2-2-1-1-2"></a>delimiter</h4>
<p>A required attribute used to specify the character string that will be used as a delimiter to split the supplied content unless it is preceded by an escape character or within a container if specified. Several of the previous examples use this attribute.</p>
<h4 id="a-namesec-2-2-1-1-3aescape"><a name="sec-2-2-1-1-3"></a>escape</h4>
<p>An optional attribute used to specify a character sequence that is used to escape the delimiter. Many delimited text formats have an escape character that is used to tell any parser that the following delimiter should be ignored, e.g. often a character such as &lsquo;' is used to escape the character that follows it so that it is not treated as a delimiter. When specified this escape sequence also applies to any container characters that may be specified.</p>
<h4 id="a-namesec-2-2-1-1-4acontainerstart"><a name="sec-2-2-1-1-4"></a>containerStart</h4>
<p>An optional attribute used to specify a character sequence that will make this expression ignore the presence of delimiters until an end container is found. If the character is preceded by the specified escape sequence then this container sequence will be ignored and the expression will continue matching characters up to a delimiter.</p>
<p>If used <code>containerEnd</code> must also be specified. If the container characters are to be ignored from the match then match group 1 must be used instead of 0.</p>
<h4 id="a-namesec-2-2-1-1-5acontainerend"><a name="sec-2-2-1-1-5"></a>containerEnd</h4>
<p>An optional attribute used to specify a character sequence that will make this expression stop ignoring the presence of delimiters if it believes it is currently in a container. If the character is preceded by the specified escape sequence then this container sequence will be ignored and the expression will continue matching characters while ignoring the presence of any delimiter.</p>
<p>If used <code>containerStart</code> must also be specified. If the container characters are to be ignored from the match then match group 1 must be used instead of 0.</p>
<h4 id="a-namesec-2-2-1-1-6amaxmatch"><a name="sec-2-2-1-1-6"></a>maxMatch</h4>
<p>An optional attribute used to specify the maximum number of times this expression is allowed to match the supplied content. If you do not supply this attribute then the Data Splitter will keep matching the supplied content until it reaches the end. If specified Data Splitter will stop matching the supplied content when it has matched it the specified number of times.</p>
<p>This attribute is used in the <a href="../../../docs/user-guide/data-splitter/1-2-simple-csv-example-with-heading/">&lsquo;CSV with header line&rsquo;</a> example to ensure that only the first line is treated as a header line.</p>
<h4 id="a-namesec-2-2-1-1-7aminmatch"><a name="sec-2-2-1-1-7"></a>minMatch</h4>
<p>An optional attribute used to specify the minimum number of times this expression should match the supplied content. If you do not supply this attribute then Data Splitter will not enforce that the expression matches the supplied content. If specified Data Splitter will generate an error if the expression does not match the supplied content at least as many times as specified.</p>
<p>Unlike <code>maxMatch</code>, <code>minMatch</code> does not control the matching process but instead controls the production of error messages generated if the parser is not seeing the expected input.</p>
<h4 id="a-namesec-2-2-1-1-8aonlymatch"><a name="sec-2-2-1-1-8"></a>onlyMatch</h4>
<p>Optional attribute to use this expression only for specific instances of a match of the parent expression, e.g. on the 4th, 5th and 8th matches of the parent expression specified by &lsquo;4,5,8&rsquo;. This is used when this expression should only be used to subdivide content from certain parent matches.</p>
<h2 id="a-namesec_2_2_2athe-ltregexgt-element"><a name="sec_2_2_2"></a>The &lt;regex&gt; element</h2>
<p>The <code>&lt;regex&gt;</code> element directs Data Splitter to match content using the specified regular expression pattern. In addition to this the same match control attributes that are available on the <code>&lt;split&gt;</code> element are also present as well as attributes to alter the way the pattern works.</p>
<h3 id="a-namesec_2_2_2_1aattributes"><a name="sec_2_2_2_1"></a>Attributes</h3>
<p>The <code>&lt;regex&gt;</code> element has the following attributes:</p>
<ul>
<li><a href="#sec-2-2-2-1-1">id</a></li>
<li><a href="#sec-2-2-2-1-2">pattern</a></li>
<li><a href="#sec-2-2-2-1-3">dotAll</a></li>
<li><a href="#sec-2-2-2-1-4">caseInsensitive</a></li>
<li><a href="#sec-2-2-2-1-5">maxMatch</a></li>
<li><a href="#sec-2-2-2-1-6">minMatch</a></li>
<li><a href="#sec-2-2-2-1-7">onlyMatch</a></li>
<li><a href="#sec-2-2-2-1-8">advance</a></li>
</ul>
<h4 id="a-namesec-2-2-2-1-1aid"><a name="sec-2-2-2-1-1"></a>id</h4>
<p>Optional attribute used to debug the location of expressions causing errors, see <a href="../../../docs/user-guide/data-splitter/element-reference/2-1-content-providers/#sec-2-1-2-1-1">id</a>.</p>
<h4 id="a-namesec-2-2-2-1-2apattern"><a name="sec-2-2-2-1-2"></a>pattern</h4>
<p>This is a required attribute used to specify a regular expression to use to match on the supplied content. The pattern is used to match the content multiple times until the end of the content is reached while the maxMatch and onlyMatch conditions are satisfied.</p>
<h4 id="a-namesec-2-2-2-1-3adotall"><a name="sec-2-2-2-1-3"></a>dotAll</h4>
<p>An optional attribute used to specify if the use of &lsquo;.&rsquo; in the supplied pattern matches all characters including new lines. If &rsquo;true&rsquo; &lsquo;.&rsquo; will match all characters including new lines, if &lsquo;false&rsquo; it will only match up to a new line. If this attribute is not specified it defaults to &lsquo;false&rsquo; and will only match up to a new line.</p>
<p>This attribute is used in many of the multiline examples above.</p>
<h4 id="a-namesec-2-2-2-1-4acaseinsensitive"><a name="sec-2-2-2-1-4"></a>caseInsensitive</h4>
<p>An optional attribute used to specify if the supplied pattern should match content in a case insensitive way. If &rsquo;true&rsquo; the expression will match content in a case insensitive manner, if &lsquo;false&rsquo; it will match the content in a case sensitive manner. If this attribute is not specified it defaults to &lsquo;false&rsquo; and will match the content in a case sensitive manner.</p>
<h4 id="a-namesec-2-2-2-1-5amaxmatch"><a name="sec-2-2-2-1-5"></a>maxMatch</h4>
<p>This is used in the same way it is on the <code>&lt;split&gt;</code> element, see <a href="#sec-2-2-1-1-6">maxMatch</a>.</p>
<h4 id="a-namesec-2-2-2-1-6aminmatch"><a name="sec-2-2-2-1-6"></a>minMatch</h4>
<p>This is used in the same way it is on the <code>&lt;split&gt;</code> element, see <a href="#sec-2-2-1-1-7">minMatch</a>.</p>
<h4 id="a-namesec-2-2-2-1-7aonlymatch"><a name="sec-2-2-2-1-7"></a>onlyMatch</h4>
<p>This is used in the same way it is on the <code>&lt;split&gt;</code> element, see <a href="#sec-2-2-1-1-8">onlyMatch</a>.</p>
<h4 id="a-namesec-2-2-2-1-8aadvance"><a name="sec-2-2-2-1-8"></a>advance</h4>
<p>After an expression has matched content in the buffer, the buffer start position is advanced so that it moves to the end of the entire match. This means that subsequent expressions operating on the content buffer will not see the previously matched content again. This is normally required behaviour, but in some cases some of the content from a match is still required for subsequent matches. Take the following example of name value pairs:</p>
<pre><code class="language-text">name1=some value 1 name2=some value 2 name3=some value 3
</code></pre>
<p>The first name value pair could be matched with the following expression:</p>
<pre><code class="language-xml">&lt;regex pattern=&quot;([^=]+)=(.+?) [^= ]+=&quot;&gt;
</code></pre>
<p>The above expression would match as follows:</p>
<pre><code class="language-text">name1=some value 1 name2=some value 2 name3=some value 3
</code></pre>
<p>In this example we have had to do a reluctant match to extract the value in group 2 and not include the subsequent name. Because the reluctant match requires us to specify what we are reluctantly matching up to, we have had to include an expression after it that matches the next name.</p>
<p>By default the parser will move the character buffer to the end of the entire match so the next expression will be presented with the following:</p>
<pre><code class="language-text">some value 2 name3=some value 3
</code></pre>
<p>Therefore <code>name2</code> will have been lost from the content buffer and will not be available for matching.</p>
<p>This behaviour can be altered by telling the expression how far to advance the character buffer after matching. This is done with the advance attribute and is used to specify the match group whose end position should be treated as the point the content buffer should advance to, e.g.</p>
<pre><code class="language-xml">&lt;regex pattern=&quot;([^=]+)=(.+?) [^= ]+=&quot; advance=&quot;2&quot;&gt;
</code></pre>
<p>In this example the content buffer will only advance to the end of match group 2 and subsequent expressions will be presented with the following content:</p>
<pre><code class="language-text">name2=some value 2 name3=some value 3
</code></pre>
<p>Therefore <code>name2</code> will still be available in the content buffer.</p>
<p>It is likely that the advance feature will only be useful in cases where a reluctant match is performed. Reluctant matches are discouraged for performance reasons so this feature should rarely be used. A better way to tackle the above example would be to present the content in <a href="../../../docs/user-guide/data-splitter/element-reference/2-1-content-providers/#sec-2-1-2-1-5">reverse</a>, however this is only possible if the expression is within a group, i.e. is not a root expression. There may also be more complex cases where reversal is not an option and the use of a reluctant match is the only option.</p>
<h2 id="a-namesec_2_2_3athe-ltallgt-element"><a name="sec_2_2_3"></a>The &lt;all&gt; element</h2>
<p>The <code>&lt;all&gt;</code> element matches the entire content of the parent group and makes it available to child groups or <code>&lt;data&gt;</code> elements. The purpose of <code>&lt;all&gt;</code> is to act as a catch all expression to deal with content that is not handled by a more specific expression, e.g. to output some other unknown, unrecognised or unexpected data.</p>
<pre><code class="language-xml">&lt;group&gt;
  &lt;regex pattern=&quot;^\s*([^=]+)=([^=]+)\s*&quot;&gt;
    &lt;data name=&quot;$1&quot; value=&quot;$2&quot; /&gt;
  &lt;/regex&gt;

  &lt;!-- Output unexpected data --&gt;
  &lt;all&gt;
    &lt;data name=&quot;unknown&quot; value=&quot;$&quot; /&gt;
  &lt;/all&gt;
&lt;/group&gt;
</code></pre>
<p>The <code>&lt;all&gt;</code> element provides the same functionality as using <code>.*</code> as a pattern in a <code>&lt;regex&gt;</code> element and where dotAll is set to true, e.g. <code>&lt;regex pattern=&quot;.*&quot; dotAll=&quot;true&quot;&gt;</code>. However it performs much faster as it doesn’t require pattern matching logic and is therefore always preferred.</p>
<h3 id="a-namesec_2_2_3_1aattributes"><a name="sec_2_2_3_1"></a>Attributes</h3>
<p>The <code>&lt;all&gt;</code> element has the following attributes:</p>
<ul>
<li><a href="#sec-2-2-3-1-1">id</a></li>
</ul>
<h4 id="a-namesec-2-2-3-1-1aid"><a name="sec-2-2-3-1-1"></a>id</h4>
<p>Optional attribute used to debug the location of expressions causing errors, see <a href="../../../docs/user-guide/data-splitter/element-reference/2-1-content-providers/#sec-2-1-2-1-1">id</a>.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.5.3.'; page-break-before: always">
    
  <h1 id="pg-7a65167c519705ee561f6d7d28e6dd8a">5.5.3 - Output</h1>
    
	<p>As with all other aspects of Data Splitter, output XML is determined by adding certain elements to the Data Splitter configuration.</p>
<h2 id="a-namesec_2_4_1athe-ltdatagt-element"><a name="sec_2_4_1"></a>The &lt;data&gt; element</h2>
<p>Output is created by Data Splitter using one or more <code>&lt;data&gt;</code> elements in the configuration. The first <code>&lt;data&gt;</code> element that is encountered within a matched expression will result in parent <code>&lt;record&gt;</code> elements being produced in the output.</p>
<h3 id="a-namesec_2_4_1_1aattributes"><a name="sec_2_4_1_1"></a>Attributes</h3>
<p>The <code>&lt;data&gt;</code> element has the following attributes:</p>
<ul>
<li><a href="#sec-2-4-1-1-1">id</a></li>
<li><a href="#sec-2-4-1-1-2">name</a></li>
<li><a href="#sec-2-4-1-1-3">value</a></li>
</ul>
<h4 id="a-namesec-2-4-1-1-1aid"><a name="sec-2-4-1-1-1"></a>id</h4>
<p>Optional attribute used to debug the location of expressions causing errors, see <a href="../../../docs/user-guide/data-splitter/element-reference/2-1-content-providers/#sec-2-1-2-1-1">id</a>.</p>
<h4 id="a-namesec-2-4-1-1-2aname"><a name="sec-2-4-1-1-2"></a>name</h4>
<p>Both the name and value attributes of the <code>&lt;data&gt;</code> element can be specified using <a href="../../../docs/user-guide/data-splitter/match-reference/">match references</a>.</p>
<h4 id="a-namesec-2-4-1-1-3avalue"><a name="sec-2-4-1-1-3"></a>value</h4>
<p>Both the name and value attributes of the <code>&lt;data&gt;</code> element can be specified using <a href="../../../docs/user-guide/data-splitter/match-reference/">match references</a>.</p>
<h4 id="a-namesec_2_4_1_2asingle-ltdatagt-element-example"><a name="sec_2_4_1_2"></a>Single &lt;data&gt; element example</h4>
<p>The simplest example that can be provided uses a single <code>&lt;data&gt;</code> element within a <code>&lt;split&gt;</code> expression.</p>
<p>Given the following input:</p>
<pre><code class="language-text">This is line 1
This is line 2
This is line 3
</code></pre>
<p>… and the following configuration:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;split delimiter=&quot;\n&quot; &gt;
    &lt;data value=&quot;$1&quot;/&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>… you would get the following output:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;record&gt;
    &lt;data value=&quot;This is line 1&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data value=&quot;This is line 2&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data value=&quot;This is line 3&quot; /&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>
<h4 id="a-namesec_2_4_1_3amultiple-ltdatagt-element-example"><a name="sec_2_4_1_3"></a>Multiple &lt;data&gt; element example</h4>
<p>You could also output multiple <code>&lt;data&gt;</code> elements for the same <code>&lt;record&gt;</code> by adding multiple elements within the same expression:</p>
<p>Given the following input:</p>
<pre><code class="language-text">ip=1.1.1.1 user=user1
ip=2.2.2.2 user=user2
ip=3.3.3.3 user=user3
</code></pre>
<p>… and the following configuration:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;regex pattern=&quot;ip=([^ ]+) user=([^ ]+)\s*&quot;&gt;
    &lt;data name=&quot;ip&quot; value=&quot;$1&quot;/&gt;
    &lt;data name=&quot;user&quot; value=&quot;$2&quot;/&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>… you would get the following output:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;record&gt;
    &lt;data name=&quot;ip&quot; value=&quot;1.1.1.1&quot; /&gt;
    &lt;data name=&quot;user&quot; value=&quot;user1&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;ip&quot; value=&quot;2.2.2.2&quot; /&gt;
    &lt;data name=&quot;user&quot; value=&quot;user2&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;ip&quot; value=&quot;3.3.3.3&quot; /&gt;
    &lt;data name=&quot;user&quot; value=&quot;user3&quot; /&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>
<h3 id="a-namesec_2_4_1_4amulti-level-ltdatagt-elements"><a name="sec_2_4_1_4"></a>Multi level &lt;data&gt; elements</h3>
<p>As long as all data elements occur within the same parent/ancestor expression, all data elements will be output within the same record.</p>
<p>Given the following input:</p>
<pre><code class="language-text">ip=1.1.1.1 user=user1
ip=2.2.2.2 user=user2
ip=3.3.3.3 user=user3
</code></pre>
<p>… and the following configuration:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;split delimiter=&quot;\n&quot; &gt;
    &lt;data name=&quot;line&quot; value=&quot;$1&quot;/&gt;

    &lt;group value=&quot;$1&quot;&gt;
      &lt;regex pattern=&quot;ip=([^ ]+) user=([^ ]+)&quot;&gt;
        &lt;data name=&quot;ip&quot; value=&quot;$1&quot;/&gt;
        &lt;data name=&quot;user&quot; value=&quot;$2&quot;/&gt;
      &lt;/regex&gt;
    &lt;/group&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>… you would get the following output:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=1.1.1.1 user=user1&quot; /&gt;
    &lt;data name=&quot;ip&quot; value=&quot;1.1.1.1&quot; /&gt;
    &lt;data name=&quot;user&quot; value=&quot;user1&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=2.2.2.2 user=user2&quot; /&gt;
    &lt;data name=&quot;ip&quot; value=&quot;2.2.2.2&quot; /&gt;
    &lt;data name=&quot;user&quot; value=&quot;user2&quot; /&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=3.3.3.3 user=user3&quot; /&gt;
    &lt;data name=&quot;ip&quot; value=&quot;3.3.3.3&quot; /&gt;
    &lt;data name=&quot;user&quot; value=&quot;user3&quot; /&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>
<h3 id="a-namesec_2_4_1_5anesting-ltdatagt-elements"><a name="sec_2_4_1_5"></a>Nesting &lt;data&gt; elements</h3>
<p>Rather than having <code>&lt;data&gt;</code> elements all appear as children of <code>&lt;record&gt;</code> it is possible to nest them either as direct children or within child groups.</p>
<h4 id="a-namesec-2-4-1-5-1adirect-children"><a name="sec-2-4-1-5-1"></a>Direct children</h4>
<p>Given the following input:</p>
<pre><code class="language-text">ip=1.1.1.1 user=user1
ip=2.2.2.2 user=user2
ip=3.3.3.3 user=user3
</code></pre>
<p>… and the following configuration:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;regex pattern=&quot;ip=([^ ]+) user=([^ ]+)\s*&quot;&gt;
    &lt;data name=&quot;line&quot; value=&quot;$&quot;&gt;
      &lt;data name=&quot;ip&quot; value=&quot;$1&quot;/&gt;
      &lt;data name=&quot;user&quot; value=&quot;$2&quot;/&gt;
    &lt;/data&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>… you would get the following output:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=1.1.1.1 user=user1&quot;&gt;
      &lt;data name=&quot;ip&quot; value=&quot;1.1.1.1&quot; /&gt;
      &lt;data name=&quot;user&quot; value=&quot;user1&quot; /&gt;
    &lt;/data&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=2.2.2.2 user=user2&quot;&gt;
      &lt;data name=&quot;ip&quot; value=&quot;2.2.2.2&quot; /&gt;
      &lt;data name=&quot;user&quot; value=&quot;user2&quot; /&gt;
    &lt;/data&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=3.3.3.3 user=user3&quot;&gt;
      &lt;data name=&quot;ip&quot; value=&quot;3.3.3.3&quot; /&gt;
      &lt;data name=&quot;user&quot; value=&quot;user3&quot; /&gt;
    &lt;/data&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>
<h4 id="a-namesec-2-4-1-5-2awithin-child-groups"><a name="sec-2-4-1-5-2"></a>Within child groups</h4>
<p>Given the following input:</p>
<pre><code class="language-text">ip=1.1.1.1 user=user1
ip=2.2.2.2 user=user2
ip=3.3.3.3 user=user3
</code></pre>
<p>… and the following configuration:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;split delimiter=&quot;\n&quot; &gt;
    &lt;data name=&quot;line&quot; value=&quot;$1&quot;&gt;
      &lt;group value=&quot;$1&quot;&gt;
        &lt;regex pattern=&quot;ip=([^ ]+) user=([^ ]+)&quot;&gt;
          &lt;data name=&quot;ip&quot; value=&quot;$1&quot;/&gt;
          &lt;data name=&quot;user&quot; value=&quot;$2&quot;/&gt;
        &lt;/regex&gt;
      &lt;/group&gt;
    &lt;/data&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>… you would get the following output:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records xmlns=&quot;records:2&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot; version=&quot;3.0&quot;&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=1.1.1.1 user=user1&quot;&gt;
      &lt;data name=&quot;ip&quot; value=&quot;1.1.1.1&quot; /&gt;
      &lt;data name=&quot;user&quot; value=&quot;user1&quot; /&gt;
    &lt;/data&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=2.2.2.2 user=user2&quot;&gt;
      &lt;data name=&quot;ip&quot; value=&quot;2.2.2.2&quot; /&gt;
      &lt;data name=&quot;user&quot; value=&quot;user2&quot; /&gt;
    &lt;/data&gt;
  &lt;/record&gt;
  &lt;record&gt;
    &lt;data name=&quot;line&quot; value=&quot;ip=3.3.3.3 user=user3&quot;&gt;
      &lt;data name=&quot;ip&quot; value=&quot;3.3.3.3&quot; /&gt;
      &lt;data name=&quot;user&quot; value=&quot;user3&quot; /&gt;
    &lt;/data&gt;
  &lt;/record&gt;
&lt;/records&gt;
</code></pre>
<p>The above example produces the same output as the previous but could be used to apply much more complex expression logic to produce the child <code>&lt;data&gt;</code> elements, e.g. the inclusion of multiple child expressions to deal with different types of lines.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.5.4.'; page-break-before: always">
    
  <h1 id="pg-51f3f0c126598dfdbe243f6ba10324b0">5.5.4 - Variables</h1>
    
	<p>A variable is added to Data Splitter using the <code>&lt;var&gt;</code> element. A variable is used to store matches from a parent expression for use in a reference elsewhere in the configuration, see <a href="../../../docs/user-guide/data-splitter/match-reference/3-2-variable-reference/#variable-reference">variable reference</a>.</p>
<p>The most recent matches are stored for use in local references, i.e. references that are in the same match scope as the variable. Multiple matches are stored for use in references that are in a separate match scope. The concept of different variable scopes is described in <a href="../../../docs/user-guide/data-splitter/match-reference/3-2-variable-reference/#sec-3-2-2">scopes</a>.</p>
<h2 id="a-namesec-2-3-1athe-ltvargt-element"><a name="sec-2-3-1"></a>The &lt;var&gt; element</h2>
<p>The <code>&lt;var&gt;</code> element is used to tell Data Splitter to store matches from a parent expression for use in a reference.</p>
<h3 id="a-namesec-2-3-1-1aattributes"><a name="sec-2-3-1-1"></a>Attributes</h3>
<p>The <code>&lt;var&gt;</code> element has the following attributes:</p>
<ul>
<li><a href="#sec-2-3-1-1-1">id</a></li>
</ul>
<h4 id="a-namesec-2-3-1-1-1aid"><a name="sec-2-3-1-1-1"></a>id</h4>
<p>Mandatory attribute used to uniquely identify it within the configuration (see <a href="../../../docs/user-guide/data-splitter/element-reference/2-1-content-providers/#sec-2-1-2-1-1">id</a>) and is the means by which a variable is referenced, e.g. <code>$VAR_ID$</code>.</p>

</div>




    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.6.'; page-break-before: always">
    
  <h1 id="pg-aaf101b97e91090cfb3df1bcf42a141a">5.6 - Match References, Variables and Fixed Strings</h1>
    
	<p>The <code>&lt;group&gt;</code> and <code>&lt;data&gt;</code> elements can reference match groups from parent expressions or from stored matches in variables. In the case of the <code>&lt;group&gt;</code> element, referenced values are passed on to child expressions whereas the <code>&lt;data&gt;</code> element can use match group references for name and value attributes. In the case of both elements the way of specifying references is the same.</p>

</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.6.1.'; page-break-before: always">
    
  <h1 id="pg-3b82e13ffa085113005df16df1cec517">5.6.1 - Concatenation of references</h1>
    
	<p>It is possible to concatenate multiple fixed strings and match group references using the <code>+</code> character. As with all references and fixed strings this can be done in <code>&lt;group&gt;</code> value and <code>&lt;data&gt;</code> name and value attributes. However concatenation does have some performance overhead as new buffers have to be created to store concatenated content.</p>
<p>A good example of concatenation is the production of ISO8601 date format from data in the previous example:</p>
<pre><code class="language-csv">01/01/2010,00:00:00
</code></pre>
<p>Here the following <code>&lt;regex&gt;</code> could be used to extract the relevant date, time groups:</p>
<pre><code class="language-xml">&lt;regex pattern=&quot;(\d{2})/(\d{2})/(\d{4}),(\d{2}):(\d{2}):(\d{2})&quot;&gt;
</code></pre>
<p>The match groups from this expression can be concatenated with the following value output pattern in the data element:</p>
<pre><code class="language-xml">&lt;data name=&quot;dateTime&quot; value=&quot;$3+’-‘+$2+’-‘+$1+’-‘+’T’+$4+’:’+$5+’:’+$6+’.000Z’&quot; /&gt;
</code></pre>
<p>Using the original example, this would result in the output:</p>
<pre><code class="language-xml">&lt;data name=&quot;dateTime&quot; value=&quot;2010-01-01T00:00:00.000Z&quot; /&gt;
</code></pre>
<p>Note that the value output pattern wraps all fixed strings in single quotes. This is necessary when concatenating strings and references so that Data Splitter can determine which parts are to be treated as fixed strings. This also allows fixed strings to contain <code>$</code> and <code>+</code> characters.</p>
<p>As single quotes are used for this purpose, a single quote needs to be escaped with another single quote if one is desired in a fixed string, e.g.</p>
<pre><code class="language-text">‘this ‘’is quoted text’’’
</code></pre>
<p>will result in:</p>
<pre><code class="language-text">this ‘is quoted text’
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.6.2.'; page-break-before: always">
    
  <h1 id="pg-1634da39a3ac0fbcef0aa75957192611">5.6.2 - Expression match references</h1>
    
	<p>Referencing matches in expressions is done using <code>$</code>. In addition to this a match group number may be added to just retrieve part of the expression match. The applicability and effect that this has depends on the type of expression used.</p>
<h2 id="a-namesec-3-1-1areferences-to-ltsplitgt-match-groups"><a name="sec-3-1-1"></a>References to &lt;split&gt; Match Groups</h2>
<p>In the following example a line matched by a parent <code>&lt;split&gt;</code> expression is referenced by a child <code>&lt;data&gt;</code> element.</p>
<pre><code class="language-xml">&lt;split delimiter=&quot;\n&quot; &gt;
  &lt;data name=&quot;line&quot; value=&quot;$&quot;/&gt;
&lt;/split&gt;
</code></pre>
<p>A <code>&lt;split&gt;</code> element matches content up to and including the specified <a href="../../../docs/user-guide/data-splitter/element-reference/2-2-expressions/#sec-2-2-1-1-2">delimiter</a>, so the above reference would output the entire line plus the delimiter. However there are various match groups that can be used by child <code>&lt;group&gt;</code> and <code>&lt;data&gt;</code> elements to reference sections of the matched content.</p>
<p>To illustrate the content provided by each match group, take the following example:</p>
<pre><code class="language-text">&quot;This is some text\, that we wish to match&quot;, &quot;This is the next text&quot;
</code></pre>
<p>And the following <code>&lt;split&gt;</code> element:</p>
<pre><code class="language-xml">&lt;split delimiter=&quot;,&quot; escape=&quot;\&quot;&gt;
</code></pre>
<p>The match groups are as follows:</p>
<ul>
<li>$ or $0: The entire content that is matched including the specified delimiter at the end</li>
</ul>
<p><code>&quot;This is some text\, that we wish to match&quot;,</code></p>
<ul>
<li>$1: The content up to the specified delimiter at the end</li>
</ul>
<p><code>&quot;This is some text\, that we wish to match&quot;</code></p>
<ul>
<li>$2: The content up to the specified delimiter at the end and filtered to remove escape characters (more expensive than $1)</li>
</ul>
<p><code>&quot;This is some text, that we wish to match&quot;</code></p>
<p>In addition to this behaviour match groups 1 and 2 will omit outermost whitespace and container characters if specified, e.g. with the following content:</p>
<pre><code class="language-text">&quot;  This is some text\, that we wish to match  &quot;  , &quot;This is the next text&quot;
</code></pre>
<p>And the following <code>&lt;split&gt;</code> element:</p>
<pre><code class="language-xml">&lt;split delimiter=&quot;,&quot; escape=&quot;\&quot; containerStart=&quot;&amp;quot&quot; containerEnd=&quot;&amp;quot&quot;&gt;
</code></pre>
<p>The match groups are as follows:</p>
<ul>
<li>$ or $0: The entire content that is matched including the specified delimiter at the end</li>
</ul>
<p><code>&quot;  This is some text\, that we wish to match  &quot;  ,</code></p>
<ul>
<li>$1: The content up to the specified delimiter at the end and strips outer containers.</li>
</ul>
<p><code>This is some text\, that we wish to match</code></p>
<ul>
<li>$2: The content up to the specified delimiter at the end and strips outer containers and filtered to remove escape characters (more computationally expensive than $1)</li>
</ul>
<p><code>This is some text, that we wish to match</code></p>
<h2 id="a-namesec_3_1_2areferences-to-ltregexgt-match-groups"><a name="sec_3_1_2"></a>References to &lt;regex&gt; Match Groups</h2>
<p>Like the <code>&lt;split&gt;</code> element various match groups can be referenced in a <code>&lt;regex&gt;</code> expression to retrieve portions of matched content. This content can be used as values for <code>&lt;group&gt;</code> and <code>&lt;data&gt;</code> elements.</p>
<p>Given the following input:</p>
<pre><code class="language-text">ip=1.1.1.1 user=user1
</code></pre>
<p>And the following <code>&lt;regex&gt;</code> element:</p>
<pre><code class="language-xml">&lt;regex pattern=&quot;ip=([^ ]+) user=([^ ]+)&quot;&gt;
</code></pre>
<p>The match groups are as follows:</p>
<ul>
<li>$ or $0: The entire content that is matched by the expression</li>
</ul>
<p><code>ip=1.1.1.1 user=user1</code></p>
<ul>
<li>$1: The content of the first match group</li>
</ul>
<p><code>1.1.1.1</code></p>
<ul>
<li>$2: The content of the second match group</li>
</ul>
<p><code>user1</code></p>
<p>Match group numbers in regular expressions are determined by the order that their open bracket appears in the expression.</p>
<h2 id="a-namesec_3_1_3areferences-to-ltanygt-match-groups"><a name="sec_3_1_3"></a>References to &lt;any&gt; Match Groups</h2>
<p>The <code>&lt;any&gt;</code> element does not have any match groups and always returns the entire content that was passed to it when referenced with $.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.6.3.'; page-break-before: always">
    
  <h1 id="pg-bcb29e33caf02d50bf39e0cfeb4ecb3b">5.6.3 - Use of fixed strings</h1>
    
	<p>Any <code>&lt;group&gt;</code> value or <code>&lt;data&gt;</code> name and value can use references to matched content, but in addition to this it is possible just to output a known string, e.g.</p>
<pre><code class="language-xml">&lt;data name=&quot;somename&quot; value=&quot;$&quot; /&gt;
</code></pre>
<p>The above example would output <code>somename</code> as the <code>&lt;data&gt;</code> name attribute. This can often be useful where there are no headings specified in the input data but we want to associate certain names with certain values.</p>
<p>Given the following data:</p>
<pre><code class="language-csv">01/01/2010,00:00:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,logon,
</code></pre>
<p>We could provide useful headings with the following configuration:</p>
<pre><code class="language-xml">&lt;regex pattern=&quot;([^,]*),([^,]*),([^,]*),([^,]*),([^,]*),([^,]*),&quot;&gt;
  &lt;data name=&quot;date&quot; value=&quot;$1&quot; /&gt;
  &lt;data name=&quot;time&quot; value=&quot;$2&quot; /&gt;
  &lt;data name=&quot;ipAddress&quot; value=&quot;$3&quot; /&gt;
  &lt;data name=&quot;hostName&quot; value=&quot;$4&quot; /&gt;
  &lt;data name=&quot;user&quot; value=&quot;$5&quot; /&gt;
  &lt;data name=&quot;action&quot; value=&quot;$6&quot; /&gt;
&lt;/regex&gt;
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.6.4.'; page-break-before: always">
    
  <h1 id="pg-ad6ae2faaa3721b740dceefffaf34916">5.6.4 - Variable reference</h1>
    
	<p>Variables are added to Data Splitter configuration using the <code>&lt;var&gt;</code> element, see <a href="../../../docs/user-guide/data-splitter/element-reference/2-3-variables/">variables</a>. Each variable must have a unique id so that it can be referenced. References to variables have the form <code>$VARIABLE_ID$</code>, e.g.</p>
<pre><code class="language-xml">&lt;data name=&quot;$heading$&quot; value=&quot;$&quot; /&gt;
</code></pre>
<h2 id="a-namesec-3-2-1aidentification"><a name="sec-3-2-1"></a>Identification</h2>
<p>Data Splitter validates the configuration on load and ensures that all element ids are unique and that referenced ids belong to a variable.</p>
<p>A variable will only store data if it is referenced so variables that are not referenced will do nothing. In addition to this a variable will only store data for match groups that are referenced, e.g. if <code>$heading$1</code> is the only reference to a variable with an id of ‘heading’ then only data for match group 1 will be stored for reference lookup.</p>
<h2 id="a-namesec-3-2-2ascopes"><a name="sec-3-2-2"></a>Scopes</h2>
<p>Variables have two scopes which affect how data is retrieved when referenced:</p>
<ul>
<li><a href="#sec-3-2-2-1">Local scope</a></li>
<li><a href="#sec-3-2-2-2">Remote scope</a></li>
</ul>
<h3 id="a-namesec-3-2-2-1alocal-scope"><a name="sec-3-2-2-1"></a>Local Scope</h3>
<p>Variables are local to a reference if the reference exists as a descendant of the variables parent expression, e.g.</p>
<pre><code class="language-xml">&lt;split delimiter=&quot;\n&quot; &gt;
  &lt;var id=&quot;line&quot; /&gt;

  &lt;group value=&quot;$1&quot;&gt;
    &lt;regex pattern=&quot;ip=([^ ]+) user=([^ ]+)&quot;&gt;
      &lt;data name=&quot;line&quot; value=&quot;$line$&quot;/&gt;
      &lt;data name=&quot;ip&quot; value=&quot;$1&quot;/&gt;
      &lt;data name=&quot;user&quot; value=&quot;$2&quot;/&gt;
    &lt;/regex&gt;
  &lt;/group&gt;
&lt;/split&gt;
</code></pre>
<p>In the above example, matches for the outermost <code>&lt;split&gt;</code> expression are stored in the variable with the id of <code>line</code>. The only reference to this variable is in a data element that is a descendant of the variables parent expression <code>&lt;split&gt;</code>, i.e. it is nested within split/group/regex.</p>
<p>Because the variable is referenced locally only the most recent parent match is relevant, i.e. no retrieval of values by
<a href="#sec-3-2-2-2-1">iteration</a>, <a href="#sec-3-2-2-2-2">iteration offset</a> or <a href="#sec-3-2-2-2-3">fixed position</a> is applicable. These features only apply to remote variables that store multiple values.</p>
<h3 id="a-namesec-3-2-2-2aremote-scope"><a name="sec-3-2-2-2"></a>Remote Scope</h3>
<p>The <a href="../../../docs/user-guide/data-splitter/1-2-simple-csv-example-with-heading/">CSV example with a heading</a> is an example of a variable being referenced from a remote scope.</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;dataSplitter xmlns=&quot;data-splitter:3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;data-splitter:3 file://data-splitter-v3.0.xsd&quot; version=&quot;3.0&quot;&gt;

  &lt;!-- Match heading line (note that maxMatch=&quot;1&quot; means that only the first line will be matched by this splitter) --&gt;
  &lt;split delimiter=&quot;\n&quot; maxMatch=&quot;1&quot;&gt;

    &lt;!-- Store each heading in a named list --&gt;
    &lt;group&gt;
      &lt;split delimiter=&quot;,&quot;&gt;
        &lt;var id=&quot;heading&quot; /&gt;
      &lt;/split&gt;
    &lt;/group&gt;
  &lt;/split&gt;

  &lt;!-- Match each record --&gt;
  &lt;split delimiter=&quot;\n&quot;&gt;

    &lt;!-- Take the matched line --&gt;
    &lt;group value=&quot;$1&quot;&gt;

      &lt;!-- Split the line up --&gt;
      &lt;split delimiter=&quot;,&quot;&gt;

        &lt;!-- Output the stored heading for each iteration and the value from group 1 --&gt;
        &lt;data name=&quot;$heading$1&quot; value=&quot;$1&quot; /&gt;
      &lt;/split&gt;
    &lt;/group&gt;
  &lt;/split&gt;
&lt;/dataSplitter&gt;
</code></pre>
<p>In the above example the parent expression of the variable is not the ancestor of the reference in the <code>&lt;data&gt;</code> element. This makes the <code>&lt;data&gt;</code> elements reference to the variable a remote one. In this situation the variable knows that it must store multiple values as the remote reference <code>&lt;data&gt;</code> may retrieve one of many values from the variable based on:</p>
<ol>
<li>The match count of the parent expression.</li>
<li>The match count of the parent expression, plus or minus an offset.</li>
<li>A fixed position in the variable store.</li>
</ol>
<h4 id="a-namesec-3-2-2-2-1aretrieval-of-value-by-iteration"><a name="sec-3-2-2-2-1"></a>Retrieval of value by iteration</h4>
<p>In the above example the first line is taken then repeatedly matched by delimiting with commas. This results in multiple values being stored in the ‘heading’ variable. Once this is done subsequent lines are matched and then also repeatedly matched by delimiting with commas in the same way the heading is.</p>
<p>Each time a line is matched the internal match count of all sub expressions, (e.g. the <code>&lt;split&gt;</code> expression that is delimited by comma) is reset to 0. Every time the sub <code>&lt;split&gt;</code> expression matches up to a comma delimiter the match count is incremented. Any references to remote variables will, by default, use the current match count as an index to retrieve one of the many values stored in the variable. This means that the <code>&lt;data&gt;</code> element in the above example will retrieve the corresponding heading for each value as the match count of the values will match the storage position of each heading.</p>
<h4 id="a-namesec-3-2-2-2-2aretrieval-of-value-by-iteration-offset"><a name="sec-3-2-2-2-2"></a>Retrieval of value by iteration offset</h4>
<p>In some cases there may be a mismatch between the position where a value is stored in a variable and the match count applicable when remotely referencing the variable.</p>
<p>Take the following input:</p>
<pre><code class="language-csv">BAD,Date,Time,IPAddress,HostName,User,EventType,Detail
01/01/2010,00:00:00,192.168.1.100,SOMEHOST.SOMEWHERE.COM,user1,logon,
</code></pre>
<p>In the above example we can see that the first heading ‘BAD’ is not correct for the first value of every line. In this situation we could either adjust the way the heading line is parsed to ignore ‘BAD’ or just adjust the way the heading variable is referenced.</p>
<p>To make this adjustment the reference just needs to be told what offset to apply to the current match count to correctly retrieve the stored value. In the above example this would be done like this:</p>
<pre><code class="language-xml">&lt;data name=&quot;$heading$1[+1]&quot; value=&quot;$1&quot; /&gt;
</code></pre>
<p>The above reference just uses the match count plus 1 to retrieve the stored value. Any integral offset plus or minus may be used, e.g. [+4] or [-10]. Offsets that result in a position that is outside of the storage range for the variable will not return a value.</p>
<h4 id="a-namesec-3-2-2-2-3aretrieval-of-value-by-fixed-position"><a name="sec-3-2-2-2-3"></a>Retrieval of value by fixed position</h4>
<p>In addition to retrieval by offset from the current match count, a stored value can be returned by a fixed position that has no relevance to the current match count.</p>
<p>In the following example the value retrieved from the ‘heading’ variable will always be ‘IPAddress’ as this is the fourth value stored in the ‘heading’ variable and the position index starts at 0.</p>
<pre><code class="language-xml">&lt;data name=&quot;$heading$1[3]&quot; value=&quot;$1&quot; /&gt;
</code></pre>

</div>




    
	
  

    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '6.'; page-break-before: always">
    
  <h1 id="pg-cc2b0d6d7767dd7b562d8bea931f32d1">6 - Editing and Viewing Data</h1>
    <div class="lead">How to view data and edit content.</div>
	<h2 id="viewing-data">Viewing Data</h2>
<p>The data viewer is shown on the <em>Data</em> tab when you open (by double clicking) one of these items in the explorer tree:</p>
<ul>
<li>Feed - to show all data for that feed.</li>
<li>Folder - to show all data for all feeds that are descendants of the folder.</li>
<li>System Root Folder - to show all data for all feeds that are ancestors of the folder.</li>
</ul>
<p>In all cases the data shown is dependant on the permissions of the user performing the action and any permissions set on the feeds/folders being viewed.</p>
<p>The Data Viewer screen is made up of the following three parts which are shown as three panes split horizontally.</p>
<h3 id="stream-list">Stream List</h3>
<p>This shows all streams within the opened entity (feed or folder).
The streams are shown in reverse chronological order.
By default <em>Deleted</em> and <em>Locked</em> streams are filtered out.
The filtering can be changed by clicking on the <img src="../resources/v7/icons/filter.svg" height="18" title="Filter"> icon.
This will show all stream types by default so may be a mixture of <em>Raw events</em>, <em>Events</em>, <em>Errors</em>, etc. depending on the feed/folder in question.</p>
<h3 id="related-stream-list">Related Stream List</h3>
<p>This list only shows data when a stream is selected in the streams list above it.
It shows all streams related to the currently selected stream.
It may show streams that are &lsquo;ancestors&rsquo; of the selected stream, e.g. showing the <em>Raw Events</em> stream for an <em>Events</em> stream, or show descendants, e.g. showing the <em>Errors</em> stream which resulted from processing the selected <em>Raw Events</em> stream.</p>
<h3 id="content-viewer-pane">Content Viewer Pane</h3>
<p>This pane shows the contents of the stream selected in the Related Streams List.
The content of a stream will differ depending on the type of stream selected and the child stream types in that stream.
For more information on the anatomy of streams, see <a href="../../../docs/user-guide/concepts/streams/">Streams</a>.
This pane is split into multiple sub tabs depending on the different types of content available.</p>
<h4 id="info-tab">Info Tab</h4>
<p>This sub-tab shows the information for the stream, such as creation times, size, physical file location, state, etc.</p>
<h4 id="error-tab">Error Tab</h4>
<p>This sub-tab is only visible for an Error stream.
It shows a table of errors and warnings with associated messages and locations in the stream that it relates to.</p>
<h4 id="data-preview-tab">Data Preview Tab</h4>
<p>This sub-tab shows the content of the data child stream, formatted if it is XML.
It will only show a limited amount of data so if the data child stream is large then it will only show the first n characters.</p>
<p>If the stream is multi-part then you will see Part navigation controls to switch between parts.
For each part you will be shown the first n character of that part (formatted if applicable).</p>
<p>If the stream is a <a href="../../../docs/user-guide/concepts/streams/#segmented-stream">Segmented stream</a> stream then you will see the Record navigation controls to switch between records.
Only one record is shown at once.
If a record is very large then only the first n characters of the record will be shown.</p>
<p>This sub-tab is intended for seeing a quick preview of the data in a form that is easy to read, i.e. formatted.
If you want to see the full data in its original form then click on the <em>View Source</em> link at the top right of the sub-tab.</p>
<p>The Data Preview tab shows a &lsquo;<a href="#data-progress-bar">progress</a>&rsquo; bar to indicate what portion of the content is visible in the editor.</p>
<h4 id="context-tab">Context Tab</h4>
<p>This sub-tab is only shown for non-segmented streams, e.g. <em>Raw Events</em> and <em>Raw_Reference</em> that have an associated context data child stream.
For more details of context streams, see <a href="../../../docs/user-guide/concepts/streams/#context">Context</a>
This sub-tab works in exactly the same way as the Data Preview sub-tab except that it shows a different child stream.</p>
<h4 id="meta-tab">Meta Tab</h4>
<p>This sub-tab is only shown for non-segmented streams, e.g. <em>Raw Events</em> and <em>Raw_Reference</em> that have an associated meta data child stream.
For more details of meta streams, see <a href="../../../docs/user-guide/concepts/streams/#meta-data">Meta</a>
This sub-tab works in exactly the same way as the Data Preview sub-tab except that it shows a different child stream.</p>
<h3 id="source-view">Source View</h3>
<p>The source view is accessed by clicking the <em>View Source</em> link on the <em>Data Preview</em> sub-tab or from the <code>data()</code> dashboard column function.
Its purpose is to display the selected child stream (data, context, meta, etc) or record in the form in which it was received, i.e un-formatted.</p>
<p>The Data Preview tab shows a &lsquo;<a href="#data-progress-bar">progress</a>&rsquo; bar to indicate what portion of the content is visible in the editor.</p>
<p>In order to navigate through the data you have three options</p>
<ul>
<li>Click on the &lsquo;progress bar&rsquo; to show a porting of the data starting from the position clicked on.</li>
<li>Page through the data using the navigation controls.</li>
<li>Select a source range to display using the Set Source Range dialog which is accessed by clicking on the <em>Lines</em> or <em>Chars</em> links.
This allows you to precisely select the range to display.
You can either specify a range with a just start point or a start point and some form of size/position limit.
If no limit is specified then Stroom will limit the data shown to the configured maximum (<code>stroom.ui.source.maxCharactersPerFetch</code>).
If a range is entered that is too big to display Stroom will limit the data to its maximum.</li>
</ul>
<h4 id="a-note-about-characters">A Note About Characters</h4>
<p>Stroom does not know the size of a stream in terms of character lines/cols, it only knows the size in bytes.
Due to the way character data is encoded into bytes it is not possible to say how many characters are in a stream based on its size in bytes.
Stroom can only provide an estimate based on the ratio of characters to bytes seen so far in the stream.</p>
<h3 id="data-progress-bar">Data Progress Bar</h3>
<p>Stroom often handles very large streams of data and it is not feasible to show all of this data in the editor at once.
Therefore Stroom will show a limited amount of the data in the editor at a time.
The &lsquo;progress&rsquo; bar at the top of the Data Preview and Source View screens shows what percentage of the data is visible in the editor and where in the stream the visible portion is located.
If all of the data is visible in the editor (which includes scrolling down to see it) the bar will be green and will occupy the full width.
If only some of the data is visible then the bar will be blue and the coloured part will only occupy part of the width.</p>
<h2 id="editor">Editor</h2>
<p>Stroom uses the <em>Ace</em> editor for editing and viewing text, such as XSLTs, raw data, cooked events, stepping, etc.</p>
<h3 id="keyboard-shortcuts">Keyboard shortcuts</h3>
<p>The following are some useful keyboard shortcuts in the editor:</p>
<ul>
<li><code>ctrl-z</code> - Undo last action.</li>
<li><code>ctrl-shift-z</code> - Redo previously undone action.</li>
<li><code>ctrl-/</code> - Toggle commenting of current line/selection. Applies when editing XML, XSLT or Javascript.</li>
<li><code>alt-up</code>/<code>alt-down</code> - Move line/selection up/down respectively</li>
<li><code>ctrl-d</code> - Delete current line.</li>
<li><code>ctrl-f</code> - Open find dialog.</li>
<li><code>ctrl-h</code> - Open find/replace dialog.</li>
<li><code>ctrl-k</code> - Find next match.</li>
<li><code>ctrl-shift-k</code> - Find previous match.</li>
<li><code>tab</code> - Indent selection.</li>
<li><code>shift-tab</code> - Outdent selection.</li>
<li><code>ctrl-u</code> - Make selection upper-case.</li>
</ul>
<p>See <a href="https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts">here (external link)</a> for more.</p>
<h4 id="vim-key-bindings">Vim key bindings</h4>
<p>If you are familiar with the Vi/Vim text editors then it is possible to enable Vim key bindings in Stroom.
This is currently done by enabling Vim bindings in the editor context menu in each editor screen.
In future versions of Stroom it will be possible to store these preferences on a per user basis.</p>
<p>The <em>Ace</em> editor does not support all features of Vim however the core navigation/editing key bindings are present.
The key supported features of Vim are:</p>
<ul>
<li>Visual mode and visual block mode.</li>
<li>Searching with <code>/</code> (javascript flavour regex)</li>
<li>Search/replace with commands like <code>:%s/foo/bar/g</code></li>
<li>Incrementing/decrementing numbers with <code>ctrl-a</code>/<code>ctrl-x</code></li>
<li>Code (un-)folding with <code>zo</code>, <code>zc</code>, etc.</li>
<li>Text objects, e.g. <code>&gt;</code>, <code>)</code>, <code>]</code>, <code>'</code>, <code>&quot;</code>, <code>p</code> paragraph, <code>w</code> word.</li>
<li>Repetition with the <code>.</code> command.</li>
<li>Jumping to a line with <code>:&lt;line no&gt;</code>.</li>
</ul>
<p>Notable features not supported by the <em>Ace</em> editor:</p>
<ul>
<li>The following text objects are not supported
<ul>
<li><code>b</code> - Braces, i.e <code>{</code> or <code>[</code>.</li>
<li><code>t</code> - Tags, i.e. XML tags <code>&lt;value&gt;</code>.</li>
<li><code>s</code> - Sentence.</li>
</ul>
</li>
<li>The <code>g</code> command mode command, i.e. <code>:g/foo/d</code></li>
<li>Splits</li>
</ul>
<p>For a list of useful Vim key bindings see this <a href="https://vim.rtorr.com">cheat sheet (external link)</a>, though not all bindings will be available in Stroom&rsquo;s <em>Ace</em> editor.</p>
<h3 id="auto-completion-and-snippets">Auto-Completion And Snippets</h3>
<p>The editor supports a number of different types of auto-completion of text.
Completion suggestions are triggered by the following mechanisms:</p>
<ul>
<li><code>ctrl-space</code> - when live auto-complete is disabled.</li>
<li>Typing - when live auto-complete is enabled.</li>
</ul>
<p>When completion suggestions are triggered the follow types of completion may be available depending on the text being edited.</p>
<ul>
<li><em>Local</em> - any word/token found in the existing text.
Useful if you have typed a long word and need to type it again.</li>
<li><em>Keyword</em> - A word/token that has been defined in the syntax highlighting rules for the text type, i.e. <code>function</code> is a keyword when editing Javascript.</li>
<li><em>Snippet</em> - A block of text that has been defined as a snippet for the editor mode (XML, Javascript, etc.).</li>
</ul>
<h4 id="snippets">Snippets</h4>
<p>Snippets allow you to quickly entry pre-defined blocks of common text.
For example when editing an XSLT you may want to insert a call-template with parameters.
To do this using snippets you can do the following:</p>
<ul>
<li>Type <code>call</code> then hit <code>ctrl-space</code>.</li>
<li>In the list of options use the cursor keys to select <code>call-template with-param</code> then hit <code>enter</code> or <code>tab</code> to insert the snippet.
The snippet will look like
<pre><code class="language-xslt">&lt;xsl:call-template name=&quot;template&quot;&gt;
  &lt;xsl:with-param name=&quot;param&quot;&gt;&lt;/xsl:with-param&gt;
&lt;/xsl:call-template&gt;
</code></pre>
</li>
<li>The cursor will be positioned on the first tab stop (the template name) with the tab stop text selected.</li>
<li>At this point you can type in your template name, e.g. <code>MyTemplate</code>, then hit <code>tab</code> to advance to the next tab stop (the param name)</li>
<li>Now type the name of the param, e.g. <code>MyParam</code>, then hit <code>tab</code> to advance to the last tab stop positioned within the <code>&lt;with-param&gt;</code> ready to enter the param value.</li>
</ul>
<p>Snippets can be disabled from the list of suggestions by selecting the option in the editor context menu.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '7.'; page-break-before: always">
    
  <h1 id="pg-d185e96091b29ee71e8e378700606d11">7 - Event Feeds</h1>
    <div class="lead">Feeds provide the means to logically group data common to a data format and source system.</div>
	<p>In order for Stroom to be able to handle the various data types as described in the previous section, Stroom must be told what the data is when it is received.
This is achieved using Event Feeds.
Each feed has a unique name within the system.</p>
<p>Events Feeds can be related to one or more Reference Feed.
Reference Feeds are used to provide look up data for a translation.
E.g. lookup a computer name by it&rsquo;s IP address.</p>
<p>Feeds can also have associated context data.
Context data used to provide look up information that is only applicable for the events file it relates to.
E.g. if the events file is missing information relating to the computer it was generated on, and you don&rsquo;t want to create separate feeds for each computer, an associated context file could be used to provide this information.</p>
<h2 id="feed-identifiers">Feed Identifiers</h2>
<p>Feed identifiers must be unique within the system.
Identifiers can be in any format but an established convetnion is to use the following format</p>
<pre><code class="language-text">&lt;SYSTEM&gt;-&lt;ENVIRONMENT&gt;-&lt;TYPE&gt;-&lt;EVENTS/REFERENCE&gt;-&lt;VERSION&gt;
</code></pre>
<p>If feeds in a certain site need different reference data then the site can be broken down further.</p>
<p><code>_</code> may be used to represent a space.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '8.'; page-break-before: always">
    
  <h1 id="pg-c15dd253f719f80d0be2ad950d65cab4">8 - Finding Things</h1>
    <div class="lead">How to find things in Stroom, for example content, simple string values, etc.</div>
	<blockquote>
<p><strong>Version Information:</strong> Created with Stroom v7.0<br>
<strong>Last Updated:</strong> 01 Jun 2020</p>
</blockquote>
<h2 id="explorer-tree">Explorer Tree</h2>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/finding-things/explorer_tree.png" href="../../../images/user-guide/finding-things/explorer_tree.png">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/finding-things/explorer_tree.png" style="max-width: fit-content" alt="images/user-guide/finding-things/explorer_tree.png">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Explorer Tree</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<p>The <em>Explorer Tree</em> in stroom is the primary means of finding user created content, for example <em>Feeds</em>, <em>XSLTs</em>, <em>Pipelines</em>, etc.</p>
<p>Branches of the <em>Explorer Tree</em> can be expanded and collapsed to reveal/hide the content at different levels.</p>
<h3 id="filtering-by-type">Filtering by Type</h3>
<p>The <em>Explorer Tree</em> can be filtered by the type of content, e.g. to display only <em>Feeds</em>, or only <em>Feeds</em> and <em>XSLTs</em>.
This is done by clicking the filter icon 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/filter.svg" 
  title="Filter" 
  alt="filter.svg">
.
The following is an example of filtering by <em>Feeds</em> and <em>XSLTs</em>.</p>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/finding-things/explorer_tree_type_filter_picker.png" href="../../../images/user-guide/finding-things/explorer_tree_type_filter_picker.png">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/finding-things/explorer_tree_type_filter_picker.png" style="max-width: fit-content" alt="images/user-guide/finding-things/explorer_tree_type_filter_picker.png">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Explorer Tree Type Filtering</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<p>Clicking <em>All/None</em> toggles between all types selected and no types selected.</p>
<p>Filtering by type can also be achieved using the Quick Filter by entering the type name (or a partial form of the type name), prefixed with <code>type:</code>.
I.e:</p>
<pre><code class="language-text">type:feed
</code></pre>
<p>For example:</p>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/finding-things/explorer_tree_type_quick_filter.png" href="../../../images/user-guide/finding-things/explorer_tree_type_quick_filter.png">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/finding-things/explorer_tree_type_quick_filter.png" style="max-width: fit-content" alt="images/user-guide/finding-things/explorer_tree_type_quick_filter.png">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Explorer Tree Type Filtering</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<blockquote>
<p>NOTE: If both the type picker and the Quick Filter are used to filter on type then the two filters will be combined as an AND.</p>
</blockquote>
<h3 id="filtering-by-name">Filtering by Name</h3>
<p>The <em>Explorer Tree</em> can be filtered by the name of the entity.
This is done by entering some text in the <em>Quick Filter</em> field.
The tree will then be updated to only show entities matching the <em>Quick Filter</em>.
The way the matching works for entity names is described in <a href="#common-fuzzy-matching">Common Fuzzy Matching</a></p>
<h3 id="filtering-by-uuid">Filtering by UUID</h3>
<h4 id="what-is-a-uuid">What is a UUID?</h4>
<p>The <em>Explorer Tree</em> can be filtered by the UUID of the entity.
The UUID <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">Universally unique identifier (external link)</a> is an identifier that can be relied on to be unique both within the system and universally across all other systems.
Stroom uses UUIDs as the primary identifier for all content (Feeds, XSLTs, Pipelines, etc.) created in Stroom.
An entity&rsquo;s UUID is generated randomly by Stroom upon creation and is fixed for the life of that entity.</p>
<p>When an entity is exported it is exported with its UUID and if it is then imported into another instance of Stroom the same UUID will be used.
The name of an entity can be changed within Stroom but its UUID remains un-changed.</p>
<p>With the exception of <em>Feeds</em>, Stroom allows multiple entities to have the same name.
This is because entities may exist that a user does not have access to see so restricting their choice of names based on existing invisible entities would be confusing.
Where there are multiple entities with the same name the UUID can be used to distinguish between them.</p>
<p>The UUID of an entity can be viewed using the context menu for the entity.
The context menu is accessed by right-clicking on the entity.</p>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/finding-things/entity_context_menu.png" href="../../../images/user-guide/finding-things/entity_context_menu.png">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/finding-things/entity_context_menu.png" style="max-width: fit-content" alt="images/user-guide/finding-things/entity_context_menu.png">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Entity Context Menu</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<p>Clicking <em>Info</em> displays the entities UUID.</p>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/finding-things/entity_info.png" href="../../../images/user-guide/finding-things/entity_info.png">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/finding-things/entity_info.png" style="max-width: fit-content" alt="images/user-guide/finding-things/entity_info.png">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Entity Info</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<p>The UUID can be copied by selecting it and then pressing <code>ctrl-c</code>.</p>
<h4 id="uuid-quick-filter-matching">UUID Quick Filter Matching</h4>
<p>In the <em>Explorer Tree</em> <em>Quick Filter</em> you can filter by UUIDs in the following ways:</p>
<p>To show the entity matching a UUID, enter the full UUID value (with dashes) prefixed with the field qualifier <code>uuid</code>, e.g. <code>uuid:a95e5c59-2a3a-4f14-9b26-2911c6043028</code>.</p>
<p>To filter on part of a UUID you can do <code>uuid:/2a3a</code> to find an entity whose UUID contains <code>2a3a</code> or <code>uuid:^2a3a</code> to find an entity whose UUID starts with <code>2a3a</code>.</p>
<h2 id="quick-filters">Quick Filters</h2>
<p>Quick Filter controls are used in a number of screens in <em>Stroom</em>.
The most prominent use of a Quick Filter is in the Explorer Tree as described above.
Quick filters allow for quick searching of a data set or a list of items using a text based query language.
The basis of the query language is described in <a href="#common-fuzzy-matching">Common Fuzzy Matching</a>.</p>
<p>A number of the Quick Filters are used for filter tables of data that have a number of fields.
The quick filter query language supports matching in specified fields.
Each Quick Filter will have a number of named fields that it can filter on.
The field to match on is specified by prefixing the match term with the name of the field followed by a <code>:</code>, i.e. <code>type:</code>.
Multiple field matches can be used, each separate by a space.
E.g:</p>
<pre><code class="language-text">name:^xml name:events$ type:feed
</code></pre>
<p>In the above example the filter will match on items with a name beginning <code>xml</code>, a name ending <code>events</code> and a type partially matching <code>feed</code>.</p>
<p>All the match terms are combined together with an AND operator.
The same field can be used multiple times in the match.
The list of filterable fields and their qualifier names (sometimes a shortened form) are listed by clicking on the help icon 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/help.svg" 
  title="Help" 
  alt="help.svg">
.</p>
<p>One or more of the fields will be defined as <em>default</em> fields.
This means the if no qualifier is entered the match will be applied to all <em>default</em> fields using an OR operator.
Sometimes all fields may be considered <em>default</em> which means a match term will be tested against all fields and an item will be included in the results if one or more of those fields match.</p>
<p>For example if the Quick Filter has fields <code>Name</code>, <code>Type</code> and <code>Status</code>, of which <code>Name</code> and <code>Type</code> are <em>default</em>:</p>
<pre><code class="language-text">feed status:ok
</code></pre>
<p>The above would match items where the Name OR Type fields match <code>feed</code> AND the Status field matches <code>ok</code>.</p>
<h3 id="match-negation">Match Negation</h3>
<p>Each match item can be negated using the <code>!</code> prefix.
This is also described in <a href="#common-fuzzy-matching">Common Fuzzy Matching</a>.
The prefix is applied <strong>after</strong> the field qualifier.
E.g:</p>
<pre><code class="language-text">name:xml source:!/default
</code></pre>
<p>In the above example it would match on items where the Name field matched <code>xml</code> and the Source field does NOT match the regex pattern <code>default</code>.</p>
<h3 id="spaces-and-quotes">Spaces and Quotes</h3>
<p>If your match term contains a space then you can surround the match term with double quotes.
Also if your match term contains a double quote you can escape it with a <code>\</code> character.
The following would be valid for example.</p>
<pre><code class="language-text">&quot;name:csv splitter&quot; &quot;default field match&quot; &quot;symbol:\&quot;&quot;
</code></pre>
<h3 id="multiple-terms">Multiple Terms</h3>
<p>If multiple terms are provided for the same field then an AND is used to combine them.
This can be useful where you are not sure of the order of <em>words</em> within the items being filtered.</p>
<p>For example:</p>
<p><strong>User input</strong>: <code>spain plain rain</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">The rain in spain stays mainly in the plain
    ^^^^    ^^^^^                     ^^^^^
rainspainplain
^^^^^^^^^^^^^^
spain plain rain
^^^^^ ^^^^^ ^^^^
raining spain plain
^^^^^^^ ^^^^^ ^^^^^
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>sprain</code>, <code>rain</code>, <code>spain</code></p>
<h3 id="or-logic">OR Logic</h3>
<p>There is no support for combining terms with an OR.
However you can acheive this using a sinlge regular expression term.
For example</p>
<p><strong>User input</strong>: <code>status:/(disabled|locked)</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">Locked
^^^^^^
Disabled
^^^^^^^^
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>A MAN</code>, <code>HUMAN</code></p>
<h2 id="suggestion-input-fields">Suggestion Input Fields</h2>
<p>Stroom uses a number of suggestion input fields, such as when selecting Feeds, Pipelines, types, status values, etc. in the pipeline processor filter screen.</p>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <a title="images/user-guide/finding-things/feed_suggestion.png" href="../../../images/user-guide/finding-things/feed_suggestion.png">
    <figure style="margin-block-end: 0px" >
      
      <img class="card-img-top" src="../../../images/user-guide/finding-things/feed_suggestion.png" style="max-width: fit-content" alt="images/user-guide/finding-things/feed_suggestion.png">
      

      
      <div class="card-body px-0 pt-2 pb-0">
        <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
        <figcaption class="card-text" style="font-size: smaller; text-align: center;">Feed Input Suggestions</figcaption>
      </div>
      
    </figure>
  </a>
</div>

<p>These fields will typically display the full list of values or a truncated list where the total number of value is too large.
Entering text in one of these fields will use the fuzzy matching algorithm to partially/fully match on values.
See <a href="#common-fuzzy-matching">CommonFuzzy Matching</a> below for details of how the matching works.</p>
<h2 id="common-fuzzy-matching">Common Fuzzy Matching</h2>
<p>A common fuzzy matching mechanism is used in a number of places in <em>Stroom</em>.
It is used for partially matching the user input to a list of a list of possible values.</p>
<p>In some instances, the list of matched items will be truncated to a more manageable size with the expectation that the filter will be refined.</p>
<p>The fuzzy matching employs a number of approaches that are attempted in the following order:</p>
<p>NOTE: In the following examples the <code>^</code> character is used to indicate which characters have been matched.</p>
<h3 id="no-input">No Input</h3>
<p>If no input is provided all items will match.</p>
<h3 id="contains-default">Contains (Default)</h3>
<p>If no prefixes or suffixes are used then all characters in the user input will need to be contained as a whole somewhere within the string being tested.
The matching is case insensitive.</p>
<p><strong>User input</strong>: <code>bad</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">bad angry dog
^^^          
BAD
^^^
very badly
     ^^^  
Very bad
     ^^^
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>dab</code>, <code>ba d</code>, <code>ba</code></p>
<h3 id="characters-anywhere-matching">Characters Anywhere Matching</h3>
<p>If the user input is prefixed with a <code>~</code> (tilde) character then characters anywher matching will be employed.
The matching is case insensitive.</p>
<p><strong>User input</strong>: <code>bad</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">Big Angry Dog
^   ^     ^  
bad angry dog
^^^          
BAD
^^^
badly
^^^  
Very bad
     ^^^
b a d
^ ^ ^
bbaadd
^ ^ ^ 
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>dab</code>, <code>ba</code></p>
<h3 id="word-boundary-matching">Word Boundary Matching</h3>
<p>If the user input is prefixed with a <code>?</code> character then word boundary matching will be employed.
This approache uses upper case letters to denote the start of a <em>word</em>.
If you know the some or all of <em>words</em> in the item you are looking for, and their order, then condensing those <em>words</em> down to their first letters (capitalised) makes this a more targeted way to find what you want than the characters anywhere matching above.
Words can either be separated by characters like <code>_- ()[].</code>, or be distinguished with <code>lowerCamelCase</code> or <code>upperCamelCase</code> format.
An upper case letter in the input denotes the beginning of a <em>word</em> and any subsequent lower case characters are treated as contiguously following the character at the start of the word.</p>
<p><strong>User input</strong>: <code>?OTheiMa</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">the cat sat on their mat
            ^  ^^^^  ^^                                                                  
ON THEIR MAT
^  ^^^^  ^^ 
Of their magic
^  ^^^^  ^^   
o thei ma
^ ^^^^ ^^
onTheirMat
^ ^^^^ ^^ 
OnTheirMat
^ ^^^^ ^^ 
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>On the mat</code>, <code>the cat sat on there mat</code>, <code>On their moat</code></p>
<p><strong>User input</strong>: <code>?MFN</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">MY_FEED_NAME
^  ^    ^   
MY FEED NAME
^  ^    ^   
MY_FEED_OTHER_NAME
^  ^          ^   
THIS_IS_MY_FEED_NAME_TOO
        ^  ^    ^                  
myFeedName
^ ^   ^   
MyFeedName
^ ^   ^   
also-my-feed-name
     ^  ^    ^   
MFN
^^^
stroom.something.somethingElse.maxFileNumber
                               ^  ^   ^
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>myfeedname</code>, <code>MY FEEDNAME</code></p>
<h3 id="regular-expression-matching">Regular Expression Matching</h3>
<p>If the user input is prefixed with a <code>/</code> character then the remaining user input is treated as a Java syntax regular expression.
An string will be considered a match if any part of it matches the regular expression pattern.
The regular expression operates in case insensitive mode.
For more details on the syntax of java regular expressions see this internet link <a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/regex/Pattern.html">https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/regex/Pattern.html</a>.</p>
<p><strong>User input</strong>: <code>/(^|wo)man</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">MAN
^^^
A WOMAN
  ^^^^^
Manly
^^^  
Womanly
^^^^^  
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>A MAN</code>, <code>HUMAN</code></p>
<h3 id="exact-match">Exact Match</h3>
<p>If the user input is prefixed with a <code>^</code> character and suffixed with a <code>$</code> character then a case-insensitive exact match will be used.
E.g:</p>
<p><strong>User input</strong>: <code>^xml-events$</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">xml-events
^^^^^^^^^^
XML-EVENTS
^^^^^^^^^^
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>xslt-events</code>, <code>XML EVENTS</code>, <code>SOME-XML-EVENTS</code>, <code>AN-XML-EVENTS-PIPELINE</code></p>
<p>Note: Despite the similarity in syntax, this is NOT regular expression matching.</p>
<h3 id="starts-with">Starts With</h3>
<p>If the user input is prefixed with a <code>^</code> character then a case-insensitive starts with match will be used.
E.g:</p>
<p><strong>User input</strong>: <code>^events</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">events
^^^^^^
EVENTS_FEED
^^^^^^     
events-xslt
^^^^^^     
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>xslt-events</code>, <code>JSON_EVENTS</code></p>
<p>Note: Despite the similarity in syntax, this is NOT regular expression matching.</p>
<h3 id="ends-with">Ends With</h3>
<p>If the user input is suffixed with a <code>$</code> character then a case-insensitive ends with match will be used.
E.g:</p>
<p><strong>User input</strong>: <code>events$</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">events
^^^^^^
xslt-events
     ^^^^^^
JSON_EVENTS
     ^^^^^^
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>EVENTS_FEED</code>, <code>events-xslt</code></p>
<p>Note: Despite the similarity in syntax, this is NOT regular expression matching.</p>
<h3 id="wild-carded-case-sensitive-exact-matching">Wild-Carded Case Sensitive Exact Matching</h3>
<p>If one or more <code>*</code> characters are found in the user input then this form of matching will be used.</p>
<p>This form of matching is to support those fields that accept wild-carded values, e.g. a whild-carded feed name expression term.
In this instance you are NOT picking a value from the suggestion list but entering a wild-carded value that will be evaluated when the expression/filter is actually used.
The user may want an expression term that matches on all feeds starting with <code>XML_</code>, in which case they would enter <code>XML_*</code>.
To give an indication of what it would match on if the list of feeds remains the same, the list of suggested items will reflect the wild-carded input.</p>
<p><strong>User input</strong>: <code>XML_*</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">XML_
^^^^
XML_EVENTS
^^^^
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>BAD_XML_EVENTS</code>, <code>XML-EVENTS</code>, <code>xml_events</code></p>
<p><strong>User input</strong>: <code>XML_*EVENTS*</code></p>
<p><strong>Will match</strong>:</p>
<pre><code class="language-text">XML_EVENTS
^^^^^^^^^^
XML_SEC_EVENTS
^^^^    ^^^^^^
XML_SEC_EVENTS_FEED
^^^^    ^^^^^^
</code></pre>
<p><strong>Won&rsquo;t match</strong>: <code>BAD_XML_EVENTS</code>, <code>xml_events</code></p>
<h3 id="match-negation-1">Match Negation</h3>
<p>A match can be negated, ie. the NOT operator using the prefix <code>!</code>.
This prefix can be applied <em>before</em> all the match prefixes listed above.
E.g:</p>
<pre><code class="language-text">!/(error|warn)
</code></pre>
<p>In the above example it will match everything except those matched by the regex pattern <code>(error|warn)</code>.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '9.'; page-break-before: always">
    
  <h1 id="pg-b8860b8c19e9ebb1b61cd7ccafb22447">9 - Nodes</h1>
    <div class="lead">Configuring the nodes in a Stroom cluster.</div>
	<p>All nodes in an Stroom cluster must be configured correctly for them to communicate with each other.</p>
<h2 id="configuring-nodes">Configuring nodes</h2>
<p>Open Monitoring/Nodes from the top menu. The nodes screen looks like this:</p>

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">TODO</h4>

    Screenshot

</div>

<p>You need to edit each line by selecting it and then clicking the edit 










<img 
  class="stroom-icon " 
  src="../../../images/stroom-ui/edit.svg" 
  title="Edit" 
  alt="edit.svg">
 icon at the bottom.
The URL for each node needs to be set as above but obviously substituting in the host name of the individual node, e.g. <code>http://&lt;HOST_NAME&gt;:8080/stroom/clustercall.rpc</code></p>
<p>Nodes are expected communicate with each other on port 8080 over http.
Ensure you have configured your firewall to allow nodes to talk to each other over this port.
You can configure the URL to use a different port and possibly HTTPS but performance will be better with HTTP as no SSL termination is required.</p>
<p>Once you have set the URLs of each node you should also set the master assignment priority for each node to be different to all of the others.
In the image above the priorities have been set in a random fashion to ensure that node3 assumes the role of master node for as long as it is enabled.
You also need to check all of the nodes are enabled that you want to take part in processing or any other jobs.</p>
<p>Keep refreshing the table until all nodes show healthy pings as above.
If you do not get ping results for each node then they are not configured correctly.</p>
<p>Once a cluster is configured correctly you will get proper distribution of processing tasks and search will be able to access all nodes to take part in a distributed query.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.'; page-break-before: always">
    
  <h1 id="pg-4ba3d827447c0b785302fa20b313f31c">10 - Pipelines</h1>
    <div class="lead">Pipelines are the mechanism for processin and transforming ingested data.</div>
	<h1 id="pipelines">Pipelines</h1>
<p>Every feed has an associated translation. The translation is used to convert the input text or XML into event logging XML format.</p>
<p>XSLT is used to translate from XML to event logging XML.</p>

</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.1.'; ">
    
  <h1 id="pg-0d3ac18ea787cffda6272f82e6bae0a5">10.1 - Reference Data</h1>
    <div class="lead">Performing temporal reference data lookups to decorate event data.</div>
	
<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">See Also</h4>


    <ul>
<li><a href="../../../docs/howtos/referencefeeds/createsimplereferencefeed/">HOWTO - Creating a Simple Reference Feed</a></li>
<li><a href="../../../docs/user-guide/pipelines/xslt/xslt-functions/">XSLT Functions</a></li>
</ul>


</div>


<blockquote>
<p><strong>See Also:</strong></p>
</blockquote>
<p>In Stroom reference data is primarily used to decorate events using <code>stroom:lookup()</code> calls in XSLTs.
For example you may have reference data feed that associates the FQDN of a device to the physical location.
You can then perform a <code>stroom:lookup()</code> in the XSLT to decorate an event with the physical location of a device by looking up the FQDN found in the event.</p>
<p>Reference data is time sensitive and each stream of reference data has an Effective Date set against it.
This allows reference data lookups to be performed using the date of the event to ensure the reference data that was actually effective at the time of the event is used.</p>
<p>Using reference data involves the following steps/processes:</p>
<ul>
<li>Ingesting the raw reference data into Stroom.</li>
<li>Creating (and processing) a pipeline to transform the raw reference into <code>reference-data:2</code> format XML.</li>
<li>Creating a reference loader pipeline with a Reference Data Filter element to load <em>cooked</em> reference data into the reference data store.</li>
<li>Adding reference pipeline/feeds to an XSLT Filter in your event pipeline.</li>
<li>Adding the lookup call to the XSLT.</li>
<li>Processing the raw events through the event pipeline.</li>
</ul>
<p>The process of creating a reference data pipeline is described in the HOWTO linked at the top of this document.</p>
<h2 id="reference-data-structure">Reference Data Structure</h2>
<p>A reference data entry essentially consists of the following:</p>
<ul>
<li><strong>Effective time</strong> - The data/time that the entry was effective from, i.e the time the raw reference data was received.</li>
<li><strong>Map name</strong> - A unique name for the key/value map that the entry will be stored in.
The name only needs to be unique within all map names that may be loaded within an XSLT Filter.
In practice it makes sense to keep map names globally unique.</li>
<li><strong>Key</strong> - The text that will be used to lookup the value in the reference data map.
Mutually exclusive with <strong>Range</strong>.</li>
<li><strong>Range</strong> - The inclusive range of integer keys that the entry applies to.
Mutually exclusive with <strong>Key</strong>.</li>
<li><strong>Value</strong> - The value can either be simple text, e.g. an IP address, or an XML fragment that can be inserted into another XML document.
XML values must be correctly namespaced.</li>
</ul>
<p>The following is an example of some reference data that has been converted from its raw form into <code>reference-data:2</code> XML.
In this example the reference data contains three entries that each belong to a different map.
Two of the entries are simple text values and the last has an XML value.</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.1&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;referenceData 
    xmlns=&quot;reference-data:2&quot; 
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; 
    xmlns:stroom=&quot;stroom&quot; 
    xmlns:evt=&quot;event-logging:3&quot; 
    xsi:schemaLocation=&quot;reference-data:2 file://reference-data-v2.0.xsd&quot; 
    version=&quot;2.0.1&quot;&gt;

  &lt;!-- A simple string value --&gt;
  &lt;reference&gt;
    &lt;map&gt;FQDN_TO_IP&lt;/map&gt;
    &lt;key&gt;stroomnode00.strmdev00.org&lt;/key&gt;
    &lt;value&gt;
      &lt;IPAddress&gt;192.168.2.245&lt;/IPAddress&gt;
    &lt;/value&gt;
  &lt;/reference&gt;

  &lt;!-- A simple string value --&gt;
  &lt;reference&gt;
    &lt;map&gt;IP_TO_FQDN&lt;/map&gt;
    &lt;key&gt;192.168.2.245&lt;/key&gt;
    &lt;value&gt;
      &lt;HostName&gt;stroomnode00.strmdev00.org&lt;/HostName&gt;
    &lt;/value&gt;
  &lt;/reference&gt;

  &lt;!-- A key range --&gt;
  &lt;reference&gt;
    &lt;map&gt;USER_ID_TO_COUNTRY_CODE&lt;/map&gt;
    &lt;range&gt;
      &lt;from&gt;1&lt;/from&gt;
      &lt;to&gt;1000&lt;/to&gt;
    &lt;/range&gt;
    &lt;value&gt;GBR&lt;/value&gt;
  &lt;/reference&gt;

  &lt;!-- An XML fragment value --&gt;
  &lt;reference&gt;
    &lt;map&gt;FQDN_TO_LOC&lt;/map&gt;
    &lt;key&gt;stroomnode00.strmdev00.org&lt;/key&gt;
    &lt;value&gt;
      &lt;evt:Location&gt;
        &lt;evt:Country&gt;GBR&lt;/evt:Country&gt;
        &lt;evt:Site&gt;Bristol-S00&lt;/evt:Site&gt;
        &lt;evt:Building&gt;GZero&lt;/evt:Building&gt;
        &lt;evt:Room&gt;R00&lt;/evt:Room&gt;
        &lt;evt:TimeZone&gt;+00:00/+01:00&lt;/evt:TimeZone&gt;
      &lt;/evt:Location&gt;
    &lt;/value&gt;
  &lt;/reference&gt;
&lt;/referenceData&gt;
</code></pre>
<h3 id="reference-data-namespaces">Reference Data Namespaces</h3>
<p>When XML reference data values are created, as in the example XML above, the XML values must be qualified with a namespace to distinguish them from the <code>reference-data:2</code> XML that surrounds them.
In the above example the XML fragment will become as follows when injected into an event:</p>
<pre><code class="language-xml">      &lt;evt:Location xmlns:evt=&quot;event-logging:3&quot; &gt;
        &lt;evt:Country&gt;GBR&lt;/evt:Country&gt;
        &lt;evt:Site&gt;Bristol-S00&lt;/evt:Site&gt;
        &lt;evt:Building&gt;GZero&lt;/evt:Building&gt;
        &lt;evt:Room&gt;R00&lt;/evt:Room&gt;
        &lt;evt:TimeZone&gt;+00:00/+01:00&lt;/evt:TimeZone&gt;
      &lt;/evt:Location&gt;
</code></pre>
<p>Even if <code>evt</code> is already declared in the XML being injected into it, if it has been declared for the reference fragment then it will be explicitly declared in the destination.
While duplicate namespacing may appear odd it is valid XML.</p>
<p>The namespacing can also be achieved like this:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.1&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;referenceData 
    xmlns=&quot;reference-data:2&quot; 
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; 
    xmlns:stroom=&quot;stroom&quot; 
    xsi:schemaLocation=&quot;reference-data:2 file://reference-data-v2.0.xsd&quot; 
    version=&quot;2.0.1&quot;&gt;

  &lt;!-- An XML value --&gt;
  &lt;reference&gt;
    &lt;map&gt;FQDN_TO_LOC&lt;/map&gt;
    &lt;key&gt;stroomnode00.strmdev00.org&lt;/key&gt;
    &lt;value&gt;
      &lt;Location xmlns=&quot;event-logging:3&quot;&gt;
        &lt;Country&gt;GBR&lt;/Country&gt;
        &lt;Site&gt;Bristol-S00&lt;/Site&gt;
        &lt;Building&gt;GZero&lt;/Building&gt;
        &lt;Room&gt;R00&lt;/Room&gt;
        &lt;TimeZone&gt;+00:00/+01:00&lt;/TimeZone&gt;
      &lt;/Location&gt;
    &lt;/value&gt;
  &lt;/reference&gt;
&lt;/referenceData&gt;
</code></pre>
<p>This reference data will be injected into event XML exactly as it, i.e.:</p>
<pre><code class="language-xml">      &lt;Location xmlns=&quot;event-logging:3&quot;&gt;
        &lt;Country&gt;GBR&lt;/Country&gt;
        &lt;Site&gt;Bristol-S00&lt;/Site&gt;
        &lt;Building&gt;GZero&lt;/Building&gt;
        &lt;Room&gt;R00&lt;/Room&gt;
        &lt;TimeZone&gt;+00:00/+01:00&lt;/TimeZone&gt;
      &lt;/Location&gt;
</code></pre>
<h2 id="reference-data-storage">Reference Data Storage</h2>
<p>Reference data is stored in two different places on a Stroom node.
All reference data is only visible to the node where it is located.
Each node that is performing reference data lookups will need to load and store its own reference data.
While this will result in duplicate data being held by nodes it makes the storage of reference data and its subsequent lookup very performant.</p>
<h3 id="on-heap-store">On-Heap Store</h3>
<p>The On-Heap store is the reference data store that is held in memory in the Java Heap.
This store is volatile and will be lost on shut down of the node.
The On-Heap store is only used for storage of context data.</p>
<h3 id="off-heap-store">Off-Heap Store</h3>
<p>The Off-Heap store is the reference data store that is held in memory outside of the Java Heap and is persisted to to local disk.
As the store is also persisted to local disk it means the reference data will survive the shutdown of the stroom instance.
Storing the data off-heap means Stroom can run with a much smaller Java Heap size.</p>
<p>The Off-Heap store is based on the Lightning Memory-Mapped Database (LMDB).
LMDB makes use of the Linux page cache to ensure that hot portions of the reference data are held in the page cache (making use of all available free memory).
Infrequently used portions of the reference data will be evicted from the page cache by the Operating System.
Given that LMDB utilises the page cache for holding reference data in memory the more free memory the host has the better as there will be less shifting of pages in/out of the OS page cache.
When storing large amounts of data you may experience the OS reporting very little free memory as a large amount will be in use by the page cache.
This is not an issue as the OS will evict pages when memory is needed for other applications, e.g. the Java Heap.</p>
<h4 id="local-disk">Local Disk</h4>
<p>The Off-Heap store is intended to be located on local disk on the Stroom node.
The location of the store is set using the property <code>stroom.pipeline.referenceData.localDir</code>.
Using LMDB on remote storage is NOT advised, see <a href="http://www.lmdb.tech/doc">http://www.lmdb.tech/doc</a>.</p>
<p>If you are running stroom on AWS EC2 instances then you will need to attach some local instance storage to the host, e.g. SSD, to use for the reference data store.
In tests EBS storage was found to be VERY slow.
It should be noted that AWS instance storage is not persistent between instance stops, terminations and hardware failure.
However any loss of the reference data store will mean that the next time Stroom boots a new store will be created and reference data will be loaded on demand as normal.</p>
<h4 id="transactions">Transactions</h4>
<p>LMDB is a transactional database with ACID semantics.
All interaction with LMDB is done within a read or write transaction.
There can only be one write transaction at a time so if there are a number of concurrent reference data loads then they will have to wait in line.
Read transactions, i.e. lookups, are not blocked by each other or by write transactions so once the data is loaded and is in memory lookups can be performed very quickly.</p>
<h4 id="read-ahead-mode">Read-Ahead Mode</h4>
<p>When data is read from the store, if the data is not already in the page cache then it will be read from disk and added to the page cache by the OS.
Read-ahead is the process of speculatively reading ahead to load more pages into the page cache then were requested.
This is on the basis that future requests for data may need the pages speculatively read into memory.
If the reference data store is very large or is larger than the available memory then it is recommended to turn read-ahead off as the result will be to evict hot reference data from the page cache to make room for speculative pages that may not be needed.
It can be tuned off with the system property <code>stroom.pipeline.referenceData.readAheadEnabled</code>.</p>
<h4 id="key-size">Key Size</h4>
<p>When reference data is created care must be taken to ensure that the <em>Key</em> used for each entry is less than 507 bytes.
For simple ASCII characters then this means less than 507 characters.
If non-ASCII characters are in the key then these will take up more than one byte per character so the length of the key in characters will be less.
This is a limitation inherent to LMDB.</p>
<h4 id="commit-intervals">Commit intervals</h4>
<p>The property <code>stroom.pipeline.referenceData.maxPutsBeforeCommit</code> controls the number of entries that are put into the store between each commit.
As there can be only one transaction writing to the store at a time, committing periodically allows other process to jump in and make writes.
There is a trade off though as reducing the number of entries put between each commit can seriously affect performance.
For the fastest single process performance a value of zero should be used which means it will not commit mid-load.
This however means all other processes wanting to write to the store will need to wait.</p>
<h4 id="cloning-the-off-heap-store">Cloning The Off Heap Store</h4>
<p>If you are provisioning a new stroom node it is possible to copy the off heap store from another node.
Stroom should not be running on the node being copied from.
Simply copy the contents of <code>stroom.pipeline.referenceData.localDir</code> into the same configured location on the other node.
The new node will use the copied store and have access to its reference data.</p>
<h4 id="store-size--compaction">Store Size &amp; Compaction</h4>
<p>Due to the way LMDB works the store can only grow in size, it will never shrink, even if data is deleted.
Deleted data frees up space for new writes to the store so will be reused but never freed.
If there is a regular process of purging old data and adding new reference data then this should not be an issue as the new reference data will use the space made available by the purged data.</p>
<p>If store size becomes an issue then it is possible to compact the store.
<code>lmdb-utils</code> is available on some package managers and this has an <code>mdb_copy</code> command that can be used with the <code>-c</code> switch to copy the LMDB environment to a new one, compacting it in the process.
This should be done when Stroom is down to avoid writes happening to the store while the copy is happening.</p>
<p>Given that the store is essentially a cache and all data can be re-loaded another option is to delete the contents of <code>stroom.pipeline.referenceData.localDir</code> when Stroom is not running.
On boot Stroom will create a brand new store and reference data will be re-loaded as required.</p>
<h2 id="the-loading-process">The Loading Process</h2>
<p>Reference data is loaded into the store on demand during the processing of a <code>stroom:lookup()</code> method call.
Reference data will only be loaded if it does not already exist in the store, however it is always loaded as a complete stream, rather than entry by entry.</p>
<p>The test for existence in the store is based on the following criteria:</p>
<ul>
<li>The UUID of the reference loader pipeline.</li>
<li>The version of the reference loader pipeline.</li>
<li>The Stream ID for the stream of reference data that has been deemed effective for the lookup.</li>
<li>The Stream Number (in the case of multi part streams).</li>
</ul>
<p>If a reference stream has already been loaded matching the above criteria then no additional load is required.</p>
<p><strong>IMPORTANT</strong>: It should be noted that as the version of the reference data pipeline forms part of the criteria, if the reference loader pipeline is changed, for whatever reason, then this will invalidate ALL existing reference data associated with that reference loader pipeline.</p>
<p>Typically the reference loader pipeline is very static so this should not be an issue.</p>
<p>Standard practice is to convert raw reference data into <code>reference:2</code> XML on receipt using a pipeline separate to the reference loader.
The reference loader is then only concerned with reading cooked <code>reference:2</code> into the Reference Data Filter.</p>
<p>In instances where reference data streams are infrequently used it may be preferable to not convert the raw reference on receipt but instead to do it in the reference loader pipeline.</p>
<h3 id="duplicate-keys">Duplicate Keys</h3>
<p>The Reference Data Filter pipeline element has a property <code>overrideExistingValues</code> which if set to <em>true</em> means if an entry is found in an effective stream with the same key as an entry already loaded then it will overwrite the existing one.
Entries are loaded in the order they are found in the <code>reference:2</code> XML document.
If set to <em>false</em> then the existing entry will be kept.
If <code>warnOnDuplicateKeys</code> is set to <em>true</em> then a warning will be logged for any duplicate keys, whether an overwrite happens or not.</p>
<h3 id="value-de-duplication">Value De-Duplication</h3>
<p>Only unique values are held in the store to reduce the storage footprint.
This is useful given that typically, reference data updates may be received daily and each one is a full snapshot of the whole reference data.
As a result this can mean many copies of the same value being loaded into the store.
The store will only hold the first instance of duplicate values.</p>
<h2 id="querying-the-reference-data-store">Querying the Reference Data Store</h2>
<p>The reference data store can be queried within a Dashboard in Stroom by selecting <code>Reference Data Store</code> in the data source selection pop-up.
Querying the store is currently an experimental feature and is mostly intended for use in fault finding.
Given the localised nature of the reference data store the dashboard can currently only query the store on the node that the user interface is being served from.
In a multi-node environment where some nodes are UI only and most are processing only, the UI nodes will have no reference data in their store.</p>
<h2 id="purging-old-reference-data">Purging Old Reference Data</h2>
<p>Reference data loading and purging is done at the level of a reference stream.
Whenever a reference lookup is performed the last accessed time of the reference stream in the store is checked.
If it is older than one hour then it will be updated to the current time.
This last access time is used to determine reference streams that are no longer in active use and thus can be purged.</p>
<p>The Stroom job <em>Ref Data Off-heap Store Purge</em> is used to perform the purge operation on the Off-Heap reference data store.
No purge is required for the On-Heap store as that only holds transient data.
When the purge job is run it checks the time since each reference stream was accessed against the purge cut-off age.
The purge age is configured via the property <code>stroom.pipeline.referenceData.purgeAge</code>.
It is advised to schedule this job for quiet times when it is unlikely to conflict with reference loading operations as they will fight for access to the single write transaction.</p>
<h2 id="lookups">Lookups</h2>
<p>Lookups are performed in XSLT Filters using the XSLT functions.
In order to perform a lookup one or more reference feeds must be specified on the XSLT Filter pipeline element.
Each reference feed is specified along with a reference loader pipeline that will ingest the specified feed (optional convert it into <code>reference:2</code> XML if it is not already) and pass it into a Reference Data Filter pipeline element.</p>
<h3 id="reference-feeds--loaders">Reference Feeds &amp; Loaders</h3>
<p>In the XSLT Filter pipeline element multiple combinations of feed and reference loader pipeline can be specified.
There must be at least one in order to perform lookups.
If there are multiple then when a lookup is called for a given time, the effective stream for each feed/loader combination is determined.
The effective stream for each feed/loader combination will be loaded into the store, unless it is already present.</p>
<p>When the actual lookup is performed Stroom will try to find the key in each of the effective streams that have been loaded and that contain the map in the lookup call.
If the lookup is unsuccessful in the effective stream for the first feed/loader combination then it will try the next, and so on until it has tried all of them.
For this reason if you have multiple feed/loader combinations then order is important.
It is possible for multiple effective streams to contain the same map/key so a feed/loader combination higher up the list will trump one lower down with the same map/key.
Also if you have some lookups that may not return a value and others that should always return a value then the feed/loader for the latter should be higher up the list so it is searched first.</p>
<h3 id="standard-keyvalue-lookups">Standard Key/Value Lookups</h3>
<p>Standard key/value lookups consist of a simple string key and a value that is either a simple string or an XML fragment.
Standard lookups are performed using the various forms of the <a href="../../../docs/user-guide/pipelines/xslt/xslt-functions/#lookup"><code>stroom:lookup()</code></a> XSLT function.</p>
<h3 id="range-lookups">Range Lookups</h3>
<p>Range lookups consist of a key that is an integer and a value that is either a simple string or an XML fragment.
For more detail on range lookups see the XSLT function <a href="../../../docs/user-guide/pipelines/xslt/xslt-functions/#range-lookups"><code>stroom:lookup()</code></a>.</p>
<h3 id="nested-map-lookups">Nested Map Lookups</h3>
<p>Nested map lookups involve chaining a number of lookups with the value of each map being used as the key for the next.
For more detail on nested lookups see the XSLT function <a href="../../../docs/user-guide/pipelines/xslt/xslt-functions/#nested-maps"><code>stroom:lookup()</code></a>.</p>
<h3 id="bitmap-lookups">Bitmap Lookups</h3>
<p>A bitmap lookup is a special kind of lookup that actually performs a lookup for each enabled bit position of the passed bitmap value.
For more detail on bitmap lookups see the XSLT function <a href="../../../docs/user-guide/pipelines/xslt/xslt-functions/#bitmap-lookup"><code>stroom:bitmap-lookup()</code></a>.</p>
<p>Values can either be a simple string or an XML fragment.</p>
<h3 id="context-data-lookups">Context data lookups</h3>
<p>Some event streams have a Context stream associated with them.
Context streams allow the system sending the events to Stroom to supply an additional stream of data that provides context to the raw event stream.
This can be useful when the system sending the events has no control over the event content but needs to supply additional information.
The context stream can be used in lookups as a reference source to decorate events on receipt.
Context reference data is specific to a single event stream so is transient in nature, therefore the On Heap Store is used to hold it for the duration of the event stream processing only.</p>
<p>Typically the reference loader for a context stream will include a translation step to convert the raw context data into <code>reference:2</code> XML.</p>
<h2 id="reference-data-api">Reference Data API</h2>
<p>The reference data store has an API to allow other systems to access the reference data store.
The <code>lookup</code> endpoint requires the caller to provide details of the reference feed and loader pipeline so if the effective stream is not in the store it can be loaded prior to performing the lookup.</p>
<p>Below is an example of a lookup request.</p>
<pre><code class="language-json">{
  &quot;mapName&quot;: &quot;USER_ID_TO_LOCATION&quot;,
  &quot;effectiveTime&quot;: &quot;2020-12-02T08:37:02.772Z&quot;,
  &quot;key&quot;: &quot;jbloggs&quot;,
  &quot;referenceLoaders&quot;: [
    {
      &quot;loaderPipeline&quot; : {
        &quot;name&quot; : &quot;Reference Loader&quot;,
        &quot;uuid&quot; : &quot;da1c7351-086f-493b-866a-b42dbe990700&quot;,
        &quot;type&quot; : &quot;Pipeline&quot;
      },
      &quot;referenceFeed&quot; : {
        &quot;name&quot;: &quot;USER_ID_TOLOCATION-REFERENCE&quot;,
        &quot;uuid&quot;: &quot;60f9f51d-e5d6-41f5-86b9-ae866b8c9fa3&quot;,
        &quot;type&quot; : &quot;Feed&quot;
      }
    }
  ]
}
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.2.'; page-break-before: always">
    
  <h1 id="pg-b02a3d3f350b1b05feec5352bf2f0e77">10.2 - File Output</h1>
    
	<p>When outputting files with Stroom, the output file names and paths can include various substitution variables to form the file and path names.</p>
<h2 id="context-variables">Context Variables</h2>
<p>The following replacement variables are specific to the current processing context.</p>
<ul>
<li><code>${feed}</code> - The name of the feed that the stream being processed belongs to</li>
<li><code>${pipeline}</code> - The name of the pipeline that is producing output</li>
<li><code>${sourceId}</code> - The id of the input data being processed</li>
<li><code>${partNo}</code> - The part number of the input data being processed where data is in aggregated batches</li>
<li><code>${searchId}</code> - The id of the batch search being performed. This is only available during a batch search</li>
<li><code>${node}</code> - The name of the node producing the output</li>
</ul>
<h2 id="time-variables">Time Variables</h2>
<p>The following replacement variables can be used to include aspects of the current time in UTC.</p>
<ul>
<li><code>${year}</code> - Year in 4 digit form, e.g. 2000</li>
<li><code>${month}</code> - Month of the year padded to 2 digits</li>
<li><code>${day}</code> - Day of the month padded to 2 digits</li>
<li><code>${hour}</code> - Hour padded to 2 digits using 24 hour clock, e.g. 22</li>
<li><code>${minute}</code> - Minute padded to 2 digits</li>
<li><code>${second}</code> - Second padded to 2 digits</li>
<li><code>${millis}</code> - Milliseconds padded to 3 digits</li>
<li><code>${ms}</code> - Milliseconds since the epoch</li>
</ul>
<h2 id="system-environment-variables">System (Environment) Variables</h2>
<p>System variables (environment variables) can also be used, e.g. <code>${TMP}</code>.</p>
<h2 id="file-name-references">File Name References</h2>
<p>rolledFileName in RollingFileAppender can use references to the fileName to incorporate parts of the non rolled file name.</p>
<ul>
<li><code>${fileName}</code> - The complete file name</li>
<li><code>${fileStem}</code> - Part of the file name before the file extension, i.e. everything before the last &lsquo;.&rsquo;</li>
<li><code>${fileExtension}</code> - The extension part of the file name, i.e. everything after the last &lsquo;.&rsquo;</li>
</ul>
<h2 id="other-variables">Other Variables</h2>
<ul>
<li><code>${uuid}</code> - A randomly generated UUID to guarantee unique file names</li>
</ul>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.3.'; page-break-before: always">
    
  <h1 id="pg-abb89cd998f89dc653cebf1da2271a55">10.3 - Parser</h1>
    <div class="lead">Parsing input data.</div>
	<p>The following capabilities are available to parse input data:</p>
<ul>
<li>XML - XML input can be parsed with the XML parser.</li>
<li><a href="../../../docs/user-guide/pipelines/parser/xml-fragments/">XML Fragment</a> - Treat input data as an XML fragment, i.e. XML that does not have an XML declaration or root elements.</li>
<li><a href="../../../docs/user-guide/data-splitter/">Data Splitter</a> - Delimiter and regular expression based language for turning non XML data into XML (e.g. CSV)</li>
</ul>

</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.3.1.'; page-break-before: always">
    
  <h1 id="pg-850da8228403d37fae63cefb4607865a">10.3.1 - Context Data</h1>
    
	<p>##Context File</p>
<p>###Input File:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;SomeData&gt;
	&lt;SomeEvent&gt;
			&lt;SomeTime&gt;01/01/2009:12:00:01&lt;/SomeTime&gt;
			&lt;SomeAction&gt;OPEN&lt;/SomeAction&gt;
			&lt;SomeUser&gt;userone&lt;/SomeUser&gt;
			&lt;SomeFile&gt;D:\TranslationKit\example\VerySimple\OpenFileEvents.txt&lt;/SomeFile&gt;
	&lt;/SomeEvent&gt;
&lt;/SomeData&gt;
</code></pre>
<p>###Context File:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;SomeContext&gt;
	&lt;Machine&gt;MyMachine&lt;/Machine&gt;
&lt;/SomeContext&gt;
</code></pre>
<p>###Context XSLT:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;xsl:stylesheet
	xmlns=&quot;reference-data:2&quot;
	xmlns:evt=&quot;event-logging:3&quot;
	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
	xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
	version=&quot;2.0&quot;&gt;
		
		&lt;xsl:template match=&quot;SomeContext&quot;&gt;
			&lt;referenceData 
					xsi:schemaLocation=&quot;event-logging:3 file://event-logging-v3.0.0.xsd reference-data:2 file://reference-data-v2.0.1.xsd&quot;
					version=&quot;2.0.1&quot;&gt;
							
					&lt;xsl:apply-templates/&gt;
			&lt;/referenceData&gt;
		&lt;/xsl:template&gt;

		&lt;xsl:template match=&quot;Machine&quot;&gt;
			&lt;reference&gt;
					&lt;map&gt;CONTEXT&lt;/map&gt;
					&lt;key&gt;Machine&lt;/key&gt;
					&lt;value&gt;&lt;xsl:value-of select=&quot;.&quot;/&gt;&lt;/value&gt;
			&lt;/reference&gt;
		&lt;/xsl:template&gt;
		
&lt;/xsl:stylesheet&gt;
</code></pre>
<p>###Context XML Translation:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;referenceData xmlns:evt=&quot;event-logging:3&quot;
								xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
								xmlns=&quot;reference-data:2&quot;
								xsi:schemaLocation=&quot;event-logging:3 file://event-logging-v3.0.0.xsd reference-data:2 file://reference-data-v2.0.1.xsd&quot;
								version=&quot;2.0.1&quot;&gt;
		&lt;reference&gt;
			&lt;map&gt;CONTEXT&lt;/map&gt;
			&lt;key&gt;Machine&lt;/key&gt;
			&lt;value&gt;MyMachine&lt;/value&gt;
		&lt;/reference&gt;
&lt;/referenceData&gt;
</code></pre>
<p>###Input File:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;SomeData&gt;
	&lt;SomeEvent&gt;
			&lt;SomeTime&gt;01/01/2009:12:00:01&lt;/SomeTime&gt;
			&lt;SomeAction&gt;OPEN&lt;/SomeAction&gt;
			&lt;SomeUser&gt;userone&lt;/SomeUser&gt;
			&lt;SomeFile&gt;D:\TranslationKit\example\VerySimple\OpenFileEvents.txt&lt;/SomeFile&gt;
	&lt;/SomeEvent&gt;
&lt;/SomeData&gt;
</code></pre>
<p>###Main XSLT (Note the use of the context lookup):</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;xsl:stylesheet
	xmlns=&quot;event-logging:3&quot;
	xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; 
	version=&quot;2.0&quot;&gt;
	
    &lt;xsl:template match=&quot;SomeData&quot;&gt;
        &lt;Events xsi:schemaLocation=&quot;event-logging:3 file://event-logging-v3.0.0.xsd&quot; Version=&quot;3.0.0&quot;&gt;
            &lt;xsl:apply-templates/&gt;
        &lt;/Events&gt;
    &lt;/xsl:template&gt;
    &lt;xsl:template match=&quot;SomeEvent&quot;&gt;
        &lt;xsl:if test=&quot;SomeAction = 'OPEN'&quot;&gt;
            &lt;Event&gt;
                &lt;EventTime&gt;
                        &lt;TimeCreated&gt;
                            &lt;xsl:value-of select=&quot;s:format-date(SomeTime, 'dd/MM/yyyy:hh:mm:ss')&quot;/&gt;
                        &lt;/TimeCreated&gt;
                &lt;/EventTime&gt;
				&lt;EventSource&gt;
					&lt;System&gt;Example&lt;/System&gt;
					&lt;Environment&gt;Example&lt;/Environment&gt;
					&lt;Generator&gt;Very Simple Provider&lt;/Generator&gt;
					&lt;Device&gt;
						&lt;IPAddress&gt;182.80.32.132&lt;/IPAddress&gt;
						&lt;Location&gt;
							&lt;Country&gt;UK&lt;/Country&gt;
							&lt;Site&gt;&lt;xsl:value-of select=&quot;s:lookup('CONTEXT', 'Machine')&quot;/&gt;&lt;/Site&gt;
							&lt;Building&gt;Main&lt;/Building&gt;
							&lt;Floor&gt;1&lt;/Floor&gt;              
							&lt;Room&gt;1aaa&lt;/Room&gt;
						&lt;/Location&gt;           
					&lt;/Device&gt;
					&lt;User&gt;&lt;Id&gt;&lt;xsl:value-of select=&quot;SomeUser&quot;/&gt;&lt;/Id&gt;&lt;/User&gt;
				&lt;/EventSource&gt;
				&lt;EventDetail&gt;
					&lt;View&gt;
						&lt;Document&gt;
							&lt;Title&gt;UNKNOWN&lt;/Title&gt;
							&lt;File&gt;
								&lt;Path&gt;&lt;xsl:value-of select=&quot;SomeFile&quot;/&gt;&lt;/Path&gt;
							&lt;/File&gt;
						&lt;/Document&gt;
					&lt;/View&gt;
				&lt;/EventDetail&gt;
            &lt;/Event&gt;
        &lt;/xsl:if&gt;
    &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</code></pre>
<p>###Main Output XML:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Events xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
				xmlns=&quot;event-logging:3&quot;
				xsi:schemaLocation=&quot;event-logging:3 file://event-logging-v3.0.0.xsd&quot;
				Version=&quot;3.0.0&quot;&gt;
		&lt;Event Id=&quot;6:1&quot;&gt;
			&lt;EventTime&gt;
					&lt;TimeCreated&gt;2009-01-01T00:00:01.000Z&lt;/TimeCreated&gt;
			&lt;/EventTime&gt;
			&lt;EventSource&gt;
					&lt;System&gt;Example&lt;/System&gt;
					&lt;Environment&gt;Example&lt;/Environment&gt;
					&lt;Generator&gt;Very Simple Provider&lt;/Generator&gt;
					&lt;Device&gt;
						&lt;IPAddress&gt;182.80.32.132&lt;/IPAddress&gt;
						&lt;Location&gt;
								&lt;Country&gt;UK&lt;/Country&gt;
								&lt;Site&gt;MyMachine&lt;/Site&gt;
								&lt;Building&gt;Main&lt;/Building&gt;
								&lt;Floor&gt;1&lt;/Floor&gt;
								&lt;Room&gt;1aaa&lt;/Room&gt;
						&lt;/Location&gt;
					&lt;/Device&gt;
					&lt;User&gt;
						&lt;Id&gt;userone&lt;/Id&gt;
					&lt;/User&gt;
			&lt;/EventSource&gt;
			&lt;EventDetail&gt;
					&lt;View&gt;
						&lt;Document&gt;
								&lt;Title&gt;UNKNOWN&lt;/Title&gt;
								&lt;File&gt;
									&lt;Path&gt;D:\TranslationKit\example\VerySimple\OpenFileEvents.txt&lt;/Path&gt;
								&lt;/File&gt;
						&lt;/Document&gt;
					&lt;/View&gt;
			&lt;/EventDetail&gt;
		&lt;/Event&gt;
&lt;/Events&gt;
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.3.2.'; page-break-before: always">
    
  <h1 id="pg-59f866a6d2114dc2ea44119af58eff26">10.3.2 - XML Fragments</h1>
    <div class="lead">Handling XML data without root level elements.</div>
	<p>Some input XML data may be missing an XML declaration and root level enclosing elements.
This data is not a valid XML document and must be treated as an XML fragment.
To use XML fragments the input type for a translation must be set to &lsquo;XML Fragment&rsquo;.
A fragment wrapper must be defined in the XML conversion that tells Stroom what declaration and root elements to place around the XML fragment data.</p>
<p>Here is an example:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.1&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE records [
&lt;!ENTITY fragment SYSTEM &quot;fragment&quot;&gt;
]&gt;
&lt;records
  xmlns=&quot;records:2&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;records:2 file://records-v2.0.xsd&quot;
  version=&quot;2.0&quot;&gt;
  &amp;fragment;
&lt;/records&gt;
</code></pre>
<p>During conversion Stroom replaces the fragment text entity with the input XML fragment data.
Note that XML fragments must still be well formed so that they can be parsed correctly.</p>

</div>




    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.4.'; page-break-before: always">
    
  <h1 id="pg-50b1aef8645c34dbbce8b9fff3d3ba23">10.4 - XSLT Conversion</h1>
    <div class="lead">Using Extensible Stylesheet Language Transformations (XSLT) to transform data.</div>
	<p>Once the text file has been converted into Intermediary XML (or the feed is already XML), XSLT is used to
translate the XML into event logging XML format.</p>
<p>Event Feeds must be translated into the events schema and Reference
into the reference schema. You can browse documentation relating to the
schemas within the application.</p>
<p>Here is an example XSLT:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;xsl:stylesheet
    xmlns=&quot;event-logging:3&quot;
    xmlns:s=&quot;stroom&quot;
    xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    version=&quot;2.0&quot;&gt;

    &lt;xsl:template match=&quot;SomeData&quot;&gt;
        &lt;Events
        xsi:schemaLocation=&quot;event-logging:3 file://event-logging-v3.0.0.xsd&quot;
        Version=&quot;3.0.0&quot;&gt;
            &lt;xsl:apply-templates/&gt;
        &lt;/Events&gt;
    &lt;/xsl:template&gt;
    &lt;xsl:template match=&quot;SomeEvent&quot;&gt;
        &lt;xsl:variable name=&quot;dateTime&quot; select=&quot;SomeTime&quot;/&gt;
        &lt;xsl:variable name=&quot;formattedDateTime&quot; select=&quot;s:format-date($dateTime, 'dd/MM/yyyyhh:mm:ss')&quot;/&gt;

        &lt;xsl:if test=&quot;SomeAction = 'OPEN'&quot;&gt;
            &lt;Event&gt;
            &lt;EventTime&gt;
                &lt;TimeCreated&gt;
                    &lt;xsl:value-of select=&quot;$formattedDateTime&quot;/&gt;
                &lt;/TimeCreated&gt;
            &lt;/EventTime&gt;
            &lt;EventSource&gt;
                &lt;System&gt;Example&lt;/System&gt;
                &lt;Environment&gt;Example&lt;/Environment&gt;
                &lt;Generator&gt;Very Simple Provider&lt;/Generator&gt;
                &lt;Device&gt;
                    &lt;IPAddress&gt;3.3.3.3&lt;/IPAddress&gt;
                &lt;/Device&gt;
                &lt;User&gt;
                    &lt;Id&gt;&lt;xsl:value-of select=&quot;SomeUser&quot;/&gt;&lt;/Id&gt;
                &lt;/User&gt;
            &lt;/EventSource&gt;
            &lt;EventDetail&gt;
                &lt;View&gt;
                    &lt;Document&gt;
                        &lt;Title&gt;UNKNOWN&lt;/Title&gt;
                        &lt;File&gt;
                        &lt;Path&gt;&lt;xsl:value-of select=&quot;SomeFile&quot;/&gt;&lt;/Path&gt;
                        &lt;File&gt;
                    &lt;/Document&gt;
                &lt;/View&gt;
            &lt;/EventDetail&gt;
            &lt;/Event&gt;
        &lt;/xsl:if&gt;
    &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</code></pre>

</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.4.1.'; page-break-before: always">
    
  <h1 id="pg-00fcef074a5fb84079d17e4049c5a7f8">10.4.1 - XSLT Functions</h1>
    <div class="lead">Custom XSLT functions available in Stroom.</div>
	<p>By including the following namespace:</p>
<pre><code class="language-xml">xmlns:s=&quot;stroom&quot;
</code></pre>
<p>E.g.</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;xsl:stylesheet
    xmlns=&quot;event-logging:3&quot;
    xmlns:s=&quot;stroom&quot;
    xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    version=&quot;2.0&quot;&gt;
</code></pre>
<p>The following functions are available to aid your translation:</p>
<ul>
<li><a href="#bitmap-lookup"><code>bitmap-lookup(String map, String key)</code></a> - Bitmap based look up against reference data map using the period start time</li>
<li><a href="#bitmap-lookup"><code>bitmap-lookup(String map, String key, String time)</code></a> - Bitmap based look up against reference data map using a specified time, e.g. the event time</li>
<li><a href="#bitmap-lookup"><code>bitmap-lookup(String map, String key, String time, Boolean ignoreWarnings)</code></a> - Bitmap based look up against reference data map using a specified time, e.g. the event time, and ignore any warnings generated by a failed lookup</li>
<li><a href="#bitmap-lookup"><code>bitmap-lookup(String map, String key, String time, Boolean ignoreWarnings, Boolean trace)</code></a> - Bitmap based look up against reference data map using a specified time, e.g. the event time, and ignore any warnings generated by a failed lookup and get trace information for the path taken to resolve the lookup.</li>
<li><code>classification()</code> - The classification of the feed for the data being processed</li>
<li><code>col-from()</code> - The column in the input that the current record begins on (can be 0).</li>
<li><code>col-to()</code> - The column in the input that the current record ends at.</li>
<li><code>current-time()</code> - The current system time</li>
<li><code>current-user()</code> - The current user logged into Stroom (only relevant for interactive use, e.g. search)</li>
<li><code>decode-url(String encodedUrl)</code> - Decode the provided url.</li>
<li><a href="#dictionary"><code>dictionary(String name)</code></a> - Loads the contents of the named dictionary for use within the translation</li>
<li><code>encode-url(String url)</code> - Encode the provided url.</li>
<li><code>feed-name()</code> - Name of the feed for the data being processed</li>
<li><a href="#format-date"><code>format-date(String date, String pattern)</code></a> - Format a date that uses the specified pattern using the default time zone</li>
<li><a href="#format-date"><code>format-date(String date, String pattern, String timeZone)</code></a> - Format a date that uses the specified pattern with the specified time zone</li>
<li><a href="#format-date"><code>format-date(String date, String patternIn, String timeZoneIn, String patternOut, String timeZoneOut)</code></a> - Parse a date with the specified input pattern and time zone and format the output with the specified output pattern and time zone</li>
<li><a href="#format-date"><code>format-date(String milliseconds)</code></a> - Format a date that is specified as a number of milliseconds since a standard base time known as &ldquo;the epoch&rdquo;, namely January 1, 1970, 00:00:00 GMT</li>
<li><a href="#put-and-get"><code>get(String key)</code></a> - Returns the value associated with a key that has been stored using put()</li>
<li><code>hash(String value)</code> - Hash a string value using the default <code>SHA-256</code> algorithm and no salt</li>
<li><code>hash(String value, String algorithm, String salt)</code> - Hash a string value using the specified hashing algorithm and supplied salt value. Supported hashing algorithms include <code>SHA-256</code>, <code>SHA-512</code>, <code>MD5</code>.</li>
<li><code>hex-to-dec(String hex)</code> - Convert hex to dec representation</li>
<li><code>hex-to-oct(String hex)</code> - Convert hex to oct representation</li>
<li><code>json-to-xml(String json)</code> - Returns an XML representation of the supplied JSON value for use in XPath expressions</li>
<li><code>line-from()</code> - The line in the input that the current record begins on (1 based).</li>
<li><code>line-to()</code> - The line in the input that the current record ends at.</li>
<li><a href="#link"><code>link(String url)</code></a> - Creates a stroom dashboard table link.</li>
<li><a href="#link"><code>link(String title, String url)</code></a> - Creates a stroom dashboard table link.</li>
<li><a href="#link"><code>link(String title, String url, String type)</code></a> - Creates a stroom dashboard table link.</li>
<li><a href="#log"><code>log(String severity, String message)</code></a> - Logs a message to the processing log with the specified severity</li>
<li><a href="#lookup"><code>lookup(String map, String key)</code></a> - Look up a reference data map using the period start time</li>
<li><a href="#lookup"><code>lookup(String map, String key, String time)</code></a> - Look up a reference data map using a specified time, e.g. the event time</li>
<li><a href="#lookup"><code>lookup(String map, String key, String time, Boolean ignoreWarnings)</code></a> - Look up a reference data map using a specified time, e.g. the event time, and ignore any warnings generated by a failed lookup</li>
<li><a href="#lookup"><code>lookup(String map, String key, String time, Boolean ignoreWarnings, Boolean trace)</code></a> - Look up a reference data map using a specified time, e.g. the event time, ignore any warnings generated by a failed lookup and get trace information for the path taken to resolve the lookup.</li>
<li><code>meta(String key)</code> - Lookup a meta data value for the current stream using the specified key. The key can be <code>Feed</code>, <code>StreamType</code>, <code>CreatedTime</code>, <code>EffectiveTime</code>, <code>Pipeline</code> or any other attribute supplied when the stream was sent to Stroom, e.g. meta(&lsquo;System&rsquo;).</li>
<li><code>numeric-ip(String ipAddress)</code> - Convert an IP address to a numeric representation for range comparison</li>
<li><code>part-no()</code> - The current part within a multi part aggregated input stream (AKA the substream number) (1 based)</li>
<li><a href="#parse-uri"><code>parse-uri(String URI)</code></a> - Returns an XML structure of the URI providing <code>authority</code>, <code>fragment</code>, <code>host</code>, <code>path</code>, <code>port</code>, <code>query</code>, <code>scheme</code>, <code>schemeSpecificPart</code>, and <code>userInfo</code> components if present.</li>
<li><code>random()</code> - Get a system generated random number between 0 and 1.</li>
<li><code>record-no()</code> - The current record number within the current part (substream) (1 based).</li>
<li><code>search-id()</code> - Get the id of the batch search when a pipeline is processing as part of a batch search</li>
<li><code>source()</code> - Returns an XML structure with the <code>stroom-meta</code> namespace detailing the current source location.</li>
<li><code>source-id()</code> - Get the id of the current input stream that is being processed</li>
<li><code>stream-id()</code> - An alias for <code>source-id</code> included for backward compatibility.</li>
<li><code>pipeline-name()</code> - Name of the current processing pipeline using the XSLT</li>
<li><a href="#put-and-get"><code>put(String key, String value)</code></a> - Store a value for use later on in the translation</li>
</ul>
<h2 id="bitmap-lookup">bitmap-lookup()</h2>
<p>The bitmap-lookup() function looks up a bitmap key from reference or context data a value (which can be an XML node set) for each set bit position and adds it to the resultant XML.</p>
<pre><code class="language-text">bitmap-lookup(String map, String key)
bitmap-lookup(String map, String key, String time)
bitmap-lookup(String map, String key, String time, Boolean ignoreWarnings)
bitmap-lookup(String map, String key, String time, Boolean ignoreWarnings, Boolean trace)
</code></pre>
<ul>
<li><code>map</code> - The name of the reference data map to perform the lookup against.</li>
<li><code>key</code> - The bitmap value to lookup.
This can either be represented as a decimal integer (e.g. <code>14</code>) or as hexadecimal by prefixing with <code>0x</code> (e.g <code>0xE</code>).</li>
<li><code>time</code> - Determines which set of reference data was effective at the requested time.
If no reference data exists with an effective time before the requested time then the lookup will fail.
Time is in the format <code>yyyy-MM-dd'T'HH:mm:ss.SSSXX</code>, e.g. <code>2010-01-01T00:00:00.000Z</code>.</li>
<li><code>ignoreWarnings</code> - If true, any lookup failures will be ignored, else they will be reported as warnings.</li>
<li><code>trace</code> - If true, additional trace information is output as INFO messages.</li>
</ul>
<p>If the look up fails no result will be returned.</p>
<p>The key is a bitmap expressed as either a decimal integer or a hexidecimal value, e.g. <code>14</code>/<code>0xE</code> is <code>1110</code> as a binary bitmap.
For each bit position that is set, (i.e. has a binary value of <code>1</code>)  a lookup will be performed using that bit position as the key.
In this example, positions <code>1</code>, <code>2</code> &amp; <code>3</code> are set so a lookup would be performed for these bit positions.
The result of each lookup for the bitmap are concatenated together in bit position order, separated by a space.</p>
<p>If <code>ignoreWarnings</code> is true then any lookup failures will be ignored and it will return the value(s) for the bit positions it was able to lookup.</p>
<p>This function can be useful when you have a set of values that can be represented as a bitmap and you need them to be converted back to individual values.
For example if you have a set of additive account permissions (e.g Admin, ManageUsers, PerformExport, etc.), each of which is associated with a bit position, then a user&rsquo;s permissions could be defined as a single decimal/hex bitmap value.
Thus a bitmap lookup with this value would return all the permissions held by the user.</p>
<p>For example the reference data store may contain:</p>
<table>
<thead>
<tr>
<th>Key (Bit position)</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Administrator</td>
</tr>
<tr>
<td>1</td>
<td>Manage_Users</td>
</tr>
<tr>
<td>2</td>
<td>Perform_Export</td>
</tr>
<tr>
<td>3</td>
<td>View_Data</td>
</tr>
<tr>
<td>4</td>
<td>Manage_Jobs</td>
</tr>
<tr>
<td>5</td>
<td>Delete_Data</td>
</tr>
<tr>
<td>6</td>
<td>Manage_Volumes</td>
</tr>
</tbody>
</table>
<p>The following are example lookups using the above reference data:</p>
<table>
<thead>
<tr>
<th>Lookup Key (decimal)</th>
<th>Lookup Key (Hex)</th>
<th>Bitmap</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0</code></td>
<td><code>0x0</code></td>
<td><code>0000000</code></td>
<td>-</td>
</tr>
<tr>
<td><code>1</code></td>
<td><code>0x1</code></td>
<td><code>0000001</code></td>
<td><code>Administrator</code></td>
</tr>
<tr>
<td><code>74</code></td>
<td><code>0x4A</code></td>
<td><code>1001010</code></td>
<td><code>Manage_Users View_Data Manage_Volumes</code></td>
</tr>
<tr>
<td><code>2</code></td>
<td><code>0x2</code></td>
<td><code>0000010</code></td>
<td><code>Manage_Users</code></td>
</tr>
<tr>
<td><code>96</code></td>
<td><code>0x60</code></td>
<td><code>1100000</code></td>
<td><code>Delete_Data Manage_Volumes</code></td>
</tr>
</tbody>
</table>
<h2 id="dictionary">dictionary()</h2>
<p>The dictionary() function gets the contents of the specified dictionary for use during translation.
The main use for this function is to allow users to abstract the management of a set of keywords from the XSLT so that it is easier for some users to make quick alterations to a dictionary that is used by some XSLT, without the need for the user to understand the complexities of XSLT.</p>
<h2 id="format-date">format-date()</h2>
<p>The format-date() function takes a Pattern and optional TimeZone arguments and replaces the parsed
contents with an XML standard Date Format. The pattern must be a Java based SimpleDateFormat.  If the
optional TimeZone argument is present the pattern must not include the time zone pattern tokens (z and Z).
A special time zone value of &ldquo;GMT/BST&rdquo; can be used to guess the time based on the date (BST during
British Summer Time).</p>
<p>E.g. Convert a GMT date time &ldquo;2009/12/01 12:34:11&rdquo;</p>
<pre><code class="language-xml">&lt;xsl:value-of select=&quot;s:format-date('2009/08/01 12:34:11', 'yyyy/MM/dd HH:mm:ss')&quot;/&gt;
</code></pre>
<p>E.g. Convert a GMT or BST date time &ldquo;2009/08/01 12:34:11&rdquo;</p>
<pre><code class="language-xml">&lt;xsl:value-of select=&quot;s:format-date('2009/08/01 12:34:11', 'yyyy/MM/dd HH:mm:ss', 'GMT/BST')&quot;/&gt;
</code></pre>
<p>E.g. Convert a GMT+1:00 date time &ldquo;2009/08/01 12:34:11&rdquo;</p>
<pre><code class="language-xml">&lt;xsl:value-of select=&quot;s:format-date('2009/08/01 12:34:11', 'yyyy/MM/dd HH:mm:ss', 'GMT+1:00')&quot;/&gt;
</code></pre>
<p>E.g. Convert a date time specified as milliseconds since the epoch &ldquo;1269270011640&rdquo;</p>
<pre><code class="language-xml">&lt;xsl:value-of select=&quot;s:format-date('1269270011640')&quot;/&gt;
</code></pre>
<p>Time Zone Must be as per the rules defined in SimpleDateFormat under General Time Zone syntax.</p>
<h2 id="link">link()</h2>
<p>Create a string that represents a hyperlink for display in a dashboard table.</p>
<pre><code>link(url)
link(title, url)
link(title, url, type)
</code></pre>
<p>Example</p>
<pre><code>link('http://www.somehost.com/somepath')
&gt; [http://www.somehost.com/somepath](http://www.somehost.com/somepath)
link('Click Here','http://www.somehost.com/somepath')
&gt; [Click Here](http://www.somehost.com/somepath)
link('Click Here','http://www.somehost.com/somepath', 'dialog')
&gt; [Click Here](http://www.somehost.com/somepath){dialog}
link('Click Here','http://www.somehost.com/somepath', 'dialog|Dialog Title')
&gt; [Click Here](http://www.somehost.com/somepath){dialog|Dialog Title}
</code></pre>
<p>Type can be one of:</p>
<ul>
<li><code>dialog</code> : Display the content of the link URL within a stroom popup dialog.</li>
<li><code>tab</code> : Display the content of the link URL within a stroom tab.</li>
<li><code>browser</code> : Display the content of the link URL within a new browser tab.</li>
<li><code>dashboard</code> : Used to launch a stroom dashboard internally with parameters in the URL.</li>
</ul>
<p>If you wish to override the default title or URL of the target link in either a tab or dialog you can. Both <code>dialog</code> and <code>tab</code> types allow titles to be specified after a <code>|</code>, e.g. <code>dialog|My Title</code>.</p>
<h2 id="log">log()</h2>
<p>The log() function writes a message to the processing log with the specified severity.
Severities of INFO, WARN, ERROR and FATAL can be used.
Severities of ERROR and FATAL will result in records being omitted from the output if a RecordOutputFilter is used in the pipeline.
The counts for RecWarn, RecError will be affected by warnings or errors generated in this way therefore this function is useful for adding business rules to XML output.</p>
<p>E.g. Warn if a SID is not the correct length.</p>
<pre><code class="language-xml">&lt;xsl:if test=&quot;string-length($sid) != 7&quot;&gt;
  &lt;xsl:value-of select=&quot;s:log('WARN', concat($sid, ' is not the correct length'))&quot;/&gt;
&lt;/xsl:if&gt;
</code></pre>
<h2 id="lookup">lookup()</h2>
<p>The lookup() function looks up from reference or context data a value (which can be an XML node set) and adds it to the resultant XML.</p>
<pre><code class="language-text">lookup(String map, String key)
lookup(String map, String key, String time)
lookup(String map, String key, String time, Boolean ignoreWarnings)
lookup(String map, String key, String time, Boolean ignoreWarnings, Boolean trace)
</code></pre>
<ul>
<li><code>map</code> - The name of the reference data map to perform the lookup against.</li>
<li><code>key</code> - The key to lookup. The key can be a simple string, an integer value in a numeric range or a nested lookup key.</li>
<li><code>time</code> - Determines which set of reference data was effective at the requested time.
If no reference data exists with an effective time before the requested time then the lookup will fail.
Time is in the format <code>yyyy-MM-dd'T'HH:mm:ss.SSSXX</code>, e.g. <code>2010-01-01T00:00:00.000Z</code>.</li>
<li><code>ignoreWarnings</code> - If true, any lookup failures will be ignored, else they will be reported as warnings.</li>
<li><code>trace</code> - If true, additional trace information is output as INFO messages.</li>
</ul>
<p>If the look up fails no result will be returned.
By testing the result a default value may be output if no result is returned.</p>
<p>E.g. Look up a SID given a PF</p>
<pre><code class="language-xml">&lt;xsl:variable name=&quot;pf&quot; select=&quot;PFNumber&quot;/&gt;
&lt;xsl:if test=&quot;$pf&quot;&gt;
   &lt;xsl:variable name=&quot;sid&quot; select=&quot;s:lookup('PF_TO_SID', $pf, $formattedDateTime)&quot;/&gt;

   &lt;xsl:choose&gt;
      &lt;xsl:when test=&quot;$sid&quot;&gt;
         &lt;User&gt;
             &lt;Id&gt;&lt;xsl:value-of select=&quot;$sid&quot;/&gt;&lt;/Id&gt;
         &lt;/User&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
         &lt;data name=&quot;PFNumber&quot;&gt;
            &lt;xsl:attribute name=&quot;Value&quot;&gt;&lt;xsl:value-of select=&quot;$pf&quot;/&gt;&lt;/xsl:attribute&gt;
         &lt;/data&gt;
      &lt;/xsl:otherwise&gt;
   &lt;/xsl:choose&gt;
&lt;/xsl:if&gt;
</code></pre>
<h3 id="range-lookups">Range lookups</h3>
<p>Reference data entries can either be stored with single string key or a key range that defines a numeric range, e.g 1-100.
When a lookup is preformed the passed key is looked up as if it were a normal string key.
If that lookup fails Stroom will try to convert the key to an integer (long) value.
If it can be converted to an integer than a second lookup will be performed against entries with key ranges to see if there is a key range that includes the requested key.</p>
<p>Range lookups can be used for looking up an IP address where the reference data values are associated with ranges of IP addresses.
In this use case, the IP address must first be converted into a numeric value using <code>numeric-ip()</code>, e.g:</p>
<pre><code class="language-xslt">stroom:lookup('IP_TO_LOCATION', numeric-ip($ipAddress))
</code></pre>
<p>Similarly the reference data must be stored with key ranges whose bounds were created using this function.</p>
<h3 id="nested-maps">Nested Maps</h3>
<p>The lookup function allows you to perform chained lookups using nested maps.
For example you may have a reference data map called <em>USER_ID_TO_LOCATION</em> that maps user IDs to some location information for that user and a map called <em>USER_ID_TO_MANAGER</em> that maps user IDs to the user ID of their manager.
If you wanted to decorate a user&rsquo;s event with the location of their manager you could use a nested map to achieve the lookup chain.
To perform the lookup set the <code>map</code> argument to the list of maps in the lookup chain, separated by a <code>/</code>, e.g. <code>USER_ID_TO_MANAGER/USER_ID_TO_LOCATION</code>.</p>
<p>This will perform a lookup against the first map in the list using the requested key.
If a value is found the value will be used as the key in a lookup against the next map.
The value from each map lookup is used as the key in the next map all the way down the chain.
The value from the last lookup is then returned as the result of the <code>lookup()</code> call.
If no value is found at any point in the chain then that results in no value being returned from the function.</p>
<p>In order to use nested map lookups each intermediate map must contain simple string values.
The last map in the chain can either contain string values or XML fragment values.</p>
<h2 id="put-and-get">put() and get()</h2>
<p>You can put values into a map using the put() function. These values can then be retrieved
later using the get() function. Values are stored against a key name so that multiple values
can be stored. These functions can be used for many purposes but are most commonly used to
count a number of records that meet certain criteria.</p>
<p>An example of how to count records is shown below:</p>
<pre><code class="language-xml">&lt;!-- Get the current record count --&gt;
&lt;xsl:variable name=&quot;currentCount&quot; select=&quot;number(s:get('count'))&quot; /&gt;

&lt;!-- Increment the record count --&gt;
&lt;xsl:variable name=&quot;count&quot;&gt;
  &lt;xsl:choose&gt;
    &lt;xsl:when test=&quot;$currentCount&quot;&gt;
      &lt;xsl:value-of select=&quot;$currentCount + 1&quot; /&gt;
    &lt;/xsl:when&gt;
    &lt;xsl:otherwise&gt;
      &lt;xsl:value-of select=&quot;1&quot; /&gt;
    &lt;/xsl:otherwise&gt;
  &lt;/xsl:choose&gt;
&lt;/xsl:variable&gt;

&lt;!-- Store the count for future retrieval --&gt;
&lt;xsl:value-of select=&quot;s:put('count', $count)&quot; /&gt;

&lt;!-- Output the new count --&gt;
&lt;data name=&quot;Count&quot;&gt;
  &lt;xsl:attribute name=&quot;Value&quot; select=&quot;$count&quot; /&gt;
&lt;/data&gt;
</code></pre>
<h2 id="parse-uri">parse-uri()</h2>
<p>The parse-uri() function takes a Uniform Resource Identifier (URI) in string form and returns an XML node with a namespace of <code>uri</code> containing the URI&rsquo;s individual components of <code>authority</code>, <code>fragment</code>, <code>host</code>, <code>path</code>, <code>port</code>, <code>query</code>, <code>scheme</code>, <code>schemeSpecificPart</code> and <code>userInfo</code>. See either <a href="http://www.ietf.org/rfc/rfc2396.txt">RFC 2306: Uniform Resource Identifiers (URI): Generic Syntax</a> or Java&rsquo;s java.net.URI Class for details regarding the components.</p>
<p>The following xml</p>
<pre><code class="language-xml">&lt;!-- Display and parse the URI contained within the text of the rURI element --&gt;
&lt;xsl:variable name=&quot;u&quot; select=&quot;s:parseUri(rURI)&quot; /&gt;

&lt;URI&gt;
  &lt;xsl:value-of select=&quot;rURI&quot; /&gt;
&lt;/URI&gt;
&lt;URIDetail&gt;
  &lt;xsl:copy-of select=&quot;$v&quot;/&gt;
&lt;/URIDetail&gt;
</code></pre>
<p>given the rURI text contains</p>
<pre><code>   http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;amp;p2=v2#more-details
</code></pre>
<p>would provide</p>
<pre><code class="language-xml">&lt;URL&gt;http://foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;amp;p2=v2#more-details&lt;/URL&gt;
&lt;URIDetail&gt;
  &lt;authority xmlns=&quot;uri&quot;&gt;foo:bar@w1.superman.com:8080&lt;/authority&gt;
  &lt;fragment xmlns=&quot;uri&quot;&gt;more-details&lt;/fragment&gt;
  &lt;host xmlns=&quot;uri&quot;&gt;w1.superman.com&lt;/host&gt;
  &lt;path xmlns=&quot;uri&quot;&gt;/very/long/path.html&lt;/path&gt;
  &lt;port xmlns=&quot;uri&quot;&gt;8080&lt;/port&gt;
  &lt;query xmlns=&quot;uri&quot;&gt;p1=v1&amp;amp;p2=v2&lt;/query&gt;
  &lt;scheme xmlns=&quot;uri&quot;&gt;http&lt;/scheme&gt;
  &lt;schemeSpecificPart xmlns=&quot;uri&quot;&gt;//foo:bar@w1.superman.com:8080/very/long/path.html?p1=v1&amp;amp;p2=v2&lt;/schemeSpecificPart&gt;
  &lt;userInfo xmlns=&quot;uri&quot;&gt;foo:bar&lt;/userInfo&gt;
&lt;/URIDetail&gt;
</code></pre>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '10.4.2.'; page-break-before: always">
    
  <h1 id="pg-3f52cd945d5eabe8bb9a84799caa130e">10.4.2 - XSLT Includes</h1>
    <div class="lead">Using an XSLT import to include XSLT from another translation.</div>
	<p>You can use an XSLT import to include XSLT from another translation.  E.g.</p>
<pre><code class="language-xml">&lt;xsl:import href=&quot;ApacheAccessCommon&quot; /&gt;
</code></pre>
<p>This would include the XSLT from the ApacheAccessCommon translation.</p>

</div>




    
	
  

    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '11.'; page-break-before: always">
    
  <h1 id="pg-43200edc2182b8f93348171cfe19220f">11 - Properties</h1>
    <div class="lead">Configuration of Stroom&rsquo;s application properties.</div>
	<blockquote>
<p>This documentation applies to Stroom 7.0 or higher</p>
</blockquote>
<p>Properties are the means of configuring the Stroom application and are typically maintained by the Stroom system administrator.
The value of some properties are required in order for Stroom to function, e.g. database connection details, and thus need to be set prior to running Stroom.
Some properties can be changed at runtime to alter the behaviour of Stroom.</p>
<h2 id="sources">Sources</h2>
<p>Property values can be defined in the following locations.</p>
<h3 id="system-default">System Default</h3>
<p>The system defaults are hard-coded into the Stroom application code by the developers and can&rsquo;t be changed.
These represent reasonable defaults, where applicable, but may need to be changed, e.g. to reflect the scale of the Stroom system or the specific environment.</p>
<p>The default property values can either be viewed in the Stroom user interface (<em>Tools</em> -&gt; <em>Properties</em>) or in the file <code>config/config-defaults.yml</code> in the Stroom distribution.</p>
<h3 id="global-database-value">Global Database Value</h3>
<p>Global database values are property values stored in the database that are global across the whole cluster.</p>
<p>The global database value is defined as a record in the <code>config</code> table in the database.
The database record will only exist if a database value has explicitly been set.
The database value will apply to all nodes in the cluster, overriding the default value, unless a node also has a value set in its YAML configuration.</p>
<p>Database values can be set from the Stroom user interface using <em>Tools</em> -&gt; <em>Properties</em>.
Some properties are marked <em>Read Only</em> which means they cannot have a database value set for them.
These properties can only be altered via the YAML configuration file on each node.
Such properties are typically used to configure values required for Stroom to be able to boot, so it does not make sense for them to be configurable from the User Interface.</p>
<h3 id="yaml-configuration-file">YAML Configuration file</h3>
<p>Stroom is built on top of a framework called Drop Wizard.
Drop Wizard uses a YAML configuration file on each node to configure the application.
This is typically <code>config.yml</code> and is located in the <code>config</code> directory.</p>
<p>This file contains both the Drop Wizard configuration settings (settings for ports, paths and application logging) and the Stroom specific properties configuration.
The file is in YAML format and the Stroom properties are located under the <code>appConfig</code> key.
For details of the Drop Wizard configuration structure, see <a href="https://www.dropwizard.io/en/latest/manual/configuration.html">here (external link)</a>.</p>
<p>The file is split into three sections using these keys:</p>
<ul>
<li><code>server</code> - Configuration of the web server, e.g. ports, paths, request logging.</li>
<li><code>logging</code> - Configuration of application logging</li>
<li><code>appConfig</code> - The stroom configuration properties</li>
</ul>
<p>The following is an example of the YAML configuration file:</p>
<pre><code class="language-yaml"># Drop Wizard configuration section
server:
  # e.g. ports and paths
logging:
  # e.g. logging levels/appenders

# Stroom properties configuration section
appConfig:
  commonDbDetails:
    connection:
      jdbcDriverClassName: ${STROOM_JDBC_DRIVER_CLASS_NAME:-com.mysql.cj.jdbc.Driver}
      jdbcDriverUrl: ${STROOM_JDBC_DRIVER_URL:-jdbc:mysql://localhost:3307/stroom?useUnicode=yes&amp;characterEncoding=UTF-8}
      jdbcDriverUsername: ${STROOM_JDBC_DRIVER_USERNAME:-stroomuser}
      jdbcDriverPassword: ${STROOM_JDBC_DRIVER_PASSWORD:-stroompassword1}
  contentPackImport:
    enabled: true
  ...
</code></pre>
<p>In the Stroom user interface properties are named with a dot notation key, e.g. <em>stroom.contentPackImport.enabled</em>.
Each part of the dot notation property name represents a key in the YAML file, e.g. for this example, the location in the YAML would be:</p>
<pre><code class="language-yaml">appConfig:
  contentPackImport:
    enabled: true   # stroom.contentPackImport.enabled
</code></pre>
<p>The <em>stroom</em> part of the dot notation name is replaced with <em>appConfig</em>.</p>
<h4 id="variable-substitution">Variable Substitution</h4>
<p>The YAML configuration file supports Bash style variable substitution in the form of:</p>
<pre><code class="language-bash">${ENV_VAR_NAME:-value_if_not_set}
</code></pre>
<p>This allows values to be set either directly in the file or via an environment variable, e.g.</p>
<pre><code class="language-yaml">      jdbcDriverClassName: ${STROOM_JDBC_DRIVER_CLASS_NAME:-com.mysql.cj.jdbc.Driver}
</code></pre>
<p>In the above example, if the <em>STROOM_JDBC_DRIVER_CLASS_NAME</em> environment variable is not set then the value <em>com.mysql.cj.jdbc.Driver</em> will be used instead.</p>
<h4 id="typed-values">Typed Values</h4>
<p>YAML supports typed values rather than just strings, see <a href="https://yaml.org/refcard.html">https://yaml.org/refcard.html</a>.
YAML understands booleans, strings, integers, floating point numbers, as well as sequences/lists and maps.
Some properties will be represented differently in the user interface to the YAML file.
This is due to how values are stored in the database and how the current user interface works.
This will likely be improved in future versions.
For details of how different types are represented in the YAML and the UI, see <a href="#data-types">Data Types</a>.</p>
<h2 id="source-precedence">Source Precedence</h2>
<p>The three sources (<em>Default</em>, <em>Database</em> &amp; <em>YAML</em>) are listed in increasing priority, i.e <em>YAML</em> trumps <em>Database</em>, which trumps <em>Default</em>.</p>
<p>For example, in a two node cluster, this table shows the effective value of a property on each node.
A <code>-</code> indicates the value has not been set in that source.
<code>NULL</code> indicates that the value has been explicitly set to NULL.</p>
<table>
<thead>
<tr>
<th>Source</th>
<th>Node1</th>
<th>Node2</th>
</tr>
</thead>
<tbody>
<tr>
<td>Default</td>
<td>red</td>
<td>red</td>
</tr>
<tr>
<td>Database</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>YAML</td>
<td>-</td>
<td>blue</td>
</tr>
<tr>
<td>Effective</td>
<td><strong>red</strong></td>
<td><strong>blue</strong></td>
</tr>
</tbody>
</table>
<p>Or where a Database value is set.</p>
<table>
<thead>
<tr>
<th>Source</th>
<th>Node1</th>
<th>Node2</th>
</tr>
</thead>
<tbody>
<tr>
<td>Default</td>
<td>red</td>
<td>red</td>
</tr>
<tr>
<td>Database</td>
<td>green</td>
<td>green</td>
</tr>
<tr>
<td>YAML</td>
<td>-</td>
<td>blue</td>
</tr>
<tr>
<td>Effective</td>
<td><strong>green</strong></td>
<td><strong>blue</strong></td>
</tr>
</tbody>
</table>
<p>Or where a YAML value is explicitly set to <code>NULL</code>.</p>
<table>
<thead>
<tr>
<th>Source</th>
<th>Node1</th>
<th>Node2</th>
</tr>
</thead>
<tbody>
<tr>
<td>Default</td>
<td>red</td>
<td>red</td>
</tr>
<tr>
<td>Database</td>
<td>green</td>
<td>green</td>
</tr>
<tr>
<td>YAML</td>
<td>-</td>
<td>NULL</td>
</tr>
<tr>
<td>Effective</td>
<td><strong>green</strong></td>
<td><strong>NULL</strong></td>
</tr>
</tbody>
</table>
<h2 id="data-types">Data Types</h2>
<p>Stroom property values can be set using a number of different data types.
Database property values are currently set in the user interface using the string form of the value.
For each of the data types defined below, there will be an example of how the data type is recorded in its string form.</p>
<table>
<thead>
<tr>
<th>Data Type</th>
<th>Example UI String Forms</th>
<th>Example YAML form</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td><code>true</code> <code>false</code></td>
<td><code>true</code> <code>false</code></td>
</tr>
<tr>
<td>String</td>
<td><code>This is a string</code></td>
<td><code>&quot;This is a string&quot;</code></td>
</tr>
<tr>
<td>Integer/Long</td>
<td><code>123</code></td>
<td><code>123</code></td>
</tr>
<tr>
<td>Float</td>
<td><code>1.23</code></td>
<td><code>1.23</code></td>
</tr>
<tr>
<td>Stroom Duration</td>
<td><code>P30D</code> <code>P1DT12H</code> <code>PT30S</code> <code>30d</code> <code>30s</code> <code>30000</code></td>
<td><code>&quot;P30D&quot;</code> <code>&quot;P1DT12H&quot;</code> <code>&quot;PT30S&quot;</code> <code>&quot;30d&quot;</code> <code>&quot;30s&quot;</code> <code>&quot;30000&quot;</code> See <a href="#stroom-duration-data-type">Stroom Duration Data Type</a>.</td>
</tr>
<tr>
<td>List</td>
<td><code>#red#Green#Blue</code> <code>,1,2,3</code></td>
<td>See <a href="#list-data-type">List Data Type</a></td>
</tr>
<tr>
<td>Map</td>
<td><code>,=red=FF0000,Green=00FF00,Blue=0000FF</code></td>
<td>See <a href="#map-data-type">Map Data Type</a></td>
</tr>
<tr>
<td>DocRef</td>
<td><code>,docRef(MyType,a56ff805-b214-4674-a7a7-a8fac288be60,My DocRef name)</code></td>
<td>See <a href="#docref-data-type">DocRef Data Type</a></td>
</tr>
<tr>
<td>Enum</td>
<td><code>HIGH</code> <code>LOW</code></td>
<td><code>&quot;HIGH&quot;</code> <code>&quot;LOW&quot;</code></td>
</tr>
<tr>
<td>Path</td>
<td><code>/some/path/to/a/file</code></td>
<td><code>&quot;/some/path/to/a/file&quot;</code></td>
</tr>
<tr>
<td>ByteSize</td>
<td><code>32</code>, <code>512Kib</code></td>
<td><code>32</code>, <code>512Kib</code> See <a href="#byte-size-data-type">Byte Size Data Type</a></td>
</tr>
</tbody>
</table>
<h3 id="stroom-duration-data-type">Stroom Duration Data Type</h3>
<p>The <em>Stroom Duration</em> data type is used to specify time durations, for example the time to live of a cache or the time to keep data before it is purged.
<em>Stroom Duration</em> uses a number of string forms to support legacy property values.</p>
<h4 id="iso-8601-durations">ISO 8601 Durations</h4>
<p><em>Stroom Duration</em> can be expressed using <a href="https://en.wikipedia.org/wiki/ISO_8601"><em>ISO 8601</em> (external link)</a> duration strings.
It does NOT support the full <em>ISO 8601</em> format, only <code>D</code>, <code>H</code>, <code>M</code> and <code>S</code>.
For details of how the string is parsed to a Stroom Duration, see <a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/time/Duration.html#parse(java.lang.CharSequence)">Duration (external link)</a></p>
<p>The following are examples of <em>ISO 8601</em> duration strings:</p>
<ul>
<li><code>P30D</code> - 30 days</li>
<li><code>P1DT12H</code> - 1 day 12 hours (36 hours)</li>
<li><code>PT30S</code> - 30 seconds</li>
<li><code>PT0.5S</code> - 500 milliseconds</li>
</ul>
<h4 id="legacy-stroom-durations">Legacy Stroom Durations</h4>
<p>This format was used in versions of Stroom older than v7 and is included to support legacy property values.</p>
<p>The following are examples of legacy duration strings:</p>
<ul>
<li><code>30d</code> - 30 days</li>
<li><code>12h</code> - 12 hours</li>
<li><code>10m</code> - 10 minutes</li>
<li><code>30s</code> - 30 seconds</li>
<li><code>500</code> - 500 milliseconds</li>
</ul>
<p>Combinations such as <code>1m30s</code> are not supported.</p>
<h3 id="list-data-type">List Data Type</h3>
<p>This type supports ordered lists of items, where an item can be of any supported data type, e.g. a list of strings or list of integers.</p>
<p>The following is an example of how a property (<code>statusValues</code>) that is is List of strings is represented in the YAML:</p>
<pre><code class="language-yaml">  annotation:
    statusValues:
    - &quot;New&quot;
    - &quot;Assigned&quot;
    - &quot;Closed&quot;
</code></pre>
<p>This would be represented as a string in the User Interface as:</p>
<p><code>|New|Assigned|Closed</code>.</p>
<p>See <a href="#delimiters-in-string-conversion">Delimiters in String Conversion</a> for details of how the items are delimited in the string.</p>
<p>The following is an example of how a property (<code>cpu</code>) that is is List of DocRefs is represented in the YAML:</p>
<pre><code class="language-yaml">  statistics:
    internal:
      cpu:
      - type: &quot;StatisticStore&quot;
        uuid: &quot;af08c4a7-ee7c-44e4-8f5e-e9c6be280434&quot;
        name: &quot;CPU&quot;
      - type: &quot;StroomStatsStore&quot;
        uuid: &quot;1edfd582-5e60-413a-b91c-151bd544da47&quot;
        name: &quot;CPU&quot;
</code></pre>
<p>This would be represented as a string in the User Interface as:</p>
<p><code>|,docRef(StatisticStore,af08c4a7-ee7c-44e4-8f5e-e9c6be280434,CPU)|,docRef(StroomStatsStore,1edfd582-5e60-413a-b91c-151bd544da47,CPU)</code></p>
<p>See <a href="#delimiters-in-string-conversion">Delimiters in String Conversion</a> for details of how the items are delimited in the string.</p>
<h3 id="map-data-type">Map Data Type</h3>
<p>This type supports a collection of key/value pairs where the key is unique within the collection.
The type of the key must be string, but the type of the value can be any supported type.</p>
<p>The following is an example of how a property (<code>mapProperty</code>) that is a map of string =&gt; string would be represented in the YAML:</p>
<pre><code class="language-yaml">mapProperty:
  red: &quot;FF0000&quot;
  green: &quot;00FF00&quot;
  blue: &quot;0000FF&quot;
</code></pre>
<p>This would be represented as a string in the User Interface as:</p>
<p><code>,=red=FF0000,Green=00FF00,Blue=0000FF</code></p>
<p>The delimiter between pairs is defined first, then the delimiter for the key and value.</p>
<p>See <a href="#delimiters-in-string-conversion">Delimiters in String Conversion</a> for details of how the items are delimited in the string.</p>
<h3 id="docref-data-type">DocRef Data Type</h3>
<p>A DocRef (or Document Reference) is a type specific to Stroom that defines a reference to an instance of a Document within Stroom, e.g. an XLST, Pipeline, Dictionary, etc.
A DocRef consists of three parts, the type, the <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID (external link)</a> and the name of the Document.</p>
<p>The following is an example of how a property (<code>aDocRefProperty</code>) that is a DocRef would be represented in the YAML:</p>
<pre><code class="language-yaml">aDocRefProperty:
  type: &quot;MyType&quot;
  uuid: &quot;a56ff805-b214-4674-a7a7-a8fac288be60&quot;
  name: &quot;My DocRef name&quot;
</code></pre>
<p>This would be represented as a string in the User Interface as:</p>
<p><code>,docRef(MyType,a56ff805-b214-4674-a7a7-a8fac288be60,My DocRef name)</code></p>
<p>See <a href="#delimiters-in-string-conversion">Delimiters in String Conversion</a> for details of how the items are delimited in the string.</p>
<h3 id="byte-size-data-type">Byte Size Data Type</h3>
<p>The Byte Size data type is used to represent a quantity of bytes using the <a href="https://en.wikipedia.org/wiki/Binary_prefix">IEC (external link)</a> standard.
Quantities are represented as powers of 1024, i.e. a Kib (Kibibyte) means 1024 bytes.</p>
<p>Examples of Byte Size values in string form are (a YAML value would optionally be surrounded with double quotes):</p>
<ul>
<li><code>32</code>, <code>32b</code>, <code>32B</code>, <code>32bytes</code> - 32 bytes</li>
<li><code>32K</code>, <code>32KB</code>, <code>32KiB</code> - 32 kibibytes</li>
<li><code>32M</code>, <code>32MB</code>, <code>32MiB</code> - 32 mebibytes</li>
<li><code>32G</code>, <code>32GB</code>, <code>32GiB</code> - 32 gibibytes</li>
<li><code>32T</code>, <code>32TB</code>, <code>32TiB</code> - 32 tebibytes</li>
<li><code>32P</code>, <code>32PB</code>, <code>32PiB</code> - 32 pebibytes</li>
</ul>
<p>The <code>*iB</code> form is preferred as it is more explicit and avoids confusion with SI units.</p>
<h3 id="delimiters-in-string-conversion">Delimiters in String Conversion</h3>
<p>The string conversion used for collection types like <em>List</em>, <em>Map</em> etc. relies on the string form defining the delimiter(s) to use for the collection.
The delimiter(s) are added as the first n characters of the string form, e.g. <code>|red|green|blue</code> or <code>|=red=FF0000|Green=00FF00|Blue=0000FF</code>.
It is possible to use a number of different delimiters to allow for delimiter characters appearing in the actual value, e.g. <code>#some text#some text with a | in it</code>
The following are the delimiter characters that can be used.</p>
<p><code>|</code>, <code>:</code>, <code>;</code>, <code>,</code>, <code>!</code>, <code>/</code>, <code>\</code>, <code>#</code>, <code>@</code>, <code>~</code>, <code>-</code>, <code>_</code>, <code>=</code>, <code>+</code>, <code>?</code></p>
<p>When Stroom records a property value to the database it may use a delimiter of its own choosing, ensuring that it picks a delimiter that is not used in the property value.</p>
<h2 id="restart-required">Restart Required</h2>
<p>Some properties are marked as requiring a restart.
There are two scopes for this:</p>
<h3 id="requires-ui-refresh">Requires UI Refresh</h3>
<p>If a property is marked in UI as requiring a UI refresh then this means that a change to the property requires that the Stroom nodes serving the UI are restarted for the new value to take effect.</p>
<h3 id="requires-restart">Requires Restart</h3>
<p>If a property is marked in UI as requiring a restart then this means that a change to the property requires that all Stroom nodes are restarted for the new value to take effect.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '12.'; page-break-before: always">
    
  <h1 id="pg-ae5866da9cfde114a554760822fd9fca">12 - Roles</h1>
    
	
<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">TODO</h4>

    Describe application level permissions and how users and groups behave

</div>


</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '13.'; page-break-before: always">
    
  <h1 id="pg-2de7b2fe97b4152bbd00994cf953e1a2">13 - Security</h1>
    <div class="lead">There are many aspects of security that should be considered when installing and running Stroom.</div>
	<h2 id="shared-storage">Shared Storage</h2>
<p>For most large installations Stroom uses shared storage for its data store. This storage could be a CIFS, NFS or similar shared file system. It is recommended that access to this shared storage is protected so that only the application can access it. This could be achieved by placing the storage and application behind a firewall and by requiring appropriate authentication to the shared storage. It should be noted that NFS is unauthenticated so should be used with appropriate safeguards.</p>
<h2 id="mysql">MySQL</h2>
<h3 id="accounts">Accounts</h3>
<p>It is beyond the scope of this article to discuss this in detail but all MySQL accounts should be secured on initial install. Official guidance for doing this can be found <a href="https://dev.mysql.com/doc/refman/5.6/en/security.html">here (external link)</a>.</p>
<h3 id="communication">Communication</h3>
<p>Communication between MySQL and the application should be secured. This can be achieved in one of the following ways:</p>
<ul>
<li>Placing MySQL and the application behind a firewall</li>
<li>Securing communication through the use of iptables</li>
<li>Making MySQL and the application communicate over SSL (see <a href="https://dev.mysql.com/doc/refman/5.6/en/encrypted-connections.html">here (external link)</a> for instructions)</li>
</ul>
<p>The above options are not mutually exclusive and may be combined to better secure communication.</p>
<h2 id="application">Application</h2>
<h3 id="node-to-node-communication">Node to node communication</h3>
<p>In a multi node Stroom deployment each node communicates with the master node. This can be configured securely in one of several ways:</p>
<ul>
<li>Direct communication to Tomcat on port 8080 - Secured by being behind a firewall or using iptables</li>
<li>Direct communication to Tomcat on port 8443 - Secured using SSL and certificates</li>
<li>Removal of Tomcat connectors other than AJP and configuration of Apache to communicate on port 443 using SSL and certificates</li>
</ul>
<h3 id="application-to-stroom-proxy-communication">Application to Stroom Proxy Communication</h3>
<p>The application can be configured to share some information with Stroom Proxy so that Stroom Proxy can decide whether or not to accept data for certain feeds based on the existence of the feed or it&rsquo;s reject/accept status. The amount of information shared between the application and the proxy is minimal but could be used to discover what feeds are present within the system. Securing this communication is harder as both the application and the proxy will not typically reside behind the same firewall. Despite this communication can still be performed over SSL thus protecting this potential attack vector.</p>
<h3 id="admin-port">Admin port</h3>
<p>Stroom (v6 and above) and its associated family of stroom-* DropWizard based services all expose an admin port (8081 in the case of stroom). This port serves up various health check and monitoring pages as well as a number of restful services for initiating admin tasks. There is currently no authentication on this admin port so it is assumed that access to this port will be tightly controlled using a firewall, iptables or similar.</p>
<h3 id="servlets">Servlets</h3>
<p>There are several servlets in Stroom that are accessible by certain URLs. Considerations should be made about what URLs are made available via Apache and who can access them. The servlets, path and function are described below:</p>
<table>
<thead>
<tr>
<th>Servlet</th>
<th>Path</th>
<th>Function</th>
<th>Risk</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataFeed</td>
<td>/datafeed or /datafeed/*</td>
<td>Used to receive data</td>
<td>Possible denial of service attack by posting too much data/noise</td>
</tr>
<tr>
<td>RemoteFeedService</td>
<td>/remoting/remotefeedservice.rpc</td>
<td>Used by proxy to ask application about feed status (described in previous section)</td>
<td>Possible to systematically discover which feeds are available. Communication with this service should be secured over SSL discussed above</td>
</tr>
<tr>
<td>DynamicCSSServlet</td>
<td>/stroom/dynamic.css</td>
<td>Serves dynamic CSS based on theme configuration</td>
<td>Low risk as no important data is made available by this servlet</td>
</tr>
<tr>
<td>DispatchService</td>
<td>/stroom/dispatch.rpc</td>
<td>Service for UI and server communication</td>
<td>All back-end services accessed by this umbrella service are secured appropriately by the application</td>
</tr>
<tr>
<td>ImportFileServlet</td>
<td>/stroom/importfile.rpc</td>
<td>Used during configuration upload</td>
<td>Users must be authenticated and have appropriate permissions to import configuration</td>
</tr>
<tr>
<td>ScriptServlet</td>
<td>/stroom/script</td>
<td>Serves user defined visualisation scripts to the UI</td>
<td>The visualisation script is considered to be part of the application just as the CSS so is not secured</td>
</tr>
<tr>
<td>ClusterCallService</td>
<td>/clustercall.rpc</td>
<td>Used for node to node communication as discussed above</td>
<td>Communication must be secured as discussed above</td>
</tr>
<tr>
<td>ExportConfig</td>
<td>/export/*</td>
<td>Servlet used to export configuration data</td>
<td>Servlet access must be restricted with Apache to prevent configuration data being made available to unauthenticated users</td>
</tr>
<tr>
<td>Status</td>
<td>/status</td>
<td>Shows the application status including volume usage</td>
<td>Needs to be secured so that only appropriate users can see the application status</td>
</tr>
<tr>
<td>Echo</td>
<td>/echo</td>
<td>Block GZIP data posted to the echo servlet is sent back uncompressed. This is a utility servlet for decompression of external data</td>
<td>URL should be secured or not made available</td>
</tr>
<tr>
<td>Debug</td>
<td>/debug</td>
<td>Servlet for echoing HTTP header arguments including certificate details</td>
<td>Should be secured in production environments</td>
</tr>
<tr>
<td>SessionList</td>
<td>/sessionList</td>
<td>Lists the logged in users</td>
<td>Needs to be secured so that only appropriate users can see who is logged in</td>
</tr>
<tr>
<td>SessionResourceStore</td>
<td>/resourcestore/*</td>
<td>Used to create, download and delete temporary files liked to a users session such as data for export</td>
<td>This is secured by using the users session and requiring authentication</td>
</tr>
</tbody>
</table>
<h2 id="hdfs-kafka-hbase-zookeeper">HDFS, Kafka, HBase, Zookeeper</h2>
<p>Stroom and stroom-stats can integrate with HDFS, Kafka, HBase and Zookeeper. It should be noted that communication with these external services is currently not secure. Until additional security measures (e.g. authentication) are put in place it is assumed that access to these services will be careful controlled (using a firewall, iptables or similar) so that only stroom nodes can access the open ports.</p>
<h2 id="content">Content</h2>
<p>It may be possible for a user to write XSLT, Data Splitter or other content that may expose data that we do not wish to or to cause the application some harm. At present processing operations are not isolated processes and so it is easy to cripple processing performance with a badly written translation whether written accidentally or on purpose. To mitigate this risk it is recommended that users that are given permission to create XSLT, Data Splitter and Pipeline configurations are trusted to do so.</p>
<p>Visualisations can be completely customised with javascript. The javascript that is added is executed in a clients browser potentially opening up the possibility of XSS attacks, an attack on the application to access data that a user shouldn&rsquo;t be able to access, an attack to destroy data or simply failure/incorrect operation of the user interface. To mitigate this risk all user defined javascript is executed within a separate browser IFrame. In addition all javascript should be examined before being added to a production system unless the author is trusted. This may necessitate the creation of a separate development and testing environment for user content.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '14.'; page-break-before: always">
    
  <h1 id="pg-1df26607b1da056bc5eb1790db5dcdd0">14 - Stroom Jobs</h1>
    <div class="lead">Managing background jobs.</div>
	<p>There are various jobs that run in the background within Stroom.
Among these are jobs that control pipeline processing, removing old files from the file system, checking the status of nodes and volumes etc.
Each task executes at a different time depending on the purpose of the task. There are three ways that a task can be executed:</p>
<ol>
<li>Scheduled jobs execute periodically according to a cron schedule.
These include jobs such as cleaning the file system where Stroom only needs to perform this action once a day and can do so overnight.</li>
<li>Frequency controlled jobs are executed every X seconds, minutes, hours etc.
Most of the jobs that execute with a given frequency are status checking jobs that perform a short lived action fairly frequently.</li>
<li>Distributed jobs are only applicable to stream processing with a pipeline.
Distributed jobs are executed by a worker node as soon as a worker has available threads to execute a jobs and the task distributor has work available.</li>
</ol>
<p>A list of task types and their execution method can be seen by opening <em>Monitoring/Jobs</em> from the main menu.</p>
<blockquote>
<p><strong>TODO</strong>: image</p>
</blockquote>
<p>Expanding each task type allows you to configure how a task behaves on each node:</p>
<blockquote>
<p><strong>TODO</strong>: image</p>
</blockquote>
<h2 id="account-maintenance">Account Maintenance</h2>
<p>This job checks user accounts on the system and de-activates them under the following conditions:</p>
<ul>
<li>An unused account that has been inactive for longer than the age configured by <code>stroom.security.identity.passwordPolicy.neverUsedAccountDeactivationThreshold</code>.</li>
<li>An account that has been inactive for longer than the age configured by <code>stroom.security.identity.passwordPolicy.unusedAccountDeactivationThreshold</code>.</li>
</ul>
<h2 id="attribute-value-data-retention">Attribute Value Data Retention</h2>
<p>Deletes Meta attribute values (additional and less valuable metadata) older than <code>stroom.data.meta.metaValue.deleteAge</code>.</p>
<h2 id="data-delete">Data Delete</h2>
<p>Before data is physically removed from the database and file system it is marked as logically deleted by adding a flag to the metadata record in the database.
Data can be logically deleted by a user from the UI or via a process such as data retention.
Data is deleted logically as it is faster to do than a physical delete (important in the UI), and it also allows for data to be restored (undeleted) from the UI.
This job performs the actual physical deletion of data that has been marked logically deleted for longer than the duration configured with <code>stroom.data.store.deletePurgeAge</code>.
All data files associated with a metadata record are deleted from the file system before the metadata is physically removed from the database.</p>
<h2 id="data-processor">Data Processor</h2>
<p>Processes data by finding data that matches processing filters on each pipeline.
When enabled, each worker node asks the master node for data processing tasks.
The master node creates tasks based on processing filters added to the <code>Processors</code> screen of each pipeline and supplies them to the requesting workers.</p>
<h2 id="feed-based-data-retention">Feed Based Data Retention</h2>
<p>This job uses the retention property of each feed to logically delete data from the associated feed that is older than the retention period.
The recommended way of specifying data retention rules is via the data retention policy feature, but feed based retention still exists for backwards compatibility.
Feed based data retention will be removed in a future release and should be considered deprecated.</p>
<h2 id="file-system-clean-deprecated">File System Clean (deprecated)</h2>
<p>This is the previous incarnation of the <code>Data Delete</code> job.
This job scans the file system looking for files that are no longer associated with metadata in the database or where the metadata is marked as deleted and deletes the files if this is the case.
The process is slow to run as it has to traverse all stored data files and examine each.
However, this version of the data deletion process was created when metadata was deleted immediately, i.e. not marked for future physical deletion, so was the only way to perform this clean up activity at the time.
This job will be removed in a future release. The <code>Data Delete</code> job should be used instead from now on.</p>
<h2 id="file-system-volume-status">File System Volume Status</h2>
<p>Scans your data volumes to ensure they are available and determines how much free space they have.
Records this status in the Volume Status table.</p>
<h2 id="index-searcher-cache-refresh">Index Searcher Cache Refresh</h2>
<p>Refresh references to Lucene index searchers that have been cached for a while.</p>
<h2 id="index-shard-delete">Index Shard Delete</h2>
<p>How frequently index shards that have been logically deleted are physically deleted from the file system.</p>
<h2 id="index-shard-retention">Index Shard Retention</h2>
<p>How frequently index shards that are older then their retention period are logically deleted.</p>
<h2 id="index-volume-status">Index Volume Status</h2>
<p>Scans your index volumes to ensure they are available and determines how much free space they have.
Records this status in the Index Volume Status table.</p>
<h2 id="index-writer-cache-sweep">Index Writer Cache Sweep</h2>
<p>How frequently entries in the Index Shard Writer cache are evicted based on the time-to-live, time-to-idle and cache size settings.</p>
<h2 id="index-writer-flush">Index Writer Flush</h2>
<p>How frequently in-memory changes to the index shards are flushed to the file system and committed to the index.</p>
<h2 id="java-heap-histogram-statistics">Java Heap Histogram Statistics</h2>
<p>How frequently heap histogram statistics will be captured.
This can be useful for diagnosing issues or seeing where memory is being used.
Each run will result in a JVM pause so car should be taken when running this on a production system.</p>
<h2 id="node-status">Node Status</h2>
<p>How frequently we try write stats about node status including JVM and memory usage.</p>
<h2 id="pipeline-destination-roll">Pipeline Destination Roll</h2>
<p>How frequently rolling pipeline destinations, e.g. a Rolling File Appender are checked to see if they need to be rolled.
This frequency should be at least as short as the most frequent rolling frequency.</p>
<h2 id="policy-based-data-retention">Policy Based Data Retention</h2>
<p>Run the policy based data retention rules over the data and logically delete and data that should no longer be retained.</p>
<h2 id="processor-task-queue-statistics">Processor Task Queue Statistics</h2>
<p>How frequently statistics about the state of the stream processing task queue are captured.</p>
<h2 id="processor-task-retention">Processor Task Retention</h2>
<p>How frequently failed and completed tasks are checked to see if they are older than the delete age threshold set by <code>stroom.processor.deleteAge</code>.
Any that are older than this threshold are deleted.</p>
<h2 id="property-cache-reload">Property Cache Reload</h2>
<p>Stroom&rsquo;s configuration properties can each be configured globally in the database.
This job controls the frequency that each node refreshes the values of its properties cache from the global database values.
See also <a href="../../../docs/user-guide/properties/">Properties</a>.</p>
<h2 id="proxy-aggregation">Proxy Aggregation</h2>
<p>If you front Stroom with an Stroom proxy which is configured to &lsquo;store&rsquo; rather than &lsquo;store/forward&rsquo;, then this task when run will pick up all files in the proxy repository dir, aggregate them by feed and bring them into Stroom.
It uses the system property <code>stroom.proxyDir</code>.</p>
<h2 id="query-history-clean">Query History Clean</h2>
<p>How frequently items in the query history are removed from the history if their age is older than <code>stroom.history.daysRetention</code> or if the number of items in the history exceeds <code>stroom.history.itemsRetention</code>.</p>
<h2 id="ref-data-off-heap-store-purge">Ref Data Off-heap Store Purge</h2>
<p>Purges all data older than the purge age defined by property <code>stroom.pipeline.purgeAge</code>.
See also <a href="../../../docs/user-guide/pipelines/reference-data/#purging-old-reference-data">Reference Data</a>.</p>
<h2 id="solr-index-optimise">Solr Index Optimise</h2>
<p>How frequently Solr index segments are explicitly optimised by merging them into one.</p>
<h2 id="solr-index-retention">Solr Index Retention</h2>
<p>How frequently a process is run to delete items from the Solr indexes that don&rsquo;t meet the retention rule of that index.</p>
<h2 id="sql-stats-database-aggregation">SQL Stats Database Aggregation</h2>
<p>This job controls the frequency that the database statistics aggregation process is run.
This process takes the entries in <code>SQL_STAT_VAL_SRC</code> and merges them into the main statistics tables <code>SQL_STAT_KEY</code> and <code>SQL_STAT_KEY</code>.
As this process is reliant on data flushed by the <em>SQL Stats In Memory Flush</em> job it is advisable to schedule it to run after that, leaving some time for the in-memory flush to finish.</p>
<h2 id="sql-stats-in-memory-flush">SQL Stats In Memory Flush</h2>
<p>SQL Statistics are initially held and aggregated in memory.
This job controls the frequency that the in memory statistics are flushed from the in memory buffer to the staging table <code>SQL_STAT_VAL_SRC</code> in the database.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '15.'; page-break-before: always">
    
  <h1 id="pg-62543d26872ef2bc00bbc72ff957471a">15 - Tools</h1>
    <div class="lead">Various additional tools to assist in administering Stroom and accessing its data.</div>
	
</div>




    
      
  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '15.1.'; ">
    
  <h1 id="pg-75d7e9d7b1cee4d8756d17b998f45770">15.1 - Command Line Tools</h1>
    <div class="lead">Command line actions for administering Stroom.</div>
	<blockquote>
<p><strong>Version Information:</strong> Created with Stroom v7.0<br>
<strong>Last Updated:</strong> 10 September 2020</p>
</blockquote>
<p>Stroom has a number of tools that are available from the command line in addition to starting the main application.</p>
<p>The basic structure of the command for starting one of stroom&rsquo;s commands is:</p>
<pre><code class="language-bash">java -jar /absolute/path/to/stroom-app.jar COMMAND
</code></pre>
<p><code>COMMAND</code> can be a number of values depending on what you want to do.
Each command value is described in its own section.</p>
<blockquote>
<p><strong>NOTE:</strong> These commands are very powerful and potentially dangerous in the wrong hands, e.g. they allow the changing of user&rsquo;s passwords.
Access to these commands should be strictly limited.
Also, each command will run in its own JVM so are not really intended to be run when Stroom is running on the node.</p>
</blockquote>
<h2 id="server"><code>server</code></h2>
<pre><code class="language-bash">java -jar /absolute/path/to/stroom-app.jar server path/to/config.yml
</code></pre>
<p>This is the normal command for starting the Stroom application using the supplied YAML configuration file.
The example above will start the application as a foreground process.
Stroom would typically be started using the <code>start.sh</code> shell script, but the command above is listed for completeness.</p>
<p>When stroom starts it will check the database to see if any migration is required.
If migration from an earlier version (including from an empty database) is required then this will happen as part of the application start process.</p>
<h2 id="migrate"><code>migrate</code></h2>
<pre><code class="language-bash">java -jar /absolute/path/to/stroom-app.jar migrate path/to/config.yml
</code></pre>
<p>There may be occasions where you want to migrate an old version but not start the application, e.g. during migration testing or to initiate the migration before starting up a cluster.
This command will run the process that checks for any required migrations and then performs them.
On completion of the process it exits.
This runs as a foreground process.</p>
<h2 id="create_account"><code>create_account</code></h2>
<pre><code class="language-bash">java -jar /absolute/path/to/stroom-app.jar create_account --u USER --p PASSWORD [OPTIONS] path/to/config.yml
</code></pre>
<p>Where the named arguments are:</p>
<ul>
<li><code>-u</code> <code>--user</code> - The username for the user.</li>
<li><code>-p</code> <code>--password</code> - The password for the user.</li>
<li><code>-e</code> <code>--email</code> - The email address of the user.</li>
<li><code>-f</code> <code>--firstName</code> - The first name of the user.</li>
<li><code>-s</code> <code>--lastName</code> - The last name of the user.</li>
<li><code>--noPasswordChange</code> - If set do not require a password change on first login.</li>
<li><code>--neverExpires</code> - If set, the account will never expire.</li>
</ul>
<p>This command will create an account in the internal identity provider within Stroom.
Stroom is able to use third party OpenID identity providers such as Google or AWS Cognito but by default will use its own.
When configured to use its own (the default) it will auto create an admin account when starting up a fresh instance.
There are times when you may wish to create this account manually which this command allows.</p>
<h3 id="authentication-accounts-and-stroom-users">Authentication Accounts and Stroom Users</h3>
<p>The user account used for authentication is distinct to the Stroom <em>user</em> entity that is used for authorisation within Stroom.
If an external IDP is used then the mechanism for creating the authentication account will be specific to that IDP.
If using the default internal Stroom IDP then an account must be created in order to authenticate, either from within the UI if you are already authenticated as a privileged used or using this command.
In either case a Stroom user will need to exist with the same username as the authentication account.</p>
<p>The command will fail if the user already exists.
This command should NOT be run if you are using a third party identity provider.</p>
<p>This command will also run any necessary database migrations to ensure it is working with the correct version of the database schema.</p>
<h2 id="reset_password"><code>reset_password</code></h2>
<pre><code class="language-bash">java -jar /absolute/path/to/stroom-app.jar reset_password --u USER --p PASSWORD path/to/config.yml
</code></pre>
<p>Where the named arguments are:</p>
<ul>
<li><code>-u</code> <code>--user</code> - The username for the user.</li>
<li><code>-p</code> <code>--password</code> - The password for the user.</li>
</ul>
<p>This command is used for changing the password of an existing account in stroom&rsquo;s internal identity provider.
It will also reset all locked/inactive/disabled statuses to ensure the account can be logged into.
This command should NOT be run if you are using a third party identity provider.
It will fail if the account does not exist.</p>
<p>This command will also run any necessary database migrations to ensure it is working with the correct version of the database schema.</p>
<h2 id="manage_users"><code>manage_users</code></h2>
<pre><code class="language-bash">java -jar /absolute/path/to/stroom-app.jar manage_users [OPTIONS] path/to/config.yml
</code></pre>
<p>Where the named arguments are:</p>
<ul>
<li><code>--createUser USER_NAME</code> - Creates a Stroom user with the supplied username.</li>
<li><code>--greateGroup GROUP_NAME</code> - Creates a Stroom user group with the supplied group name.</li>
<li><code>--addToGroup USER_OR_GROUP_NAME TARGET_GROUP</code> - Adds a user/group to an existing group.</li>
<li><code>--removeFromGroup USER_OR_GROUP_NAME TARGET_GROUP</code> - Removes a user/group from an existing group.</li>
<li><code>--grantPermission USER_OR_GROUP_NAME PERMISSION_NAME</code> - Grants the named application permission to the user/group.</li>
<li><code>--revokePermission USER_OR_GROUP_NAME PERMISSION_NAME</code> - Revokes the named application permission from the user/group.</li>
<li><code>--listPermissions</code> - Lists all the valid permission names.</li>
</ul>
<p>This command allows you to manage the account permissions within stroom regardless of whether the internal identity provider or a 3rd party one is used.
A typical use case for this is when using a third party identity provider.
In this instance Stroom has no way of auto creating an admin account when first started so the association between the account on the 3rd party IDP and the stroom user account needs to be made manually.
To set up an admin account to enable you to login to stroom you can do:</p>
<p>This command is not intended for automation of user management tasks on a running Stroom instance that you can authenticate with.
It is only intended for cases where you cannot authenticate with Stroom, i.e. when setting up a new Stroom with a 3rd party IDP or when scripting the creation of a test environment.
If you want to automate actions that can be performed in the UI then you can make use of the REST API that is described at <code>/stroom/noauth/swagger-ui</code>.</p>
<blockquote>
<p>See the <a href="#authentication-accounts-and-stroom-users">note</a> above about the distinction between authentication accounts and stroom users.</p>
</blockquote>
<pre><code class="language-bash">java -jar /absolute/path/to/stroom-app.jar manage_users --createUser jbloggs --createGroup Administrators --addToGroup jbloggs Administrators --grantPermission Administrators &quot;Administrator&quot; path/to/config.yml
</code></pre>
<p>Where <em>jbloggs</em> is the user name of the account on the 3rd party IDP.</p>
<p>This command will also run any necessary database migrations to ensure it is working with the correct version of the database schema.</p>
<p>The named arguments can be used as many times as you like so you can create multiple users/groups/grants/etc.
Regardless of the order of the arguments, the changes are executed in the following order:</p>
<ol>
<li>Create users</li>
<li>Create groups</li>
<li>Add users/groups to a group</li>
<li>Remove users/groups from a group</li>
<li>Grant permissions to users/groups</li>
<li>Revoke permissions from users/groups</li>
</ol>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '15.2.'; page-break-before: always">
    
  <h1 id="pg-aaa793b6817f12a49ae679e8c2c3f5c8">15.2 - Stream Dump Tool</h1>
    <div class="lead">A tool for exporting stream data from Stroom.</div>
	<p>Data within Stroom can be exported to a directory using the <code>StreamDumpTool</code>.
The tool is contained within the core Stroom Java library and can be accessed via the command line, e.g.</p>
<p><code>java -cp &quot;apache-tomcat-7.0.53/lib/*:lib/*:instance/webapps/stroom/WEB-INF/lib/*&quot; stroom.util.StreamDumpTool outputDir=output</code></p>
<p><em>Note the classpath may need to be altered depending on your installation.</em></p>
<p>The above command will export all content from Stroom and output it to a directory called <code>output</code>. Data is exported to zip files in the same format as zip files in proxy repositories. The structure of the exported data is <code>${feed}/${pathId}/${id}</code> by default with a <code>.zip</code> extension.</p>
<p>To provide greater control over what is exported and how the following additional parameters can be used:</p>
<p><code>feed</code> - Specify the name of the feed to export data for (all feeds by default).</p>
<p><code>streamType</code> - The single stream type to export (all stream types by default).</p>
<p><code>createPeriodFrom</code> - Exports data created after this time specified in ISO8601 UTC format, e.g. <code>2001-01-01T00:00:00.000Z</code> (exports from earliest data by default).</p>
<p><code>createPeriodTo</code> - Exports data created before this time specified in ISO8601 UTC format, e.g. <code>2001-01-01T00:00:00.000Z</code> (exports up to latest data by default).</p>
<p><code>outputDir</code> - The output directory to write data to (required).</p>
<p><code>format</code> - The format of the output data directory and file structure (<code>${feed}/${pathId}/${id}</code> by default).</p>
<h2 id="format">Format</h2>
<p>The format parameter can include several replacement variables:</p>
<p><code>feed</code> - The name of the feed for the exported data.</p>
<p><code>streamType</code> - The data type of the exported data, e.g. <code>RAW_EVENTS</code>.</p>
<p><code>streamId</code> - The id of the data being exported.</p>
<p><code>pathId</code> - A incrementing numeric id that creates sub directories when required to ensure no directory ends up containing too many files.</p>
<p><code>id</code> - A incrementing numeric id similar to <code>pathId</code> but without sub directories.</p>

</div>




    
	
  

    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '16.'; page-break-before: always">
    
  <h1 id="pg-d1aae0692f9ecb664825a4638d825273">16 - Volumes</h1>
    <div class="lead">Stroom&rsquo;s logical storage volumes for storing event and index data.</div>
	
<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">TODO</h4>

    Describe volumes

</div>


</div>




    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/gchq/stroom" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Crown Copyright All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    

<script src='../../../js/popper.min.js'></script>
<script src='../../../js/bootstrap.min.js'></script>






<script src='../../../js/tabpane-persist.js'></script>



















<script src="../../../js/main.js"></script>



<script src='../../../js/prism.js'></script>



  </body>
</html>
