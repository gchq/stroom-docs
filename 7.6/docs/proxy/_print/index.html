<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.95.0" />
<link rel="canonical" type="text/html" href="../../../docs/proxy/">
<meta name="robots" content="noindex, nofollow">

<link rel="preload" href="../../../fonts/google_open_sans_300.ttf" as="font" type="font/ttf" crossorigin >
<link rel="preload" href="../../../fonts/google_open_sans_300i.ttf" as="font" type="font/ttf" crossorigin >
<link rel="preload" href="../../../fonts/google_open_sans_400.ttf" as="font" type="font/ttf" crossorigin >
<link rel="preload" href="../../../fonts/google_open_sans_400i.ttf" as="font" type="font/ttf" crossorigin >
<link rel="preload" href="../../../fonts/google_open_sans_700.ttf" as="font" type="font/ttf" crossorigin >
<link rel="preload" href="../../../fonts/google_open_sans_700i.ttf" as="font" type="font/ttf" crossorigin >
<link rel="preload" href="../../../webfonts/fa-brands-400.ttf" as="font" type="font/ttf" crossorigin >
<link rel="preload" href="../../../webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin >


<link rel="preload" href="../../../webfonts/fa-solid-900.ttf" as="font" type="font/ttf" crossorigin >
<link rel="preload" href="../../../webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin >





<link rel="canonical" href="../../../../">


<link rel="shortcut icon" href="../../../favicons/favicon.ico" >
<link rel="apple-touch-icon" href="../../../favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="../../../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../../../favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="../../../favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../../../favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="../../../favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="../../../favicons/android-192x192.png" sizes="192x192">

<title>Stroom Proxy | Stroom</title>
<meta name="description" content="Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can be used to forward to other Stroom Proxy instances.
">
<meta property="og:title" content="Stroom Proxy" />
<meta property="og:description" content="Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can be used to forward to other Stroom Proxy instances.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/proxy/" /><meta property="og:site_name" content="Stroom" />

<meta itemprop="name" content="Stroom Proxy">
<meta itemprop="description" content="Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can be used to forward to other Stroom Proxy instances.
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Stroom Proxy"/>
<meta name="twitter:description" content="Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can be used to forward to other Stroom Proxy instances.
"/>




<link rel="preload" href="../../../scss/main.min.c9c2acb16647e4c0a24660355bfca96b0ec94226f4c0568ac7b0913f56303345.css" as="style">
<link href="../../../scss/main.min.c9c2acb16647e4c0a24660355bfca96b0ec94226f4c0568ac7b0913f56303345.css" rel="stylesheet" integrity="">


<script src='../../../js/jquery-3.6.0.min.js'></script>




<link rel="stylesheet" href="../../../css/prism.css"/>


<link rel="stylesheet" href="../../../css/stroom-ui/icon-colours.min.c7f7492721ac22f5e69eb7c9e66ec2d6dda4fbb93805fdb5f383e323f347838d.css" integrity="sha256-x/dJJyGsIvXmnrfJ5m7C1t2k&#43;7k4Bf2184PjI/NHg40=">

<link rel="stylesheet" href="../../../css/stroom-ui/material_design_colors.min.ab1318fe69a1013ff756090954c02c5364ff48d150dcc94468a73d2e3efd3fc0.css" integrity="sha256-qxMY/mmhAT/3VgkJVMAsU2T/SNFQ3MlEaKc9Lj79P8A=">

<link rel="stylesheet" href="../../../css/stroom-ui/theme-root.min.716a7e38230c67b422f13d3491ef2962fd3952e29d7b0b2944f015b2fd1d1e19.css" integrity="sha256-cWp&#43;OCMMZ7Qi8T00ke8pYv05UuKdewspRPAVsv0dHhk=">

<link rel="stylesheet" href="../../../css/stroom-ui/theme-dark.min.00dc0d0c4c6a008a394dbf66edbaae4e8bd4ce20d0fdeae542ddbe942f90bfe5.css" integrity="sha256-ANwNDExqAIo5Tb9m7bquTovUziDQ/erlQt2&#43;lC&#43;Qv&#43;U=">




  </head>
  <body class="td-section">
    <header>
      <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="../../../"><span class="navbar-brand__logo navbar-logo"><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="110.61089" height="30.000004" viewBox="0 0 88.488641 23.999957" id="svg2" inkscape:version="0.91 r13725" sodipodi:docname="logo.svg"><defs id="defs20"/><sodipodi:namedview pagecolor="#989898" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1920" inkscape:window-height="1137" id="namedview18" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="5.5951814" inkscape:cx="55.451414" inkscape:cy="16.275348" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg2"/><g id="g4150" style="opacity:.97000002" transform="matrix(0.03883584,0,0,0.03883584,0,-3.1155874e-4)"><path id="path6" d="M121.99991 205.98497C54.999958 205.98497.0 259.98493.0 327.98487c0 66.99994 54.999958 121.99989 121.99991 121.99989h167.99987c24.99998.0 44.99996 20.99998 44.99996 44.99996.0 24.99998-19.99998 44.99996-44.99996 44.99996H109.20929C65.984126 553.87219 27.100843 581.57313.01093599 617.98462H289.99978c66.99994.0 121.99991-54.99996 121.99991-122.9999.0-66.99994-54.99997-121.99989-121.99991-121.99989H121.99991c-24.999984.0-44.999969-19.99999-44.999969-44.99996.0-24.99998 19.999985-44.99996 44.999969-44.99996h228.79045c26.9905-35.88325 65.47093-63.18547 108.21554-76.99994H121.99991z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path8" d="M601.44485-.00077860649C572.6583 8.3697982 546.49491 22.822962 524.44491 41.902305V205.78969l.002.19528h-.002c-65.11 48e-5-123.03145 30.0199-160.74675 76.99994h160.74675v334.99971h76.99994V282.98491h144.85298c27.16134-36.05885 65.96411-63.39275 109.02184-76.99994H601.44485v-205.98574860649z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path10" d="m919.42586 205.98497c-113.99519.0-205.99537 92.00648-206.00296 205.99982-15e-5 68.67178.0 137.32749.0 205.99983h77.99994c-.012-68.6493.0176-137.46869.0-205.99983.0846-70.92785 57.05747-128.99988 128.00462-128.99988 5.28623.0 10.49823.32864 15.62183.95311 18.2219-24.51229 41.78461-45.0838 68.42501-60.15146-25.65065-11.43799-54.08662-17.80159-84.04684-17.80159z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path12" d="m1109.4153 205.98457c-113.99994.0-205.99983 91.99993-205.99983 205.99984.0 112.9999 91.99989 205.9998 205.99983 205.9998 114 0 205.9999-92.9999 205.9999-205.9998.0-113.99991-91.9999-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.99994-56.99996-128.99994-127.9999.0-70.99995 58.00004-128.9999 128.99994-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path14" d="m1444.4737 205.98457c-113.9999.0-205.9998 91.99993-205.9998 205.99984.0 112.9999 91.9999 205.9998 205.9998 205.9998s205.9999-92.9999 205.9999-205.9998c0-113.99991-92-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.9999-56.99996-128.9999-127.9999.0-70.99995 58-128.9999 128.9999-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path16" d="m1738.5308 379.98447c0-53 43-97 95.9999-97 53 0 97 44 97 97v237.9997h76.9999v-237.9997c0-53 43-97 96.9999-97 53 0 95.9999 44 95.9999 97v237.9997h77v-237.9997c0-96-77-173.9999-172.9999-173.9999-54.9999.0-103.9999 24.99998-135.9999 64.99995-31.9999-39.99997-79.9999-64.99995-134.9999-64.99995-95.9999.0-173.9998 77.9999-173.9998 173.9999v237.9997h77.9999z" style="fill:#fff" inkscape:connector-curvature="0"/></g></svg></span><span class="navbar-brand__name">Stroom</span></a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="../../../about/about/"><span>About</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link active" href="../../../docs/"><span class="active">Documentation</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="../../../releases/"><span>Releases Notes</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="../../../community/"><span>Community</span></a>
      </li>
      <li class="nav-item dropdown mr-4 d-none d-lg-block">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Stroom Version (7.6)
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	
	
	<a class="dropdown-item" href="../../../../">7.8 (Latest)</a>
	
	<a class="dropdown-item" href="../../../../7.7">7.7</a>
	
	<a class="dropdown-item" href="../../../">7.6</a>
	
	<a class="dropdown-item" href="../../../../7.5">7.5</a>
	
	<a class="dropdown-item" href="../../../../7.4">7.4</a>
	
	<a class="dropdown-item" href="../../../../7.3">7.3</a>
	
	<a class="dropdown-item" href="../../../../7.2">7.2</a>
	
	<a class="dropdown-item" href="../../../../7.1">7.1</a>
	
	<a class="dropdown-item" href="../../../../7.0">7.0</a>
	
	<a class="dropdown-item" href="../../../../legacy">Legacy</a>
	
</div>
</li>
      </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="../../../offline-search-index.3324f550cd4c3c871969f58b5007922e.json"
    data-offline-search-base-href="../../../"
    data-offline-search-max-results="50"
  >
</div>

  </div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="../../../docs/proxy/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Stroom Proxy</h1>
<div class="lead">Stroom Proxy acts as a proxy when sending data to a Stroom instance. Stroom Proxy has various modes such as storing, aggregating and forwarding the received data. Stroom Proxies can be used to forward to other Stroom Proxy instances.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-66e532a8ec8d994c948525cce6b1926c">Stroom Proxy Installation</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '1.'; ">
    
  <h1 id="pg-66e532a8ec8d994c948525cce6b1926c">1 - Stroom Proxy Installation</h1>
    
	<p>There are 2 versions of the stroom software availble for building a proxy server.
There is an <em>app</em> version that runs stroom as a Java ARchive (jar) file locally on the server and has settings contained in a configuration file that controls access to the stroom server and database.
The other version runs stroom proxy within docker containers and also has a settings configuration file that controls access to the stroom server and database.
The document will cover the installation and configuration of the stroom proxy software for both the docker and &lsquo;app&rsquo; versions.</p>
<h2 id="assumptions">Assumptions</h2>
<p>The following assumptions are used in this document.</p>
<ul>
<li>the user has reasonable RHEL/CentOS System administration skills.</li>
<li>installation is on a fully patched minimal CentOS 7 instance.</li>
<li>the Stroom database has been created and resides on the host <code>stroomdb0.strmdev00.org</code> listening on port 3307.</li>
<li>the Stroom database user is <code>stroomuser</code> with a password of <code>Stroompassword1@</code>.</li>
<li>the application user <code>stroomuser</code> has been created.</li>
<li>the user is or has deployed the two node Stroom cluster described <a href="../../../docs/howtos/install/installhowto/#storage-scenario">here</a>.</li>
<li>the user has set up the Stroom processing user as described <a href="../../../docs/howtos/install/installprocessingusersetuphowto/">here</a>.</li>
<li>the prerequisite software has been installed.</li>
<li>when a screen capture is documented, data entry is identified by the data surrounded by &lsquo;&lt;<strong>&rsquo; &lsquo;</strong>&gt;&rsquo; . This excludes enter/return presses.</li>
</ul>
<h2 id="stroom-remote-proxy-docker-version">Stroom Remote Proxy (docker version)</h2>
<p>The build of a stroom proxy where the stroom applications are running in docker containers.
The operating system (OS) build for a &lsquo;dockerised&rsquo; stroom proxy is minimal RHEL/CentOS 7 plus the docker-ce &amp; docker-compose packages.
Neither of the pre-requisites are available from the CentOS ditribution.
It will also be necessary to open additional ports on the system firewall (where appropriate).</p>
<h3 id="download-and-install-docker">Download and install docker</h3>
<p>To download and install - docker-ce - from the internet, a new &lsquo;repo&rsquo; file is downloaded first, that provides access to the docker.com repository.
e.g. as <em>root</em> user:</p>
<ul>
<li>wget <a href="https://download.docker.com/linux/centos/docker-ce.repo">https://download.docker.com/linux/centos/docker-ce.repo</a> -O /etc/yum.repos.d/docker-ce.repo</li>
<li>yum install docker-ce.x86_64</li>
</ul>
<p>The packages - docker-ce docker-ce-cli &amp; containerd.io - will be installed</p>
<p>The docker-compose software can de downloaded from github
e.g. as <em>root</em> user to download docker-compose version 1.25.4 and save it to -  /usr/local/bin/docker-compose</p>
<ul>
<li>curl -L <a href="https://github.com/docker/compose/releases/download/1.25.4/docker-compose-Linux-x86_64">https://github.com/docker/compose/releases/download/1.25.4/docker-compose-Linux-x86_64</a> -o /usr/local/bin/docker-compose</li>
<li>chmod 755 /usr/local/bin/docker-compose</li>
</ul>
<h3 id="firewall-configuration">Firewall Configuration</h3>
<p>If you have a firewall running additional ports will need to be opened, to allow the Docker containers to talk to each other.
Currently these ports are:</p>
<p>80
443<br>
2888<br>
3307<br>
5000<br>
8080<br>
8081<br>
8090<br>
8091<br>
8543</p>
<p>For example on a RHEL/CentOS server using <code>firewalld</code> the commands would be as <em>root</em> user:</p>
<pre><code class="language-bash">firewall-cmd --zone=public --permanent --add-port=80/tcp
firewall-cmd --zone=public --permanent --add-port=443/tcp
firewall-cmd --zone=public --permanent --add-port=2888/tcp
firewall-cmd --zone=public --permanent --add-port=3307/tcp
firewall-cmd --zone=public --permanent --add-port=5000/tcp
firewall-cmd --zone=public --permanent --add-port=8080/tcp
firewall-cmd --zone=public --permanent --add-port=8081/tcp
firewall-cmd --zone=public --permanent --add-port=8090/tcp
firewall-cmd --zone=public --permanent --add-port=8091/tcp
firewall-cmd --zone=public --permanent --add-port=8099/tcp
firewall-cmd --reload
</code></pre>
<h3 id="download-and-install-stroom-v7-docker-version">Download and install Stroom v7 (docker version)</h3>
<p>The installation example below is for stroom version 7.0.beta.45 - but is applicable to other stroom v7 versions.
As a suitable stroom user e.g. stroomuser - download and unpack the stroom software.</p>
<ul>
<li>wget <a href="https://github.com/gchq/stroom-resources/releases/download/stroom-stacks-v7.0-beta.41/stroom_proxy-v7.0-beta.45.tar.gz">https://github.com/gchq/stroom-resources/releases/download/stroom-stacks-v7.0-beta.41/stroom_proxy-v7.0-beta.45.tar.gz</a></li>
<li>tar zxf stroom-stacks…………..</li>
</ul>
<p>For a stroom proxy, the configuration file - stroom_proxy/stroom_proxy-v7.0-beta.45/stroom_proxy.env needs to be edited, with the connection details of the stroom server that data files will be sent to.
The default network port for connection to the stroom server is 8080.</p>
<p>The values that need to be set are:</p>
<pre><code class="language-text">STROOM_PROXY_REMOTE_FEED_STATUS_API_KEY  
STROOM_PROXY_REMOTE_FEED_STATUS_URL  
STROOM_PROXY_REMOTE_FORWARD_URL  
</code></pre>
<p>The &lsquo;API key&rsquo; is generated on the stroom server and is related to a specific user e.g. proxyServiceUser.
The 2 URL values also refer to the stroom server and can be a fully qualified domain name (fqdn) or the IP Address.</p>
<p>e.g. if the stroom server was - stroom-serve.somewhere.co.uk - the URL lines would be:</p>
<pre><code class="language-bash">export STROOM_PROXY_REMOTE_FEED_STATUS_URL=&quot;http://stroom-serve.somewhere.co.uk:8080/api/feedStatus/v1&quot;
export STROOM_PROXY_REMOTE_FORWARD_URL=&quot;http://stroom-serve.somewhere.co.uk:8080/stroom/datafeed&quot;
</code></pre>
<h3 id="to-start-stroom-proxy">To Start Stroom Proxy</h3>
<p>As the stroom user, run the &lsquo;start.sh&rsquo; script found in the stroom install:</p>
<ul>
<li>cd ~/stroom_proxy/stroom_proxy-v7.0-beta.45/</li>
<li>./start.sh</li>
</ul>
<p>The first time the script is ran it will download from github the docker containers for a stroom proxy
these are - stroom-proxy-remote, stroom-log-sender and nginx.
Once the script has completed the stroom proxy server should be running.
There are additional scripts - status.sh - that will show the status of the docker containers (stroom-proxy-remote, stroom-log-sender and nginx)
and - logs.sh - that will tail all of the stroom message files to the screen.</p>
<h2 id="stroom-remote-proxy-app-version">Stroom Remote Proxy (app version)</h2>
<p>The build of a stroom proxy server, where the stroom application is running locally as a Java ARchive (jar) file.
The operating system (OS) build for an &lsquo;application&rsquo; stroom proxy is minimal RHEL/CentOS 7 plus Java.</p>
<p>The Java version required for stroom v7 is 15+.
This version of Java is not available from the RHEL/CentOS distribution.
The version of Java used below is the &lsquo;openJDK&rsquo; version as opposed to Oracle&rsquo;s version.
This can be downloaded from the internet.</p>

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">TODO</h4>

    Needs updating for java 15.

</div>

<p>Version 12.0.1

  






<div class="code-toolbar">
  <pre 
    class="command-line language-bash" 
    data-user="root" 
    data-host="localhost" 
    data-continuation-str="\"
    data-filter-output="(out)"><code class="language-bash">wget https://download.java.net/java/GA/jdk12.0.1/69cfe15208a647278a19ef0990eea691/12/GPL/openjdk-12.0.1_linux-x64_bin.tar.gz</code></pre>
</div>
</p>
<p><em>Or version 14.0.2 <a href="https://download.java.net/java/GA/jdk14.0.2/205943a0976c4ed48cb16f1043c5c647/12/GPL/openjdk-14.0.2_linux-x64_bin.tar.gz">https://download.java.net/java/GA/jdk14.0.2/205943a0976c4ed48cb16f1043c5c647/12/GPL/openjdk-14.0.2_linux-x64_bin.tar.gz</a></em></p>
<p>The gzipped tar file needs to be untarred and moved to a suitable location.</p>

  






<div class="code-toolbar">
  <pre 
    class="command-line language-bash" 
    data-user="root" 
    data-host="localhost" 
    data-continuation-str="\"
    data-filter-output="(out)"><code class="language-bash">tar xvf openjdk-12.0.1_linux-x64_bin.tar.gz
mv jdk-12.0.1 /opt/</code></pre>
</div>

<p>Create a shell script that will define the Java variables	OR add the statements to .bash_profile.
e.g. vi /etc/profile.d/jdk12.sh</p>
<pre><code class="language-bash">export JAVA_HOME=/opt/jdk-12.0.1
export PATH=$PATH:$JAVA_HOME/bin
</code></pre>

  






<div class="code-toolbar">
  <pre 
    class="command-line language-bash" 
    data-user="root" 
    data-host="localhost" 
    data-continuation-str="\"
    data-filter-output="(out)"><code class="language-bash">source /etc/profile.d/jdk12.sh
echo $JAVA_HOME
(out)/opt/jdk-12.0.1

java --version
(out)*openjdk version &#34;12.0.1&#34; 2019-04-16*
(out)*OpenJDK Runtime Environment (build 12.0.1&#43;12)*
(out)*OpenJDK 64-Bit Server VM (build 12.0.1&#43;12, mixed mode, sharing)*</code></pre>
</div>

<p><strong>Disable selinux to avoid issues with access and file permissions.</strong></p>
<h3 id="firewall-configuration-1">Firewall Configuration</h3>
<p>If you have a firewall running additional ports will need to be opened, to allow the Docker containers to talk to each other.
Currently these ports are:</p>
<p>80
443
2888
3307
5000
8080
8081
8090
8091
8543</p>
<p>For example on a RHEL/CentOS server using <code>firewalld</code> the commands would be as <em>root</em> user:</p>

  






<div class="code-toolbar">
  <pre 
    class="command-line language-bash" 
    data-user="root" 
    data-host="localhost" 
    data-continuation-str="\"
    data-filter-output="(out)"><code class="language-bash">firewall-cmd --zone=public --permanent --add-port=80/tcp
firewall-cmd --zone=public --permanent --add-port=443/tcp
firewall-cmd --zone=public --permanent --add-port=2888/tcp
firewall-cmd --zone=public --permanent --add-port=3307/tcp
firewall-cmd --zone=public --permanent --add-port=5000/tcp
firewall-cmd --zone=public --permanent --add-port=8080/tcp
firewall-cmd --zone=public --permanent --add-port=8081/tcp
firewall-cmd --zone=public --permanent --add-port=8090/tcp
firewall-cmd --zone=public --permanent --add-port=8091/tcp
firewall-cmd --zone=public --permanent --add-port=8099/tcp
firewall-cmd --reload</code></pre>
</div>

<h3 id="download-and-install-stroom-v7-app-version">Download and install Stroom v7 (app version)</h3>
<p>The installation example below is for stroom version 7.0.beta.45 - but is applicable to other stroom v7 versions.
As a suitable stroom user e.g. stroomuser - download and unpack the stroom software.</p>

  






<div class="code-toolbar">
  <pre 
    class="command-line language-bash" 
    data-user="stroomuser" 
    data-host="localhost" 
    data-continuation-str="\"
    data-filter-output="(out)"><code class="language-bash">wget https://github.com/gchq/stroom/releases/download/v7.0-beta.45/stroom-proxy-app-v7.0-beta.45.zip
unzip stroom-proxy-app..............</code></pre>
</div>

<p>The configuration file – <code>stroom-proxy/config/config.yml</code> – is the principal file to be edited, as it contains</p>
<ul>
<li>connection details to the stroom server</li>
<li>the locations of the proxy server log files</li>
<li>the directory on the proxy server, where data files will be stored prior to forwarding onot stroom</li>
<li>the location of the PKI Java keystore (jks) files</li>
</ul>
<p>The log file locations are changed to be relative to where stroom is started i.e. <code>~stroomuser/stroom-proxy/logs/…</code>..</p>
<pre><code class="language-yaml">server:
  requestLog:
    appenders:
    - currentLogFilename: logs/access/access.log		
      archivedLogFilenamePattern: logs/access/access-%d{yyyy-MM-dd'T'HH:mm}.log
logging:
  loggers:
    &quot;receive&quot;:
      appenders:
      - currentLogFilename: logs/receive/receive.log
        archivedLogFilenamePattern: logs/receive/receive-%d{yyyy-MM-dd'T'HH:mm}.log
    &quot;send&quot;:
      appenders:
      - currentLogFilename: logs/send/send.log
        archivedLogFilenamePattern: logs/send/send-%d{yyyy-MM-dd'T'HH:mm}.log.gz
  appenders:
      - currentLogFilename: logs/app/app.log
        archivedLogFilenamePattern: logs/app/app-%d{yyyy-MM-dd'T'HH:mm}.log.gz
</code></pre>
<p>An API key created on the stroom server for a special proxy user is added to the configuration file.
The API key is used to validate access to the application</p>
<pre><code class="language-yaml">proxyConfig:
  useDefaultOpenIdCredentials: false
  proxyContentDir: &quot;/stroom-proxy/content&quot;

  feedStatus:
    url: “http://stroomserver.somewhere.co.uk:8080/api/feedStatus/v1&quot;
    apiKey: &quot;eyJhbGciOiJSUz...ScdPX0qai5UwlBA&quot;
  forwardStreamConfig:
    forwardingEnabled: true
</code></pre>
<p>The location of the jks files has to be set, or comment all of the lines that have <strong>sslConfig: and tls:</strong> sections out to not use jks checking.</p>
<p>Stroom also needs the client and ca ‘jks’ files and by default are located in - <code>/stroom-proxy/certs/ca.jks</code> and <code>client.jks</code>.
Their location can be changed in the <code>config.yml</code></p>
<pre><code class="language-yaml">keyStorePath: &quot;/stroom-proxy/certs/client.jks&quot;
trustStorePath: &quot;/stroom-proxy/certs/ca.jks&quot;
keyStorePath: &quot;/stroom-proxy/certs/client.jks&quot;
trustStorePath: &quot;/stroom-proxy/certs/ca.jks&quot;
</code></pre>

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">TODO</h4>

    Change to reflect use of proxy home.

</div>

<p>Could be changed to</p>
<pre><code class="language-yaml">keyStorePath: &quot;/home/stroomuser/stroom-proxy/certs/client.jks&quot;
trustStorePath: &quot;/home/stroomuser/stroom-proxy/certs/ca.jks&quot;
keyStorePath: &quot;/home/stroomuser/stroom-proxy/certs/client.jks&quot;
trustStorePath: &quot;/home/stroomuser/stroom-proxy/certs/ca.jks&quot;
</code></pre>
<p>Create a directory - <code>/stroom-proxy</code> – and ensure that stroom can write to it.
This is where the proxy data files are stored - <code>/stroom-proxy/repo</code></p>
<pre><code class="language-yaml">proxyRepositoryConfig:
  storingEnabled: true
  repoDir: &quot;/stroom-proxy/repo&quot;
  format: &quot;${executionUuid}/${year}-${month}-${day}/${feed}/${pathId}/${id}&quot;
</code></pre>

</div>




    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/gchq/stroom" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2025 Crown Copyright All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    

<script src='../../../js/popper.min.js'></script>
<script src='../../../js/bootstrap.min.js'></script>






    <script src='../../../js/lunr.min.js'></script>
  


<script src='../../../js/tabpane-persist.js'></script>




















<script src="../../../js/main.min.cbc1d428d83561c4dec32da9374290554119d7483329f849251cb7153b2ecd07.js" integrity="sha256-y8HUKNg1YcTewy2pN0KQVUEZ10gzKfhJJRy3FTsuzQc=" crossorigin="anonymous"></script>



<script src='../../../js/prism.js'></script>



  </body>
</html>
