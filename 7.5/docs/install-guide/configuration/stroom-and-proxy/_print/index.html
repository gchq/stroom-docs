<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.95.0" />
<link rel="canonical" type="text/html" href="../../../../../docs/install-guide/configuration/stroom-and-proxy/">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="../../../../../favicons/favicon.ico" >
<link rel="apple-touch-icon" href="../../../../../favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="../../../../../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../../../../../favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../../../favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="../../../../../favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../../../../../favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="../../../../../favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../../../favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="../../../../../favicons/android-192x192.png" sizes="192x192">

<title>Stroom and Stroom-Proxy Configuration | Stroom</title>
<meta name="description" content="How to configure Stroom and Stroom-Proxy.
">
<meta property="og:title" content="Stroom and Stroom-Proxy Configuration" />
<meta property="og:description" content="How to configure Stroom and Stroom-Proxy.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/install-guide/configuration/stroom-and-proxy/" /><meta property="og:site_name" content="Stroom" />

<meta itemprop="name" content="Stroom and Stroom-Proxy Configuration">
<meta itemprop="description" content="How to configure Stroom and Stroom-Proxy.
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Stroom and Stroom-Proxy Configuration"/>
<meta name="twitter:description" content="How to configure Stroom and Stroom-Proxy.
"/>




<link rel="preload" href="../../../../../scss/main.min.3b6e69e7cc89c8276c76586be0d33ea26f06759dc5e79fb60f3d7487f7dc87bd.css" as="style">
<link href="../../../../../scss/main.min.3b6e69e7cc89c8276c76586be0d33ea26f06759dc5e79fb60f3d7487f7dc87bd.css" rel="stylesheet" integrity="">


<script src='../../../../../js/jquery-3.6.0.min.js'></script>


<script src='../../../../../js/lunr.min.js'></script>
  
<link rel="stylesheet" href="../../../../../css/prism.css"/>
<link rel="stylesheet" href="../../../../../css/stroom-ui/icon-colours.css"/>
<link rel="stylesheet" href="../../../../../css/stroom-ui/material_design_colors.css"/>
<link rel="stylesheet" href="../../../../../css/stroom-ui/theme-root.css"/>
<link rel="stylesheet" href="../../../../../css/stroom-ui/theme-dark.css"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-00000000-0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="../../../../../"><span class="navbar-brand__logo navbar-logo"><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="110.61089" height="30.000004" viewBox="0 0 88.488641 23.999957" id="svg2" inkscape:version="0.91 r13725" sodipodi:docname="logo.svg"><defs id="defs20"/><sodipodi:namedview pagecolor="#989898" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1920" inkscape:window-height="1137" id="namedview18" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="5.5951814" inkscape:cx="55.451414" inkscape:cy="16.275348" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg2"/><g id="g4150" style="opacity:.97000002" transform="matrix(0.03883584,0,0,0.03883584,0,-3.1155874e-4)"><path id="path6" d="M121.99991 205.98497C54.999958 205.98497.0 259.98493.0 327.98487c0 66.99994 54.999958 121.99989 121.99991 121.99989h167.99987c24.99998.0 44.99996 20.99998 44.99996 44.99996.0 24.99998-19.99998 44.99996-44.99996 44.99996H109.20929C65.984126 553.87219 27.100843 581.57313.01093599 617.98462H289.99978c66.99994.0 121.99991-54.99996 121.99991-122.9999.0-66.99994-54.99997-121.99989-121.99991-121.99989H121.99991c-24.999984.0-44.999969-19.99999-44.999969-44.99996.0-24.99998 19.999985-44.99996 44.999969-44.99996h228.79045c26.9905-35.88325 65.47093-63.18547 108.21554-76.99994H121.99991z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path8" d="M601.44485-.00077860649C572.6583 8.3697982 546.49491 22.822962 524.44491 41.902305V205.78969l.002.19528h-.002c-65.11 48e-5-123.03145 30.0199-160.74675 76.99994h160.74675v334.99971h76.99994V282.98491h144.85298c27.16134-36.05885 65.96411-63.39275 109.02184-76.99994H601.44485v-205.98574860649z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path10" d="m919.42586 205.98497c-113.99519.0-205.99537 92.00648-206.00296 205.99982-15e-5 68.67178.0 137.32749.0 205.99983h77.99994c-.012-68.6493.0176-137.46869.0-205.99983.0846-70.92785 57.05747-128.99988 128.00462-128.99988 5.28623.0 10.49823.32864 15.62183.95311 18.2219-24.51229 41.78461-45.0838 68.42501-60.15146-25.65065-11.43799-54.08662-17.80159-84.04684-17.80159z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path12" d="m1109.4153 205.98457c-113.99994.0-205.99983 91.99993-205.99983 205.99984.0 112.9999 91.99989 205.9998 205.99983 205.9998 114 0 205.9999-92.9999 205.9999-205.9998.0-113.99991-91.9999-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.99994-56.99996-128.99994-127.9999.0-70.99995 58.00004-128.9999 128.99994-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path14" d="m1444.4737 205.98457c-113.9999.0-205.9998 91.99993-205.9998 205.99984.0 112.9999 91.9999 205.9998 205.9998 205.9998s205.9999-92.9999 205.9999-205.9998c0-113.99991-92-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.9999-56.99996-128.9999-127.9999.0-70.99995 58-128.9999 128.9999-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path16" d="m1738.5308 379.98447c0-53 43-97 95.9999-97 53 0 97 44 97 97v237.9997h76.9999v-237.9997c0-53 43-97 96.9999-97 53 0 95.9999 44 95.9999 97v237.9997h77v-237.9997c0-96-77-173.9999-172.9999-173.9999-54.9999.0-103.9999 24.99998-135.9999 64.99995-31.9999-39.99997-79.9999-64.99995-134.9999-64.99995-95.9999.0-173.9998 77.9999-173.9998 173.9999v237.9997h77.9999z" style="fill:#fff" inkscape:connector-curvature="0"/></g></svg></span><span class="navbar-brand__name">Stroom</span></a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="../../../../../about/about/"><span>About</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link active" href="../../../../../docs/"><span class="active">Documentation</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="../../../../../releases/"><span>Releases Notes</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="../../../../../community/"><span>Community</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="../../../../../news/"><span>News</span></a>
      </li>
      <li class="nav-item dropdown mr-4 d-none d-lg-block">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Stroom Version (7.4)
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	
	
	<a class="dropdown-item" href="../../../../../">7.5 (Latest)</a>
	
	<a class="dropdown-item" href="../../../../../7.4">7.4</a>
	
	<a class="dropdown-item" href="../../../../../7.3">7.3</a>
	
	<a class="dropdown-item" href="../../../../../7.2">7.2</a>
	
	<a class="dropdown-item" href="../../../../../7.1">7.1</a>
	
	<a class="dropdown-item" href="../../../../../7.0">7.0</a>
	
	<a class="dropdown-item" href="../../../../../legacy">Legacy</a>
	
</div>
</li>
      </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="../../../../../offline-search-index.e56c95c8e9f95c7ebbe16e09435c741a.json"
    data-offline-search-base-href="../../../../../"
    data-offline-search-max-results="50"
  >
</div>

  </div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="../../../../../docs/install-guide/configuration/stroom-and-proxy/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Stroom and Stroom-Proxy Configuration</h1>
<div class="lead">How to configure Stroom and Stroom-Proxy.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-ebcaffc40cb3c2f5e1aab92fae38e51d">Common Configuration</a></li>


    
  
    
    
	
<li>2: <a href="#pg-7b2a27b905aa6ec1ca2fc5dd048532fa">Stroom Configuration</a></li>


    
  
    
    
	
<li>3: <a href="#pg-8b79abf8bc6d35d887f9b09047eebed1">Stroom Proxy Configuration</a></li>


    
  

    </ul>


<div class="content">
      <p>The Stroom and Stroom-Proxy applications are built on the same Dropwizard framework so have a lot of similarities when it comes to configuration.</p>
<p>The Stroom/Stroom-Proxy applications are essentially just an executable 







  
  

<span class="external-link">
  <a href="https://en.wikipedia.org/wiki/JAR_%28file_format%29" target="_blank" class="" style="" title="JAR (external link to https://en.wikipedia.org/wiki/JAR_%28file_format%29)">
    <span>JAR</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
 file that can be run when provided with a configuration file, <code>config.yml</code>.
This config file is common to all forms of deployment.</p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '1.'; page-break-before: always">
    
  <h1 id="pg-ebcaffc40cb3c2f5e1aab92fae38e51d">1 - Common Configuration</h1>
    <div class="lead">Configuration common to Stroom and Stroom-Proxy.</div>
	<h2 id="configyml">config.yml</h2>
<p>This YAML file, sometimes known as the Dropwizard configuration file (as it conforms to a structure defined by Dropwizard) is the primary means of configuring Stroom/Stroom-Proxy.
As a minimum this file should be used to configure anything that needs to be set before stroom can start up, e.g. web server, logging, database connection details, etc.
It is also used to configure anything that is specific to a node in a stroom cluster.</p>
<p>If you are using some form of scripted deployment, e.g. ansible then it can be used to set all stroom properties for the environment that stroom runs in.
If you are not using scripted deployments then you can maintain stroom&rsquo;s node agnostic configuration properties via the user interface.</p>
<h3 id="config-file-structure">Config File Structure</h3>
<p>This file contains both the Dropwizard configuration settings (settings for ports, paths and application logging) and the Stroom/Stroom-Proxy application specific properties configuration.
The file is in YAML format and the application properties are located under the <code>appConfig</code> key.
For details of the Dropwizard configuration structure, see 







  
  

<span class="external-link">
  <a href="https://www.dropwizard.io/en/latest/manual/configuration.html" target="_blank" class="" style="" title="here (external link to https://www.dropwizard.io/en/latest/manual/configuration.html)">
    <span>here</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
.</p>
<p>The file is split into sections using these keys:</p>
<ul>
<li><code>server</code> - Configuration of the web server, e.g. ports, paths, request logging.</li>
<li><code>logging</code> - Configuration of application logging</li>
<li><code>jerseyClients</code> - Configuration of the various Jersey HTTP clients in use.
See <a href="#jersey-http-client-configuration">Jersey HTTP Client Configuration</a>.</li>
<li>Application specific configuration:
<ul>
<li><code>appConfig</code> - The Stroom configuration properties.
These properties can be viewed/modified in the user interface.</li>
<li><code>proxyConfig</code> - The Stroom-Proxy configuration properties.
These properties can be viewed/modified in the user interface.</li>
</ul>
</li>
</ul>
<p>The following is an example of the YAML configuration file for Stroom:</p>
<pre><code class="language-yaml"># Dropwizard configuration section
server:
  # e.g. ports and paths
logging:
  # e.g. logging levels/appenders

jerseyClients:
  DEFAULT:
    # Configuration of the named client

# Stroom properties configuration section
appConfig:
  commonDbDetails:
    connection:
      jdbcDriverClassName: ${STROOM_JDBC_DRIVER_CLASS_NAME:-com.mysql.cj.jdbc.Driver}
      jdbcDriverUrl: ${STROOM_JDBC_DRIVER_URL:-jdbc:mysql://localhost:3307/stroom?useUnicode=yes&amp;characterEncoding=UTF-8}
      jdbcDriverUsername: ${STROOM_JDBC_DRIVER_USERNAME:-stroomuser}
      jdbcDriverPassword: ${STROOM_JDBC_DRIVER_PASSWORD:-stroompassword1}
  contentPackImport:
    enabled: true
  ...
</code></pre>
<p>The following is an example of the YAML configuration file for Stroom-Proxy:</p>
<pre><code class="language-yaml"># Dropwizard configuration section
server:
  # e.g. ports and paths
logging:
  # e.g. logging levels/appenders

jerseyClients:
  DEFAULT:
    # Configuration of the named client

# Stroom properties configuration section
proxyConfig:
  path:
    home: /some/path
  ...
</code></pre>
<h4 id="appconfig-section"><code>appConfig</code> Section</h4>
<p>The <code>appConfig</code> section is special as it maps to the Properties seen in the Stroom user interface so values can be managed in the file or via the Properties screen in the Stroom UI.
The other sections of the file can only be managed via the YAML file.
In the Stroom user interface, properties are named with a dot notation key, e.g. <em>stroom.contentPackImport.enabled</em>.
Each part of the dot notation property name represents a key in the YAML file, e.g. for this example, the location in the YAML would be:</p>
<pre><code class="language-yaml">appConfig:
  contentPackImport:
    enabled: true   # stroom.contentPackImport.enabled
</code></pre>
<p>The <em>stroom</em> part of the dot notation name is replaced with <em>appConfig</em>.</p>
<p>For more details on the link between this YAML file and Stroom Properties, see <a href="../../../../../docs/user-guide/properties/">Properties</a></p>
<h4 id="variable-substitution">Variable Substitution</h4>
<p>The YAML configuration file supports Bash style variable substitution in the form of:</p>
<pre><code class="language-bash">${ENV_VAR_NAME:-value_if_not_set}
</code></pre>
<p>This allows values to be set either directly in the file or via an environment variable, e.g.</p>
<pre><code class="language-yaml">      jdbcDriverClassName: ${STROOM_JDBC_DRIVER_CLASS_NAME:-com.mysql.cj.jdbc.Driver}
</code></pre>
<p>In the above example, if the <em>STROOM_JDBC_DRIVER_CLASS_NAME</em> environment variable is not set then the value <em>com.mysql.cj.jdbc.Driver</em> will be used instead.</p>
<h4 id="typed-values">Typed Values</h4>
<p>YAML supports typed values rather than just strings, see <a href="https://yaml.org/refcard.html">https://yaml.org/refcard.html</a>.
YAML understands booleans, strings, integers, floating point numbers, as well as sequences/lists and maps.
Some properties will be represented differently in the user interface to the YAML file.
This is due to how values are stored in the database and how the current user interface works.
This will likely be improved in future versions.
For details of how different types are represented in the YAML and the UI, see <a href="../../../../../docs/user-guide/properties#data-types">Data Types</a>.</p>
<h3 id="server-configuration">Server configuration</h3>
<p>The <code>server</code> section controls the configuration of the Jetty web server.</p>
<p>For full details of how to configure the <code>server</code> section see:</p>
<ul>
<li>







  
  

<span class="external-link">
  <a href="https://www.dropwizard.io/en/latest/manual/configuration.html#servers" target="_blank" class="" style="" title="Server (external link to https://www.dropwizard.io/en/latest/manual/configuration.html#servers)">
    <span>Server</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
</li>
<li>







  
  

<span class="external-link">
  <a href="https://www.dropwizard.io/en/latest/manual/configuration.html#connectors" target="_blank" class="" style="" title="Connectors (external link to https://www.dropwizard.io/en/latest/manual/configuration.html#connectors)">
    <span>Connectors</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
</li>
</ul>
<p>The following is an example of the configuration for an application listening on HTTP.</p>
<pre><code class="language-yaml">server:
  # The base path for the main application
  applicationContextPath: &quot;/&quot;
  # The base path for the admin pages/API
  adminContextPath: &quot;/stroomAdmin&quot;

  # The scheme/port for the main application
  applicationConnectors:
    - type: http
      port: 8080
      # Uses X-Forwarded-*** headers in request log instead of proxy server details.
      useForwardedHeaders: true
  # The scheme/port for the admin pages/API
  adminConnectors:
    - type: http
      port: 8081
      useForwardedHeaders: true
</code></pre>
<h3 id="jersey-http-client-configuration">Jersey HTTP Client Configuration</h3>
<p>Stroom and Stroom Proxy use the 







  
  

<span class="external-link">
  <a href="https://eclipse-ee4j.github.io/jersey/" target="_blank" class="" style="" title="Jersey (external link to https://eclipse-ee4j.github.io/jersey/)">
    <span>Jersey</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
 client for making HTTP connections with other nodes or other systems (e.g. Open ID Connect identity providers).
In the YAML file, the <code>jerseyClients</code> key controls the configuration of the various clients in use.</p>
<p>To allow complete control of the client configuration, Stroom uses the concept of named client configurations.
Each named client will be unique to a destination (where a destination is typically a server or a cluster of functionally identical servers).
Thus the configuration of the connections to each of those destinations can be configured independently.</p>
<p>The client names are as follows:</p>
<ul>
<li><code>AWS_PUBLIC_KEYS</code> - Connections to fetch AWS public keys used in Open ID Connect authentication.</li>
<li><code>CONTENT_SYNC</code> - Connections to downstream proxy/stroom instances to sync content. (<strong>Stroom Proxy only</strong>).</li>
<li><code>DEFAULT</code> - The default client configuration used if a named configuration is not present.</li>
<li><code>FEED_STATUS</code> - Connections to downstream proxy/stroom instances to check feed status. (<strong>Stroom Proxy only</strong>).</li>
<li><code>OPEN_ID</code> - Connections to an Open ID Connect identity provider, e.g. Cognito, Azure AD, KeyCloak, etc.</li>
<li><code>STROOM</code> - Inter-node communications within the Stroom cluster (<strong>Stroom only</strong>).</li>
</ul>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>


    If a named configuration does not exist then the configuration for <code>DEFAULT</code> will be used.
If <code>DEFAULT</code> is not defined in the configuration then the Dropwizard defaults will be used.

</div>


<p>The following is an example of how the clients are configured in the YAML file:</p>
<pre><code class="language-yaml">jerseyClients:
  DEFAULT:
    # Default client configuration, e.g.
    timeout: 500ms
  STROOM:
    # Configuration items for stroom inter-node communications
    timeout: 30s
  # etc.
</code></pre>
<p>The configuration keys (along with their default values and descriptions) for each client can be found here:</p>
<ul>
<li>







  
  

<span class="external-link">
  <a href="https://www.dropwizard.io/en/latest/manual/configuration.html#jerseyclient" target="_blank" class="" style="" title="Jersey Client (external link to https://www.dropwizard.io/en/latest/manual/configuration.html#jerseyclient)">
    <span>Jersey Client</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
</li>
<li>







  
  

<span class="external-link">
  <a href="https://www.dropwizard.io/en/latest/manual/configuration.html#httpclient" target="_blank" class="" style="" title="Base HTTP Client (external link to https://www.dropwizard.io/en/latest/manual/configuration.html#httpclient)">
    <span>Base HTTP Client</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
</li>
<li>







  
  

<span class="external-link">
  <a href="https://www.dropwizard.io/en/latest/manual/configuration.html#proxy" target="_blank" class="" style="" title="Proxy server settings (external link to https://www.dropwizard.io/en/latest/manual/configuration.html#proxy)">
    <span>Proxy server settings</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
</li>
<li>







  
  

<span class="external-link">
  <a href="https://www.dropwizard.io/en/latest/manual/configuration.html#tls" target="_blank" class="" style="" title="TLS settings (external link to https://www.dropwizard.io/en/latest/manual/configuration.html#tls)">
    <span>TLS settings</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
</li>
</ul>
<p>The following is another example including most keys:</p>
<pre><code class="language-yaml">jerseyClients:
  DEFAULT:
    minThreads: 1
    maxThreads: 128
    workQueueSize: 8
    gzipEnabled: true
    gzipEnabledForRequests: true
    chunkedEncodingEnabled: true
    timeout: 500ms
    connectionTimeout: 500ms
    timeToLive: 1h
    cookiesEnabled: false
    maxConnections: 1024
    maxConnectionsPerRoute: 1024
    keepAlive: 0ms
    retries: 0
    userAgent: &lt;application name&gt; (&lt;client name&gt;)
    proxy:
      host: 192.168.52.11
      port: 8080
      scheme : http
      auth:
        username: secret
        password: stuff
        authScheme: NTLM
        realm: realm
        hostname: host
        domain: WINDOWSDOMAIN
        credentialType: NT
      nonProxyHosts:
        - localhost
        - '192.168.52.*'
        - '*.example.com'
    tls:
      protocol: TLSv1.2
      provider: SunJSSE
      verifyHostname: true
      keyStorePath: /path/to/file
      keyStorePassword: changeit
      keyStoreType: JKS
      trustStorePath: /path/to/file
      trustStorePassword: changeit
      trustStoreType: JKS
      trustSelfSignedCertificates: false
      supportedProtocols: TLSv1.1,TLSv1.2
      supportedCipherSuites: TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256
      certAlias: alias-of-specific-cert
</code></pre>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>



    <p>Duration values in the Jersey client configuration blocks are different to <a href="#stroom-duration-data-type">Stroom Durations</a> defined in Stroom properties.
They are defined as a numeric value and a unit suffix.
Typical suffixes are (in ascending order): <code>ns</code>, <code>us</code>, <code>ms</code>, <code>s</code>, <code>m</code>, <code>h</code>, <code>d</code>.
ISO 8601 duration strings are NOT supported, nor are values without a suffix.</p>
<span class="external-link">
  <a href="https://github.com/dropwizard/dropwizard/blob/master/dropwizard-util/src/main/java/io/dropwizard/util/Duration.java" target="_blank" class="" style="" title="Full list of duration suffixes and their aliases (external link to https://github.com/dropwizard/dropwizard/blob/master/dropwizard-util/src/main/java/io/dropwizard/util/Duration.java)">
    <span>Full list of duration suffixes and their aliases</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>


</div>



<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>


    The paths used for the key and trust stores will be treated in the same way as Stroom property paths, i.e relative to <code>stroom.home</code> if relative and supporting variable substitution.

</div>


<h3 id="logging-configuration">Logging Configuration</h3>
<p>The Dropwizard configuration file controls all the logging by the application.
In addition to the main application log, there are additional logs such as stroom user events (for audit), Stroom-Proxy send and receive logs and database migration logs.</p>
<p>For full details of the logging configuration, see 







  
  

<span class="external-link">
  <a href="https://www.dropwizard.io/en/latest/manual/configuration.html#logging" target="_blank" class="" style="" title="Dropwizard Logging Configuration (external link to https://www.dropwizard.io/en/latest/manual/configuration.html#logging)">
    <span>Dropwizard Logging Configuration</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
</p>
<h4 id="request-log">Request Log</h4>
<p>The request log is slightly different to the other logs.
It logs all requests to the web server.
It is configured in the <code>server</code> section.</p>
<p>The property <code>archivedLogFilenamePattern</code> controls rolling of the active log file.
The date pattern in the filename controls the frequency that the log files are rolled.
In this example, files will be rolled every 1 minute.</p>
<pre><code class="language-yaml">server:
  requestLog:
    appenders:
    - type: file
      currentLogFilename: logs/access/access.log
      discardingThreshold: 0
      # Rolled and gzipped every minute
      archivedLogFilenamePattern: logs/access/access-%d{yyyy-MM-dd'T'HH:mm}.log.gz
      archivedFileCount: 10080
      logFormat: '%h %l &quot;%u&quot; [%t] &quot;%r&quot; %s %b &quot;%i{Referer}&quot; &quot;%i{User-Agent}&quot; %D'
</code></pre>
<h4 id="logback-logs">Logback Logs</h4>
<p>Dropwizard uses 







  
  

<span class="external-link">
  <a href="https://logback.qos.ch" target="_blank" class="" style="" title="Logback (external link to https://logback.qos.ch)">
    <span>Logback</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
 for application level logging.
All logs in Stroom and Stroom-Proxy apart from the request log are Logback based logs.</p>
<p>Logback uses the concept of <em>Loggers</em> and <em>Appenders</em>.
A <em>Logger</em> is a named thing that that produces log messages.
An _Appender is an output that a <em>Logger</em> can append its log messages to.
Typical <em>Appenders</em> are:</p>
<ul>
<li>File - appends messages to a file that may or may not be rolled.</li>
<li>Console - appends messages to <code>stdout</code>.</li>
<li>Syslog - appends messages to <code>syslog</code>.</li>
</ul>
<h5 id="loggers">Loggers</h5>
<p>A <em>Logger</em> can append to more than one <em>Appender</em> if required.
For example, the default configuration file for Stroom has two appenders for the application logs.
The rolled files from one appender are POSTed to Stroom to index its own logs, then deleted and the other is intended to
remain on the server until archived off to allow viewing by an administrator.</p>
<p>A <em>Logger</em> can be configured with a severity, valid severities are (<code>TRACE</code>, <code>DEBUG</code>, <code>WARN</code>, <code>ERROR</code>).
The severity set on a logger means that only messages with that severity or higher will be logged, with the rest not logged.</p>
<p><em>Logger</em> names are typically the name of the Java class that is producing the log message.
You don&rsquo;t need to understand too much about Java classes as you are only likely to change logger severities when requested by one of the developers.
Some loggers, such as <code>event-logger</code> do not have a Java class name.</p>
<p>As an example this is a portion of a Stroom config.yml file to illustrate the different loggers/appenders:</p>
<pre><code class="language-yaml">logging:
  # This is root logging severity level for all loggers. Only messages &gt;= to WARN will be logged unless overridden
  # for a specific logger
  level: WARN

  # All the named loggers
  loggers:
    # Logs useful information about stroom. Only set DEBUG on specific 'stroom' classes or packages
    # due to the large volume of logs that would be produced for all of 'stroom' in DEBUG.
    stroom: INFO
    # Logs useful information about dropwizard when booting stroom
    io.dropwizard: INFO
    # Logs useful information about the jetty server when booting stroom
    org.eclipse.jetty: INFO
    # Logs REST request/responses with headers/payloads. Set this to OFF to turn disable that logging.
    org.glassfish.jersey.logging.LoggingFeature: INFO
    # Logs summary information about FlyWay database migrations
    org.flywaydb: INFO
    # Logger and custom appender for audit logs
    event-logger:
      level: INFO
      # Prevents messages from this logger from being sent to other appenders
      additive: false
      appenders:
        - type: file
          currentLogFilename: logs/user/user.log
          discardingThreshold: 0
          # Rolled every minute
          archivedLogFilenamePattern: logs/user/user-%d{yyyy-MM-dd'T'HH:mm}.log
          # Minute rolled logs older than a week will be deleted. Note rolled logs are deleted
          # based on the age of the window they contain, not the number of them. This value should be greater
          # than the maximum time stroom is not producing events for.
          archivedFileCount: 10080
          logFormat: &quot;%msg%n&quot;
    # Logger and custom appender for the flyway DB migration SQL output
    org.flywaydb.core.internal.sqlscript:
      level: DEBUG
      additive: false
      appenders:
        - type: file
          currentLogFilename: logs/migration/migration.log
          discardingThreshold: 0
          # Rolled every day
          archivedLogFilenamePattern: logs/migration/migration-%d{yyyy-MM-dd}.log
          archivedFileCount: 10
          logFormat: &quot;%-6level [%d{\&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\&quot;,UTC}] [%t] %logger - %X{code} %msg %n&quot;
</code></pre>
<h5 id="appenders">Appenders</h5>
<p>The following is an example of the default appenders that will be used for all loggers unless they have their own custom appender configured.</p>
<pre><code class="language-yaml">logging:
  # Appenders for all loggers except for where a logger has a custom appender configured
  appenders:

    # stdout
  - type: console
    # Multi-coloured log format for console output
    logFormat: &quot;%highlight(%-6level) [%d{\&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\&quot;,UTC}] [%green(%t)] %cyan(%logger) - %X{code} %msg %n&quot;
    timeZone: UTC
#
    # Minute rolled files for stroom/datafeed, will be curl'd/deleted by stroom-log-sender
  - type: file
    currentLogFilename: logs/app/app.log
    discardingThreshold: 0
    # Rolled and gzipped every minute
    archivedLogFilenamePattern: logs/app/app-%d{yyyy-MM-dd'T'HH:mm}.log.gz
    # One week using minute files
    archivedFileCount: 10080
    logFormat: &quot;%-6level [%d{\&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\&quot;,UTC}] [%t] %logger - %X{code} %msg %n&quot;
</code></pre>
<h5 id="log-rolling">Log Rolling</h5>
<p>Rolling of log files can be done based on size of file or time.
The <code>archivedLogFilenamePattern</code> property controls the rolling behaviour.
The rolling policy is determined from the filename pattern, e.g a pattern with a minute precision date format will be rolled every minute.
The following is an example of an appender that rolls based on the size of the log file:</p>
<pre><code class="language-yaml">  - type: file
    currentLogFilename: logs/app.log
    # The name pattern, where i a sequential number indicating age, where 1 is the most recent
    archivedLogFilenamePattern: logs/app-%i.log
    # The maximum number of rolled files to keep
    archivedFileCount: 10
    # The maximum size of a log file
    maxFileSize: &quot;100MB&quot;
    logFormat: &quot;%-6level [%d{\&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\&quot;,UTC}] [%t] %logger - %X{code} %msg %n&quot;

</code></pre>
<p>The following is an example of an appender that rolls every minute to gzipped files:</p>
<pre><code class="language-yaml">  - type: file
    currentLogFilename: logs/app/app.log
    # Rolled and gzipped every minute
    archivedLogFilenamePattern: logs/app/app-%d{yyyy-MM-dd'T'HH:mm}.log.gz
    # One week using minute files
    archivedFileCount: 10080
    logFormat: &quot;%-6level [%d{\&quot;yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\&quot;,UTC}] [%t] %logger - %X{code} %msg %n&quot;
</code></pre>

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    <p>Log file rolling is event based, so a file will only roll when a new message arrives that would require a roll to happen.
This means that if the application is idle for a long period with no log output then the un-rolled file will remain active until a new message arrives to trigger it to roll. For example, if Stroom is unused overnight, then the last log message from the night before will not be rolled until a new messages arrive in the morning.</p>
<p>For this reason, <code>archivedFileCount</code> should be set to a value that is greater than the maximum time the application may be idle, else rolled log files may be deleted as soon as they are rolled.</p>


</div>



</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '2.'; page-break-before: always">
    
  <h1 id="pg-7b2a27b905aa6ec1ca2fc5dd048532fa">2 - Stroom Configuration</h1>
    <div class="lead">Describes how the Stroom application is configured.</div>
	
<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">See Also</h4>


    <p><a href="../../../../../docs/install-guide/configuration/stroom-and-proxy/common-configuration/">Stroom and Stroom-Proxy Common Configuration</a><br>
<a href="../../../../../docs/user-guide/properties/">Stroom Properties</a></p>


</div>


<h2 id="general-configuration">General configuration</h2>
<p>The Stroom application is essentially just an executable 







  
  

<span class="external-link">
  <a href="https://en.wikipedia.org/wiki/JAR_%28file_format%29" target="_blank" class="" style="" title="JAR (external link to https://en.wikipedia.org/wiki/JAR_%28file_format%29)">
    <span>JAR</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
 file that can be run when provided with a configuration file, <code>config.yml</code>.
This config file is common to all forms of deployment.</p>
<h3 id="configyml">config.yml</h3>
<p>Stroom operates on a configuration by exception basis so all configuration properties will have a sensible default value and a property only needs to be explicitly configured if the default value is not appropriate, e.g. for tuning a large scale production deployment or where values are environment specific.
As a result <code>config.yml</code> only contains a minimal set of properties.
The full tree of properties can be seen in <code>./config/config-defaults.yml</code> and a schema for the configuration tree (along with descriptions for each property) can be found in <code>./config/config-schema.yml</code>.
These two files can be used as a reference when configuring stroom.</p>
<h4 id="key-configuration-properties">Key Configuration Properties</h4>
<p>The following are key properties that would typically be changed for a production deployment.
All configuration branches are relative to the <code>appConfig</code> root.</p>
<p>The database name(s), hostname(s), port(s), usernames(s) and password(s) should be configured using these properties.
Typically stroom is configured to keep it statistics data in a separate database to the main stroom database, as is configured below.</p>
<pre><code class="language-yaml">  commonDbDetails:
    connection:
      jdbcDriverUrl: &quot;jdbc:mysql://localhost:3307/stroom?useUnicode=yes&amp;characterEncoding=UTF-8&quot;
      jdbcDriverUsername: &quot;stroomuser&quot;
      jdbcDriverPassword: &quot;stroompassword1&quot;
  statistics:
    sql:
      db:
        connection:
          jdbcDriverUrl: &quot;jdbc:mysql://localhost:3307/stats?useUnicode=yes&amp;characterEncoding=UTF-8&quot;
          jdbcDriverUsername: &quot;statsuser&quot;
          jdbcDriverPassword: &quot;stroompassword1&quot;
</code></pre>
<p>In a clustered deployment each node must be given a node name that is unique within the cluster.
This is used to identify nodes in the Nodes screen.
It could be the hostname of the node or follow some other naming convetion.</p>
<pre><code class="language-yaml">  node:
    name: &quot;node1a&quot;
</code></pre>
<p>Each node should have its identity on the network configured so that it uses the appropriate FQDNs.
The <code>nodeUri</code> hostname is the FQDN of each node and used by nodes to communicate with each other, therefore it can be private to the cluster of nodes.
The <code>publicUri</code> hostname is the public facing FQDN for stroom, i.e. the address of a load balancer or Nginx.
This is the address that users will use in their browser.</p>
<pre><code class="language-yaml">  nodeUri:
    hostname: &quot;localhost&quot; # e.g. node5.stroomnodes.somedomain
  publicUri:
    hostname: &quot;localhost&quot; # e.g. stroom.somedomain
</code></pre>
<h2 id="deploying-without-docker">Deploying without Docker</h2>
<p>Stroom running without docker has two files to configure it.
The following locations are relative to the stroom home directory, i.e. the root of the distribution zip.</p>
<ul>
<li><code>./config/config.yml</code> - Stroom configuration YAML file</li>
<li><code>./config/scripts.env</code> - Stroom scripts configuration env file</li>
</ul>
<p>The distribution also includes these files which are helpful when it comes to configuring stroom.</p>
<ul>
<li><code>./config/config-defaults.yml</code> - Full version of the config.yml file containing all branches/leaves with default values set.
Useful as a reference for the structure and the default values.</li>
<li><code>./config/config-schema.yml</code> - The schema defining the structure of the <code>config.yml</code> file.</li>
</ul>
<h3 id="scriptsenv">scripts.env</h3>
<p>This file is used by the various shell scripts like <code>start.sh</code>, <code>stop.sh</code>, etc.
This file should not need to be unless you want to change the locations where certain log files are written to or need to change the java memory settings.</p>
<p>In a production system it is highly likely that you will need to increase the java heap size as the default is only 2G.
The heap size settings and any other java command line options can be set by changing:</p>
<pre><code class="language-sh">JAVA_OPTS=&quot;-Xms512m -Xmx2048m&quot;
</code></pre>
<h2 id="as-part-of-a-docker-stack">As part of a docker stack</h2>
<p>When stroom is run as part of one of our docker stacks, e.g. <em>stroom_core</em> there are some additional layers of configuration to take into account, but the configuration is still primarily done using the <code>config.yml</code> file.</p>
<p>Stroom&rsquo;s <code>config.yml</code> file is found in the stack in <code>./volumes/stroom/config/</code> and this is the primary means of configuring Stroom.</p>
<p>The stack also ships with a default <code>config.yml</code> file baked into the docker image.
This minimal fallback file (located in <code>/stroom/config-fallback/</code> inside the container) will be used in the absence of one provided in the docker stack configuration (<code>./volumes/stroom/config/</code>).</p>
<p>The default <code>config.yml</code> file uses <a href="../../../../../docs/install-guide/configuration/stroom-and-proxy/#environment-variables">environment variable substitution</a> so some configuration items will be set by environment variables set into the container by the stack <em>env</em> file and the docker-compose YAML.
This approach is useful for configuration values that need to be used by multiple containers, e.g. the public FQDN of Nginx, so it can be configured in one place.</p>
<p>If you need to further customise the stroom configuration then it is recommended to edit the <code>./volumes/stroom/config/config.yml</code> file.
This can either be a simple file with hard coded values or one that uses environment variables for some of its
configuration items.</p>
<p>The configuration works as follows:</p>
<pre><code class="language-text">env file (stroom&lt;stack name&gt;.env)
                |
                |
                | environment variable substitution
                |
                v
docker compose YAML (01_stroom.yml)
                |
                |
                | environment variable substitution
                |
                v
Stroom configuration file (config.yml)
</code></pre>
<h3 id="ansible">Ansible</h3>
<p>If you are using Ansible to deploy a stack then it is recommended that all of stroom&rsquo;s configuration properties are set directly in the <code>config.yml</code> file using a templated version of the file and to NOT use any environment variable substitution.
When using Ansible, the Ansible inventory is the single source of truth for your configuration so not using environment variable substitution for stroom simplifies the configuration and makes it clearer when looking at deployed configuration files.</p>
<p><a href="https://github.com/gchq/stroom-ansible">Stroom-ansible</a> has an example inventory for a single node stroom stack deployment.
The <a href="https://github.com/gchq/stroom-ansible/blob/master/config/single_node_stroom_core_stack/example_inventory/group_vars/all">group_vars/all</a> file shows how values can be set into the <em>env</em> file.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.'; page-break-before: always">
    
  <h1 id="pg-8b79abf8bc6d35d887f9b09047eebed1">3 - Stroom Proxy Configuration</h1>
    <div class="lead">Describes how the Stroom-Proxy application is configured.</div>
	
<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">See Also</h4>


    <p><a href="../../../../../docs/install-guide/configuration/stroom-and-proxy/common-configuration/">Stroom and Stroom-Proxy Common Configuration</a><br>
<a href="../../../../../docs/user-guide/properties/">Stroom Properties</a></p>


</div>


<p>The configuration of Stroom-proxy is very much the same as for Stroom with the only difference being the structure of the application specific part of the <code>config.yml</code> file.
Stroom-proxy has a <code>proxyConfig</code> key in the YAML while Stroom has <code>appConfig</code>.</p>
<h2 id="general-configuration">General configuration</h2>
<p>The Stroom-proxy application is essentially just an executable 







  
  

<span class="external-link">
  <a href="https://en.wikipedia.org/wiki/JAR_%28file_format%29" target="_blank" class="" style="" title="JAR (external link to https://en.wikipedia.org/wiki/JAR_%28file_format%29)">
    <span>JAR</span>
    <i class="external-link-icon fas fa-external-link-alt fa-sm text-secondary"></i>
  </a>
</span>
 file that can be run when provided with a configuration file, <code>config.yml</code>.
This configuration file is common to all forms of deployment.</p>
<h3 id="configyml">config.yml</h3>
<p>Stroom-proxy does not have a user interface so the <code>config.yml</code> file is the only way of configuring stroom-proxy.
As with stroom, the <code>config.yml</code> file is split into three sections using these keys:</p>
<ul>
<li><code>server</code> - Configuration of the web server, e.g. ports, paths, request logging.</li>
<li><code>logging</code> - Configuration of application logging</li>
<li><code>proxyConfig</code> - Stroom-Proxy specific configuration</li>
</ul>
<p>See also <a href="../../../../../docs/user-guide/properties/">Properties</a> for more details on structure of the config.yml file and supported data types.</p>
<p>Stroom-Proxy operates on a configuration by exception basis so all configuration properties will have a sensible default value and a property only needs to be explicitly configured if the default value is not appropriate, e.g. for tuning a large scale production deployment or where values are environment specific.
As a result <code>config.yml</code> only contains a minimal set of properties.
The full tree of properties can be seen in <code>./config/config-defaults.yml</code> and a schema for the configuration tree (along with descriptions for each property) can be found in <code>./config/config-schema.yml</code>.
These two files can be used as a reference when configuring stroom.</p>
<h4 id="key-configuration-properties">Key Configuration Properties</h4>
<p>Stroom-proxy has two main functions, storing and forwarding.
It can be configured to do either or both of these functions.
These functions are enabled/disabled using:</p>
<pre><code class="language-yaml">proxyConfig:

  # The list of named destinations that Stroom-Proxy will forward to
  forwardHttpDestinations:
    - enabled: true
      name: &quot;downstream&quot;
      forwardUrl: &quot;https://some-host/stroom/datafeed&quot;

  # Whether to store received data in a repository
  repository:
    storingEnabled: true

  # If we are storing data in a proxy repository we can aggregate it before forwarding.
  aggregator:
    maxItemsPerAggregate: 1000
    maxUncompressedByteSize: &quot;1G&quot;
    maxAggregateAge: 10m
    aggregationFrequency: 1m
</code></pre>
<p>Stroom-proxy should be configured to check the receipt status of feeds on receipt of data.
This is done by configuring the end point of a downstream stroom-proxy or stroom.</p>
<pre><code class="language-yaml">  feedStatus:
    url: &quot;http://stroom:8080/api/feedStatus/v1&quot;
    apiKey: &quot;&quot;
</code></pre>
<p>The <code>url</code> should be the url for the feed status API on the downstream stroom(-proxy).
If this is on the same host then you can use the http endpoint, however if it is on a remote host then you should use https and the host of its nginx, e.g. <code>https://downstream-instance/api/feedStatus/v1</code>.</p>
<p>In order to use the API, the proxy must have a configured <code>apiKey</code>.
The API key must be created in the downstream stroom instance and then copied into this configuration.</p>
<p>If the proxy is configured to forward data then the forward destination(s) should be set.
This is the <code>datafeed</code> endpoint of the downstream stroom-proxy or stroom instance that data will be forwarded to.
This may also be te address of a load balancer or similar that is fronting a cluster of stroom-proxy or stroom instances.
See also <a href="#feed-status-certificate-configuration">Feed status certificate configuration</a>.</p>
<pre><code class="language-yaml">  forwardHttpDestinations:
    - enabled: true
      name: &quot;downstream&quot;
      forwardUrl: &quot;https://some-host/stroom/datafeed&quot;
</code></pre>
<p><code>forwardUrl</code> specifies the URL of the <em>datafeed</em> endpoint on the destination host.
Each forward location can use a different key/trust store pair.
See also <a href="#forwarding-certificate-configuration">Forwarding certificate configuration</a>.</p>
<p>If the proxy is configured to store then it is the location of the proxy repository may need to be configured if it needs to be in a different location to the proxy home directory, e.g. on another mount point.</p>
<h2 id="deploying-without-docker">Deploying without Docker</h2>
<p>Apart from the structure of the <code>config.yml</code> file, the configuration in a non-docker environment is the same as for <a href="../../../../../docs/install-guide/configuration/stroom-and-proxy/configuring-stroom-proxy/#deploying-without-docker">stroom</a></p>
<h2 id="as-part-of-a-docker-stack">As part of a docker stack</h2>
<p>The way stroom-proxy is configured is essentially the same as for <a href="../../../../../docs/install-guide/configuration/stroom-and-proxy/configuring-stroom-proxy/#as-part-of-a-docker-stack">stroom</a> with the only real difference being the structure of the <code>config.yml</code> file as note <a href="#configyml">above</a> .
As with stroom the docker stack comes with a <code>./volumes/stroom-proxy-*/config/config.yml</code> file that will be used in the absence of a provided one.
Also as with stroom, the <code>config.yml</code> file supports environment variable substitution so can make use of environment variables set in the stack env file and passed down via the docker-compose YAML files.</p>
<h3 id="certificates">Certificates</h3>
<p>Stroom-proxy makes use of client certificates for two purposes:</p>
<ul>
<li>Communicating with a downstream stroom/stroom-proxy in order to establish the receipt status for the feeds it has received data for.</li>
<li>When forwarding data to a downstream stroom/stroom-proxy</li>
</ul>
<p>The stack comes with the following files that can be used for demo/test purposes.</p>
<pre><code class="language-text">volumes/stroom-proxy-*/certs/ca.jks
volumes/stroom-proxy-*/certs/client.jks
</code></pre>
<p>For a production deployment these will need to be changed, see <a href="../../../../../docs/install-guide/configuration/stroom-and-proxy/#certificates">Certificates</a></p>
<h4 id="feed-status-certificate-configuration">Feed status certificate configuration</h4>
<p>The configuration of the client certificates for feed status checks is done using the <code>FEED_STATUS</code> jersey client configuration.
See <a href="../../../../../docs/install-guide/configuration/stroom-and-proxy/common-configuration/#jersey-http-client-configuration">Stroom and Stroom-Proxy Common Configuration</a>.</p>
<h4 id="forwarding-certificate-configuration">Forwarding certificate configuration</h4>
<p>Stroom-proxy can forward to multiple locations.
The configuration of the certificate(s) for the forwarding locations is as follows:</p>
<pre><code class="language-yaml">proxyConfig:

  forwardHttpDestinations:
    - enabled: true
      name: &quot;downstream&quot;
      forwardUrl: &quot;https://some-host/stroom/datafeed&quot;
      sslConfig:
        keyStorePath: &quot;/stroom-proxy/certs/client.jks&quot;
        keyStorePassword: &quot;password&quot;
        keyStoreType: &quot;JKS&quot;
        trustStorePath: &quot;/stroom-proxy/certs/ca.jks&quot;
        trustStorePassword: &quot;password&quot;
        trustStoreType: &quot;JKS&quot;
        hostnameVerificationEnabled: true
</code></pre>
<p><code>forwardUrl</code> specifies the URL of the <em>datafeed</em> endpoint on the destination host.
Each forward location can use a different key/trust store pair.</p>

</div>




    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/gchq/stroom" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2024 Crown Copyright All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    

<script src='../../../../../js/popper.min.js'></script>
<script src='../../../../../js/bootstrap.min.js'></script>






<script src='../../../../../js/tabpane-persist.js'></script>




















<script src="../../../../../js/main.min.cbc1d428d83561c4dec32da9374290554119d7483329f849251cb7153b2ecd07.js" integrity="sha256-y8HUKNg1YcTewy2pN0KQVUEZ10gzKfhJJRy3FTsuzQc=" crossorigin="anonymous"></script>



<script src='../../../../../js/prism.js'></script>



  </body>
</html>
