<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.91.2" />
<link rel="canonical" type="text/html" href="https://gchq.github.io/stroom-docs/hugo-docsy/docs/user-guide/sending-data/">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/stroom-docs/hugo-docsy/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/stroom-docs/hugo-docsy/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/stroom-docs/hugo-docsy/favicons/android-192x192.png" sizes="192x192">

<title>Sending Data | Stroom</title>
<meta name="description" content="How to send data into Stroom.
">
<meta property="og:title" content="Sending Data" />
<meta property="og:description" content="How to send data into Stroom.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://gchq.github.io/stroom-docs/hugo-docsy/docs/user-guide/sending-data/" /><meta property="og:site_name" content="Stroom" />

<meta itemprop="name" content="Sending Data">
<meta itemprop="description" content="How to send data into Stroom.
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Sending Data"/>
<meta name="twitter:description" content="How to send data into Stroom.
"/>





<link href="/stroom-docs/hugo-docsy/scss/main.css" rel="stylesheet">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/stroom-docs/hugo-docsy/css/prism.css"/>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/stroom-docs/hugo-docsy/">
		<span class="navbar-logo"><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="110.61089" height="30.000004" viewBox="0 0 88.488641 23.999957" id="svg2" inkscape:version="0.91 r13725" sodipodi:docname="logo.svg"><defs id="defs20"/><sodipodi:namedview pagecolor="#989898" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1920" inkscape:window-height="1137" id="namedview18" showgrid="false" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" inkscape:zoom="5.5951814" inkscape:cx="55.451414" inkscape:cy="16.275348" inkscape:window-x="0" inkscape:window-y="0" inkscape:window-maximized="1" inkscape:current-layer="svg2"/><g id="g4150" style="opacity:.97000002" transform="matrix(0.03883584,0,0,0.03883584,0,-3.1155874e-4)"><path id="path6" d="M121.99991 205.98497C54.999958 205.98497.0 259.98493.0 327.98487c0 66.99994 54.999958 121.99989 121.99991 121.99989h167.99987c24.99998.0 44.99996 20.99998 44.99996 44.99996.0 24.99998-19.99998 44.99996-44.99996 44.99996H109.20929C65.984126 553.87219 27.100843 581.57313.01093599 617.98462H289.99978c66.99994.0 121.99991-54.99996 121.99991-122.9999.0-66.99994-54.99997-121.99989-121.99991-121.99989H121.99991c-24.999984.0-44.999969-19.99999-44.999969-44.99996.0-24.99998 19.999985-44.99996 44.999969-44.99996h228.79045c26.9905-35.88325 65.47093-63.18547 108.21554-76.99994H121.99991z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path8" d="M601.44485-.00077860649C572.6583 8.3697982 546.49491 22.822962 524.44491 41.902305V205.78969l.002.19528h-.002c-65.11 48e-5-123.03145 30.0199-160.74675 76.99994h160.74675v334.99971h76.99994V282.98491h144.85298c27.16134-36.05885 65.96411-63.39275 109.02184-76.99994H601.44485v-205.98574860649z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path10" d="m919.42586 205.98497c-113.99519.0-205.99537 92.00648-206.00296 205.99982-15e-5 68.67178.0 137.32749.0 205.99983h77.99994c-.012-68.6493.0176-137.46869.0-205.99983.0846-70.92785 57.05747-128.99988 128.00462-128.99988 5.28623.0 10.49823.32864 15.62183.95311 18.2219-24.51229 41.78461-45.0838 68.42501-60.15146-25.65065-11.43799-54.08662-17.80159-84.04684-17.80159z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path12" d="m1109.4153 205.98457c-113.99994.0-205.99983 91.99993-205.99983 205.99984.0 112.9999 91.99989 205.9998 205.99983 205.9998 114 0 205.9999-92.9999 205.9999-205.9998.0-113.99991-91.9999-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.99994-56.99996-128.99994-127.9999.0-70.99995 58.00004-128.9999 128.99994-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path14" d="m1444.4737 205.98457c-113.9999.0-205.9998 91.99993-205.9998 205.99984.0 112.9999 91.9999 205.9998 205.9998 205.9998s205.9999-92.9999 205.9999-205.9998c0-113.99991-92-205.99984-205.9999-205.99984zm0 333.99974c-70.9999.0-128.9999-56.99996-128.9999-127.9999.0-70.99995 58-128.9999 128.9999-128.9999 71 0 128.9999 57.99995 128.9999 128.9999.0 70.99994-57.9999 127.9999-128.9999 127.9999z" style="fill:#fff" inkscape:connector-curvature="0"/><path id="path16" d="m1738.5308 379.98447c0-53 43-97 95.9999-97 53 0 97 44 97 97v237.9997h76.9999v-237.9997c0-53 43-97 96.9999-97 53 0 95.9999 44 95.9999 97v237.9997h77v-237.9997c0-96-77-173.9999-172.9999-173.9999-54.9999.0-103.9999 24.99998-135.9999 64.99995-31.9999-39.99997-79.9999-64.99995-134.9999-64.99995-95.9999.0-173.9998 77.9999-173.9998 173.9999v237.9997h77.9999z" style="fill:#fff" inkscape:connector-curvature="0"/></g></svg></span><span class="font-weight-bold">Stroom</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/stroom-docs/hugo-docsy/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/stroom-docs/hugo-docsy/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/stroom-docs/hugo-docsy/news/" ><span>News / Releases</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/stroom-docs/hugo-docsy/community/" ><span>Community</span></a>
			</li>
			
			
			<li class="nav-item dropdown mr-4 d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Stroom Versions
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://gchq.github.io/stroom-docs/hugo-docsy/">7.1</a>
	
	<a class="dropdown-item" href="https://gchq.github.io/stroom-docs/hugo-docsy/">7.0</a>
	
	<a class="dropdown-item" href="https://gchq.github.io/stroom-docs/">Legacy</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/stroom-docs/hugo-docsy/offline-search-index.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="50"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/stroom-docs/hugo-docsy/docs/user-guide/sending-data/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Sending Data</h1>
<div class="lead">How to send data into Stroom.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-17de3e3f45c7c8258ad0b1fbdaf79ac5">Example Clients</a></li>


    
  
    
    
	
<li>2: <a href="#pg-024991f412288c5759a2f39085fa42b8">Header Arguments</a></li>


    
  
    
    
	
<li>3: <a href="#pg-2350fab056816d8e23468bde99f55a5b">Java Keystores</a></li>


    
  
    
    
	
<li>4: <a href="#pg-089fcf7c39db9bc1d68c34be0a10d8fc">Payloads</a></li>


    
  
    
    
	
<li>5: <a href="#pg-66afc7930c4755ff203bc7d5959bc805">Response Codes</a></li>


    
  
    
    
	
<li>6: <a href="#pg-100b6bcd253aed8a0767220ea9bd05b2">SSL Configuration</a></li>


    
  

    </ul>


<div class="content">
      <p>Stroom has a simple HTTP POST interface that requires HTTP header arguments to be supplied as described <a href="/stroom-docs/hugo-docsy/docs/user-guide/sending-data/header-arguments/">here</a>.</p>
<p>Files are posted to Stroom as described <a href="/stroom-docs/hugo-docsy/docs/user-guide/sending-data/payloads/">here</a>.</p>
<p>Stroom will return a response code indicating the success or failure status of the post as described <a href="/stroom-docs/hugo-docsy/docs/user-guide/sending-data/response-codes/">here</a></p>
<p>Data can be sent from may operating systems or applications. Some examples to aid in sending data can be found <a href="/stroom-docs/hugo-docsy/docs/user-guide/sending-data/example-clients/">here</a></p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    



<div class="td-content" style="--base-section-num: '1.'; page-break-before: always">
    
  <h1 id="pg-17de3e3f45c7c8258ad0b1fbdaf79ac5">1 - Example Clients</h1>
    
	<p>The following article provides examples to help data providers send data to Stroom via the HTTPS interface. The code for the clients is in the <em>stroom-clients</em> repository <a href="https://github.com/gchq/stroom-clients">stroom-clients (external link)</a>.</p>
<h2 id="using-docker">Using Docker</h2>
<p><a href="https://hub.docker.com/r/gchq/stroom-log-sender/">stroom-log-sender (external link)</a> is a small Docker image for sending data to <em>stroom</em>.
This is the simplest way to get data into stroom if the data provider is itself running in docker.
It can also be used for sending data to <em>stroom</em> from data providers that are not running in Docker.
<em>stroom-log-sender</em> makes use of the <em>send_to_stroom.sh</em> bash script that is described below.
For details on how to use <em>stroom-log-sender</em>, see the Dockerhub link above.</p>
<h2 id="unix-using-send_to_stroomsh">UNIX (using send_to_stroom.sh)</h2>
<p><a href="https://github.com/gchq/stroom-clients/releases">send_to_stroom.sh (external link)</a> is a small bash script to make it easier to send data to <em>stroom</em>. To use it download the following files using wget or similar, replacing <code>SEND_TO_STROOM_VER</code> with the latest released version from <a href="https://github.com/gchq/stroom-clients/releases">here (external link)</a>:</p>
<pre><code class="language-bash">SEND_TO_STROOM_VER=&quot;send-to-stroom-v2.0&quot; &amp;&amp; \
    wget &quot;https://raw.githubusercontent.com/gchq/stroom-clients/${SEND_TO_STROOM_VER}/bash/send_to_stroom.sh&quot; &amp;&amp; \
    wget &quot;https://raw.githubusercontent.com/gchq/stroom-clients/${SEND_TO_STROOM_VER}/bash/send_to_stroom_args.sh&quot; &amp;&amp; \
    chmod u+x send_to_stroom*.sh
</code></pre>
<p>To see the help for <em>send_to_stroom.sh</em>, enter <code>./send_to_stroom.sh --help</code></p>
<p>The following is an example of using <em>send_to_stroom.sh</em> to send all logs in a directory:</p>
<pre><code class="language-bash">./send_to_stroom.sh \
    --delete-after-sending \
    --file-regex &quot;.*/access-[0-9]+.*\.log(\.gz)?$&quot; \
    --key ./client..key \
    --cert ./client.pem.crt \
    --cacert ./ca.pem.crt \
    /some_directory/logs \
    MY_FEED \
    MY_SYSTEM \
    DEV \
    https://stroom-host/stroom/datafeed
</code></pre>
<h2 id="unix-using-curl">UNIX (using curl)</h2>
<p>Curl is a standard unix tool to send data to or from a server. In the following examples -H is used to specify the header arguments required by Stroom, see <a href="/stroom-docs/hugo-docsy/docs/user-guide/sending-data/header-arguments/">Header Arguments</a>.</p>
<p>Notes:</p>
<ul>
<li>The @ character must be used in front of the file being posted. If it is not then curl will post the file name instead of it&rsquo;s contents.</li>
<li>The &ndash;data-binary argument must always be used even for text formats, in order to prevent data corruption by curl stripping out newlines.</li>
</ul>
<h3 id="example-https-post-without-authentication">Example HTTPS post without authentication:</h3>
<pre><code class="language-bash">curl -k --data-binary @file.dat &quot;https://&lt;Stroom_HOST&gt;/stroom/datafeed&quot;
        -H &quot;Feed:EXAMPLE_FEED&quot;
        -H &quot;System:EXAMPLE_SYSTEM&quot;
        -H &quot;Environment:EXAMPLE_ENVIRONMENT&quot;
</code></pre>
<p>In the above example -k is required to stop curl from authenticating the server. The next example must be used to supply the necessary CA to authenticate the server if this is required.</p>
<h3 id="example-https-with-1-way-ssl-authentication">Example HTTPS With 1 way SSL authentication:</h3>
<pre><code class="language-bash">curl --cacert root_ca.crt --data-binary @file.dat &quot;https://&lt;Stroom_HOST&gt;/stroom/datafeed&quot;
        -H &quot;Feed:EXAMPLE_FEED&quot;
        -H &quot;System:EXAMPLE_SYSTEM&quot;
        -H &quot;Environment:EXAMPLE_ENVIRONMENT&quot;
</code></pre>
<p>The above example verifies that the certificate presented by Stroom is signed by the CA. The CA is provided to curl using the &lsquo;&ndash;cacert root_ca.crt&rsquo; parameter.</p>
<p>For step by step instructions for creating, configuring and testing the PKI authentication, see the <a href="/stroom-docs/hugo-docsy/docs/user-guide/sending-data/ssl/">SSL Guide</a></p>
<h3 id="example-https-with-2-way-ssl-authentication">Example HTTPS With 2 way SSL authentication:</h3>
<pre><code class="language-bash">curl --cert example.pem --cacert root_ca.crt --data-binary @file.dat &quot;https://&lt;Stroom_HOST&gt;/stroom/datafeed&quot;
        -H &quot;Feed:EXAMPLE_FEED&quot;
        -H &quot;System:EXAMPLE_SYSTEM&quot;
        -H &quot;Environment:EXAMPLE_ENVIRONMENT&quot;
</code></pre>
<p>The above example both verifies that the certificate presented by Stroom is signed by the CA and also provides a certificate to authenticate itself with Stroom. The data provider provides a certificate using the &lsquo;&ndash;cert example.pem&rsquo; parameter.</p>
<p>If your input file is not compressed you should compress it as follows:</p>
<pre><code class="language-bash">gzip -c uncompressedfile.dat | curl --cert example.pem --cacert root_ca.crt --data-binary @- &quot;https://&lt;Stroom_HOST&gt;/stroom/datafeed&quot;
	        -H &quot;Feed:EXAMPLE_FEED&quot;
	        -H &quot;System:EXAMPLE_SYSTEM&quot;
	        -H &quot;Environment:EXAMPLE_ENVIRONMENT&quot;
	        -H &quot;Compression:Gzip&quot;
</code></pre>
<p>When delivering data from a RHEL4 host, an additional header argument must be added to specify the FQDN of the host:</p>
<pre><code class="language-bash">-H &quot;Hostname:host.being.audited&quot;
</code></pre>
<p>The hostname being sent as a header argument may be resolved upon execution using the command <strong>hostname -f</strong>.</p>
<h3 id="ssl-notes">SSL Notes</h3>
<p>To create a .pem format key simply append the private key and certifcate.</p>
<pre><code class="language-bash">cat &lt;NAME&gt;.key &gt;&gt; &lt;NAME&gt;.pem
cat &lt;NAME&gt;.crt &gt;&gt; &lt;NAME&gt;.pem
</code></pre>
<p>To remove the pass phrase from a openssl private key use.</p>
<pre><code class="language-bash">openssl rsa -in server.key -out server-clear.key
</code></pre>
<p>The <code>send-logs.sh</code> script assumes the period start and end times are embedded in the file name (e.g. log_2010-01-01T12:00:00.000Z_2010-01-02T12:00:00.000Z.log).  The certificates will need to be added to the script as above.</p>
<h2 id="windows">Windows</h2>
<h3 id="using-wget">Using wget</h3>
<p>There is a version of wget for windows</p>
<ul>
<li>Use &ndash;post-file argument to supply the data</li>
<li>Use &ndash;certificate and &ndash;certificate-type arguments to specify your client certificate</li>
<li>Use &ndash;header argument to inform Stroom which feed and environment your data relates to</li>
</ul>
<h3 id="using-curl">Using curl</h3>
<p>There is a version of curl for Windows</p>
<p>Windows 10 is the latest desktop OS offering from Microsoft.
From Windows 10 build 17063 and later, curl is now natively included - you can execute it directly from Cmd.exe or PowerShell.exe.
Curl.exe is located at c:\windows\system32 (which is included in the standard PATH environment variable) - all you need to do is run Command Prompt with administrative rights and you can use Curl. You can execute it directly from Cmd.exe or PowerShell.exe.
For older versions of Windows, the cURL project has Windows binaries.</p>
<pre><code class="language-bash">curl -s -k --data-binary @file.dat &quot;https://stroomp.strmdev00.org/stroom/datafeed&quot; -H&quot;Feed:TEST-FEED-V1_0&quot; -H&quot;System:EXAMPLE_SYSTEM&quot; -H&quot;Environment:EXAMPLE_ENVIRONMENT&quot;
</code></pre>







  
  
  
  
  







  



<div class="card rounded shadow-stroom p-2 td-post-card mb-4 mt-4" style="width: fit-content;">

  <figure style="margin-block-end: 0px" >
    
    <img class="card-img-top" src="/stroom-docs/hugo-docsy/images/user-guide/sending-data/curl_windows.png" alt="images/user-guide/sending-data/curl_windows.png">
    

    
    <div class="card-body px-0 pt-2 pb-0">
      <hr style="border-top: 1px solid #ddd; margin-top: 0px; margin-bottom:4px;">
      <figcaption class="card-text" style="font-size: smaller; text-align: center;">Windows curl CLI</figcaption>
    </div>
    
  </figure>
</div>

<h3 id="using-vbscript">Using VBScript</h3>
<p><code>extract-data.vbs</code> uses wevtutil.exe to extract <strong>Security</strong> event information from the windows event log.  This script has been tested on Windows 2008.</p>
<p>This script is designed to run periodically (say every 10 minutes).  The first time the script is run it stores the current time in UTC format in the registry.  Subsequent calls then extract event information from the last run time to the new current time.  The events are stored in a zip file with the period dates embedded.</p>
<p>The script requires a working directory used as a buffer for the zip files.  This can be set at the start of the script otherwise it will default to the working directory.</p>
<p>The <code>send-data.vbs</code> script is designed to run periodically (say every 10 minutes). The script will scan for zip files and send them to Stroom.</p>
<p>The script details several parameters that require setting per environment. Among these are the working directory that the zip files are stored in, the feed name and the URL of Stroom.</p>
<h4 id="ssl">SSL</h4>
<p>To send data over SSL (https) you must import a client certificate in p12 format into windows.<br>
To convert a certificate (.crt) and private key (.key) into a p12 format use the following command:</p>
<pre><code class="language-bash">openssl pkcs12 -export -in &lt;NAME&gt;.crt -inkey &lt;NAME&gt;.key -out &lt;NAME&gt;.p12 -name &quot;&lt;NAME&gt;&quot;
</code></pre>
<p>Once in p12 format use the windows certificate wizard to import the public private key.</p>
<p>The <code>send-data-tree.vbs</code> script works through a directory for different feed types.</p>
<h3 id="using-java">Using Java</h3>
<p>The <code>stroom-java-client</code> provides an example Java client that can:</p>
<ul>
<li>Read a zip, gzip or uncompressed an input file.</li>
<li>Perform a HTTP post of data with zip, gzip or uncompressed compression.</li>
<li>Pass down arguments on the command line as HTTP request arguments.</li>
<li>Supports HTTP and HTTPS with 1 or 2 way authentication.</li>
</ul>
<p><em>(N.B. arguments must be in lower case).</em></p>
<p>To use the example client first compile the Java code:</p>
<pre><code class="language-bash">javac DataFeedClient.java
</code></pre>
<h4 id="example-http-post">Example HTTP Post:</h4>
<pre><code class="language-bash">java -classpath . DataFeedClient inputfile=datafeed url=http://&lt;Stroom_HOST&gt;/stroom/datafeed system=EXAMPLE-SYSTEM environment=DEV feed=EXAMPLE-FEED
</code></pre>
<h4 id="example-https-with-1-way-ssl-authentication-1">Example HTTPS With 1 way SSL authentication:</h4>
<pre><code class="language-bash">java -classpath . -Djavax.net.ssl.trustStore=ca.jks -Djavax.net.ssl.trustStorePassword=capass DataFeedClient inputfile=datafeed url=https://&lt;Stroom_HOST&gt;/stroom/datafeed system=EXAMPLE-SYSTEM environment=DEV feed=EXAMPLE-FEED
</code></pre>
<h4 id="example-https-with-2-way-ssl-authentication-1">Example HTTPS With 2 way SSL authentication:</h4>
<pre><code class="language-bash">java -classpath . -Djavax.net.ssl.trustStore=ca.jks -Djavax.net.ssl.trustStorePassword=capass -Djavax.net.ssl.keyStore=example.jks -Djavax.net.ssl.keyStorePassword=&lt;PASSWORD&gt; DataFeedClient inputfile=datafeed url=https://&lt;Stroom_HOST&gt;/stroom/datafeed system=EXAMPLE-SYSTEM environment=DEV feed=EXAMPLE-FEED
</code></pre>
<h3 id="using-c">Using C*#*</h3>
<p>The <code>StroomCSharpClient</code> is a C# port of the Java client and behaves in the same way. Note that this is just an example, not a fully functional client.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '2.'; page-break-before: always">
    
  <h1 id="pg-024991f412288c5759a2f39085fa42b8">2 - Header Arguments</h1>
    <div class="lead">The various HTTP headers that can be sent with data.</div>
	<p>The following data must be passed in as HTTP header arguments when sending files to Stroom via HTTP POST. These arguments are case insensitive.</p>
<ul>
<li>
<p><code>System</code> - The name by which the system is known within the organisation, e.g. <code>PAYROLL_SYSTEM</code>. This could be the name of a project/service or capability.</p>
</li>
<li>
<p><code>Environment</code> - A means to identify the deployed instance of a system. This may indicate the deployment status, e.g. DEV, REF, LIVE, OPS, etc., and/or the location where the instance is deployed. An environment may be a combination of these attributes separated with an underscore.</p>
</li>
<li>
<p><code>Feed</code> - The name of the feed this data relates to. This is mandatory and must match a feed defined within Stroom in order for Stroom to accept the data and know what to do with it.</p>
</li>
<li>
<p><code>Compression</code> - This token is optionally used when the POST payload is compressed with either gzip of zip compression. Value of <code>ZIP</code> and <code>GZIP</code> are valid. <strong>Note</strong>: The <code>Compression</code> token MUST not be used in conjunction with the standard HTTP header token <code>Content-Encoding</code> otherwise stroom will be unable to un-compress the data. Use either <code>Compression:GZIP</code> or <code>Content-Encoding:gzip</code>, not both. Using <code>Compression</code> is preferred.</p>
</li>
<li>
<p><code>EffectiveTime</code> - This is only applicable to reference data. It is used to indicate the point in time that the reference data is applicable to, i.e. all event data that uses the reference data that is created after the effective time will use the reference data until a new reference data item arrives with a later effective time. <strong>Note</strong>: This argument must be in <em>ISO 8601</em> date time format, i.e: <code>yyyy-MM-ddTHH:mm:ss.sssZ</code>.</p>
</li>
</ul>
<p>Example header arguments for a feed called <em>MY_SYSTEM-EVENTS</em> from system <em>MY_SYSTEM</em> and environment <em>OPS</em></p>
<pre><code class="language-text">System:MY_SYSTEM
Environment:OPS
Feed:MY_SYSTEM-EVENTS
</code></pre>
<p>The post payload must contain the events file. If the compression format is ZIP the payload must contain ZIP entries with the events files and optional context files ending in .ctx. Further details of supported payload formats can be found <a href="/stroom-docs/hugo-docsy/docs/user-guide/sending-data/payloads/">here</a>.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '3.'; page-break-before: always">
    
  <h1 id="pg-2350fab056816d8e23468bde99f55a5b">3 - Java Keystores</h1>
    <div class="lead">How to create java key/trust stores for use with Java client applications.</div>
	<p>There are many times when you may wish to create a Java keystore from certificates and keys and vice versa. This guide aims to explain how this can be done.</p>
<h2 id="import">Import</h2>
<p>If you need to create a Java keystore from a .crt and .key then this is how to do it.</p>
<h3 id="convert-your-keys-to-der-format">Convert your keys to der format</h3>
<pre><code class="language-bash">openssl x509 -in &lt;YOUR KEY&gt;.crt -inform PEM -out &lt;YOUR KEY&gt;.crt.der -outform DER
openssl pkcs8 -topk8 -nocrypt -in &lt;YOUR KEY&gt;.key -inform PEM -out &lt;YOUR KEY&gt;.key.der -outform DER
</code></pre>
<h3 id="importkey">ImportKey</h3>
<p>Use the <code>ImportKey</code> class in the <code>stroom-java-client</code> library to import keys.</p>
<p>For example:</p>
<pre><code class="language-bash">java ImportKey keystore=&lt;YOUR KEY&gt;.jks keypass=&lt;YOUR PASSWORD&gt; alias=&lt;YOUR KEY&gt; keyfile=&lt;YOUR KEY&gt;.key.der certfile=&lt;YOUR KEY&gt;.crt.der
keytool -import -noprompt -alias CA -file &lt;CA CERT&gt;.crt -keystore ca.jks -storepass ca
</code></pre>
<h2 id="export">Export</h2>
<h3 id="exportkey">ExportKey</h3>
<p>Use the <code>ExportKey</code> class in the <code>stroom-java-client</code> library to export keys. If you would like to use curl or similar application but only have keys contained within a Java keystore then they can be exported.</p>
<p>For example:</p>
<pre><code class="language-bash">java ExportKey keystore=&lt;YOUR KEY&gt;.jks keypass=&lt;YOUR PASSWORD&gt; alias=&lt;YOUR KEY&gt;
</code></pre>
<p>This will print both the key and certificate to standard out. This can then be copied into a PEM file for use with cURL or other similar application.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '4.'; page-break-before: always">
    
  <h1 id="pg-089fcf7c39db9bc1d68c34be0a10d8fc">4 - Payloads</h1>
    <div class="lead">Description of the data formats for sending data into a Stroom instance.</div>
	<p>Stroom can support multiple payload formats with different compression applied. However all data once uncompressed must be text and not binary.</p>
<p>Stroom can receive data in the following formats:</p>
<ul>
<li>Uncompressed - Text data is sent to Stroom and no compression flag is set in the header arguments.</li>
<li>GZIP - Text data is GZIP compressed and the compression flag is set to GZIP.</li>
<li>ZIP - A text file is compressed into a ZIP archive and sent to Stroom with the compression flag set to ZIP. The ZIP file must contain one data file and an optional context file, see below.</li>
</ul>
<h2 id="context-files">Context Files</h2>
<p>ZIP files sent to Stroom are expected to contain the data file and an optional context file *.ctx. If provided a context file can be used to provide reference data that is specific to the data file that has been sent. Context data is supplimentary information that is not contained within logged events, e.g. the machine name, ip address etc may be delivered in a context file if it is not written by an application in each logged event.</p>
<h2 id="character-encodings">Character Encodings</h2>
<p>Although Stroom only supports data in text format, text can be encoded using multiple character encodings. Supported encodings include:</p>
<ul>
<li>ISO-8859-1 (understood by default)</li>
<li>Windows-1252 - ANSI (understood by default)</li>
<li>ASCII (understood by default)</li>
<li>UTF-8 (with or without BOM)</li>
<li>UTF-16LE (little endian with or without BOM)</li>
<li>UTF-16BE (big endian with or without BOM)</li>
<li>UTF-32LE (little endian with or without BOM)</li>
<li>UTF-32BE (big endian with or without BOM)</li>
</ul>
<p>In order to tell Stroom what character encoding to use the feed that the data belongs to can be configured within the Stroom application to use a specific character encoding. Separate character encodings can be specified for logged event and context data.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '5.'; page-break-before: always">
    
  <h1 id="pg-66afc7930c4755ff203bc7d5959bc805">5 - Response Codes</h1>
    <div class="lead">The HTTP response codes returned by stroom.</div>
	<p>Stroom will return a HTTP response code to indicate success or failure.
An additional response Header &ldquo;Stroom-Status&rdquo; will indicate a more precise error message code.
A user readable message will appear in the response body.</p>
<table>
<thead>
<tr>
<th>HTTP Status</th>
<th>Stroom-Status</th>
<th>Message</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>200</td>
<td>0</td>
<td>OK</td>
<td>Post of data successful</td>
</tr>
<tr>
<td>406</td>
<td>100</td>
<td>Feed must be specified</td>
<td>You must provide Feed as a header argument in the request</td>
</tr>
<tr>
<td>406</td>
<td>110</td>
<td>Feed is not set to receive data</td>
<td>The feed you have provided is not setup to receive data (maybe does not exist or is set to reject)</td>
</tr>
<tr>
<td>406</td>
<td>200</td>
<td>Unknown compression</td>
<td>Compression argument must be one of ZIP, GZIP and NONE</td>
</tr>
<tr>
<td>401</td>
<td>300</td>
<td>Client Certificate Required</td>
<td>The feed you have provided requires a client HTTPS certificate to send data</td>
</tr>
<tr>
<td>403</td>
<td>310</td>
<td>Client Certificate not authorised</td>
<td>The feed you have provided does not allow your client certificate to send data</td>
</tr>
<tr>
<td>500</td>
<td>400</td>
<td>Compressed stream invalid</td>
<td>The stream of data sent does not form a valid compressed file.  Maybe it terminated unexpectedly or is corrupt.</td>
</tr>
<tr>
<td>500</td>
<td>999</td>
<td>Unknown error</td>
<td>An unknown unexpected error occurred</td>
</tr>
</tbody>
</table>
<p>In the event that data is not successfully received by Stroom, i.e. the response code is not 200, the client system should buffer data and keep trying to re-send it.
Data should only be removed from the client system when it has been sent successfully.</p>

</div>




    
	
  
    
    
	
    



<div class="td-content" style="--base-section-num: '6.'; page-break-before: always">
    
  <h1 id="pg-100b6bcd253aed8a0767220ea9bd05b2">6 - SSL Configuration</h1>
    <div class="lead">Configuring SSL with cURL.</div>
	<p>This page provides a step by step guide to getting PKI authentication working correctly for Unix hosts so as to be able to sign deliveries from cURL.</p>
<p>First make sure you have a copy of your organisations CA certificate.</p>
<p>Check that the CA certificate works by running the following command:</p>
<pre><code class="language-bash">echo &quot;Test&quot; | curl --cacert CA.crt --data-binary @- &quot;https://&lt;Stroom_HOST&gt;/stroom/datafeed&quot;
</code></pre>
<p>If the response starts with the line:</p>
<pre><code class="language-bash">curl: (60) SSL certificate problem, verify that the CA cert is OK.
</code></pre>
<p>then you do not have the correct CA certificate.</p>
<p>If the response contains the line</p>
<pre><code class="language-bash">HTTP Status 406 - Stroom Status 100 - Feed must be specified
</code></pre>
<p>then one-way SSL authentication using the CA certificate is successful.</p>
<p>The VBScript file to check windows certificates is <code>check-certs.vbs</code> (TODO link).</p>
<p>#Final Testing</p>
<p>Once one-way authentication has been tested, two-way authentication should be configured:</p>
<p>The server certificate and private key should be concatenated to create a PEM file:</p>
<pre><code class="language-bash">cat hostname.cert hostname.key &gt; hostname.pem
</code></pre>
<p>Finally, test for 2-way authentication:</p>
<pre><code class="language-bash">echo &quot;Test&quot; | curl --cacert CA.crt --cert hostname.pem --data-binary @- &quot;https://&lt;Stroom_HOST&gt;/stroom/datafeed&quot;
</code></pre>
<p>If the response contains the line</p>
<pre><code class="language-bash">HTTP Status 406 - Stroom Status 100 - Feed must be specified
</code></pre>
<p>then two-way SSL authentication is successful.</p>
<p>#Final Tidy Up</p>
<p>The files <code>ca.crt</code> and <code>hostname.pem</code> are the only files required for two-way authentication and should be stored permanently on the server; all other remaining files may be deleted or backed up if required.</p>
<p>#Certificate Expiry</p>
<p>PKI certificates expire after 2 years.  To check the expiry date of a certificate, run the following command:</p>
<pre><code class="language-bash">openssl x509 -in /path/to/certificate.pem -noout -enddate
</code></pre>
<p>This will give a response looking similar to:</p>
<pre><code class="language-bash">notAfter=Aug 15 10:01:42 2013 GMT
</code></pre>

</div>




    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/gchq/stroom" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Crown Copyright 2021 All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/stroom-docs/hugo-docsy/js/tabpane-persist.js'></script>



















<script src="/stroom-docs/hugo-docsy/js/main.js"></script>



<script src='/stroom-docs/hugo-docsy/js/prism.js'></script>



  </body>
</html>
