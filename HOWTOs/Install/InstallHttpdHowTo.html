
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Httpd Â· Stroom Docs</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="InstallCertificatesHowTo.html" />
    
    
    <link rel="prev" href="InstallVolumesHowTo.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">1. Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../release-notes.html">
            
                <a href="../../release-notes.html">
            
                    
                        <b>1.2.</b>
                    
                    Release Notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../screenshots.html">
            
                <a href="../../screenshots.html">
            
                    
                        <b>1.3.</b>
                    
                    Screenshots
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../quick-start-guide/quick-start.html">
            
                <a href="../../quick-start-guide/quick-start.html">
            
                    
                        <b>1.4.</b>
                    
                    Quick-start guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../quick-start-guide/running/running.html">
            
                <a href="../../quick-start-guide/running/running.html">
            
                    
                        <b>1.4.1.</b>
                    
                    Running
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../quick-start-guide/feed/feed.html">
            
                <a href="../../quick-start-guide/feed/feed.html">
            
                    
                        <b>1.4.2.</b>
                    
                    Getting data in
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../quick-start-guide/process/process.html">
            
                <a href="../../quick-start-guide/process/process.html">
            
                    
                        <b>1.4.3.</b>
                    
                    Processing the data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../quick-start-guide/index/">
            
                <a href="../../quick-start-guide/index/">
            
                    
                        <b>1.4.4.</b>
                    
                    Indexing the data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../quick-start-guide/dashboard/dashboard.html">
            
                <a href="../../quick-start-guide/dashboard/dashboard.html">
            
                    
                        <b>1.4.5.</b>
                    
                    Visualising the data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">2. Installation</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../install-guide/stroom-6-architecture.html">
            
                <a href="../../install-guide/stroom-6-architecture.html">
            
                    
                        <b>2.1.</b>
                    
                    Architecture & Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../install-guide/stroom-app-install.html">
            
                <a href="../../install-guide/stroom-app-install.html">
            
                    
                        <b>2.2.</b>
                    
                    Installing Stroom
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../install-guide/Stroom-7-Proxy-Installation.html">
            
                <a href="../../install-guide/Stroom-7-Proxy-Installation.html">
            
                    
                        <b>2.3.</b>
                    
                    Installing Stroom Proxy v7
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
                <span>
            
                    
                        <b>2.4.</b>
                    
                    Setup
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="../../install-guide/setup/apache-forwarding.html">
            
                <a href="../../install-guide/setup/apache-forwarding.html">
            
                    
                        <b>2.4.1.</b>
                    
                    Apache forwarding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="../../install-guide/setup/java-key-store-setup.html">
            
                <a href="../../install-guide/setup/java-key-store-setup.html">
            
                    
                        <b>2.4.2.</b>
                    
                    Java key store setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.3" data-path="../../install-guide/setup/mysql-server-setup.html">
            
                <a href="../../install-guide/setup/mysql-server-setup.html">
            
                    
                        <b>2.4.3.</b>
                    
                    MySQL server setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.4" data-path="../../install-guide/setup/processing-user-setup.html">
            
                <a href="../../install-guide/setup/processing-user-setup.html">
            
                    
                        <b>2.4.4.</b>
                    
                    Processing user setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4.5" data-path="../../install-guide/setup/securing-stroom.html">
            
                <a href="../../install-guide/setup/securing-stroom.html">
            
                    
                        <b>2.4.5.</b>
                    
                    Securing Stroom
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../install-guide/upgrade-patch.html">
            
                <a href="../../install-guide/upgrade-patch.html">
            
                    
                        <b>2.5.</b>
                    
                    Upgrading and patching
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="../../install-guide/upgrades/6_to_7_upgrade.html">
            
                <a href="../../install-guide/upgrades/6_to_7_upgrade.html">
            
                    
                        <b>2.5.1.</b>
                    
                    v6 to v7 Upgrade
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../install-guide/stroom-6-installation.html">
            
                <a href="../../install-guide/stroom-6-installation.html">
            
                    
                        <b>2.6.</b>
                    
                    Stroom 6 installation guide (DRAFT)
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">3. User Guide</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../user-guide/concepts/">
            
                <a href="../../user-guide/concepts/">
            
                    
                        <b>3.1.</b>
                    
                    Concepts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../../user-guide/concepts/streams.html">
            
                <a href="../../user-guide/concepts/streams.html">
            
                    
                        <b>3.1.1.</b>
                    
                    Streams
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../user-guide/properties.html">
            
                <a href="../../user-guide/properties.html">
            
                    
                        <b>3.2.</b>
                    
                    Properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../user-guide/nodes.html">
            
                <a href="../../user-guide/nodes.html">
            
                    
                        <b>3.3.</b>
                    
                    Nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../user-guide/volumes.html">
            
                <a href="../../user-guide/volumes.html">
            
                    
                        <b>3.4.</b>
                    
                    Volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../user-guide/jobs.html">
            
                <a href="../../user-guide/jobs.html">
            
                    
                        <b>3.5.</b>
                    
                    Jobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../../user-guide/feeds.html">
            
                <a href="../../user-guide/feeds.html">
            
                    
                        <b>3.6.</b>
                    
                    Feeds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../../user-guide/finding-things/finding-things.html">
            
                <a href="../../user-guide/finding-things/finding-things.html">
            
                    
                        <b>3.7.</b>
                    
                    Finding Things
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="../../user-guide/editing-and-viewing.html">
            
                <a href="../../user-guide/editing-and-viewing.html">
            
                    
                        <b>3.8.</b>
                    
                    Editing and Viewing Text Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="../../user-guide/roles.html">
            
                <a href="../../user-guide/roles.html">
            
                    
                        <b>3.9.</b>
                    
                    Roles and permissions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="../../user-guide/sending-data/">
            
                <a href="../../user-guide/sending-data/">
            
                    
                        <b>3.10.</b>
                    
                    Sending data to Stroom
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.10.1" data-path="../../user-guide/sending-data/header-arguments.html">
            
                <a href="../../user-guide/sending-data/header-arguments.html">
            
                    
                        <b>3.10.1.</b>
                    
                    Header Arguments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.2" data-path="../../user-guide/sending-data/payloads.html">
            
                <a href="../../user-guide/sending-data/payloads.html">
            
                    
                        <b>3.10.2.</b>
                    
                    Payloads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.3" data-path="../../user-guide/sending-data/response-codes.html">
            
                <a href="../../user-guide/sending-data/response-codes.html">
            
                    
                        <b>3.10.3.</b>
                    
                    Response codes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.4" data-path="../../user-guide/sending-data/example-clients.html">
            
                <a href="../../user-guide/sending-data/example-clients.html">
            
                    
                        <b>3.10.4.</b>
                    
                    Example clients
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.5" data-path="../../user-guide/sending-data/java-keystores.html">
            
                <a href="../../user-guide/sending-data/java-keystores.html">
            
                    
                        <b>3.10.5.</b>
                    
                    SSL Java keystores
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.6" data-path="../../user-guide/sending-data/ssl.html">
            
                <a href="../../user-guide/sending-data/ssl.html">
            
                    
                        <b>3.10.6.</b>
                    
                    SSL configuration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="../../user-guide/pipelines/">
            
                <a href="../../user-guide/pipelines/">
            
                    
                        <b>3.11.</b>
                    
                    Pipelines
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.1" data-path="../../user-guide/pipelines/parser/">
            
                <a href="../../user-guide/pipelines/parser/">
            
                    
                        <b>3.11.1.</b>
                    
                    Parser
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.1.1" data-path="../../user-guide/pipelines/parser/xml-fragments.html">
            
                <a href="../../user-guide/pipelines/parser/xml-fragments.html">
            
                    
                        <b>3.11.1.1.</b>
                    
                    XML fragments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.1.2" data-path="../../user-guide/pipelines/parser/context-data.html">
            
                <a href="../../user-guide/pipelines/parser/context-data.html">
            
                    
                        <b>3.11.1.2.</b>
                    
                    Context data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.2" data-path="../../user-guide/pipelines/xslt/">
            
                <a href="../../user-guide/pipelines/xslt/">
            
                    
                        <b>3.11.2.</b>
                    
                    XSLT
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.2.1" data-path="../../user-guide/pipelines/xslt/xslt-includes.html">
            
                <a href="../../user-guide/pipelines/xslt/xslt-includes.html">
            
                    
                        <b>3.11.2.1.</b>
                    
                    XSLT includes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.2.2" data-path="../../user-guide/pipelines/xslt/xslt-functions.html">
            
                <a href="../../user-guide/pipelines/xslt/xslt-functions.html">
            
                    
                        <b>3.11.2.2.</b>
                    
                    XSLT functions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11.3" data-path="../../user-guide/pipelines/file-output.html">
            
                <a href="../../user-guide/pipelines/file-output.html">
            
                    
                        <b>3.11.3.</b>
                    
                    File output
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.4" data-path="../../user-guide/pipelines/reference-data.html">
            
                <a href="../../user-guide/pipelines/reference-data.html">
            
                    
                        <b>3.11.4.</b>
                    
                    Reference Data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="../../user-guide/dashboards/">
            
                <a href="../../user-guide/dashboards/">
            
                    
                        <b>3.12.</b>
                    
                    Dashboards
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.12.1" data-path="../../user-guide/dashboards/queries.html">
            
                <a href="../../user-guide/dashboards/queries.html">
            
                    
                        <b>3.12.1.</b>
                    
                    Queries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.2" data-path="../../user-guide/dashboards/dictionaries.html">
            
                <a href="../../user-guide/dashboards/dictionaries.html">
            
                    
                        <b>3.12.2.</b>
                    
                    Dictionaries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.3" data-path="../../user-guide/dashboards/direct-urls.html">
            
                <a href="../../user-guide/dashboards/direct-urls.html">
            
                    
                        <b>3.12.3.</b>
                    
                    Direct URLs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4" data-path="../../user-guide/dashboards/expressions/">
            
                <a href="../../user-guide/dashboards/expressions/">
            
                    
                        <b>3.12.4.</b>
                    
                    Expressions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.12.4.1" data-path="../../user-guide/dashboards/expressions/aggregate.html">
            
                <a href="../../user-guide/dashboards/expressions/aggregate.html">
            
                    
                        <b>3.12.4.1.</b>
                    
                    Aggregate Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.2" data-path="../../user-guide/dashboards/expressions/cast.html">
            
                <a href="../../user-guide/dashboards/expressions/cast.html">
            
                    
                        <b>3.12.4.2.</b>
                    
                    Cast Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.3" data-path="../../user-guide/dashboards/expressions/date.html">
            
                <a href="../../user-guide/dashboards/expressions/date.html">
            
                    
                        <b>3.12.4.3.</b>
                    
                    Date Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.4" data-path="../../user-guide/dashboards/expressions/link.html">
            
                <a href="../../user-guide/dashboards/expressions/link.html">
            
                    
                        <b>3.12.4.4.</b>
                    
                    Link Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.5" data-path="../../user-guide/dashboards/expressions/logic.html">
            
                <a href="../../user-guide/dashboards/expressions/logic.html">
            
                    
                        <b>3.12.4.5.</b>
                    
                    Logic Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.6" data-path="../../user-guide/dashboards/expressions/mathematics.html">
            
                <a href="../../user-guide/dashboards/expressions/mathematics.html">
            
                    
                        <b>3.12.4.6.</b>
                    
                    Mathematics Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.7" data-path="../../user-guide/dashboards/expressions/rounding.html">
            
                <a href="../../user-guide/dashboards/expressions/rounding.html">
            
                    
                        <b>3.12.4.7.</b>
                    
                    Rounding Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.8" data-path="../../user-guide/dashboards/expressions/selection.html">
            
                <a href="../../user-guide/dashboards/expressions/selection.html">
            
                    
                        <b>3.12.4.8.</b>
                    
                    Selection Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.9" data-path="../../user-guide/dashboards/expressions/string.html">
            
                <a href="../../user-guide/dashboards/expressions/string.html">
            
                    
                        <b>3.12.4.9.</b>
                    
                    String Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.10" data-path="../../user-guide/dashboards/expressions/type-checking.html">
            
                <a href="../../user-guide/dashboards/expressions/type-checking.html">
            
                    
                        <b>3.12.4.10.</b>
                    
                    Type Checking Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.11" data-path="../../user-guide/dashboards/expressions/uri.html">
            
                <a href="../../user-guide/dashboards/expressions/uri.html">
            
                    
                        <b>3.12.4.11.</b>
                    
                    URI Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12.4.12" data-path="../../user-guide/dashboards/expressions/value.html">
            
                <a href="../../user-guide/dashboards/expressions/value.html">
            
                    
                        <b>3.12.4.12.</b>
                    
                    Value Functions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="../../user-guide/data-retention.html">
            
                <a href="../../user-guide/data-retention.html">
            
                    
                        <b>3.13.</b>
                    
                    Data Retention
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="../../user-guide/security.html">
            
                <a href="../../user-guide/security.html">
            
                    
                        <b>3.14.</b>
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15" >
            
                <span>
            
                    
                        <b>3.15.</b>
                    
                    Data splitter
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.15.1" data-path="../../datasplitter/1-0-introduction.html">
            
                <a href="../../datasplitter/1-0-introduction.html">
            
                    
                        <b>3.15.1.</b>
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.15.1.1" data-path="../../datasplitter/1-1-simple-csv-example.html">
            
                <a href="../../datasplitter/1-1-simple-csv-example.html">
            
                    
                        <b>3.15.1.1.</b>
                    
                    Simple CSV example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.1.2" data-path="../../datasplitter/1-2-simple-csv-example-with-heading.html">
            
                <a href="../../datasplitter/1-2-simple-csv-example-with-heading.html">
            
                    
                        <b>3.15.1.2.</b>
                    
                    Simple CSV example with heading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.1.3" data-path="../../datasplitter/1-3-complex-example.html">
            
                <a href="../../datasplitter/1-3-complex-example.html">
            
                    
                        <b>3.15.1.3.</b>
                    
                    Complex example with regex and user defined names
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.1.4" data-path="../../datasplitter/1-4-multi-line-example.html">
            
                <a href="../../datasplitter/1-4-multi-line-example.html">
            
                    
                        <b>3.15.1.4.</b>
                    
                    Multi-line example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.15.2" data-path="../../datasplitter/2-0-element-reference.html">
            
                <a href="../../datasplitter/2-0-element-reference.html">
            
                    
                        <b>3.15.2.</b>
                    
                    Element reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.15.2.1" data-path="../../datasplitter/2-1-content-providers.html">
            
                <a href="../../datasplitter/2-1-content-providers.html">
            
                    
                        <b>3.15.2.1.</b>
                    
                    Content providers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.2.2" data-path="../../datasplitter/2-2-expressions.html">
            
                <a href="../../datasplitter/2-2-expressions.html">
            
                    
                        <b>3.15.2.2.</b>
                    
                    Expressions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.2.3" data-path="../../datasplitter/2-3-variables.html">
            
                <a href="../../datasplitter/2-3-variables.html">
            
                    
                        <b>3.15.2.3.</b>
                    
                    Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.2.4" data-path="../../datasplitter/2-4-output.html">
            
                <a href="../../datasplitter/2-4-output.html">
            
                    
                        <b>3.15.2.4.</b>
                    
                    Output
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.15.3" data-path="../../datasplitter/3-0-match-references.html">
            
                <a href="../../datasplitter/3-0-match-references.html">
            
                    
                        <b>3.15.3.</b>
                    
                    Match references, variables and fixed strings
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.15.3.1" data-path="../../datasplitter/3-1-expression-match-references.html">
            
                <a href="../../datasplitter/3-1-expression-match-references.html">
            
                    
                        <b>3.15.3.1.</b>
                    
                    Expression match references
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.3.2" data-path="../../datasplitter/3-2-variable-reference.html">
            
                <a href="../../datasplitter/3-2-variable-reference.html">
            
                    
                        <b>3.15.3.2.</b>
                    
                    Variable reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.3.3" data-path="../../datasplitter/3-3-use-of-fixed-strings.html">
            
                <a href="../../datasplitter/3-3-use-of-fixed-strings.html">
            
                    
                        <b>3.15.3.3.</b>
                    
                    Use of fixed strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15.3.4" data-path="../../datasplitter/3-4-concatenation-of-references.html">
            
                <a href="../../datasplitter/3-4-concatenation-of-references.html">
            
                    
                        <b>3.15.3.4.</b>
                    
                    Concatenation of references
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.16" data-path="../../user-guide/api/">
            
                <a href="../../user-guide/api/">
            
                    
                        <b>3.16.</b>
                    
                    Application Programming Interfaces (API)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.16.1" data-path="../../user-guide/api/query-api.html">
            
                <a href="../../user-guide/api/query-api.html">
            
                    
                        <b>3.16.1.</b>
                    
                    Query API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.17" data-path="../../user-guide/tools/">
            
                <a href="../../user-guide/tools/">
            
                    
                        <b>3.17.</b>
                    
                    Tools
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.17.1" data-path="../../user-guide/tools/command-line.html">
            
                <a href="../../user-guide/tools/command-line.html">
            
                    
                        <b>3.17.1.</b>
                    
                    Command Line Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.17.2" data-path="../../user-guide/tools/stream-dump-tool.html">
            
                <a href="../../user-guide/tools/stream-dump-tool.html">
            
                    
                        <b>3.17.2.</b>
                    
                    Stream Dump Tool
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">4. HOWTOs</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../StroomHowTos.html">
            
                <a href="../StroomHowTos.html">
            
                    
                        <b>4.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" >
            
                <span>
            
                    
                        <b>4.2.</b>
                    
                    General
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../General/FeedManagementHowTo.html">
            
                <a href="../General/FeedManagementHowTo.html">
            
                    
                        <b>4.2.1.</b>
                    
                    Feed Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../General/TasksHowTo.html">
            
                <a href="../General/TasksHowTo.html">
            
                    
                        <b>4.2.2.</b>
                    
                    Tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../General/RawSourceTracking.html">
            
                <a href="../General/RawSourceTracking.html">
            
                    
                        <b>4.2.3.</b>
                    
                    Raw Source Tracking
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" >
            
                <span>
            
                    
                        <b>4.3.</b>
                    
                    Authentication
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../Authentication/UserLogoutHowTo.html">
            
                <a href="../Authentication/UserLogoutHowTo.html">
            
                    
                        <b>4.3.1.</b>
                    
                    User Logout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="../Authentication/UserLoginHowTo.html">
            
                <a href="../Authentication/UserLoginHowTo.html">
            
                    
                        <b>4.3.2.</b>
                    
                    User Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="../Authentication/CreateUserHowTo.html">
            
                <a href="../Authentication/CreateUserHowTo.html">
            
                    
                        <b>4.3.3.</b>
                    
                    Create User
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                        <b>4.4.</b>
                    
                    Install
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="InstallNodesHowTo.html">
            
                <a href="InstallNodesHowTo.html">
            
                    
                        <b>4.4.1.</b>
                    
                    Nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.2" data-path="InstallDatabaseHowTo.html">
            
                <a href="InstallDatabaseHowTo.html">
            
                    
                        <b>4.4.2.</b>
                    
                    Database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.3" data-path="InstallHowTo.html">
            
                <a href="InstallHowTo.html">
            
                    
                        <b>4.4.3.</b>
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.4" data-path="InstallProcessingUserSetupHowTo.html">
            
                <a href="InstallProcessingUserSetupHowTo.html">
            
                    
                        <b>4.4.4.</b>
                    
                    Processing User Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.5" data-path="InstallNFSHowTo.html">
            
                <a href="InstallNFSHowTo.html">
            
                    
                        <b>4.4.5.</b>
                    
                    NFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.6" data-path="InstallTestingHowTo.html">
            
                <a href="InstallTestingHowTo.html">
            
                    
                        <b>4.4.6.</b>
                    
                    Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.7" data-path="InstallProxyHowTo.html">
            
                <a href="InstallProxyHowTo.html">
            
                    
                        <b>4.4.7.</b>
                    
                    Proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.8" data-path="InstallVolumesHowTo.html">
            
                <a href="InstallVolumesHowTo.html">
            
                    
                        <b>4.4.8.</b>
                    
                    Volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.4.9" data-path="InstallHttpdHowTo.html">
            
                <a href="InstallHttpdHowTo.html">
            
                    
                        <b>4.4.9.</b>
                    
                    Httpd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.10" data-path="InstallCertificatesHowTo.html">
            
                <a href="InstallCertificatesHowTo.html">
            
                    
                        <b>4.4.10.</b>
                    
                    Certificates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.11" data-path="InstallApplicationHowTo.html">
            
                <a href="InstallApplicationHowTo.html">
            
                    
                        <b>4.4.11.</b>
                    
                    Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.5" >
            
                <span>
            
                    
                        <b>4.5.</b>
                    
                    Event Feeds
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="../EventFeeds/ProcessingHowTo.html">
            
                <a href="../EventFeeds/ProcessingHowTo.html">
            
                    
                        <b>4.5.1.</b>
                    
                    Event Processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.2" data-path="../EventFeeds/CreateApacheHTTPDEventFeed.html">
            
                <a href="../EventFeeds/CreateApacheHTTPDEventFeed.html">
            
                    
                        <b>4.5.2.</b>
                    
                    Apache HTTPD Event Feed
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" >
            
                <span>
            
                    
                        <b>4.6.</b>
                    
                    Reference Feeds
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="../ReferenceFeeds/CreateSimpleReferenceFeed.html">
            
                <a href="../ReferenceFeeds/CreateSimpleReferenceFeed.html">
            
                    
                        <b>4.6.1.</b>
                    
                    Create Reference Feed
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7" >
            
                <span>
            
                    
                        <b>4.7.</b>
                    
                    Administration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.7.1" data-path="../Administration/SystemProperties.html">
            
                <a href="../Administration/SystemProperties.html">
            
                    
                        <b>4.7.1.</b>
                    
                    System Properties
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8" >
            
                <span>
            
                    
                        <b>4.8.</b>
                    
                    Indexing and Search
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.8.1" data-path="../Search/SearchFromBash.html">
            
                <a href="../Search/SearchFromBash.html">
            
                    
                        <b>4.8.1.</b>
                    
                    Search API using bash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.2" data-path="../Search/Elasticsearch.html">
            
                <a href="../Search/Elasticsearch.html">
            
                    
                        <b>4.8.2.</b>
                    
                    Elasticsearch integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.3" data-path="../Search/Solr.html">
            
                <a href="../Search/Solr.html">
            
                    
                        <b>4.8.3.</b>
                    
                    Solr integration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">5. Stroom Proxy</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../proxy/install.html">
            
                <a href="../../proxy/install.html">
            
                    
                        <b>5.1.</b>
                    
                    Installing Stroom proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../../proxy/docker.html">
            
                <a href="../../proxy/docker.html">
            
                    
                        <b>5.2.</b>
                    
                    Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../../proxy/apache-forwarding.html">
            
                <a href="../../proxy/apache-forwarding.html">
            
                    
                        <b>5.3.</b>
                    
                    Apache forwarding
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">6. Developer Guide</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../dev-guide/">
            
                <a href="../../dev-guide/">
            
                    
                        <b>6.1.</b>
                    
                    Developer guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../../CONTRIBUTING.html">
            
                <a href="../../CONTRIBUTING.html">
            
                    
                        <b>6.1.1.</b>
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../../dev-guide/releasing.html">
            
                <a href="../../dev-guide/releasing.html">
            
                    
                        <b>6.1.2.</b>
                    
                    Releasing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="../../dev-guide/stroom-in-an-ide.html">
            
                <a href="../../dev-guide/stroom-in-an-ide.html">
            
                    
                        <b>6.1.3.</b>
                    
                    Running Stroom from IntelliJ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4" data-path="../../dev-guide/docker-running.html">
            
                <a href="../../dev-guide/docker-running.html">
            
                    
                        <b>6.1.4.</b>
                    
                    Running Stroom using Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.5" data-path="../../dev-guide/components.html">
            
                <a href="../../dev-guide/components.html">
            
                    
                        <b>6.1.5.</b>
                    
                    Components
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.6" data-path="../../dev-guide/gitbook.html">
            
                <a href="../../dev-guide/gitbook.html">
            
                    
                        <b>6.1.6.</b>
                    
                    Building GitBook documentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">7. About Stroom-docs</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../CHANGELOG.html">
            
                <a href="../../CHANGELOG.html">
            
                    
                        <b>7.1.</b>
                    
                    Change log
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../../VERSION.html">
            
                <a href="../../VERSION.html">
            
                    
                        <b>7.2.</b>
                    
                    Version information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../../gitbook.html">
            
                <a href="../../gitbook.html">
            
                    
                        <b>7.3.</b>
                    
                    Building stroom-docs
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Httpd</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="stroom-howto---apache-httpdmodjk-configuration-for-stroom">Stroom HOWTO - Apache Httpd/Mod_JK configuration for Stroom</h1>
<p>The following is a HOWTO to assist users in configuring Apache&apos;s HTTPD with Mod_JK for Stroom.</p>
<h2 id="assumptions">Assumptions</h2>
<p>The following assumptions are used in this document.</p>
<ul>
<li>the user has reasonable RHEL/Centos System administration skills</li>
<li>installations are on Centos 7.3 minimal systems (fully patched)</li>
<li>the security of the HTTPD deployment should be reviewed for a production environment.</li>
</ul>
<h2 id="installation-of-apache-httpd-and-modjk-software">Installation of Apache httpd and Mod_JK Software</h2>
<p>To deploy Stroom using Apache&apos;s httpd web service as a front end (https) and Apache&apos;s mod_jk as the interface between Apache and the Stroom tomcat applications, we also need</p>
<ul>
<li>apr</li>
<li>apr-util</li>
<li>apr-devel</li>
<li>gcc</li>
<li>httpd</li>
<li>httpd-devel</li>
<li>mod_ssl</li>
<li>epel-release</li>
<li>tomcat-native</li>
<li>apache&apos;s mod_jk tomcat connector plugin</li>
</ul>
<p>Most of the required software are packages available via standard repositories and hence we can simply execute</p>
<pre><code class="lang-bash">sudo yum -y install apr apr-util apr-devel gcc httpd httpd-devel mod_ssl epel-release
sudo yum -y install tomcat-native
</code></pre>
<p>The reason for the distinct <code>tomcat-native</code> installation is that this package is from the <a href="https://fedoraproject.org/wiki/EPEL" title="Extra Packages for Enterprise Linux (EPEL)" target="_blank">EPEL</a> repository so it must be installed first.</p>
<p>For the Apache mod_jk Tomcat connector we need to acquire a recent
<a href="https://tomcat.apache.org/connectors-doc" title="The Apache Tomcat Connectors: mod_jk, ISAPI redirector, NSAPI redirector" target="_blank">release</a> and install it.
The following commands achieve this for the 1.2.42 release.</p>
<pre><code class="lang-bash">sudo bash
cd /tmp
V=1.2.42
wget https://www.apache.org/dist/tomcat/tomcat-connectors/jk/tomcat-connectors-${V}-src.tar.gz
tar xf tomcat-connectors-${V}-src.tar.gz
cd tomcat-connectors-*-src/native
./configure --with-apxs=/bin/apxs
make &amp;&amp; make install
cd /tmp
rm -rf tomcat-connectors-*-src
</code></pre>
<p>Although you could remove the gcc compiler at this point, we leave it installed as one <em>should</em> continue to upgrade the Tomcat Connectors to later releases.</p>
<h2 id="configure-apache-httpd">Configure Apache httpd</h2>
<p>We need to configure Apache as the <code>root</code> user.</p>
<p>If the Apache httpd service is &apos;fronting&apos; a Stroom user interface, we should create an index file (/var/www/html/index.html) on all nodes so browsing to
the root of the node will present the Stroom UI. This is not needed if you are deploying a Forwarding or Standalone Stroom proxy.</p>
<h3 id="forwarding-file-for-stroom-user-interface-deployments">Forwarding file for Stroom User Interface deployments</h3>
<pre><code class="lang-bash">F=/var/www/html/index.html
printf &apos;&lt;html&gt;\n&apos; &gt; ${F}
printf &apos;&lt;head&gt;\n&apos; &gt;&gt; ${F}
printf &apos;  &lt;meta http-equiv=&quot;Refresh&quot; content=&quot;0; URL=stroom&quot;/&gt;\n&apos; &gt;&gt; ${F}
printf &apos;&lt;/head&gt;\n&apos; &gt;&gt; ${F}
printf &apos;&lt;/html&gt;\n&apos; &gt;&gt; ${F}
chmod 644 ${F}
</code></pre>
<p>Remember, deploy this file on all nodes running the Stroom Application.</p>
<h3 id="httpdconf-configuration">Httpd.conf Configuration</h3>
<p>We modify <code>/etc/httpd/conf/httpd.conf</code> on all nodes, but backup the file first with</p>
<pre><code class="lang-bash">cp /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.ORIG
</code></pre>
<p>Irrespective of the Stroom scenario being deployed - Multi Node Stroom (Application and Proxy), single Standalone Stroom Proxy or single Forwarding
Stroom Proxy, the configuration of the <code>/etc/httpd/conf/httpd.conf</code> file is the same.</p>
<p>We start by modify the configuration file by,
add just before the ServerRoot directive the following directives which are designed to make the httpd service more secure.</p>
<pre><code># Stroom Change: Start - Apply generic security directives
ServerTokens Prod
ServerSignature Off
FileETag None
RewriteEngine On
RewriteCond %{THE_REQUEST} !HTTP/1.1$
RewriteRule .* - [F]
Header set X-XSS-Protection &quot;1; mode=block&quot;
# Stroom Change: End
</code></pre><p>That is,</p>
<pre><code>...
# Do not add a slash at the end of the directory path.  If you point
# ServerRoot at a non-local disk, be sure to specify a local disk on the
# Mutex directive, if file-based mutexes are used.  If you wish to share the
# same ServerRoot for multiple httpd daemons, you will need to change at
# least PidFile.
#
ServerRoot &quot;/etc/httpd&quot;

#
# Listen: Allows you to bind Apache to specific IP addresses and/or
...
</code></pre><p>becomes</p>
<pre><code>...
# Do not add a slash at the end of the directory path.  If you point
# ServerRoot at a non-local disk, be sure to specify a local disk on the
# Mutex directive, if file-based mutexes are used.  If you wish to share the
# same ServerRoot for multiple httpd daemons, you will need to change at
# least PidFile.
#
# Stroom Change: Start - Apply generic security directives
ServerTokens Prod
ServerSignature Off
FileETag None
RewriteEngine On
RewriteCond %{THE_REQUEST} !HTTP/1.1$
RewriteRule .* - [F]
Header set X-XSS-Protection &quot;1; mode=block&quot;
# Stroom Change: End
ServerRoot &quot;/etc/httpd&quot;

#
# Listen: Allows you to bind Apache to specific IP addresses and/or
...
</code></pre><p>We now block access to the /var/www directory by commenting out</p>
<pre><code>&lt;Directory &quot;/var/www&quot;&gt;
  AllowOverride None
  # Allow open access:
  Require all granted
&lt;/Directory&gt;
</code></pre><p>that is</p>
<pre><code>...
#
# Relax access to content within /var/www.
#
&lt;Directory &quot;/var/www&quot;&gt;
    AllowOverride None
    # Allow open access:
    Require all granted
&lt;/Directory&gt;

# Further relax access to the default document root:
...
</code></pre><p>becomes</p>
<pre><code>...
#
# Relax access to content within /var/www.
#
# Stroom Change: Start - Block access to /var/www
# &lt;Directory &quot;/var/www&quot;&gt;
#     AllowOverride None
#     # Allow open access:
#     Require all granted
# &lt;/Directory&gt;
# Stroom Change: End

# Further relax access to the default document root:
...
</code></pre><p>then within the /var/www/html directory turn off Indexes FollowSymLinks by commenting out the line</p>
<pre><code>Options Indexes FollowSymLinks
</code></pre><p>That is</p>
<pre><code>...
    # The Options directive is both complicated and important.  Please see
    # http://httpd.apache.org/docs/2.4/mod/core.html#options
    # for more information.
    #
    Options Indexes FollowSymLinks

    #
    # AllowOverride controls what directives may be placed in .htaccess files.
    # It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:
...
</code></pre><p>becomes</p>
<pre><code>...
    # The Options directive is both complicated and important.  Please see
    # http://httpd.apache.org/docs/2.4/mod/core.html#options
    # for more information.
    #
    # Stroom Change: Start - turn off indexes and FollowSymLinks
    # Options Indexes FollowSymLinks
    # Stroom Change: End

    #
    # AllowOverride controls what directives may be placed in .htaccess files.
    # It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:
...
</code></pre><p>Then finally we add two new log formats and configure the access log to use the new format. This is done within the <code>&lt;IfModule logio_module&gt;</code> by adding the two new LogFormat directives</p>
<pre><code>LogFormat &quot;%a/%{REMOTE_PORT}e %X %t %l \&quot;%u\&quot; \&quot;%r\&quot; %s/%&gt;s %D %I/%O/%B \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %V/%p&quot; blackboxUser
LogFormat &quot;%a/%{REMOTE_PORT}e %X %t %l \&quot;%{SSL_CLIENT_S_DN}x\&quot; \&quot;%r\&quot; %s/%&gt;s %D %I/%O/%B \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %V/%p&quot; blackboxSSLUser
</code></pre><p>and replacing the CustomLog directive</p>
<pre><code>CustomLog &quot;logs/access_log&quot; combined
</code></pre><p>with</p>
<pre><code>CustomLog logs/access_log blackboxSSLUser
</code></pre><p>That is</p>
<pre><code>...
    LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common

    &lt;IfModule logio_module&gt;
      # You need to enable mod_logio.c to use %I and %O
      LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %I %O&quot; combinedio
    &lt;/IfModule&gt;

    #
    # The location and format of the access logfile (Common Logfile Format).
    # If you do not define any access logfiles within a &lt;VirtualHost&gt;
    # container, they will be logged here.  Contrariwise, if you *do*
    # define per-&lt;VirtualHost&gt; access logfiles, transactions will be
    # logged therein and *not* in this file.
    #
    #CustomLog &quot;logs/access_log&quot; common

    #
    # If you prefer a logfile with access, agent, and referer information
    # (Combined Logfile Format) you can use the following directive.
    #
    CustomLog &quot;logs/access_log&quot; combined
&lt;/IfModule&gt;
...
</code></pre><p>becomes</p>
<pre><code>...
    LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common

    &lt;IfModule logio_module&gt;
      # You need to enable mod_logio.c to use %I and %O
      LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %I %O&quot; combinedio
      # Stroom Change: Start - Add new logformats
      LogFormat &quot;%a/%{REMOTE_PORT}e %X %t %l \&quot;%u\&quot; \&quot;%r\&quot; %s/%&gt;s %D %I/%O/%B \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %V/%p&quot; blackboxUser
      LogFormat &quot;%a/%{REMOTE_PORT}e %X %t %l \&quot;%{SSL_CLIENT_S_DN}x\&quot; \&quot;%r\&quot; %s/%&gt;s %D %I/%O/%B \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %V/%p&quot; blackboxSSLUser
      # Stroom Change: End
    &lt;/IfModule&gt;
    # Stroom Change: Start - Add new logformats without the additional byte values
    &lt;IfModule !logio_module&gt;
      LogFormat &quot;%a/%{REMOTE_PORT}e %X %t %l \&quot;%u\&quot; \&quot;%r\&quot; %s/%&gt;s %D 0/0/%B \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %V/%p&quot; blackboxUser
      LogFormat &quot;%a/%{REMOTE_PORT}e %X %t %l \&quot;%{SSL_CLIENT_S_DN}x\&quot; \&quot;%r\&quot; %s/%&gt;s %D 0/0/%B \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %V/%p&quot; blackboxSSLUser
    &lt;/IfModule&gt;
    # Stroom Change: End

    #
    # The location and format of the access logfile (Common Logfile Format).
    # If you do not define any access logfiles within a &lt;VirtualHost&gt;
    # container, they will be logged here.  Contrariwise, if you *do*
    # define per-&lt;VirtualHost&gt; access logfiles, transactions will be
    # logged therein and *not* in this file.
    #
    #CustomLog &quot;logs/access_log&quot; common

    #
    # If you prefer a logfile with access, agent, and referer information
    # (Combined Logfile Format) you can use the following directive.
    #
    # Stroom Change: Start - Make the access log use a new format
    # CustomLog &quot;logs/access_log&quot; combined
    CustomLog logs/access_log blackboxSSLUser
    # Stroom Change: End
&lt;/IfModule&gt;
...
</code></pre><p>Remember, deploy this file on all nodes.</p>
<h3 id="configuration-of-sslconf">Configuration of ssl.conf</h3>
<p>We modify <code>/etc/httpd/conf.d/ssl.conf</code> on all nodes, backing up first,</p>
<pre><code class="lang-base">cp /etc/httpd/conf.d/ssl.conf /etc/httpd/conf.d/ssl.conf.ORIG
</code></pre>
<p>The configuration of the <code>/etc/httpd/conf.d/ssl.conf</code> <strong>does</strong> change depending on the Stroom scenario deployed. In the following we will indicate
differences by tagged sub-headings. If the configuration applies irrespective of scenario, then <strong>All scenarios</strong> is the tag, else the tag indicated the
type of Stroom deployment.</p>
<h4 id="sslconf-http-to-https-redirection---all-scenarios">ssl.conf: HTTP to HTTPS Redirection - All scenarios</h4>
<p>Before the <virtualhost _default_:443=""> context we add http to https redirection by adding the directives (noting we specify the actual server name)</virtualhost></p>
<pre><code>&lt;VirtualHost *:80&gt;
  ServerName stroomp00.strmdev00.org
  Redirect permanent &quot;/&quot; &quot;https://stroomp00.strmdev00.org/&quot;
&lt;/VirtualHost&gt;
</code></pre><p>That is, we change</p>
<pre><code>...
## SSL Virtual Host Context
##

&lt;VirtualHost _default_:443&gt;
...
</code></pre><p>to</p>
<pre><code>...
## SSL Virtual Host Context
##

# Stroom Change: Start - Add http redirection to https
&lt;VirtualHost *:80&gt;
  ServerName stroomp00.strmdev00.org
  Redirect permanent &quot;/&quot; &quot;https://stroomp00.strmdev00.org/&quot;
&lt;/VirtualHost&gt;
# Stroom Change: End

&lt;VirtualHost _default_:443&gt;
</code></pre><h4 id="sslconf-virtualhost-directives---multi-node-application-and-proxy-deployment">ssl.conf: VirtualHost directives - Multi Node &apos;Application and Proxy&apos; deployment</h4>
<p>Within the <virtualhost _default_:443=""> context we set the directives, in this case, we use the CNAME <code>stroomp.strmdev00.org</code></virtualhost></p>
<pre><code>ServerName stroomp.strmdev00.org
JkMount /stroom* loadbalancer
JkMount /stroom/remoting/cluster* local
JkMount /stroom/datafeed* loadbalancer_proxy
JkMount /stroom/remoting* loadbalancer_proxy
JkMount /stroom/datafeed/direct* loadbalancer
JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories
</code></pre><p>That is, we change</p>
<pre><code>...
&lt;VirtualHost _default_:443&gt;

# General setup for the virtual host, inherited from global configuration
#DocumentRoot &quot;/var/www/html&quot;
#ServerName www.example.com:443

# Use separate log files for the SSL virtual host; note that LogLevel
# is not inherited from httpd.conf.
...
</code></pre><p>to</p>
<pre><code>...
&lt;VirtualHost _default_:443&gt;

# General setup for the virtual host, inherited from global configuration
#DocumentRoot &quot;/var/www/html&quot;
#ServerName www.example.com:443
# Stroom Change: Start - Set servername and mod_jk connectivity
ServerName stroomp.strmdev00.org
JkMount /stroom* loadbalancer
JkMount /stroom/remoting/cluster* local
JkMount /stroom/datafeed* loadbalancer_proxy
JkMount /stroom/remoting* loadbalancer_proxy
JkMount /stroom/datafeed/direct* loadbalancer
JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories
# Stroom Change: End

# Use separate log files for the SSL virtual host; note that LogLevel
# is not inherited from httpd.conf.
...
</code></pre><h4 id="sslconf-virtualhost-directives---standalone-or-forwarding-proxy-deployment">ssl.conf: VirtualHost directives - Standalone or Forwarding Proxy deployment</h4>
<p>Within the <virtualhost _default_:443=""> context set the directives, in this case, for a node named say <code>stroomfp0.strmdev00.org</code></virtualhost></p>
<pre><code>ServerName stroomfp0.strmdev00.org
JkMount /stroom/datafeed* local_proxy
JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories
</code></pre><p>That is, we change</p>
<pre><code>...
&lt;VirtualHost _default_:443&gt;

# General setup for the virtual host, inherited from global configuration
#DocumentRoot &quot;/var/www/html&quot;
#ServerName www.example.com:443

# Use separate log files for the SSL virtual host; note that LogLevel
# is not inherited from httpd.conf.
...
</code></pre><p>to</p>
<pre><code>...
&lt;VirtualHost _default_:443&gt;

# General setup for the virtual host, inherited from global configuration
#DocumentRoot &quot;/var/www/html&quot;
#ServerName www.example.com:443
# Stroom Change: Start - Set servername and mod_jk connectivity
ServerName stroomfp0.strmdev00.org
JkMount /stroom/datafeed* local_proxy
JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories
# Stroom Change: End

# Use separate log files for the SSL virtual host; note that LogLevel
# is not inherited from httpd.conf.
...
</code></pre><h4 id="sslconf-virtualhost-directives---single-node-application-and-proxy-deployment">ssl.conf: VirtualHost directives - Single Node &apos;Application and Proxy&apos; deployment</h4>
<p>Within the <virtualhost _default_:443=""> context set the directives, in this case, for a node name <code>stroomp00.strmdev00.org</code></virtualhost></p>
<pre><code>ServerName stroomp00.strmdev00.org
JkMount /stroom* local
JkMount /stroom/remoting/cluster* local
JkMount /stroom/datafeed* local_proxy
JkMount /stroom/remoting* local_proxy
JkMount /stroom/datafeed/direct* local
JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories
</code></pre><p>That is, we change</p>
<pre><code>...
&lt;VirtualHost _default_:443&gt;

# General setup for the virtual host, inherited from global configuration
#DocumentRoot &quot;/var/www/html&quot;
#ServerName www.example.com:443

# Use separate log files for the SSL virtual host; note that LogLevel
# is not inherited from httpd.conf.
...
</code></pre><p>to</p>
<pre><code>...
&lt;VirtualHost _default_:443&gt;

# General setup for the virtual host, inherited from global configuration
#DocumentRoot &quot;/var/www/html&quot;
#ServerName www.example.com:443
# Stroom Change: Start - Set servername and mod_jk connectivity
ServerName stroomp00.strmdev00.org
JkMount /stroom* local
JkMount /stroom/remoting/cluster* local
JkMount /stroom/datafeed* local_proxy
JkMount /stroom/remoting* local_proxy
JkMount /stroom/datafeed/direct* local
JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories
# Stroom Change: End

# Use separate log files for the SSL virtual host; note that LogLevel
# is not inherited from httpd.conf.
...
</code></pre><h4 id="sslconf-certificate-file-changes---all-scenarios">ssl.conf: Certificate file changes - All scenarios</h4>
<p>We replace the standard certificate files with the generated certificates. In the example below, we are using the multi node scenario, in
that the key file names are <code>stroomp.crt</code> and <code>stroomp.key</code>. For other scenarios, use the appropriate file names generated. We replace</p>
<pre><code>SSLCertificateFile /etc/pki/tls/certs/localhost.crt
</code></pre><p>with</p>
<pre><code>SSLCertificateFile /home/stroomuser/stroom-jks/public/stroomp.crt
</code></pre><p>and</p>
<pre><code>SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
</code></pre><p>with</p>
<pre><code>SSLCertificateKeyFile /home/stroomuser/stroom-jks/private/stroomp.key
</code></pre><p>That is, change</p>
<pre><code>...
# pass phrase.  Note that a kill -HUP will prompt again.  A new
# certificate can be generated using the genkey(1) command.
SSLCertificateFile /etc/pki/tls/certs/localhost.crt

#   Server Private Key:
#   If the key is not combined with the certificate, use this
#   directive to point at the key file.  Keep in mind that if
#   you&apos;ve both a RSA and a DSA private key you can configure
#   both in parallel (to also allow the use of DSA ciphers, etc.)
SSLCertificateKeyFile /etc/pki/tls/private/localhost.key

#   Server Certificate Chain:
#   Point SSLCertificateChainFile at a file containing the
...
</code></pre><p>to</p>
<pre><code>...
# pass phrase.  Note that a kill -HUP will prompt again.  A new
# certificate can be generated using the genkey(1) command.
# Stroom Change: Start - Replace with Stroom server certificate
# SSLCertificateFile /etc/pki/tls/certs/localhost.crt
SSLCertificateFile /home/stroomuser/stroom-jks/public/stroomp.crt
# Stroom Change: End

#   Server Private Key:
#   If the key is not combined with the certificate, use this
#   directive to point at the key file.  Keep in mind that if
#   you&apos;ve both a RSA and a DSA private key you can configure
#   both in parallel (to also allow the use of DSA ciphers, etc.)
# Stroom Change: Start - Replace with Stroom server private key file
# SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
SSLCertificateKeyFile /home/stroomuser/stroom-jks/private/stroomp.key
# Stroom Change: End

#   Server Certificate Chain:
#   Point SSLCertificateChainFile at a file containing the
...
</code></pre><h4 id="sslconf-certificate-bundleno-ca-verification---all-scenarios">ssl.conf: Certificate Bundle/NO-CA Verification - All scenarios</h4>
<p>If you have signed your Stroom server certificate with a Certificate Authority, then change</p>
<pre><code>SSLCACertificateFile /etc/pki/tls/certs/ca-bundle.crt
</code></pre><p>to be your own certificate bundle which you should probably store as <code>~stroomuser/stroom-jks/public/stroomp-ca-bundle.crt</code>.</p>
<p>Now if you are using a self signed certificate, you will need to set the Client Authentication to have a value of</p>
<pre><code>SSLVerifyClient optional_no_ca
</code></pre><p>noting that this may change if you actually use a CA.
That is, changing</p>
<pre><code>...
#   Client Authentication (Type):
#   Client certificate verification type and depth.  Types are
#   none, optional, require and optional_no_ca.  Depth is a
#   number which specifies how deeply to verify the certificate
#   issuer chain before deciding the certificate is not valid.
#SSLVerifyClient require
#SSLVerifyDepth  10

#   Access Control:
#   With SSLRequire you can do per-directory access control based
...
</code></pre><p>to</p>
<pre><code>...
#   Client Authentication (Type):
#   Client certificate verification type and depth.  Types are
#   none, optional, require and optional_no_ca.  Depth is a
#   number which specifies how deeply to verify the certificate
#   issuer chain before deciding the certificate is not valid.
#SSLVerifyClient require
#SSLVerifyDepth  10
# Stroom Change: Start - Set optional_no_ca (given we have a self signed certificate)
SSLVerifyClient optional_no_ca
# Stroom Change: End

#   Access Control:
#   With SSLRequire you can do per-directory access control based
...
</code></pre><h4 id="sslconf-servlet-protection---single-or-multi-node-scenarios-not-for-standaloneforwarding-proxy">ssl.conf: Servlet Protection - Single or Multi Node scenarios (not for Standalone/Forwarding Proxy)</h4>
<p>We now need to secure certain Stroom Application servlets, to ensure they are only accessed under appropriate control.</p>
<p>This set of servlets will be accessible by all nodes in the subnet 192.168.2 (as well as localhost). We achieve this by adding after the example Location directives</p>
<pre><code>&lt;Location ~ &quot;stroom/(status|echo|sessionList|debug)&quot; &gt;
 Require all denied
 Require ip 127.0.0.1 192.168.2
&lt;/Location&gt;
</code></pre><p>We further restrict the clustercall and export servlets to just the localhost. If we had multiple Stroom processing nodes, you would specify each node, or preferably, the subnet they are on. In our multi node case this is 192.168.2.</p>
<pre><code>&lt;Location ~ &quot;stroom/export/|stroom/remoting/clustercall.rpc&quot; &gt;
 Require all denied
 Require ip 127.0.0.1 192.168.2
&lt;/Location&gt;
</code></pre><p>That is, the following</p>
<pre><code>...
#            and %{TIME_WDAY} &gt;= 1 and %{TIME_WDAY} &lt;= 5 \
#            and %{TIME_HOUR} &gt;= 8 and %{TIME_HOUR} &lt;= 20       ) \
#           or %{REMOTE_ADDR} =~ m/^192\.76\.162\.[0-9]+$/
#&lt;/Location&gt;

#   SSL Engine Options:
#   Set various options for the SSL engine.
#   o FakeBasicAuth:
...
</code></pre><p>changes to</p>
<pre><code>...
#            and %{TIME_WDAY} &gt;= 1 and %{TIME_WDAY} &lt;= 5 \
#            and %{TIME_HOUR} &gt;= 8 and %{TIME_HOUR} &lt;= 20       ) \
#           or %{REMOTE_ADDR} =~ m/^192\.76\.162\.[0-9]+$/
#&lt;/Location&gt;

# Stroom Change: Start - Lock access to certain servlets
&lt;Location ~ &quot;stroom/(status|echo|sessionList|debug)&quot; &gt;
 Require all denied
 Require ip 127.0.0.1 192.168.2
&lt;/Location&gt;
# Lock these Servlets more securely - to just localhost and processing node(s)
&lt;Location ~ &quot;stroom/export/|stroom/remoting/clustercall.rpc&quot; &gt;
 Require all denied
 Require ip 127.0.0.1 192.168.2
&lt;/Location&gt;
# Stroom Change: End

#   SSL Engine Options:
#   Set various options for the SSL engine.
#   o FakeBasicAuth:
...
</code></pre><h4 id="sslconf-log-formats---all-scenarios">ssl.conf: Log formats - All scenarios</h4>
<p>Finally, as we make use of the Black Box Apache log format, we replace the standard format</p>
<pre><code>CustomLog logs/ssl_request_log \
        &quot;%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \&quot;%r\&quot; %b&quot;
</code></pre><p>with</p>
<pre><code>CustomLog logs/ssl_request_log blackboxSSLUser
</code></pre><p>That is, change</p>
<pre><code>...
#   Per-Server Logging:
#   The home of a custom SSL log file. Use this when you want a
#   compact non-error SSL logfile on a virtual host basis.
CustomLog logs/ssl_request_log \
          &quot;%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \&quot;%r\&quot; %b&quot;

&lt;/VirtualHost&gt;
</code></pre><p>to</p>
<pre><code>...
#   Per-Server Logging:
#   The home of a custom SSL log file. Use this when you want a
#   compact non-error SSL logfile on a virtual host basis.
# Stroom Change: Start - Change ssl_request log to use our BlackBox format
# CustomLog logs/ssl_request_log \
#           &quot;%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \&quot;%r\&quot; %b&quot;
CustomLog logs/ssl_request_log blackboxSSLUser
# Stroom Change: End

&lt;/VirtualHost&gt;
</code></pre><p>Remember, in the case of Multi node stroom Application servers, deploy this file on all servers.</p>
<h3 id="apache-modjk-configuration">Apache Mod_JK configuration</h3>
<p>Apache Mod_JK has two configuration files</p>
<ul>
<li>/etc/httpd/conf.d/mod_jk.conf - for the http server configuration</li>
<li>/etc/httpd/conf/workers.properties - to configure the Tomcat workers</li>
</ul>
<p>In multi node scenarios, <code>/etc/httpd/conf.d/mod_jk.conf</code> is the same on all servers, but the <code>/etc/httpd/conf/workers.properties</code> file is different.
The contents of these two configuration files differ depending on the Stroom deployment. The following provide the various deployment scenarios.</p>
<h4 id="modjk-multi-node-application-and-proxy-deployment">Mod_JK Multi Node Application and Proxy Deployment</h4>
<p>For a Stroom Multi node Application and Proxy server,</p>
<ul>
<li>we configure <code>/etc/httpd/conf.d/mod_jk.conf</code> as per</li>
</ul>
<pre><code class="lang-bash">F=/etc/httpd/conf.d/mod_jk.conf
printf &apos;LoadModule jk_module modules/mod_jk.so\n&apos; &gt; ${F}
printf &apos;JkWorkersFile conf/workers.properties\n&apos; &gt;&gt; ${F}
printf &apos;JkLogFile logs/mod_jk.log\n&apos; &gt;&gt; ${F}
printf &apos;JkLogLevel info\n&apos; &gt;&gt; ${F}
printf &apos;JkLogStampFormat  &quot;[%%a %%b %%d %%H:%%M:%%S %%Y]&quot;\n&apos; &gt;&gt; ${F}
printf &apos;JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories\n&apos; &gt;&gt; ${F}
printf &apos;JkRequestLogFormat &quot;%%w %%V %%T&quot;\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom* loadbalancer\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/remoting/cluster* local\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/datafeed* loadbalancer_proxy\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/remoting* loadbalancer_proxy\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/datafeed/direct* loadbalancer\n&apos; &gt;&gt; ${F}
printf &apos;# Note: Replaced JkShmFile logs/jk.shm due to SELinux issues. Refer to\n&apos; &gt;&gt; ${F}
printf &apos;# https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=225452\n&apos; &gt;&gt; ${F}
printf &apos;# The following makes use of the existing /run/httpd directory\n&apos; &gt;&gt; ${F}
printf &apos;JkShmFile run/jk.shm\n&apos; &gt;&gt; ${F}
printf &apos;&lt;Location /jkstatus/&gt;\n&apos; &gt;&gt; ${F}
printf &apos;  JkMount status\n&apos; &gt;&gt; ${F}
printf &apos;  Order deny,allow\n&apos; &gt;&gt; ${F}
printf &apos;  Deny from all\n&apos; &gt;&gt; ${F}
printf &apos;  Allow from 127.0.0.1\n&apos; &gt;&gt; ${F}
printf &apos;&lt;/Location&gt;\n&apos; &gt;&gt; ${F}
chmod 640 ${F}
</code></pre>
<ul>
<li>we configure <code>/etc/httpd/conf/workers.properties</code> as per</li>
</ul>
<p>Since we are deploying for a cluster with load balancing, we need a <em>workers.properties</em> file per node. Executing the following will result in two files (<em>workers.properties.stroomp00</em> and <em>workers.properties.stroomp01</em>) which should be deployed to their respective servers.</p>
<pre><code class="lang-bash">cd /tmp
# Set the list of nodes
Nodes=&quot;stroomp00.strmdev00.org stroomp01.strmdev00.org&quot;
for oN in ${Nodes}; do
  _n=`echo ${oN} | cut -f1 -d\.`
  (
  printf &apos;# Workers.properties for Stroom Cluster member: %s %s\n&apos; ${oN}
  printf &apos;worker.list=loadbalancer,loadbalancer_proxy,local,local_proxy,status\n&apos;
  L_t=&quot;&quot;
  Lp_t=&quot;&quot;
  for FQDN in ${Nodes}; do
    N=`echo ${FQDN} | cut -f1 -d\.`
    printf &apos;worker.%s.port=8009\n&apos; ${N}
    printf &apos;worker.%s.host=%s\n&apos; ${N} ${FQDN}
    printf &apos;worker.%s.type=ajp13\n&apos; ${N}
    printf &apos;worker.%s.lbfactor=1\n&apos; ${N}
    printf &apos;worker.%s.max_packet_size=65536\n&apos; ${N}
    printf &apos;worker.%s_proxy.port=9009\n&apos; ${N}
    printf &apos;worker.%s_proxy.host=%s\n&apos; ${N} ${FQDN}
    printf &apos;worker.%s_proxy.type=ajp13\n&apos; ${N}
    printf &apos;worker.%s_proxy.lbfactor=1\n&apos; ${N}
    printf &apos;worker.%s_proxy.max_packet_size=65536\n&apos; ${N}
    L_t=&quot;${L_t}${N},&quot;
    Lp_t=&quot;${Lp_t}${N}_proxy,&quot;
  done
  L=`echo $L_t | sed -e &apos;s/.$//&apos;`
  Lp=`echo $Lp_t | sed -e &apos;s/.$//&apos;`
  printf &apos;worker.loadbalancer.type=lb\n&apos;
  printf &apos;worker.loadbalancer.balance_workers=%s\n&apos; $L
  printf &apos;worker.loadbalancer.sticky_session=1\n&apos;
  printf &apos;worker.loadbalancer_proxy.type=lb\n&apos;
  printf &apos;worker.loadbalancer_proxy.balance_workers=%s\n&apos; $Lp
  printf &apos;worker.loadbalancer_proxy.sticky_session=1\n&apos;
  printf &apos;worker.local.type=lb\n&apos;
  printf &apos;worker.local.balance_workers=%s\n&apos; ${_n}
  printf &apos;worker.local.sticky_session=1\n&apos;
  printf &apos;worker.local_proxy.type=lb\n&apos;
  printf &apos;worker.local_proxy.balance_workers=%s_proxy\n&apos; ${_n}
  printf &apos;worker.local_proxy.sticky_session=1\n&apos;
  printf &apos;worker.status.type=status\n&apos;
  ) &gt; workers.properties.${_n}
  chmod 640 workers.properties.${_n}
done
</code></pre>
<p>Now depending in the node you are on, copy the relevant workers.properties.nodename file to /etc/httpd/conf/workers.properties. The following command makes this simple.</p>
<pre><code class="lang-bash">cp workers.properties.`hostname -s` /etc/httpd/conf/workers.properties
</code></pre>
<p>If you were to add an additional node to a multi node cluster, say the node <code>stroomp02.strmdev00.org</code>, then you would re-run the above script with</p>
<pre><code class="lang-bash">Nodes=&quot;stroomp00.strmdev00.org stroomp01.strmdev00.org stroomp02.strmdev00.org&quot;
</code></pre>
<p>then redeploy all three files to the respective servers. Also note, that for the newly created workers.properties files for the existing nodes to
take effect you will need to restart the Apache Httpd service on both nodes.</p>
<p>Remember, in multi node cluster deployments, the following files are the same and hence can be created on one node, but copied to the
others not forgetting to backup the other node&apos;s original files. That is, the files</p>
<ul>
<li>/var/www/html/index.html</li>
<li>/etc/httpd/conf.d/mod_jk.conf</li>
<li>/etc/httpd/conf/httpd.conf</li>
</ul>
<p>are to be the same on all nodes. Only the /etc/httpd/conf.d/ssl.conf and /etc/httpd/conf/workers.properties files change.</p>
<h4 id="modjk-standalone-or-forwarding-stroom-proxy-deployment">Mod_JK Standalone or Forwarding Stroom Proxy Deployment</h4>
<p>For a Stroom Standalone or Forwarding proxy,</p>
<ul>
<li>we configure <code>/etc/httpd/conf.d/mod_jk.conf</code> as per</li>
</ul>
<pre><code class="lang-bash">F=/etc/httpd/conf.d/mod_jk.conf
printf &apos;LoadModule jk_module modules/mod_jk.so\n&apos; &gt; ${F}
printf &apos;JkWorkersFile conf/workers.properties\n&apos; &gt;&gt; ${F}
printf &apos;JkLogFile logs/mod_jk.log\n&apos; &gt;&gt; ${F}
printf &apos;JkLogLevel info\n&apos; &gt;&gt; ${F}
printf &apos;JkLogStampFormat  &quot;[%%a %%b %%d %%H:%%M:%%S %%Y]&quot;\n&apos; &gt;&gt; ${F}
printf &apos;JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories\n&apos; &gt;&gt; ${F}
printf &apos;JkRequestLogFormat &quot;%%w %%V %%T&quot;\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/datafeed* local_proxy\n&apos; &gt;&gt; ${F}
printf &apos;# Note: Replaced JkShmFile logs/jk.shm due to SELinux issues. Refer to\n&apos; &gt;&gt; ${F}
printf &apos;# https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=225452\n&apos; &gt;&gt; ${F}
printf &apos;# The following makes use of the existing /run/httpd directory\n&apos; &gt;&gt; ${F}
printf &apos;JkShmFile run/jk.shm\n&apos; &gt;&gt; ${F}
printf &apos;&lt;Location /jkstatus/&gt;\n&apos; &gt;&gt; ${F}
printf &apos;  JkMount status\n&apos; &gt;&gt; ${F}
printf &apos;  Order deny,allow\n&apos; &gt;&gt; ${F}
printf &apos;  Deny from all\n&apos; &gt;&gt; ${F}
printf &apos;  Allow from 127.0.0.1\n&apos; &gt;&gt; ${F}
printf &apos;&lt;/Location&gt;\n&apos; &gt;&gt; ${F}
chmod 640 ${F}
</code></pre>
<ul>
<li>we configure <code>/etc/httpd/conf/workers.properties</code> as per</li>
</ul>
<p>The variable <strong>N</strong> in the script below is to be the node name (not FQDN) of your sever (i.e. stroomfp0).</p>
<pre><code class="lang-bash">N=stroomfp0
FQDN=`hostname -f`
F=/etc/httpd/conf/workers.properties
printf &apos;worker.list=local_proxy,status\n&apos; &gt; ${F}
printf &apos;worker.%s_proxy.port=9009\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s_proxy.host=%s\n&apos; ${N} ${FQDN} &gt;&gt; ${F}
printf &apos;worker.%s_proxy.type=ajp13\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s_proxy.lbfactor=1\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.local_proxy.type=lb\n&apos; &gt;&gt; ${F}
printf &apos;worker.local_proxy.balance_workers=%s_proxy\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.local_proxy.sticky_session=1\n&apos; &gt;&gt; ${F}
printf &apos;worker.status.type=status\n&apos; &gt;&gt; ${F}
chmod 640 ${F}
</code></pre>
<h4 id="modjk-single-node-application-and-proxy-deployment">Mod_JK Single Node Application and Proxy Deployment</h4>
<p>For a Stroom Single node Application and Proxy server,</p>
<ul>
<li>we configure <code>/etc/httpd/conf.d/mod_jk.conf</code> as per</li>
</ul>
<pre><code class="lang-bash">F=/etc/httpd/conf.d/mod_jk.conf
printf &apos;LoadModule jk_module modules/mod_jk.so\n&apos; &gt; ${F}
printf &apos;JkWorkersFile conf/workers.properties\n&apos; &gt;&gt; ${F}
printf &apos;JkLogFile logs/mod_jk.log\n&apos; &gt;&gt; ${F}
printf &apos;JkLogLevel info\n&apos; &gt;&gt; ${F}
printf &apos;JkLogStampFormat  &quot;[%%a %%b %%d %%H:%%M:%%S %%Y]&quot;\n&apos; &gt;&gt; ${F}
printf &apos;JkOptions +ForwardKeySize +ForwardURICompat +ForwardSSLCertChain -ForwardDirectories\n&apos; &gt;&gt; ${F}
printf &apos;JkRequestLogFormat &quot;%%w %%V %%T&quot;\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom* local\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/remoting/cluster* local\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/datafeed* local_proxy\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/remoting* local_proxy\n&apos; &gt;&gt; ${F}
printf &apos;JkMount /stroom/datafeed/direct* local\n&apos; &gt;&gt; ${F}
printf &apos;# Note: Replaced JkShmFile logs/jk.shm due to SELinux issues. Refer to\n&apos; &gt;&gt; ${F}
printf &apos;# https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=225452\n&apos; &gt;&gt; ${F}
printf &apos;# The following makes use of the existing /run/httpd directory\n&apos; &gt;&gt; ${F}
printf &apos;JkShmFile run/jk.shm\n&apos; &gt;&gt; ${F}
printf &apos;&lt;Location /jkstatus/&gt;\n&apos; &gt;&gt; ${F}
printf &apos;  JkMount status\n&apos; &gt;&gt; ${F}
printf &apos;  Order deny,allow\n&apos; &gt;&gt; ${F}
printf &apos;  Deny from all\n&apos; &gt;&gt; ${F}
printf &apos;  Allow from 127.0.0.1\n&apos; &gt;&gt; ${F}
printf &apos;&lt;/Location&gt;\n&apos; &gt;&gt; ${F}
chmod 640 ${F}
</code></pre>
<ul>
<li>we configure <code>/etc/httpd/conf/workers.properties</code> as per</li>
</ul>
<p>The variable <strong>N</strong> in the script below is to be the node name (not FQDN) of your sever (i.e. stroomp00).</p>
<pre><code class="lang-bash">N=stroomp00
FQDN=`hostname -f`
F=/etc/httpd/conf/workers.properties
printf &apos;worker.list=local,local_proxy,status\n&apos; &gt; ${F}
printf &apos;worker.%s.port=8009\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s.host=%s\n&apos; ${N} ${FQDN} &gt;&gt; ${F}
printf &apos;worker.%s.type=ajp13\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s.lbfactor=1\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s.max_packet_size=65536\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s_proxy.port=9009\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s_proxy.host=%s\n&apos; ${N} ${FQDN} &gt;&gt; ${F}
printf &apos;worker.%s_proxy.type=ajp13\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s_proxy.lbfactor=1\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.%s_proxy.max_packet_size=65536\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.local.type=lb\n&apos; &gt;&gt; ${F}
printf &apos;worker.local.balance_workers=%s\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.local.sticky_session=1\n&apos; &gt;&gt; ${F}
printf &apos;worker.local_proxy.type=lb\n&apos; &gt;&gt; ${F}
printf &apos;worker.local_proxy.balance_workers=%s_proxy\n&apos; ${N} &gt;&gt; ${F}
printf &apos;worker.local_proxy.sticky_session=1\n&apos; &gt;&gt; ${F}
printf &apos;worker.status.type=status\n&apos; &gt;&gt; ${F}
chmod 640 ${F}
</code></pre>
<h2 id="final-host-configuration-and-web-service-enablement">Final host configuration and web service enablement</h2>
<p>Now tidy up the SELinux context for access on all nodes and files via the commands</p>
<pre><code class="lang-bash">setsebool -P httpd_enable_homedirs on
setsebool -P httpd_can_network_connect on
chcon --reference /etc/httpd/conf.d/README /etc/httpd/conf.d/mod_jk.conf
chcon --reference /etc/httpd/conf/magic /etc/httpd/conf/workers.properties
</code></pre>
<p>We also enable both http and https services via the firewall on all nodes. If you don&apos;t want to present a http access point,
then don&apos;t enable it in the firewall setting. This is done with</p>
<pre><code class="lang-bash">firewall-cmd --zone=public --add-service=http --permanent
firewall-cmd --zone=public --add-service=https --permanent
firewall-cmd --reload
firewall-cmd --zone=public --list-all
</code></pre>
<p>Finally enable then start the httpd service, correcting any errors. It should be noted that on any errors,
the suggestion of a systemctl status or viewing the journal are good, but also review information in the httpd error logs found in <code>/var/log/httpd/</code>.</p>
<pre><code class="lang-bash">systemctl enable httpd.service
systemctl start httpd.service
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="InstallVolumesHowTo.html" class="navigation navigation-prev " aria-label="Previous page: Volumes">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="InstallCertificatesHowTo.html" class="navigation navigation-next " aria-label="Next page: Certificates">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Httpd","level":"4.4.9","depth":2,"next":{"title":"Certificates","level":"4.4.10","depth":2,"path":"HOWTOs/Install/InstallCertificatesHowTo.md","ref":"HOWTOs/Install/InstallCertificatesHowTo.md","articles":[]},"previous":{"title":"Volumes","level":"4.4.8","depth":2,"path":"HOWTOs/Install/InstallVolumesHowTo.md","ref":"HOWTOs/Install/InstallVolumesHowTo.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-highlight","github","anchorjs"],"styles":{"website":"build/gitbook.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/gchq/stroom-docs"},"theme-default":{"styles":{"website":"build/gitbook.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"anchorjs":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Stroom Docs","gitbook":"3.x.x"},"file":{"path":"HOWTOs/Install/InstallHttpdHowTo.md","mtime":"2021-05-20T20:59:05.825Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-05-20T21:00:36.412Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchorjs/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

