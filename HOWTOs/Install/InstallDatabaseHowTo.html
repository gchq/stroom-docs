
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Database Â· Stroom Docs</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="InstallHowTo.html" />
    
    
    <link rel="prev" href="InstallNodesHowTo.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">1. Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../screenshots.html">
            
                <a href="../../screenshots.html">
            
                    
                        <b>1.2.</b>
                    
                    Screenshots
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../quick-start-guide/quick-start.html">
            
                <a href="../../quick-start-guide/quick-start.html">
            
                    
                        <b>1.3.</b>
                    
                    Quick-start guide
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">2. Installation</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../install-guide/stroom-app-install.html">
            
                <a href="../../install-guide/stroom-app-install.html">
            
                    
                        <b>2.1.</b>
                    
                    Installing Stroom
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" >
            
                <span>
            
                    
                        <b>2.2.</b>
                    
                    Setup
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../../install-guide/setup/apache-forwarding.html">
            
                <a href="../../install-guide/setup/apache-forwarding.html">
            
                    
                        <b>2.2.1.</b>
                    
                    Apache forwarding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../../install-guide/setup/java-key-store-setup.html">
            
                <a href="../../install-guide/setup/java-key-store-setup.html">
            
                    
                        <b>2.2.2.</b>
                    
                    Java key store setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="../../install-guide/setup/mysql-server-setup.html">
            
                <a href="../../install-guide/setup/mysql-server-setup.html">
            
                    
                        <b>2.2.3.</b>
                    
                    MySQL server setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.4" data-path="../../install-guide/setup/processing-user-setup.html">
            
                <a href="../../install-guide/setup/processing-user-setup.html">
            
                    
                        <b>2.2.4.</b>
                    
                    Processing user setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.5" data-path="../../install-guide/setup/securing-stroom.html">
            
                <a href="../../install-guide/setup/securing-stroom.html">
            
                    
                        <b>2.2.5.</b>
                    
                    Securing Stroom
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../install-guide/upgrade-patch.html">
            
                <a href="../../install-guide/upgrade-patch.html">
            
                    
                        <b>2.3.</b>
                    
                    Upgrading and patching
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">3. User Guide</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../user-guide/nodes.html">
            
                <a href="../../user-guide/nodes.html">
            
                    
                        <b>3.1.</b>
                    
                    Nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../user-guide/volumes.html">
            
                <a href="../../user-guide/volumes.html">
            
                    
                        <b>3.2.</b>
                    
                    Volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../user-guide/tasks.html">
            
                <a href="../../user-guide/tasks.html">
            
                    
                        <b>3.3.</b>
                    
                    Tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../user-guide/feeds.html">
            
                <a href="../../user-guide/feeds.html">
            
                    
                        <b>3.4.</b>
                    
                    Feeds
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../user-guide/roles.html">
            
                <a href="../../user-guide/roles.html">
            
                    
                        <b>3.5.</b>
                    
                    Roles and permissions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../../user-guide/sending-data/">
            
                <a href="../../user-guide/sending-data/">
            
                    
                        <b>3.6.</b>
                    
                    Sending data to Stroom
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1" data-path="../../user-guide/sending-data/header-arguments.html">
            
                <a href="../../user-guide/sending-data/header-arguments.html">
            
                    
                        <b>3.6.1.</b>
                    
                    Header Arguments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.2" data-path="../../user-guide/sending-data/payloads.html">
            
                <a href="../../user-guide/sending-data/payloads.html">
            
                    
                        <b>3.6.2.</b>
                    
                    Payloads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.3" data-path="../../user-guide/sending-data/response-codes.html">
            
                <a href="../../user-guide/sending-data/response-codes.html">
            
                    
                        <b>3.6.3.</b>
                    
                    Response codes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.4" data-path="../../user-guide/sending-data/example-clients.html">
            
                <a href="../../user-guide/sending-data/example-clients.html">
            
                    
                        <b>3.6.4.</b>
                    
                    Example clients
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.5" data-path="../../user-guide/sending-data/java-keystores.html">
            
                <a href="../../user-guide/sending-data/java-keystores.html">
            
                    
                        <b>3.6.5.</b>
                    
                    SSL Java keystores
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6.6" data-path="../../user-guide/sending-data/ssl.html">
            
                <a href="../../user-guide/sending-data/ssl.html">
            
                    
                        <b>3.6.6.</b>
                    
                    SSL configuration
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../../user-guide/pipelines/">
            
                <a href="../../user-guide/pipelines/">
            
                    
                        <b>3.7.</b>
                    
                    Pipelines
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.7.1" data-path="../../user-guide/pipelines/parser/">
            
                <a href="../../user-guide/pipelines/parser/">
            
                    
                        <b>3.7.1.</b>
                    
                    Parser
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.7.1.1" data-path="../../user-guide/pipelines/parser/xml-fragments.html">
            
                <a href="../../user-guide/pipelines/parser/xml-fragments.html">
            
                    
                        <b>3.7.1.1.</b>
                    
                    XML fragments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.1.2" data-path="../../user-guide/pipelines/parser/context-data.html">
            
                <a href="../../user-guide/pipelines/parser/context-data.html">
            
                    
                        <b>3.7.1.2.</b>
                    
                    Context data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7.2" data-path="../../user-guide/pipelines/xslt/">
            
                <a href="../../user-guide/pipelines/xslt/">
            
                    
                        <b>3.7.2.</b>
                    
                    XSLT
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.7.2.1" data-path="../../user-guide/pipelines/xslt/xslt-includes.html">
            
                <a href="../../user-guide/pipelines/xslt/xslt-includes.html">
            
                    
                        <b>3.7.2.1.</b>
                    
                    XSLT includes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7.2.2" data-path="../../user-guide/pipelines/xslt/xslt-functions.html">
            
                <a href="../../user-guide/pipelines/xslt/xslt-functions.html">
            
                    
                        <b>3.7.2.2.</b>
                    
                    XSLT functions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7.3" data-path="../../user-guide/pipelines/file-output.html">
            
                <a href="../../user-guide/pipelines/file-output.html">
            
                    
                        <b>3.7.3.</b>
                    
                    File output
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="../../user-guide/dashboards/">
            
                <a href="../../user-guide/dashboards/">
            
                    
                        <b>3.8.</b>
                    
                    Dashboards
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1" data-path="../../user-guide/dashboards/queries.html">
            
                <a href="../../user-guide/dashboards/queries.html">
            
                    
                        <b>3.8.1.</b>
                    
                    Queries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8.2" data-path="../../user-guide/dashboards/dictionaries.html">
            
                <a href="../../user-guide/dashboards/dictionaries.html">
            
                    
                        <b>3.8.2.</b>
                    
                    Dictionaries
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="../../user-guide/security.html">
            
                <a href="../../user-guide/security.html">
            
                    
                        <b>3.9.</b>
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10" >
            
                <span>
            
                    
                        <b>3.10.</b>
                    
                    Data splitter
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.10.1" data-path="../../datasplitter/1-0-introduction.html">
            
                <a href="../../datasplitter/1-0-introduction.html">
            
                    
                        <b>3.10.1.</b>
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.10.1.1" data-path="../../datasplitter/1-1-simple-csv-example.html">
            
                <a href="../../datasplitter/1-1-simple-csv-example.html">
            
                    
                        <b>3.10.1.1.</b>
                    
                    Simple CSV example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.1.2" data-path="../../datasplitter/1-2-simple-csv-example-with-heading.html">
            
                <a href="../../datasplitter/1-2-simple-csv-example-with-heading.html">
            
                    
                        <b>3.10.1.2.</b>
                    
                    Simple CSV example with heading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.1.3" data-path="../../datasplitter/1-3-complex-example.html">
            
                <a href="../../datasplitter/1-3-complex-example.html">
            
                    
                        <b>3.10.1.3.</b>
                    
                    Complex example with regex and user defined names
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.1.4" data-path="../../datasplitter/1-4-multi-line-example.html">
            
                <a href="../../datasplitter/1-4-multi-line-example.html">
            
                    
                        <b>3.10.1.4.</b>
                    
                    Multi-line example
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.10.2" data-path="../../datasplitter/2-0-element-reference.html">
            
                <a href="../../datasplitter/2-0-element-reference.html">
            
                    
                        <b>3.10.2.</b>
                    
                    Element reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.10.2.1" data-path="../../datasplitter/2-1-content-providers.html">
            
                <a href="../../datasplitter/2-1-content-providers.html">
            
                    
                        <b>3.10.2.1.</b>
                    
                    Content providers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.2.2" data-path="../../datasplitter/2-2-expressions.html">
            
                <a href="../../datasplitter/2-2-expressions.html">
            
                    
                        <b>3.10.2.2.</b>
                    
                    Expressions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.2.3" data-path="../../datasplitter/2-3-variables.html">
            
                <a href="../../datasplitter/2-3-variables.html">
            
                    
                        <b>3.10.2.3.</b>
                    
                    Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.2.4" data-path="../../datasplitter/2-4-output.html">
            
                <a href="../../datasplitter/2-4-output.html">
            
                    
                        <b>3.10.2.4.</b>
                    
                    Output
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.10.3" data-path="../../datasplitter/3-0-match-references.html">
            
                <a href="../../datasplitter/3-0-match-references.html">
            
                    
                        <b>3.10.3.</b>
                    
                    Match references, variables and fixed strings
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.10.3.1" data-path="../../datasplitter/3-1-expression-match-references.html">
            
                <a href="../../datasplitter/3-1-expression-match-references.html">
            
                    
                        <b>3.10.3.1.</b>
                    
                    Expression match references
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.3.2" data-path="../../datasplitter/3-2-variable-reference.html">
            
                <a href="../../datasplitter/3-2-variable-reference.html">
            
                    
                        <b>3.10.3.2.</b>
                    
                    Variable reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.3.3" data-path="../../datasplitter/3-3-use-of-fixed-strings.html">
            
                <a href="../../datasplitter/3-3-use-of-fixed-strings.html">
            
                    
                        <b>3.10.3.3.</b>
                    
                    Use of fixed strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10.3.4" data-path="../../datasplitter/3-4-concatenation-of-references.html">
            
                <a href="../../datasplitter/3-4-concatenation-of-references.html">
            
                    
                        <b>3.10.3.4.</b>
                    
                    Concatenation of references
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">4. HOWTOs</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../StroomHowTos.html">
            
                <a href="../StroomHowTos.html">
            
                    
                        <b>4.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" >
            
                <span>
            
                    
                        <b>4.2.</b>
                    
                    General
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../General/FeedManagementHowTo.html">
            
                <a href="../General/FeedManagementHowTo.html">
            
                    
                        <b>4.2.1.</b>
                    
                    Feed Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../General/TasksHowTo.html">
            
                <a href="../General/TasksHowTo.html">
            
                    
                        <b>4.2.2.</b>
                    
                    Tasks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" >
            
                <span>
            
                    
                        <b>4.3.</b>
                    
                    Authentication
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../Authentication/UserLogoutHowTo.html">
            
                <a href="../Authentication/UserLogoutHowTo.html">
            
                    
                        <b>4.3.1.</b>
                    
                    User Logout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="../Authentication/UserLoginHowTo.html">
            
                <a href="../Authentication/UserLoginHowTo.html">
            
                    
                        <b>4.3.2.</b>
                    
                    User Login
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="../Authentication/CreateUserHowTo.html">
            
                <a href="../Authentication/CreateUserHowTo.html">
            
                    
                        <b>4.3.3.</b>
                    
                    Create User
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" >
            
                <span>
            
                    
                        <b>4.4.</b>
                    
                    Install
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="InstallNodesHowTo.html">
            
                <a href="InstallNodesHowTo.html">
            
                    
                        <b>4.4.1.</b>
                    
                    Nodes
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.4.2" data-path="InstallDatabaseHowTo.html">
            
                <a href="InstallDatabaseHowTo.html">
            
                    
                        <b>4.4.2.</b>
                    
                    Database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.3" data-path="InstallHowTo.html">
            
                <a href="InstallHowTo.html">
            
                    
                        <b>4.4.3.</b>
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.4" data-path="InstallProcessingUserSetupHowTo.html">
            
                <a href="InstallProcessingUserSetupHowTo.html">
            
                    
                        <b>4.4.4.</b>
                    
                    Processing User Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.5" data-path="InstallNFSHowTo.html">
            
                <a href="InstallNFSHowTo.html">
            
                    
                        <b>4.4.5.</b>
                    
                    NFS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.6" data-path="InstallTestingHowTo.html">
            
                <a href="InstallTestingHowTo.html">
            
                    
                        <b>4.4.6.</b>
                    
                    Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.7" data-path="InstallProxyHowTo.html">
            
                <a href="InstallProxyHowTo.html">
            
                    
                        <b>4.4.7.</b>
                    
                    Proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.8" data-path="InstallVolumesHowTo.html">
            
                <a href="InstallVolumesHowTo.html">
            
                    
                        <b>4.4.8.</b>
                    
                    Volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.9" data-path="InstallHttpdHowTo.html">
            
                <a href="InstallHttpdHowTo.html">
            
                    
                        <b>4.4.9.</b>
                    
                    Httpd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.10" data-path="InstallCertificatesHowTo.html">
            
                <a href="InstallCertificatesHowTo.html">
            
                    
                        <b>4.4.10.</b>
                    
                    Certificates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.11" data-path="InstallApplicationHowTo.html">
            
                <a href="InstallApplicationHowTo.html">
            
                    
                        <b>4.4.11.</b>
                    
                    Application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">5. Stroom Proxy</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../proxy/install.html">
            
                <a href="../../proxy/install.html">
            
                    
                        <b>5.1.</b>
                    
                    Installing Stroom proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../../proxy/docker.html">
            
                <a href="../../proxy/docker.html">
            
                    
                        <b>5.2.</b>
                    
                    Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../../proxy/apache-forwarding.html">
            
                <a href="../../proxy/apache-forwarding.html">
            
                    
                        <b>5.3.</b>
                    
                    Apache forwarding
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">6. Developer Guide</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../dev-guide/README.md">
            
                <span>
            
                    
                        <b>6.1.</b>
                    
                    Developer guide
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../../dev-guide/releasing.html">
            
                <a href="../../dev-guide/releasing.html">
            
                    
                        <b>6.1.1.</b>
                    
                    Releasing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2" data-path="../../dev-guide/stroom-in-an-ide.html">
            
                <a href="../../dev-guide/stroom-in-an-ide.html">
            
                    
                        <b>6.1.2.</b>
                    
                    Running Stroom from IntelliJ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.3" data-path="../../dev-guide/docker-running.html">
            
                <a href="../../dev-guide/docker-running.html">
            
                    
                        <b>6.1.3.</b>
                    
                    Running Stroom using Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.4" data-path="../../dev-guide/docker-building.html">
            
                <a href="../../dev-guide/docker-building.html">
            
                    
                        <b>6.1.4.</b>
                    
                    Building a Stroom Docker image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.5" data-path="../../dev-guide/gitbook.html">
            
                <a href="../../dev-guide/gitbook.html">
            
                    
                        <b>6.1.5.</b>
                    
                    Building GitBook documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.6" data-path="../../dev-guide/c">
            
                <span>
            
                    
                        <b>6.1.6.</b>
                    
                    C# Client
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Database</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="stroom-howto---database-installation">Stroom HOWTO - Database Installation</h1>
<p>This HOWTO describes the installation of the Stroom databases. Following this HOWTO will produce a simple, minimally secured database deployment. In a production environment consideration needs to be made for redundancy, better security, data-store location, increased memory usage, and the like.</p>
<p>Stroom has two databases. The first, <code>stroom</code>, is used for management of Stroom itself and the second, <code>statistics</code> is used for the Stroom Statistics capability. There are many ways to deploy these two databases. One could</p>
<ul>
<li>have a single database instance and serve both databases from it</li>
<li>have two database instances on the same server and serve one database per instance</li>
<li>have two separate nodes, each with it&apos;s own database instance</li>
<li>the list goes on.</li>
</ul>
<p>In this HOWTO, we describe the deployment of two database instances on the one node, each serving a single database. We provide example deployments using either the <a href="https://mariadb.com" title="MariaDB Site" target="_blank">MariaDB</a> or <a href="https://www.mysql.com/products/community/" title="MySQL Community Site" target="_blank">MySQL Community</a> versions of MySQL.</p>
<h2 id="assumptions">Assumptions</h2>
<ul>
<li>we are installing the MariaDB or MySQL Community RDBMS software.</li>
<li>the primary database node is &apos;stroomdb0.strmdev00.org&apos;.</li>
<li>installation is on a fully patched minimal Centos 7.3 instance.</li>
<li>we are installing BOTH databases (<code>stroom</code> and <code>statistics</code>) on the same node - &apos;stroomdb0.stromdev00.org&apos; but with two distinct database engines. The first database will communicate on port <code>3307</code> and the second on <code>3308</code>.</li>
<li>we are deploying with SELinux in enforcing mode.</li>
<li>any scripts or commands that should run are in code blocks and are designed to allow the user to cut then paste the commands onto their systems.</li>
<li>in this document, when a textual screen capture is documented, data entry is identified by the data surrounded by &apos;<__' '__="">&apos; . This excludes enter/return presses.</__'></li>
</ul>
<h2 id="installation-of-software">Installation of Software</h2>
<h3 id="mariadb-server-installation">MariaDB Server Installation</h3>
<p>As MariaDB is directly supported by Centos 7, we simply install the database server software and SELinux policy files, as per</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> yum -y <span class="token function">install</span> policycoreutils-python mariadb-server
</code></pre>
<h3 id="mysql-community-server-installation">MySQL Community Server Installation</h3>
<p>As MySQL is not directly supported by Centos 7, we need to install it&apos;s repository files prior to installation.
We get the current MySQL Community release repository rpm and validate it&apos;s MD5 checksum against the published value found on the
<a href="https://dev.mysql.com/downloads/repo/yum" title="Download MySQL Yum Repository" target="_blank">MySQL Yum Repository</a> site.</p>
<pre class="language-"><code class="lang-bash"><span class="token function">wget</span> https://repo.mysql.com/mysql57-community-release-el7.rpm
md5sum mysql57-community-release-el7.rpm
</code></pre>
<p>On correct validation of the MD5 checksum, we install the repository files via</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> yum -y localinstall mysql57-community-release-el7.rpm
</code></pre>
<p><strong>NOTE:</strong> Stroom currently does not support the latest production MySQL version - 5.7. You will need to install MySQL Version 5.6.</p>
<p>Now since we must use MySQL Version 5.6 you will need to edit the MySQL repo file <code>/etc/yum.repos.d/mysql-community.repo</code> to
disable the <code>mysql57-community</code> channel and enable the <code>mysql56-community</code> channel. We start by, backing up the repo file with</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /etc/yum.repos.d/mysql-community.repo /etc/yum.repos.d/mysql-community.repo.ORIG
</code></pre>
<p>Then edit the file to change</p>
<pre class="language-"><code>...
# Enable to use MySQL 5.6
[mysql56-community]
name=MySQL 5.6 Community Server
baseurl=http://repo.mysql.com/yum/mysql-5.6-community/el/7/$basearch/
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql

[mysql57-community]
name=MySQL 5.7 Community Server
baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql
...
</code></pre><p>to become</p>
<pre class="language-"><code>...
# Enable to use MySQL 5.6
[mysql56-community]
name=MySQL 5.6 Community Server
baseurl=http://repo.mysql.com/yum/mysql-5.6-community/el/7/$basearch/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql

[mysql57-community]
name=MySQL 5.7 Community Server
baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/7/$basearch/
enabled=0
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql
...
</code></pre><p>Next we install server software and SELinux policy files, as per</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> yum -y <span class="token function">install</span> policycoreutils-python mysql-community-server
</code></pre>
<h2 id="preparing-the-database-deployment">Preparing the Database Deployment</h2>
<h3 id="mariadb-variant">MariaDB Variant</h3>
<h4 id="create-and-instantiate-both-database-instances">Create and instantiate both database instances</h4>
<p>To set up two MariaDB database instances on the one node, we will use <code>mysql_multi</code> and systemd service templates. The <code>mysql_multi</code> utility is a capability that manages multiple MariaDB databases on the same node and systemd service templates manage multiple services from one configuration file.  A systemd service template is unique in that it has an <code>@</code> character before the <code>.service</code> suffix.</p>
<p>To use this multiple-instance capability, we need to create two data directories for each database instance and also replace the main MariaDB configuration file, <code>/etc/my.cnf</code>, with one that includes configuration of key options for each instance. We will name our instances, <code>mysqld0</code> and <code>mysqld1</code>. We will also create specific log files for each instance.</p>
<p>We will use the directories, <code>/var/lib/mysql-mysqld0</code> and <code>/var/lib/mysql-mysqld1</code> for the data directories and <code>/var/log/mariadb/mysql-mysqld0.log</code> and <code>/var/log/mariadb/mysql-mysqld1.log</code> for the log files. Note you should modify /etc/logrotate.d/mariadb to manage these log files. Note also, we need to set the appropriate SELinux file contexts on the created directories and any files.</p>
<p>We create the data directories and log files and set their respective SELinux contexts via</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> /var/lib/mysql-mysqld0
<span class="token function">sudo</span> <span class="token function">chown</span> mysql:mysql /var/lib/mysql-mysqld0
<span class="token function">sudo</span> semanage fcontext -a -t mysqld_db_t <span class="token string">&quot;/var/lib/mysql-mysqld0(/.*)?&quot;</span>
<span class="token function">sudo</span> restorecon -Rv /var/lib/mysql-mysqld0

<span class="token function">sudo</span> <span class="token function">touch</span> /var/log/mariadb/mysql-mysqld0.log
<span class="token function">sudo</span> <span class="token function">chown</span> mysql:mysql /var/log/mariadb/mysql-mysqld0.log
<span class="token function">sudo</span> chcon --reference<span class="token operator">=</span>/var/log/mariadb/mariadb.log /var/log/mariadb/mysql-mysqld0.log

<span class="token function">sudo</span> <span class="token function">mkdir</span> /var/lib/mysql-mysqld1
<span class="token function">sudo</span> <span class="token function">chown</span> mysql:mysql /var/lib/mysql-mysqld1
<span class="token function">sudo</span> semanage fcontext -a -t mysqld_db_t <span class="token string">&quot;/var/lib/mysql-mysqld1(/.*)?&quot;</span>
<span class="token function">sudo</span> restorecon -Rv /var/lib/mysql-mysqld1

<span class="token function">sudo</span> <span class="token function">touch</span> /var/log/mariadb/mysql-mysqld1.log
<span class="token function">sudo</span> <span class="token function">chown</span> mysql:mysql /var/log/mariadb/mysql-mysqld1.log
<span class="token function">sudo</span> chcon --reference<span class="token operator">=</span>/var/log/mariadb/mariadb.log /var/log/mariadb/mysql-mysqld1.log
</code></pre>
<p>We now initialise the our two database data directories via</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> mysql_install_db --user<span class="token operator">=</span>mysql --datadir<span class="token operator">=</span>/var/lib/mysql-mysqld0
<span class="token function">sudo</span> mysql_install_db --user<span class="token operator">=</span>mysql --datadir<span class="token operator">=</span>/var/lib/mysql-mysqld1
</code></pre>
<p>We now replace the  MySQL configuration file to set the options for each instance. Note that we will serve <code>mysqld0</code> and <code>mysqld1</code> via TCP ports <code>3307</code> and <code>3308</code> respectively. First backup the existing configuration file with</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /etc/my.cnf /etc/my.cnf.ORIG
</code></pre>
<p>then setup <code>/etc/my.cnf</code> as per</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">bash</span>
F<span class="token operator">=</span>/etc/my.cnf
<span class="token function">printf</span> <span class="token string">&apos;[mysqld_multi]\n&apos;</span> <span class="token operator">&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;mysqld = /usr/bin/mysqld_safe --basedir=/usr\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[mysqld0]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;port=3307\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;mysqld = /usr/bin/mysqld_safe --basedir=/usr\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;datadir=/var/lib/mysql-mysqld0/\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;socket=/var/lib/mysql-mysqld0/mysql.sock\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;pid-file=/var/run/mariadb/mysql-mysqld0.pid\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;log-error=/var/log/mariadb/mysql-mysqld0.log\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;# Disabling symbolic-links is recommended to prevent assorted security\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;# risks\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;symbolic-links=0\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[mysqld1]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;mysqld = /usr/bin/mysqld_safe --basedir=/usr\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;port=3308\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;datadir=/var/lib/mysql-mysqld1/\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;socket=/var/lib/mysql-mysqld1/mysql.sock\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;pid-file=/var/run/mariadb/mysql-mysqld1.pid\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;log-error=/var/log/mariadb/mysql-mysqld1.log\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;# Disabling symbolic-links is recommended to prevent assorted security risks\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;symbolic-links=0\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token keyword">exit</span> <span class="token comment" spellcheck="true"># To exit the root shell</span>
</code></pre>
<p>We also need to associate the ports with the <code>mysqld_port_t</code> SELinux context as per</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> semanage port -a -t mysqld_port_t -p tcp 3307
<span class="token function">sudo</span> semanage port -a -t mysqld_port_t -p tcp 3308
</code></pre>
<p>We next create the systemd service template as per</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">bash</span>
F<span class="token operator">=</span>/etc/systemd/system/mysqld@.service

<span class="token function">printf</span> <span class="token string">&apos;# Install in /etc/systemd/system\n&apos;</span> <span class="token operator">&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;# Enable via systemctl enable mysqld@0 or systemctl enable mysqld@1\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[Unit]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;Description=MySQL Multi Server for instance %%i\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;After=syslog.target\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;After=network.target\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[Service]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;User=mysql\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;Group=mysql\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;Type=forking\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;ExecStart=/usr/bin/mysqld_multi start %%i\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;ExecStop=/usr/bin/mysqld_multi stop %%i\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;Restart=always\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;PrivateTmp=true\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[Install]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;WantedBy=multi-user.target\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">chmod</span> 644 <span class="token variable">${F}</span>
<span class="token keyword">exit</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># to exit the root shell</span>
</code></pre>
<p>We next enable and start both instances via</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> systemctl <span class="token function">enable</span> mysqld@0
<span class="token function">sudo</span> systemctl <span class="token function">enable</span> mysqld@1
<span class="token function">sudo</span> systemctl start mysqld@0
<span class="token function">sudo</span> systemctl start mysqld@1
</code></pre>
<p>At this we should have both instances running. One should check each instance&apos;s log file for any errors.</p>
<h4 id="secure-each-database-instance">Secure each database instance</h4>
<p>We secure each database engine by running the <code>mysql_secure_installation</code> script. One should accept all defaults, which means the
only entry (aside from pressing returns) is the administrator (root) database password. Make a note of the password you use. In this case
we will use <code>Stroom5User@</code>.
The utility <code>mysql_secure_installation</code> expects to find the Linux socket file to access the database it&apos;s securing at <code>/var/lib/mysql/mysql.sock</code>.
Since we have used other locations, we temporarily link the real socket file to <code>/var/lib/mysql/mysql.sock</code> for each invocation of the
utility. Thus we execute</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">ln</span> /var/lib/mysql-mysqld0/mysql.sock /var/lib/mysql/mysql.sock
<span class="token function">sudo</span> mysql_secure_installation
</code></pre>
<p>to see</p>
<pre class="language-"><code>NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MariaDB to secure it, we&apos;ll need the current
password for the root user.  If you&apos;ve just installed MariaDB, and
you haven&apos;t set the root password yet, the password will be blank,
so you should just press enter here.

Enter current password for root (enter for none): 
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MariaDB
root user without the proper authorisation.

Set root password? [Y/n] 
New password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>__</span> <span class="token attr-name">Stroom5User@</span> <span class="token attr-name">__</span><span class="token punctuation">&gt;</span></span>
Re-enter new password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>__</span> <span class="token attr-name">Stroom5User@</span> <span class="token attr-name">__</span><span class="token punctuation">&gt;</span></span>
Password updated successfully!
Reloading privilege tables..
 ... Success!


By default, a MariaDB installation has an anonymous user, allowing anyone
to log into MariaDB without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n] 
 ... Success!

Normally, root should only be allowed to connect from &apos;localhost&apos;.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] 
 ... Success!

By default, MariaDB comes with a database named &apos;test&apos; that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n]
 - Dropping test database...
 ... Success!
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n]
... Success!

Cleaning up...

All done!  If you&apos;ve completed all of the above steps, your MariaDB
installation should now be secure.

Thanks for using MariaDB!
</code></pre><p>then we execute</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/mysql/mysql.sock
<span class="token function">sudo</span> <span class="token function">ln</span> /var/lib/mysql-mysqld1/mysql.sock /var/lib/mysql/mysql.sock
<span class="token function">sudo</span> mysql_secure_installation
<span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/mysql/mysql.sock
</code></pre>
<p>and process as before (for when running mysql_secure_installation). At this both database instances should be secure.</p>
<h3 id="mysql-community-variant">MySQL Community Variant</h3>
<h4 id="create-and-instantiate-both-database-instances">Create and instantiate both database instances</h4>
<p>To set up two MySQL database instances on the one node, we will use <code>mysql_multi</code> and systemd service templates. The <code>mysql_multi</code> utility is a capability that manages multiple MySQL databases on the same node and systemd service templates manage multiple services from one configuration file.  A systemd service template is unique in that it has an <code>@</code> character before the <code>.service</code> suffix.</p>
<p>To use this multiple-instance capability, we need to create two data directories for each database instance and also replace the main MySQL configuration file, <code>/etc/my.cnf</code>, with one that includes configuration of key options for each instance. We will name our instances, <code>mysqld0</code> and <code>mysqld1</code>. We will also create specific log files for each instance.</p>
<p>We will use the directories, <code>/var/lib/mysql-mysqld0</code> and <code>/var/lib/mysql-mysqld1</code> for the data directories and <code>/var/log/mysql-mysqld0.log</code> and <code>/var/log/mysql-mysqld1.log</code> for the log directories. Note you should modify /etc/logrotate.d/mysql to manage these log files. Note also, we need to set the appropriate SELinux file context on the created directories and files.</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> /var/lib/mysql-mysqld0
<span class="token function">sudo</span> <span class="token function">chown</span> mysql:mysql /var/lib/mysql-mysqld0
<span class="token function">sudo</span> semanage fcontext -a -t mysqld_db_t <span class="token string">&quot;/var/lib/mysql-mysqld0(/.*)?&quot;</span>
<span class="token function">sudo</span> restorecon -Rv /var/lib/mysql-mysqld0

<span class="token function">sudo</span> <span class="token function">touch</span> /var/log/mysql-mysqld0.log
<span class="token function">sudo</span> <span class="token function">chown</span> mysql:mysql /var/log/mysql-mysqld0.log
<span class="token function">sudo</span> chcon --reference<span class="token operator">=</span>/var/log/mysqld.log /var/log/mysql-mysqld0.log

<span class="token function">sudo</span> <span class="token function">mkdir</span> /var/lib/mysql-mysqld1
<span class="token function">sudo</span> <span class="token function">chown</span> mysql:mysql /var/lib/mysql-mysqld1 
<span class="token function">sudo</span> semanage fcontext -a -t mysqld_db_t <span class="token string">&quot;/var/lib/mysql-mysqld1(/.*)?&quot;</span>
<span class="token function">sudo</span> restorecon -Rv /var/lib/mysql-mysqld1

<span class="token function">sudo</span> <span class="token function">touch</span> /var/log/mysql-mysqld1.log
<span class="token function">sudo</span> <span class="token function">chown</span> mysql:mysql /var/log/mysql-mysqld1.log
<span class="token function">sudo</span> chcon --reference<span class="token operator">=</span>/var/log/mysqld.log /var/log/mysql-mysqld1.log
</code></pre>
<p>We now initialise the our two database data directories via</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> mysql_install_db --user<span class="token operator">=</span>mysql --datadir<span class="token operator">=</span>/var/lib/mysql-mysqld0
<span class="token function">sudo</span> mysql_install_db --user<span class="token operator">=</span>mysql --datadir<span class="token operator">=</span>/var/lib/mysql-mysqld1
</code></pre>
<p>Disable the default database via</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> systemctl disable mysqld
</code></pre>
<p>We now modify the  MySQL configuration file to set the options for each instance. Note that we will serve <code>mysqld0</code> and <code>mysqld1</code> via TCP ports <code>3307</code> and <code>3308</code> respectively.  First backup the existing configuration file with</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /etc/my.cnf /etc/my.cnf.ORIG
</code></pre>
<p>then setup <code>/etc/my.cnf</code> as per</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">bash</span>
F<span class="token operator">=</span>/etc/my.cnf
<span class="token function">printf</span> <span class="token string">&apos;[mysqld_multi]\n&apos;</span> <span class="token operator">&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;mysqld = /usr/bin/mysqld_safe --basedir=/usr\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[mysqld0]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;port=3307\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;mysqld = /usr/bin/mysqld_safe --basedir=/usr\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;datadir=/var/lib/mysql-mysqld0/\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;socket=/var/lib/mysql-mysqld0/mysql.sock\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;pid-file=/var/run/mysqld/mysql-mysqld0.pid\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;log-error=/var/log/mysql-mysqld0.log\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;# Disabling symbolic-links is recommended to prevent assorted security\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;# risks\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;symbolic-links=0\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[mysqld1]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;mysqld = /usr/bin/mysqld_safe --basedir=/usr\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;port=3308\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;datadir=/var/lib/mysql-mysqld1/\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;socket=/var/lib/mysql-mysqld1/mysql.sock\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;pid-file=/var/run/mysqld/mysql-mysqld1.pid\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;log-error=/var/log/mysql-mysqld1.log\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;# Disabling symbolic-links is recommended to prevent assorted security risks\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;symbolic-links=0\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token keyword">exit</span> <span class="token comment" spellcheck="true"># To exit the root shell</span>
</code></pre>
<p>We also need to associate the ports with the <code>mysqld_port_t</code> SELinux context as per</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> semanage port -a -t mysqld_port_t -p tcp 3307
<span class="token function">sudo</span> semanage port -a -t mysqld_port_t -p tcp 3308
</code></pre>
<p>We next create the systemd service template as per</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">bash</span>
F<span class="token operator">=</span>/etc/systemd/system/mysqld@.service

<span class="token function">printf</span> <span class="token string">&apos;# Install in /etc/systemd/system\n&apos;</span> <span class="token operator">&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;# Enable via systemctl enable mysqld@0 or systemctl enable mysqld@1\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[Unit]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;Description=MySQL Multi Server for instance %%i\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;After=syslog.target\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;After=network.target\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[Service]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;User=mysql\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;Group=mysql\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;Type=forking\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;ExecStart=/usr/bin/mysqld_multi start %%i\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;ExecStop=/usr/bin/mysqld_multi stop %%i\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;Restart=always\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;PrivateTmp=true\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;[Install]\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">printf</span> <span class="token string">&apos;WantedBy=multi-user.target\n&apos;</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${F}</span>
<span class="token function">chmod</span> 644 <span class="token variable">${F}</span>
<span class="token keyword">exit</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true"># to exit the root shell</span>
</code></pre>
<p>We next enable and start both instances via</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> systemctl <span class="token function">enable</span> mysqld@0
<span class="token function">sudo</span> systemctl <span class="token function">enable</span> mysqld@1
<span class="token function">sudo</span> systemctl start mysqld@0
<span class="token function">sudo</span> systemctl start mysqld@1
</code></pre>
<p>At this we should have both instances running. One should check each instance&apos;s log file for any errors.</p>
<h4 id="secure-each-database-instance">Secure each database instance</h4>
<p>We secure each database engine by running the <code>mysql_secure_installation</code> script. One should accept all defaults, which means the
only entry (aside from pressing returns) is the administrator (root) database password. Make a note of the password you use. In this case
we will use <code>Stroom5User@</code>.
The utility <code>mysql_secure_installation</code> expects to find the Linux socket file to access the database it&apos;s securing at <code>/var/lib/mysql/mysql.sock</code>.
Since we have used other locations, we temporarily link the real socket file to <code>/var/lib/mysql/mysql.sock</code> for each invocation of the
utility. Thus we execute</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">ln</span> /var/lib/mysql-mysqld0/mysql.sock /var/lib/mysql/mysql.sock
<span class="token function">sudo</span> mysql_secure_installation
</code></pre>
<p>to see</p>
<pre class="language-"><code>NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MySQL
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MySQL to secure it, we&apos;ll need the current
password for the root user.  If you&apos;ve just installed MySQL, and
you haven&apos;t set the root password yet, the password will be blank,
so you should just press enter here.

Enter current password for root (enter for none): 
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MySQL
root user without the proper authorisation.

Set root password? [Y/n] y
New password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>__</span> <span class="token attr-name">Stroom5User@</span> <span class="token attr-name">__</span><span class="token punctuation">&gt;</span></span>
Re-enter new password: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>__</span> <span class="token attr-name">Stroom5User@</span> <span class="token attr-name">__</span><span class="token punctuation">&gt;</span></span>
Password updated successfully!
Reloading privilege tables..
 ... Success!


By default, a MySQL installation has an anonymous user, allowing anyone
to log into MySQL without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n] 
 ... Success!

Normally, root should only be allowed to connect from &apos;localhost&apos;.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] 
 ... Success!

By default, MySQL comes with a database named &apos;test&apos; that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n] 
 - Dropping test database...
ERROR 1008 (HY000) at line 1: Can&apos;t drop database &apos;test&apos;; database doesn&apos;t exist
 ... Failed!  Not critical, keep moving...
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n] 
 ... Success!




All done!  If you&apos;ve completed all of the above steps, your MySQL
installation should now be secure.

Thanks for using MySQL!


Cleaning up...
</code></pre><p>then we execute</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/mysql/mysql.sock
<span class="token function">sudo</span> <span class="token function">ln</span> /var/lib/mysql-mysqld1/mysql.sock /var/lib/mysql/mysql.sock
<span class="token function">sudo</span> mysql_secure_installation
<span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/mysql/mysql.sock
</code></pre>
<p>and process as before (for when running mysql_secure_installation). At this both database instances should be secure.</p>
<h2 id="create-the-databases-and-enable-access-by-the-stroom-processing-users">Create the Databases and Enable access by the Stroom processing users</h2>
<p>We now create the <code>stroom</code> database within the first instance, <code>mysqld0</code> and the <code>statistics</code> database within the second
instance <code>mysqld1</code>. It does not matter which database variant used as all commands are the same for both.</p>
<p>As well as creating the databases, we also need to establish the Stroom processing users
that the Stroom processing nodes will use to access each database.
For the <code>stroom</code> database, we will use the database user <code>stroomuser</code> with a password of <code>Stroompassword1@</code> and for the <code>statistics</code> database, we will use the database user <code>stroomstats</code> with a password of <code>Stroompassword2@</code>. One identifies a processing user as <code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">&gt;</span></span>@<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span><span class="token punctuation">&gt;</span></span></code> on a <code>grant</code> SQL command.</p>
<p>In the <code>stroom</code> database instance, we will grant access for</p>
<ul>
<li>stroomuser@localhost for local access for maintenance etc.</li>
<li>stroomuser@stroomp00.strmdev00.org for access by processing node stroomp00.strmdev00.org</li>
<li>stroomuser@stroomp01.strmdev00.org for access by processing node stroomp01.strmdev00.org</li>
</ul>
<p>and in the <code>statistics</code> database instance, we will grant access for</p>
<ul>
<li>stroomstats@localhost for local access for maintenance etc.</li>
<li>stroomstats@stroomp00.strmdev00.org for access by processing node stroomp00.strmdev00.org</li>
<li>stroomstats@stroomp01.strmdev00.org for access by processing node stroomp01.strmdev00.org</li>
</ul>
<p>Thus for the <code>stroom</code> database we execute</p>
<pre class="language-"><code class="lang-bash">mysql --user<span class="token operator">=</span>root --port<span class="token operator">=</span>3307 --socket<span class="token operator">=</span>/var/lib/mysql-mysqld0/mysql.sock --password
</code></pre>
<p>and on entering the administrator&apos;s password, we arrive at the <code>MariaDB [(none)]&gt;</code> or <code>mysql&gt;</code> prompt. At this we create the database with</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> stroom<span class="token punctuation">;</span>
</code></pre>
<p>and then to establish the users, we execute</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> stroom<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> stroomuser<span class="token variable">@localhost</span> identified <span class="token keyword">by</span> <span class="token string">&apos;Stroompassword1@&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> stroom<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> stroomuser<span class="token variable">@stroomp00.strmdev00.org</span> identified <span class="token keyword">by</span> <span class="token string">&apos;Stroompassword1@&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> stroom<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> stroomuser<span class="token variable">@stroomp01.strmdev00.org</span> identified <span class="token keyword">by</span> <span class="token string">&apos;Stroompassword1@&apos;</span><span class="token punctuation">;</span>
</code></pre>
<p>then</p>
<pre class="language-"><code class="lang-sql">quit<span class="token punctuation">;</span>
</code></pre>
<p>to exit.</p>
<p>And for the <code>statistics</code> database </p>
<pre class="language-"><code class="lang-bash">mysql --user<span class="token operator">=</span>root --port<span class="token operator">=</span>3308 --socket<span class="token operator">=</span>/var/lib/mysql-mysqld1/mysql.sock --password
</code></pre>
<p>with</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token keyword">statistics</span><span class="token punctuation">;</span>
</code></pre>
<p>and then to establish the users, we execute</p>
<pre class="language-"><code class="lang-sql"><span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token keyword">statistics</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> stroomstats<span class="token variable">@localhost</span> identified <span class="token keyword">by</span> <span class="token string">&apos;Stroompassword2@&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token keyword">statistics</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> stroomstats<span class="token variable">@stroomp00.strmdev00.org</span> identified <span class="token keyword">by</span> <span class="token string">&apos;Stroompassword2@&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token keyword">statistics</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> stroomstats<span class="token variable">@stroomp01.strmdev00.org</span> identified <span class="token keyword">by</span> <span class="token string">&apos;Stroompassword2@&apos;</span><span class="token punctuation">;</span>
</code></pre>
<p>then</p>
<pre class="language-"><code class="lang-sql">quit<span class="token punctuation">;</span>
</code></pre>
<p>to exit.</p>
<p>Clearly if we need to add more processing nodes, additional <code>grant</code> commands would be used. Further, if we were installing the databases in a single node Stroom environment, we would just have the first two pairs of <code>grants</code>.</p>
<h2 id="configure-firewall">Configure Firewall</h2>
<p>Next we need to modify our firewall to allow remote access to our databases which listens on ports 3307 and 3308.
The simplest way to achieve this is with the commands</p>
<pre class="language-"><code class="lang-bash"><span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>3307/tcp --permanent
<span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>3308/tcp --permanent
<span class="token function">sudo</span> firewall-cmd --reload
<span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>public --list-all
</code></pre>
<p><strong>Note</strong> that this allows ANY node to connect to your databases. You should give consideration to restricting this to only allowing processing node access.</p>
<h3 id="debugging-of-mariadb-for-stroom">Debugging of Mariadb for Stroom</h3>
<p>If there is a need to debug the Mariadb database and Stroom interaction, one can turn on auditing for the Mariadb service.
To do so, log onto the relevant database as the administrative user as per</p>
<pre class="language-"><code class="lang-bash">mysql --user<span class="token operator">=</span>root --port<span class="token operator">=</span>3307 --socket<span class="token operator">=</span>/var/lib/mysql-mysqld0/mysql.sock --password
or
mysql --user<span class="token operator">=</span>root --port<span class="token operator">=</span>3308 --socket<span class="token operator">=</span>/var/lib/mysql-mysqld1/mysql.sock --password
</code></pre>
<p>and at the <code>MariaDB [(none)]&gt;</code> prompt enter</p>
<pre class="language-"><code class="lang-bash"><span class="token function">install</span> plugin server_audit SONAME <span class="token string">&apos;server_audit&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> global server_audit_file_path<span class="token operator">=</span><span class="token string">&apos;/var/log/mariadb/mysqld-mysqld0_server_audit.log&apos;</span><span class="token punctuation">;</span>
or
<span class="token keyword">set</span> global server_audit_file_path<span class="token operator">=</span><span class="token string">&apos;/var/log/mariadb/mysqld-mysqld1_server_audit.log&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> global server_audit_logging<span class="token operator">=</span>ON<span class="token punctuation">;</span>
<span class="token keyword">set</span> global server_audit_file_rotate_size<span class="token operator">=</span>10485760<span class="token punctuation">;</span>
<span class="token function">install</span> plugin SQL_ERROR_LOG soname <span class="token string">&apos;sql_errlog&apos;</span><span class="token punctuation">;</span>
quit<span class="token punctuation">;</span>
</code></pre>
<p>The above will generate two log files, </p>
<ul>
<li><code>/var/log/mariadb/mysqld-mysqld0_server_audit.log</code> or <code>/var/log/mariadb/mysqld-mysqld1_server_audit.log</code> which records all commands the respective databases run. We have configured the log file will rotate at 10MB in size.</li>
<li><code>/var/lib/mysql-mysqld0/sql_errors.log</code> or <code>/var/lib/mysql-mysqld1/sql_errors.log</code> which records all erroneous SQL commands. This log file will rotate at 10MB in size. Note we cannot set this filename via the UI, but it will be appear in the data directory.
All files will, by default, generate up to 9 rotated files.</li>
</ul>
<p>If you wish to rotate a log file manually, log into the database as the administrative user and execute either</p>
<ul>
<li><code>set global server_audit_file_rotate_now=1;</code> to rotate the audit log file</li>
<li><code>set global sql_error_log_rotate=1;</code> to rotate the sql_errlog log file</li>
</ul>
<h3 id="initial-database-access">Initial Database Access</h3>
<p>It should be noted that if you monitor the sql_errors.log log file on a new Stooom deployment, when the Stoom Application first starts, it&apos;s initial access to the <code>stroom</code> database will result in the following attempted sql statements.</p>
<pre class="language-"><code class="lang-sql"><span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">16</span>:<span class="token number">24</span>:<span class="token number">50</span> stroomuser<span class="token punctuation">[</span>stroomuser<span class="token punctuation">]</span> @ stroomp00<span class="token punctuation">.</span>strmdev00<span class="token punctuation">.</span>org <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">2.126</span><span class="token punctuation">]</span> ERROR <span class="token number">1146</span>: <span class="token keyword">Table</span> <span class="token string">&apos;stroom.schema_version&apos;</span> doesn<span class="token string">&apos;t exist : SELECT version FROM schema_version ORDER BY installed_rank DESC
2017-04-16 16:24:50 stroomuser[stroomuser] @ stroomp00.strmdev00.org [192.168.2.126] ERROR 1146: Table &apos;</span>stroom<span class="token punctuation">.</span>STROOM_VER<span class="token string">&apos; doesn&apos;</span>t exist : <span class="token keyword">SELECT</span> VER_MAJ<span class="token punctuation">,</span> VER_MIN<span class="token punctuation">,</span> VER_PAT <span class="token keyword">FROM</span> STROOM_VER <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> VER_MAJ <span class="token keyword">DESC</span><span class="token punctuation">,</span> VER_MIN <span class="token keyword">DESC</span><span class="token punctuation">,</span> VER_PAT <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span>
<span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">16</span>:<span class="token number">24</span>:<span class="token number">50</span> stroomuser<span class="token punctuation">[</span>stroomuser<span class="token punctuation">]</span> @ stroomp00<span class="token punctuation">.</span>strmdev00<span class="token punctuation">.</span>org <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">2.126</span><span class="token punctuation">]</span> ERROR <span class="token number">1146</span>: <span class="token keyword">Table</span> <span class="token string">&apos;stroom.FD&apos;</span> doesn<span class="token string">&apos;t exist : SELECT ID FROM FD LIMIT 1
2017-04-16 16:24:50 stroomuser[stroomuser] @ stroomp00.strmdev00.org [192.168.2.126] ERROR 1146: Table &apos;</span>stroom<span class="token punctuation">.</span>FEED<span class="token string">&apos; doesn&apos;</span>t exist : <span class="token keyword">SELECT</span> ID <span class="token keyword">FROM</span> FEED <span class="token keyword">LIMIT</span> <span class="token number">1</span>
</code></pre>
<p>After this access the application will realise the database does not exist and it will initialise the database.</p>
<p>In the case of the <code>statistics</code> database you may note the following attempted access</p>
<pre class="language-"><code class="lang-sql"><span class="token number">2017</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">16</span>:<span class="token number">25</span>:<span class="token number">09</span> stroomstats<span class="token punctuation">[</span>stroomstats<span class="token punctuation">]</span> @ stroomp00<span class="token punctuation">.</span>strmdev00<span class="token punctuation">.</span>org <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">2.126</span><span class="token punctuation">]</span> ERROR <span class="token number">1146</span>: <span class="token keyword">Table</span> <span class="token string">&apos;statistics.schema_version&apos;</span> doesn&apos;t exist : <span class="token keyword">SELECT</span> version <span class="token keyword">FROM</span> schema_version <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> installed_rank <span class="token keyword">DESC</span>
</code></pre>
<p>Again, at this point the application will initialise this database.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="InstallNodesHowTo.html" class="navigation navigation-prev " aria-label="Previous page: Nodes">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="InstallHowTo.html" class="navigation navigation-next " aria-label="Next page: Install">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Database","level":"4.4.2","depth":2,"next":{"title":"Install","level":"4.4.3","depth":2,"path":"HOWTOs/Install/InstallHowTo.md","ref":"HOWTOs/Install/InstallHowTo.md","articles":[]},"previous":{"title":"Nodes","level":"4.4.1","depth":2,"path":"HOWTOs/Install/InstallNodesHowTo.md","ref":"HOWTOs/Install/InstallNodesHowTo.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","github","anchorjs"],"styles":{"website":"build/gitbook.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/gchq/stroom-docs"},"theme-default":{"styles":{"website":"build/gitbook.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"prism":{},"anchorjs":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Stroom Docs","gitbook":"3.x.x"},"file":{"path":"HOWTOs/Install/InstallDatabaseHowTo.md","mtime":"2017-05-19T12:57:35.098Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-05-19T12:59:05.436Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

